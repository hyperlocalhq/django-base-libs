/*##################################################|*//* #CMS.PLACEHOLDERS# */CMS.$(document).ready(function(e){e=CMS.$||e;CMS.Placeholders=CMS.Class.$extend({options:{debug:!1,edit_mode:!1,lang:{move_warning:"",delete_request:"",cancel:"Cancel"}},initialize:function(t,n){this.options=e.extend(this.options,n);this.wrapper=e(t);this.toolbar=this.wrapper.find("#cms_toolbar-toolbar");this.dim=this.wrapper.find("#cms_placeholder-dim");this.frame=this.wrapper.find("#cms_placeholder-content");this.timer=null;this.overlay=this.wrapper.find("#cms_placeholder-overlay");this.overlayIsHidden=!1;this.success=this.wrapper.find("#cms_placeholder-success");this._setup()},_setup:function(){var e=this;this.dim.data("dimmed",!1);this.frame.data("collapsed",!0);this.overlay.bind("mouseleave",function(){e.hideOverlay()});this.overlay.find(".cms_placeholder-overlay_bg").bind("click",function(){e.hideOverlay();e.overlay.css("visibility","hidden");setTimeout(function(){e.overlayIsHidden=!0},100)})},addPlugin:function(t,n,r){var i=this;e.ajax({type:"POST",url:n,data:t,success:function(e){i.editPlugin.call(i,t.placeholder_id,e,r)},error:function(e){if(!(e.status<500))throw new Error("CMS.Placeholders was unable to perform this ajax request. Try again or contact the developers.");alert(e.responseText)}})},editPlugin:function(t,n,r){var i=this,s=this.frame.find(".cms_placeholder-content_inner"),o=!1;if(CMS.API.Toolbar.isToolbarHidden()){CMS.API.Toolbar.toggleToolbar();o=!0}this.toggleFrame();this.toggleDim();var u=e("<iframe />",{id:"cms_placeholder-iframe",src:r+t+"/edit-plugin/"+n+"/?popup=true&no_preview",style:"width:100%; height:0; border:none; overflow:auto;",allowtransparency:!0,scrollbars:"no",frameborder:0});s.html(u);e("#cms_placeholder-iframe").load(function(){setTimeout(function(){var t=e("#cms_placeholder-iframe").contents().find("body").outerHeight(!0)+26;e("#cms_placeholder-iframe").animate({height:t},500)},100);s.removeClass("cms_placeholder-content_loader");var t=e(this).contents().find('input[name^="_save"]');t.addClass("default").css("float","none");t.bind("click",function(){o&&!CMS.API.Toolbar.isToolbarHidden()&&CMS.API.Toolbar.toggleToolbar()});var n=e(this).contents().find('input[name^="_cancel"]');n.bind("click",function(e){e.preventDefault();i.toggleFrame();i.toggleDim();o&&!CMS.API.Toolbar.isToolbarHidden()&&CMS.API.Toolbar.toggleToolbar()});e(this).contents().find("#footer").css("padding",0)});e(document.body).css("min-height",this.frame.outerHeight(!0))},deletePlugin:function(t,n,r){var i=this.options.lang.delete_request,s=confirm(i,!0);s&&e.ajax({type:"POST",url:r,data:{plugin_id:n},success:function(){t.parent().hasClass("cms_multi")?t.parent().remove():t.remove()},error:function(){throw new Error("CMS.Placeholders was unable to perform this ajax request. Try again or contact the developers.")}})},movePluginPosition:function(t,n,r,i){function h(){var r,i=!1;if(t==="moveup"&&f!==l+1){i=!0;r=e(a[f-1])}t==="movedown"&&f!==-1&&(r=e(a[f+1]));t==="moveup"&&f===l+1&&(r=e(a[f-2]));if(t==="movedown"&&f===-1){r=e(a[f+1]);i=!0}var o=r.attr("id").split("-")[1];i?n.insertBefore(r):n.insertAfter(r);s.hideOverlay();s.success.css({width:n.width()-2,height:n.height()-2,left:n.offset().left,top:n.offset().top}).show().fadeOut(1e3)}var s=this,o=e(n).attr("id").split("-")[1],u=e("#cms_placeholder_multi-"+o);u.length>0&&(n=u);var a=n.siblings(".cms_moveable").andSelf(),f=a.index(n),l=a.length;if(l<=1){alert(this.options.lang.move_warning);return!1}var c=[];a.each(function(t,n){if(e(n).hasClass("cms_multi"))var r=e(n).attr("id").split("-")[1],n=e("#cms_placeholder-"+r);c.push(e(n).data("options").plugin_id)});c.splice(f,1);f<=0&&t==="moveup"?f=l+1:f>=l-1&&t==="movedown"&&(f=-1);t==="moveup"&&c.splice(f-1,0,r.plugin_id);t==="movedown"&&c.splice(f+1,0,r.plugin_id);e.ajax({type:"POST",url:i,data:{ids:c.join("_")},success:h,error:function(e){if(!(e.status<500))throw new Error("CMS.Placeholders was unable to perform this ajax request. Try again or contact the developers.");alert(e.responseText)}})},morePluginOptions:function(t,n,r,i){function c(n){var r=e('.cms_placeholder[class$="cms_placeholder::'+n+'"]'),i=r.length;i===0?t.insertAfter(e('.cms_placeholder-bar[class$="cms_placeholder_slot::'+n+'"]')):t.insertAfter(e(r.toArray()[i-1]));s.hideOverlay();s.success.css({width:t.width()-2,height:t.height()-2,left:t.offset().left,top:t.offset().top}).show().fadeOut(1e3);var o=t.attr("class").split("::");o.pop();o.push(n);o=o.join("::");t.attr("class",o)}var s=this,o=[];e(".cms_placeholder-bar").each(function(t,n){o.push(e(n).attr("class").split("::")[1])});var u=t.attr("class").split("::")[1],a=e.inArray(u,o);o.splice(a,1);var f=s.overlay.find(".cms_placeholder-options_more");f.show();var l=f.find(".move ul");o.length&&l.html("");e(o).each(function(t,r){var i=e('.cms_placeholder-bar[class$="cms_placeholder_slot::'+r+'"]').find(".cms_placeholder-title").text();l.append(e('<li><a href="">'+i+"</a></li>").data({slot:r,placeholder_id:n.placeholder,plugin_id:n.plugin_id}))});l.find("a").bind("click",function(t){t.preventDefault();var n=e(this).parent().data("slot"),i=e(this).parent().data("placeholder_id");e.ajax({type:"POST",url:r,data:{placeholder:n,placeholder_id:i,plugin_id:e(this).parent().data("plugin_id")},success:function(){c(n)},error:function(e){if(!(e.status<500))throw new Error("CMS.Placeholders was unable to perform this ajax request. Try again or contact the developers.");alert(e.responseText)}})});var h=f.find(".add_child");if(i.allow_children){h.show();plugin_list=h.find("ul");plugin_list.html("");for(var p=0;p<i.child_classes.length;p++){var d=i.child_classes[p].class_name,v=i.child_classes[p].plugin_name;plugin_list.append(e('<li><a href="" rel="type::'+d+'">'+v+"</a></li>").data({class_name:d,placeholder_id:n.placeholder,plugin_id:n.plugin_id}))}plugin_list.find("a").bind("click",function(t){t.preventDefault();var r=e(this).parent().data("slot"),s=e(this).parent().data("placeholder_id"),o={parent_id:n.plugin_id,plugin_type:e(this).attr("rel").split("::")[1]};CMS.API.Placeholders.addPlugin(o,i.urls.add_plugin,i.urls.change_list)})}else h.hide()},showOverlay:function(e){this.overlay.css({width:e.width()-2,height:e.height()-2,left:e.offset().left,top:e.offset().top}).show()},hideOverlay:function(){this.overlay.hide();this.overlay.find(".cms_placeholder-options_more").hide()},showPluginList:function(t){var n=this,r=t.parent().find(".cms_placeholder-subnav");r.show();setTimeout(function(){e(document).bind("click",function(){n.hidePluginList.call(n,t)})},100);e.browser.msie&&e.browser.version<"8.0"&&t.parent().parent().css({position:"relative","z-index":999999});t.addClass("cms_toolbar-btn-active").data("collapsed",!1)},hidePluginList:function(t){var n=t.parent().find(".cms_placeholder-subnav");n.hide();e(document).unbind("click");e.browser.msie&&e.browser.version<"8.0"&&t.parent().parent().css({position:"","z-index":""});t.removeClass("cms_toolbar-btn-active").data("collapsed",!0)},toggleFrame:function(){this.frame.data("collapsed")?this._showFrame():this._hideFrame()},_showFrame:function(){var t=this;this.frame.fadeIn();this.frame.data("collapsed",!1);var n=43,r=e(document).scrollTop();this.frame.css("top",r+n);this.toolbar.data("collapsed")&&CMS.Toolbar.API._showToolbar();this.toolbar.bind("cms.toolbar.show cms.toolbar.hide",function(e){e.handleObj.namespace==="show.toolbar"?t.frame.css("top",r+n):t.frame.css("top",r)})},_hideFrame:function(){this.frame.fadeOut();this.frame.data("collapsed",!0);this.frame.find(".cms_placeholder-content_inner").addClass("cms_placeholder-content_loader").html("");this.toolbar.unbind("cms.toolbar.show cms.toolbar.hide")},toggleDim:function(){this.dim.data("dimmed")?this._hideDim():this._showDim()},_showDim:function(){var t=this;this.timer&&clearTimeout(this.timer);e(window).bind("resize",function(){t.dim.css("height",e(window).height());t.timer=setTimeout(function(){t.dim.css("height",e(document).height())},500)});this.dim.css("height",e(document).height());this.dim.data("dimmed",!0);this.dim.css("opacity",.6).stop().fadeIn();this.dim.bind("click",function(){t.toggleFrame.call(t);t.toggleDim.call(t)})},_hideDim:function(){e(document).unbind("resize");this.dim.data("dimmed",!1);this.dim.css("opacity",.6).stop().fadeOut();this.dim.unbind("click")}});CMS.Placeholder=CMS.Class.$extend({initialize:function(t,n){var r=this;this.options=n;this.container=e(t);this.container.data("options",this.options);this.options.type==="bar"&&this._bars();this.options.type==="holder"&&this.container.bind("mouseenter",function(e){r._holders.call(r,e.currentTarget)})},_bars:function(){var t=this,n=this.container,r=n.find(".cms_toolbar-btn");r.data("collapsed",!0).bind("click",function(t){t.preventDefault();e(this).data("collapsed")?CMS.API.Placeholders.showPluginList(e(t.currentTarget)):CMS.API.Placeholders.hidePluginList(e(t.currentTarget))});var i={language:t.options.page_language,placeholder_id:t.options.page_id,placeholder:t.options.placeholder_id};n.find(".cms_placeholder-subnav li a").bind("click",function(n){n.preventDefault();i.plugin_type=e(this).attr("rel").split("::")[1];CMS.API.Placeholders.addPlugin(i,t.options.urls.add_plugin,t.options.urls.change_list)})},_holders:function(t){var n=this,r=e(t);CMS.API.Placeholders.showOverlay(r);if(CMS.API.Placeholders.overlayIsHidden===!0){CMS.API.Placeholders.overlay.css("visibility","visible");CMS.API.Placeholders.overlayIsHidden=!1}var i={plugin_id:this.options.plugin_id,placeholder:this.options.placeholder_id,type:this.options.plugin_type,slot:this.options.placeholder_slot},s=CMS.API.Placeholders.overlay.find(".cms_placeholder-options li");s.find("a").unbind("click");s.find("a[rel^=edit]").bind("click",function(e){e.preventDefault();CMS.API.Placeholders.editPlugin(i.placeholder,i.plugin_id,n.options.urls.change_list)});s.find("a[rel^=moveup], a[rel^=movedown]").bind("click",function(t){t.preventDefault();CMS.API.Placeholders.movePluginPosition(e(t.currentTarget).attr("rel"),r,i,n.options.urls.move_plugin)});s.find("a[rel^=delete]").bind("click",function(e){e.preventDefault();CMS.API.Placeholders.deletePlugin(r,i.plugin_id,n.options.urls.remove_plugin)});s.find("a[rel^=more]").bind("click",function(e){e.preventDefault();CMS.API.Placeholders.morePluginOptions(r,i,n.options.urls.move_plugin,n.options)})}})});