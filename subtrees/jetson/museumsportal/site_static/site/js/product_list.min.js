!function($,t){function e(){var t=$("#container").css("position","relative");if(r&&r.length){for(r.addClass("item-preview"),o&&o.removeClass("first_item_on_next_row"),o=r.nextAll(".item:visible:first");o.length&&r.position().top>=o.position().top;)o=o.nextAll(".item:visible:first");o.length&&o.addClass("first_item_on_next_row");var e=r.find(".description"),a=r.position().left,i=t.width(),n=parseInt(t.css("margin-left"),10),l=parseInt(t.css("margin-right"),10);e.css({left:-a-10,width:i+n+l})}}function a(){return r&&r.hasClass("item-preview")?(r.removeClass("item-preview"),o&&(o.removeClass("first_item_on_next_row"),o=null),r=null,lazyload_images(),!1):void 0}function i(){if(!navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|Opera Mini|webOS/i)){var t=$(".pagination").removeClass("item").hide(),e=$("#container").data("jscroll",null);t.length&&e.jscroll({loadingHtml:"<small>Loading...</small>",padding:100,contentSelector:"#container .grid,#container .list",nextSelector:".next_page:last",pagingSelector:".pagination",callback:function(){$(".pagination").removeClass("item").hide(),lazyload_images()}})}}var n="click";navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|Opera Mini|webOS/i)&&(n="touchstart");var r,o;$(function(){i(),$("#map-list-link").click(function(){return location.href=$(this).attr("href")+location.hash,!1}),$("#container").on("contextmenu taphold",".item>a",function(t){t.preventDefault();var i=$(this).closest(".item");if(i.hasClass("item-preview"))return a(),!1;r&&a(),r=i;var n=r.find(".description");return $.trim(n.text())?e():n.load(r.data("description-src"),function(){e(),window.init_share&&window.init_share()}),!1}).on("click",".item .cancel",function(t){t.preventDefault(),a()})}),$(window).bind("smartresize",e),$(window).load(function(){var t=$("#container"),e={},a="a-z";if(t.length){var r=$("#filters"),o=$("#filter-summary"),l={},s=!1;$(".panel-collapse",r).on("show.bs.collapse",function(t){$.bbq.pushState({filter_section:$(t.target).attr("id").replace(/^filter-/,"")})});var c=$.bbq.getState();c.filter_section&&($("#toggle-list-filter").click(),$('.btn[data-target="#filter-'+c.filter_section+'"]',r).click()),$(".search",r).on("submit",function(t,e){if(t.preventDefault(),s&&!e)return!1;s=!0;var a=$(".search input",r).val();l.page="",l.q=a;var n="?"+window.append_to_get(l,!0);return window.history.pushState({},document.title,n),e?s=!1:($("#container").jscroll.destroy&&$("#container").jscroll.destroy(),$("#container").load(n+" #container>*",function(){i(),setTimeout(function(){lazyload_images(),s=!1},500)})),!1}),$("#sorting a",r).on(n,function(t,e){if(t.preventDefault(),s&&!e)return!1;s=!0;var n=$(this).closest("li");a=n.data("value"),$("#sorting .active").removeClass("active"),n.addClass("active"),l.page="",l.sort_by=a;var r="?"+window.append_to_get(l,!0);return window.history.pushState({},document.title,r),e?s=!1:($("#container").jscroll.destroy&&$("#container").jscroll.destroy(),$("#container").load(r+" #container>*",function(){i(),setTimeout(function(){lazyload_images(),s=!1},500)})),!1}),$(".filter a",r).on(n,function(a,r){if(a.preventDefault(),!s||r){s=!0;var c=$(this),d=c.closest("li"),u=c.closest(".option-set"),v=u.attr("data-filter-group");e[v]=e[v]||[];var f=c.attr("data-filter-value"),p=u.attr("data-single-selection"),g=u.attr("data-hierarchical"),m=parseInt(d.attr("data-level"),10),h=c.attr("data-level-1-at"),w=c.attr("data-target"),_;h?_=$(h):1===m&&(_=c.closest(".level-1-container"));var y=d.data("param"),b=d.data("value");if(f)if(d.hasClass("active"))d.removeClass("active"),_&&0===m&&($("li.active>a",_).trigger(n,[!0]),$("ul.in",_).removeClass("in")),e[v]=$.grep(e[v],function(t){return t!==f}),$('li[data-param="'+y+'"]',o).remove(),1===o.children().length&&o.empty(),l[y]=!1;else{g?p?0===m?($("li.active>a",u).trigger(n,[!0]),_&&$("ul.in",_).removeClass("in"),e[v]=[f]):(_&&$("li.active>a",_).trigger(n,[!0]),e[v].push(f)):e[v].push(f):p?($("li.active>a",u).trigger(n,[!0]),e[v]=[f]):e[v].push(f),l[y]=b,d.addClass("active"),_&&$(w,_).addClass("in");var C;""===o.text().trim()&&(C=$("<li><b>"+window.str_filter_selection+":</b></li>"),o.append(C)),C=$('<li data-filter-group="'+v+'" data-filter-value="'+f+'" data-param="'+y+'" data-value="'+b+'"><a href="">'+c.text()+"</a></li>"),o.append(C),o.css("display","block")}var j=[];for(var x in e)for(var S=0;S<e[x].length;S++){var k=e[x][S].replace(/\./,"");j.push(k)}l.page="";var z="?"+window.append_to_get(l,!0);return window.history.pushState({},document.title,z),r?s=!1:($("#container").jscroll.destroy&&$("#container").jscroll.destroy(),$("#container").load(z+" #container>*",function(){i(),setTimeout(function(){lazyload_images(),s=!1},500)})),t.trigger("map_filter",{filter:j}),!1}}),o.on(n,"a",function(t){t.preventDefault();var e=$(this).closest("li"),a=e.data("param"),i=e.data("value");a?$('li.active[data-param="'+a+'"][data-value="'+i+'"]>a',r).trigger(n):$("li.active>a",r).trigger(n)}),$("#filter-reset").on(n,function(t){t.preventDefault(),$($("li.active>a",r).get().reverse()).trigger(n,[!0]),$("#container").jscroll.destroy&&$("#container").jscroll.destroy(),$(".search input",r).val(""),l.q="";var e="?"+window.append_to_get(l,!0);window.history.pushState({},document.title,e),$("#container").load(e+" #container>*",function(){i(),lazyload_images()})})}}),$(window).load(function(){setTimeout(function(){$("body").removeClass("no-transition")},1e3)})}(jQuery);