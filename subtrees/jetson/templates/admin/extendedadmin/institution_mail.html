{% extends "admin/change_form.html" %}
{% load base_tags i18n static %}

{% block extrahead %}{{ block.super.super }}
<style type="text/css">
/*<![CDATA[*/
    #break_start_row, #break_end_row {
        display: none;
    }
/*]]>*/
</style>
<script type="text/javascript" src="/jsi18n/"></script>
<script type="text/javascript" src="{% static 'grappelli/tinymce/jscripts/tiny_mce/tiny_mce.js' %}"></script>
{{ media }}
<script type="text/javascript" src="{% static 'admin/js/core.js' %}"></script>
<script type="text/javascript" src="{% static 'admin/js/admin/RelatedObjectLookups.js' %}"></script>
<script type="text/javascript" src="{% static 'admin/js/SelectBox.js' %}"></script>
<script type="text/javascript" src="{% static 'admin/js/SelectFilter2.js' %}"></script>
<script type="text/javascript" src="{% url 'jetson_media_url' path='tinymce_setup/tinymce_setup_base.js' %}"></script>
<script type="text/javascript" src="{% static 'site/tinymce_setup/tinymce_setup_e-mail.js' %}"></script>
{% endblock %}

{% block coltype %}colMS{% endblock %}

{% block bodyclass %}grp-change-form{% endblock %}

{% block breadcrumbs %}
    <ul class="breadcrumbs">
        {% if not is_popup %}<li><a href="/admin/">{% trans "Home" %}</a></li>{% endif %}
        <li><a href="/admin/institutions/institution/">{% trans "Institutions (places)" %}</a></li>
        <li>{% trans "Send an Email" %}</li>
    </ul>
{% endblock %}

{% block title %}{% trans "Send an Email" %} | {% trans 'Django site admin' %}{% endblock %}

{% block content_title %}<h1>{% trans "Send an Email" %}</h1>{% endblock %}
	
{% block content %}
<div id="grp-content-container">
	{% if form.errors %} 
	     <p class="errornote"> 
	         {% blocktrans count form.errors.items|length as counter %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
	     </p> 
    {% endif %} 
	<form method="post" action="">
		<fieldset class="grp-module">
            <div class="grp-row grp-cells-1{% if form.sender_name.errors %} grp-errors{% endif %}">
                <div class="l-2c-fluid l-d-4">
                    <div class="c-1">
                        <label{% if form.sender_name.field.required %} class="required"{% endif %}>{{ form.sender_name.label }}</label>
                    </div>
                    <div class="c-2">
                        {{ form.sender_name }}

                        {% if form.sender_name.errors %}
                            <ul class="errorlist"><li>{{ form.sender_name.errors|join:", "}}</li></ul>
                        {% endif %}
                        {% if form.sender_name.help_text %}<p class="grp-help">{{ form.sender_name.help_text }}</p>{% endif %}
                    </div>
                </div>
            </div>
            <div class="grp-row grp-cells-1{% if form.sender_email.errors %} grp-errors{% endif %}">
                <div class="l-2c-fluid l-d-4">
                    <div class="c-1">
                        <label{% if form.sender_email.field.required %} class="required"{% endif %}>{{ form.sender_email.label }}</label>
                    </div>
                    <div class="c-2">
                        {{ form.sender_email }}
                        {% if form.sender_email.errors %}
                            <ul class="errorlist"><li>{{ form.sender_email.errors|join:", "}}</li></ul>
                        {% endif %}

                        {% if form.sender_email.help_text %}<p class="grp-help">{{ form.sender_email.help_text }}</p>{% endif %}
                    </div>
                </div>
            </div>
            <div class="grp-row grp-cells-1{% if form.tester_email.errors %} grp-errors{% endif %}">
                <div class="l-2c-fluid l-d-4">
                    <div class="c-1">
                        <label{% if form.tester_email.field.required %} class="required"{% endif %}>{{ form.tester_email.label }}</label>
                    </div>
                    <div class="c-2">
                        {{ form.tester_email }}
                        {% if form.tester_email.errors %}
                            <ul class="errorlist"><li>{{ form.tester_email.errors|join:", "}}</li></ul>
                        {% endif %}

                        {% if form.tester_email.help_text %}<p class="grp-help">{{ form.tester_email.help_text }}</p>{% endif %}
                    </div>
                </div>
            </div>

            {% if display_recipients_list %}
                <div class="grp-row grp-cells-1{% if form.recipients_email_list.errors %} grp-errors{% endif %}">
                    <div class="l-2c-fluid l-d-4">
                        <div class="c-1">
                            <label{% if form.recipients_email_list.field.required %} class="required"{% endif %}>{{ form.recipients_email_list.label }}</label>
                        </div>
                        <div class="c-2">
                            <div class="many-to-many">{{ form.recipients_email_list }}</div>
                            {% if form.recipients_email_list.errors %}
                                <ul class="errorlist"><li>{{ form.recipients_email_list.errors|join:", "}}</li></ul>
                            {% endif %}

                            {% if form.recipients_email_list.help_text %}<p class="grp-help">{{ form.recipients_email_list.help_text }}</p>{% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}

            {% if display_recipients_input %}
                <div class="grp-row grp-cells-1{% if form.recipients_email_input.errors %} grp-errors{% endif %}">
                    <div class="l-2c-fluid l-d-4">
                        <div class="c-1">
                            <label{% if form.recipients_email_input.field.required %} class="required"{% endif %}>{{ form.recipients_email_input.label }}</label>
                        </div>
                        <div class="c-2">
                            {{ form.recipients_email_input }}
                            {% if form.recipients_email_input.errors %}
                                <ul class="errorlist"><li>{{ form.recipients_email_input.errors|join:", "}}</li></ul>
                            {% endif %}

                            {% if form.recipients_email_input.help_text %}<p class="grp-help">{{ form.recipients_email_input.help_text }}</p>{% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}

            {% if display_en %}
                <div class="grp-row grp-cells-1{% if form.subject.errors %} grp-errors{% endif %}">
                    <div class="l-2c-fluid l-d-4">
                        <div class="c-1">
                            <label{% if form.subject.field.required %} class="required"{% endif %}>{{ form.subject.label }}</label>
                        </div>
                        <div class="c-2">
                            {{ form.subject }}
                            {% if form.subject.errors %}
                                <ul class="errorlist"><li>{{ form.subject.errors|join:", "}}</li></ul>
                            {% endif %}

                            {% if form.subject.help_text %}<p class="grp-help">{{ form.subject.help_text }}</p>{% endif %}
                        </div>
                    </div>
                </div>

                <div class="grp-row grp-cells-1{% if form.body.errors %} grp-errors{% endif %}">
                    <div class="l-2c-fluid l-d-4">
                        <div class="c-1">
                            <label{% if form.body.field.required %} class="required"{% endif %}>{{ form.body.label }}</label>
                        </div>
                        <div class="c-2">
                            {{ form.body }}
                            {% if form.body.errors %}
                                <ul class="errorlist"><li>{{ form.body.errors|join:", "}}</li></ul>
                            {% endif %}

                            {% if form.body.help_text %}<p class="grp-help">{{ form.body.help_text }}</p>{% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}

            {% if display_de %}

                <div class="grp-row grp-cells-1{% if form.subject_de.errors %} grp-errors{% endif %}">
                    <div class="l-2c-fluid l-d-4">
                        <div class="c-1">
                            <label{% if form.subject_de.field.required %} class="required"{% endif %}>{{ form.subject_de.label }}</label>
                        </div>
                        <div class="c-2">
                            {{ form.subject_de }}
                            {% if form.subject_de.errors %}
                                <ul class="errorlist"><li>{{ form.subject_de.errors|join:", "}}</li></ul>
                            {% endif %}

                            {% if form.subject_de.help_text %}<p class="grp-help">{{ form.subject_de.help_text }}</p>{% endif %}
                        </div>
                    </div>
                </div>

                <div class="grp-row grp-cells-1{% if form.body_de.errors %} grp-errors{% endif %}">
                    <div class="l-2c-fluid l-d-4">
                        <div class="c-1">
                            <label{% if form.body_de.field.required %} class="required"{% endif %}>{{ form.body_de.label }}</label>
                        </div>
                        <div class="c-2">
                            {{ form.body_de }}
                            {% if form.body_de.errors %}
                                <ul class="errorlist"><li>{{ form.body_de.errors|join:", "}}</li></ul>
                            {% endif %}

                            {% if form.body_de.help_text %}<p class="grp-help">{{ form.body_de.help_text }}</p>{% endif %}
                        </div>
                    </div>
                </div>
                <div class="grp-row is_rte">
                    <div class="l-2c-fluid l-d-4">
                        <div class="c-1">
                            &nbsp;
                        </div>
                        <div class="c-2">
                            <input type="checkbox" name="is_rte" class="form_checkbox" checked="checked" id="id_is_rte"/><label class="vCheckboxLabel" for="id_is_rte">Rich-text editor aktivieren</label>
                        </div>
                    </div>
                </div>
            {% endif %}
		</fieldset>
        <footer class="grp-module grp-submit-row grp-fixed-footer">
            <header style="display: none">
                <h1>Submit options</h1>
            </header>
            <ul>
                <li><input type="hidden" name="goto_next" value="{% if goto_next %}{{ goto_next }}{% else %}{{ request.get_full_path }}{% endif %}" />
                <input type="submit" class="grp-button grp-default" value="{% trans "Send test email" %}" name="send_test_mail" /></li>
                <li><input type="submit" class="grp-button" value="{% trans "Send email" %}" name="send_mail" /></li>
            </ul>
        </footer>
	</form>
</div>
<script>
addEvent(window, "load", function(e) {
    SelectFilter.init("id_{{ form.recipients_email_list.name }}", "{{ form.recipients_email_list.label }}", 1, "{{ jetson_media_url }}");
});
(function($) {
    $(document).ready(function() {
        function setTinyMce(sId) {
            tinyMCE.execCommand("mceAddControl", true, sId);
        }
        function unsetTinyMce(sId) {
            tinyMCE.execCommand("mceRemoveControl", true, sId);
        }

        function initRTE() {
            toggleMarkup = function() {
                if ($(this).prop('checked')) {
                    setTinyMce('id_body');
                    setTinyMce('id_body_de');
                } else {
                    unsetTinyMce('id_body');
                    unsetTinyMce('id_body_de');
                }
            };
            $('#id_is_rte').each(toggleMarkup).change(toggleMarkup);
        }
        window.setTimeout(initRTE,500);
    });
}(django.jQuery));

</script>
{% endblock %}
