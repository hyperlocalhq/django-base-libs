{% extends "admin/change_form.html" %}

<!-- LOADING -->
{% load base_tags i18n auth_extended extended_admin compressed_jetson %}


<!-- JAVASCRIPTS -->
{% block javascripts %}
    {{ block.super }}
    <script type="text/javascript" src="{{ STATIC_URL }}admin/js/SelectBox.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}admin/js/SelectFilter2.js"></script>
    
    <script type="text/javascript" src="{{ jetson_media_url }}js/jquery/autocomplete_1.0/jquery.dimensions.js"></script>
    <script type="text/javascript" src="{{ jetson_media_url }}js/jquery/autocomplete_1.0/jquery.bgiframe.min.js"></script>
    <script type="text/javascript" src="{{ jetson_media_url }}js/jquery/autocomplete_1.0/jquery.autocomplete.js"></script>
    <script type="text/javascript" src="{{ jetson_media_url }}js/admin/autocomplete.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}admin/js/urlify.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}filebrowser/js/AddFileBrowser.js"></script>
    <script type="text/javascript" src="{{ jetson_media_url }}js/admin/jquery.grp_timepicker.js"></script>
    {% compressed_jetson_js "admin_event_change" %}
    
    <script type="text/javascript" src="{{ STATIC_URL }}admin/js/collapse.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}admin/js/inlines.min.js"></script>
    <!--
    <script type="text/javascript" charset="utf-8">
        (function($) {
            $(document).ready(function() {
                grappelli.initDateAndTimePicker();
                $("div.container-flexible div.group").grp_collapsible_group();
                $("div#content .collapse").grp_collapsible({
                    on_init: function(elem, options) {
                        // open collapse (and all collapse parents) in case of errors
                        if (elem.find("ul.errorlist").length > 0) {
                            elem.removeClass("closed")
                                .addClass("open");
                            elem.parents(".collapse")
                                .removeClass("closed")
                                .addClass("open");
                        }
                    }
                });
            });
        })(django.jQuery);
    </script>
    -->
{% endblock %}

<!-- COLTYPE/BODYCLASS -->
{% block bodyclass %}grp-change-form event{% endblock %}
{% block content-class %}grp-content-flexible{% endblock %}

<!-- BREADCRUMBS -->
{% block breadcrumbs %}
    {% if not is_popup %}
        <ul id="breadcrumbs">
            <li><a href="../../../">{% trans "Home" %}</a></li>
            <li><a href="../../">{{ "Events"|app_verbose_name }}</a></li>
            <li><a href="../">{% trans "Events" %}</a></li>
            <li>{% if original %}{{ original|truncatewords:"18" }}{% else %}{% trans "Add" %} {% trans "Event" %}{% endif %}</li>
        </ul>
    {% endif %}
{% endblock %}

<!-- OBJECT TOOLS -->
{% block object-tools %}
    {% if change and not is_popup %}
        <ul class="grp-object-tools">
            <li><a href="history/" class="historylink">{% trans "History" %}</a></li>
            {% if original.row_level_permissions %}
                {% if_has_perm "auth.change_rowlevelpermission" original %}
                    <li><a href="permissions/" class="rowlevelpermissions">{% trans "Permissions" %}</a></li>
                {% end_if_has_perm %}
            {% endif %}
            {% if original.get_url_path %}
                <li><a href="{{ original.get_url_path }}" class="viewsitelink">{% trans "View on site" %}</a></li>
            {% endif%}
        </ul>
    {% endif %}
{% endblock %}

<!-- CONTENT -->
{% block content %}
    <div id="grp-container">
        <div class="grp-content-container">
            <form action="" method="post" id="event_form">{% csrf_token %}
                <div>
                    <!-- Popup Hidden Field -->
                    {% if is_popup %}<input type="hidden" name="_popup" value="1" />{% endif %}
                    
                    <!-- Errors -->
                    {% if form.errors %}
                        <p class="errornote">
                        {% blocktrans count form.errors.items|length as counter %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
                        </p>
                        {{ form.non_field_errors }}
                    {% endif %}
                    
                    <!-- Fieldsets -->
                    {% block fieldset_event %}
                        <fieldset class="module aligned collapse open">
                            <h2>{% trans "Event" %}</h2>
                            {{ form.user_id }}
                            {% if form.title_en %}
                                <div class="row{% if form.title_en.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4"><label for="id_title_en"{% if form.title_en.field.required %} class="required"{% endif %}>{% trans "Title (English)" %}:</label></div>
                                        <div class="column span-flexible">
                                            {{ form.title_en }}
                                            {{ form.title_en.errors }}
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                            {% if form.title_de %}
                                <div class="row{% if form.title_en.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4"><label for="id_title_de"{% if form.title_de.field.required %} class="required"{% endif %}>{% trans "Title (German)" %}:</label></div>
                                        <div class="column span-flexible">
                                            {{ form.title_de }}
                                            {{ form.title_de.errors }}
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                            <div class="row{% if form.slug.errors %} errors{% endif %}">
                                <div>
                                    <div class="column span-4"><label for="id_slug"{% if form.slug.field.required %} class="required"{% endif %}>{% trans "Slug for URIs" %}:</label></div>
                                    <div class="column span-flexible">
                                        {{ form.slug }}
                                        {{ form.slug.errors }}
                                    </div>
                                </div>
                            </div>
                            <div class="row{% if form.event_type.errors %} errors{% endif %}">
                                <div>
                                    <div class="column span-4"><label for="id_event_type"{% if form.event_type.field.required %} class="required"{% endif %}>{% trans "Event Type" %}:</label></div>
                                    <div class="column span-flexible">
                                        {{ form.event_type }}
                                        {{ form.event_type.errors }}
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    {% endblock %}
        
                    {% block fieldset_eventtimes %}
                        {% for inline_admin_formset in inline_admin_formsets %}
                            <div id="{{ inline_admin_formset.formset.prefix }}-group" class="group collapse open">
                                <h2>{{ inline_admin_formset.opts.verbose_name_plural|title }}</h2>
                                <ul class="tools">
                                    <li class="open-handler-container"><a href="javascript://" class="icon open-handler" title="{% trans 'Open All Items' %}"></a></li>
                                    <li class="close-handler-container"><a href="javascript://" class="icon close-handler" title="{% trans 'Close All Items' %}"></a></li>
                                    <li class="add-handler-container"><a href="javascript://" class="icon add-handler" title="{% trans 'Add Item' %}"> </a></li>
                                </ul>
                                {{ inline_admin_formset.formset.management_form }}
                                {{ inline_admin_formset.formset.non_form_errors }}
                                <!-- container -->
                                <div class="items">
                                    {% if inline_admin_form.form.non_field_errors %}{{ inline_admin_form.form.non_field_errors }}{% endif %}
                                    {% for inline_admin_form in inline_admin_formset %}
                                        <div class="module collapse{% if forloop.first %} open{% else %} closed{% endif %}{% if inline_admin_form.original or inline_admin_form.show_url %} has_original{% endif %}{% if forloop.last %} empty-form{% endif %}" id="eventtime_set{% if forloop.last %}-empty{% else %}{{ forloop.counter0 }}{% endif %}">
                                            <h3 class="collapse-handler">{% trans "Event Time" %} #{{ forloop.counter }}&nbsp;&nbsp;{% if inline_admin_form.original %}{{ inline_admin_form.original }}{% endif %}</h3>
                                            <ul class="tools">
                                                {% if inline_admin_form.formset.can_delete %}
                                                    {% if inline_admin_form.original %}
                                                        <li class="delete-handler-container">{{ inline_admin_form.deletion_field.field }}<a href="javascript://" class="icon delete-handler" title="{% trans 'Delete Item' %}"></a></li>
                                                    {% else %}
                                                        <li class="remove-handler-container">{{ inline_admin_form.deletion_field.field }}<a href="javascript://" class="icon remove-handler" title="{% trans 'Delete Item' %}"></a></li>
                                                    {% endif %}
                                                {% endif %}
                                            </ul>
                                            {% if inline_admin_form.non_field_errors %}{{ inline_admin_form.non_field_errors }}{% endif %}
                                            <fieldset class="module aligned">
                                                <div class="row{% if inline_admin_form.form.label.errors %} errors{% endif %}">
                                                    <div>
                                                        <div class="column span-4"><label for="id_eventtime_set-{{ forloop.counter0 }}-label"{% if inline_admin_form.form.label.field.required %} class="required"{% endif %}>{% trans "Label" %}:</label></div>
                                                        <div class="column span-flexible">
                                                            {{ inline_admin_form.form.label }}
                                                            {{ inline_admin_form.form.label.errors }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="is_all_day row{% if inline_admin_form.form.is_all_day.errors %} errors{% endif %}">
                                                    <div>
                                                        <div class="column span-4">&nbsp;</div>
                                                        <div class="column span-flexible">
                                                            {{ inline_admin_form.form.is_all_day }}<label for="id_eventtime_set-{{ forloop.counter0 }}-is_all_day" class="vCheckboxLabel{% if inline_admin_form.form.is_all_day.field.required %} required{% endif %}">{% trans "All-day Event" %}</label>
                                                            {{ inline_admin_form.form.is_all_day.errors }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="availability row{% if inline_admin_form.form.start_mm.errors or inline_admin_form.form.start_dd.errors or inline_admin_form.form.start_yyyy.errors %} errors{% endif %}">
                                                    <div>
                                                        <div class="column span-4"><label for="id_eventtime_set-{{ forloop.counter0 }}-start_yyyy"{% if inline_admin_form.form.start_yyyy.field.required %} class="required"{% endif %}>{% trans "Start" %}:</label></div>
                                                        <div class="column span-flexible">
                                                            <span class="inline-fields">
                                                                <span class="low">{{ inline_admin_form.form.start_dd }}</span>
                                                                {{ inline_admin_form.form.start_mm }}
                                                                <span class="mid">{{ inline_admin_form.form.start_yyyy }}</span>
                                                            </span>
                                                            <span id="id_eventtime_set-{{ forloop.counter0 }}-start_time" class="inline-fields low start_time">
                                                                {{ inline_admin_form.form.start_hh }}
                                                                {{ inline_admin_form.form.start_ii }}
                                                            </span>
                                                            
                                                            {{ inline_admin_form.form.start_dd.errors }}
                                                            {{ inline_admin_form.form.start_mm.errors }}
                                                            {{ inline_admin_form.form.start_yyyy.errors }}
                                                            {{ inline_admin_form.form.start_hh.errors }}
                                                            {{ inline_admin_form.form.start_ii.errors }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="availability row{% if inline_admin_form.form.end_mm.errors or inline_admin_form.form.end_dd.errors or inline_admin_form.form.end_yyyy.errors %} errors{% endif %}">
                                                    <div>
                                                        <div class="column span-4"><label for="id_eventtime_set-{{ forloop.counter0 }}-end_yyyy"{% if inline_admin_form.form.end_yyyy.field.required %} class="required"{% endif %}>{% trans "End" %}:</label></div>
                                                        <div class="column span-flexible">
                                                            <span class="inline-fields">
                                                                <span class="low">{{ inline_admin_form.form.end_dd }}</span>
                                                                {{ inline_admin_form.form.end_mm }}
                                                                <span class="mid">{{ inline_admin_form.form.end_yyyy }}</span>
                                                            </span>
                                                            <span id="id_eventtime_set-{{ forloop.counter0 }}-end_time" class="inline-fields low end_time">
                                                                {{ inline_admin_form.form.end_hh }}
                                                                {{ inline_admin_form.form.end_ii }}
                                                            </span>
                                                            {{ inline_admin_form.form.end_dd.errors }}
                                                            {{ inline_admin_form.form.end_mm.errors }}
                                                            {{ inline_admin_form.form.end_yyyy.errors }}
                                                            {{ inline_admin_form.form.end_hh.errors }}
                                                            {{ inline_admin_form.form.end_ii.errors }}
                                                        </div>
                                                    </div>
                                                </div>
                                                {{ inline_admin_form.pk_field.field }}
                                                {{ inline_admin_form.fk_field.field }}
                                            </fieldset>
                                        </div>
                                    {% endfor %}
                                </div>
                                <div class="module add-item">
                                    <a class="add-handler" href="javascript://">{% trans "Add Event Time" %}</a>
                                    <ul class="tools">
                                        <li class="add-handler-container"><a title="{% trans "Add Event Time" %}" class="icon add-handler" href="javascript://"> </a></li>
                                    </ul><br clear="all">
                                </div>
                            </div>
                            <script type="text/javascript">
                            (function($) {
                                $(document).ready(function() {
                                    var updateInlineLabel = function(row) {
                                        $("#{{ inline_admin_formset.formset.prefix }}-group div.items div.module").find("h3:first").each(function(i) {
                                            $(this).html($(this).html().replace(/(#\d+)/g, "#" + ++i));
                                        });
                                    }
                                    var reinitDateTimeFields = function(row) {
                                        row.find(".vDateField").datepicker({
                                            //appendText: '(mm/dd/yyyy)',
                                            showOn: 'button',
                                            buttonImageOnly: false,
                                            buttonText: '',
                                            dateFormat: grappelli.getFormat('date')
                                        });
                                        $(".vTimeField").grp_timepicker();
                                    }
                                    var updateSelectFilter = function(row) {
                                        // If any SelectFilter widgets were added, instantiate a new instance.
                                        if (typeof SelectFilter != "undefined"){
                                            row.find(".selectfilter").each(function(index, value){
                                              var namearr = value.name.split('-');
                                              SelectFilter.init(value.id, namearr[namearr.length-1], false, "{{ STATIC_URL }}admin/");
                                            });
                                            row.find(".selectfilterstacked").each(function(index, value){
                                              var namearr = value.name.split('-');
                                              SelectFilter.init(value.id, namearr[namearr.length-1], true, "{{ STATIC_URL }}admin/");
                                            });
                                        }
                                    }
                                    var reinitTinyMCE = function(row) {
                                        row.find("textarea.vLargeTextField").each(function() {
                                            tinyMCE.execCommand('mceAddControl', false, this.id);
                                        });
                                    };
                                    var deleteTinyMCE = function(row) {
                                        row.find("textarea.vLargeTextField").each(function() {
                                            if (tinyMCE.getInstanceById(this.id)) {
                                                tinyMCE.execCommand('mceRemoveControl', false, this.id);
                                            }
                                        });
                                    };
                                    // TODO. re-init ui-calendar
                                    $("#{{ inline_admin_formset.formset.prefix }}-group").grp_inline({
                                        prefix: "{{ inline_admin_formset.formset.prefix }}",
                                        deleteCssClass: "delete-handler",
                                        emptyCssClass: "empty-form",
                                        onAfterRemoved: (function (row) {
                                            updateInlineLabel(row);
                                            deleteTinyMCE(row);
                                        }),
                                        onAfterAdded: (function(row) {
                                            row.grp_collapsible();
                                            row.find("fieldset.collapse").grp_collapsible();
                                            reinitTinyMCE(row);
                                            reinitDateTimeFields(row);
                                            updateSelectFilter(row);
                                            updateInlineLabel(row);
                                            self.TimeRangeManager.reinit(row);
                                        })
                                    });
                                });
                            })(django.jQuery);
                            </script>                            
                        {% endfor %}
                    {% endblock %}
                    
                    {% block fieldset_eventdetails %}
                        {% include "extendedadmin/includes/fieldset_details.html" %}
                    {% endblock %}
                    
                    {% block fieldset_location %}
                        <fieldset class="module aligned collapse closed">
                            <h2 class="collapse-handler">{% trans "Location" %}</h2>
                            {% if form.venue %}
                                <div class="row{% if form.venue.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4"><label for="id_venue"{% if form.venue.field.required %} class="required"{% endif %}>{% trans "Select a venue" %}:</label></div>
                                        <div class="column span-flexible">
                                            {{ form.venue }}
                                            {{ form.venue.errors }}
                                            <p class="help">{{ form.venue.help_text }}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="row{% if form.venue_title.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4"><label for="id_venue_title"{% if form.venue_title.field.required %} class="required"{% endif %}>{% trans "...or enter a venue title" %}:</label></div>
                                        <div class="column span-flexible">
                                            {{ form.venue_title }}
                                            {{ form.venue_title.errors }}
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                <div class="row{% if form.venue_title.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4"><label for="id_venue_title"{% if form.venue_title.field.required %} class="required"{% endif %}>{% trans "Venue title" %}:</label></div>
                                        <div class="column span-flexible">
                                            {{ form.venue_title }}
                                            {{ form.venue_title.errors }}
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                            <fieldset class="module aligned nested">
                                <h2>{% trans "Address" %}</h2>
                                <div class="map-settings">
                                    <div class="row{% if form.street_address.errors %} errors{% endif %}">
                                        <div class="span-8">
                                            <label for="id_street_address"{% if form.street_address.field.required %} class="required"{% endif %}>{% trans "Street Address" %}:</label>
                                            {{ form.street_address }}
                                            {{ form.street_address.errors }}
                                        </div>
                                    </div>
                                    <div class="row{% if form.street_address2.errors %} errors{% endif %}">
                                        <div class="span-8">
                                            <label for="id_street_address2"{% if form.street_address2.field.required %} class="required"{% endif %}></label>
                                            {{ form.street_address2 }}
                                            {{ form.street_address2.errors }}
                                        </div>
                                    </div>
                                    <div class="row{% if form.street_address3.errors %} errors{% endif %}">
                                        <div class="span-8">
                                            <label for="id_street_address3"{% if form.street_address3.field.required %} class="required"{% endif %}></label>
                                            {{ form.street_address3 }}
                                            {{ form.street_address3.errors }}
                                        </div>
                                    </div>
                                    <div class="row{% if form.postal_code.errors %} errors{% endif %}">
                                        <div class="span-8">
                                            <label for="id_postal_code"{% if form.postal_code.field.required %} class="required"{% endif %}>{% trans "Postal Code/ZIP" %}:</label>
                                            {{ form.postal_code }}
                                            {{ form.postal_code.errors }}
                                        </div>
                                    </div>
                                    <div class="row{% if form.neighborhood.errors %} errors{% endif %}">
                                        <div class="span-8">
                                            <label for="id_neighborhood"{% if form.neighborhood.field.required %} class="required"{% endif %}>{% trans "Neighborhood" %}:</label>
                                            {{ form.neighborhood }}
                                            {{ form.neighborhood.errors }}
                                        </div>
                                    </div>
                                    <div class="row{% if form.district.errors %} errors{% endif %}">
                                        <div class="span-8">
                                            <label for="id_district"{% if form.district.field.required %} class="required"{% endif %}>{% trans "District" %}:</label>
                                            {{ form.district }}
                                            {{ form.district.errors }}
                                        </div>
                                    </div>
                                    <div class="row{% if form.city.errors %} errors{% endif %}">
                                        <div class="span-8">
                                            <label for="id_city"{% if form.city.field.required %} class="required"{% endif %}>{% trans "City" %}:</label>
                                            {{ form.city }}
                                            {{ form.city.errors }}
                                        </div>
                                    </div>
                                    <div class="row{% if form.state.errors %} errors{% endif %}">
                                        <div class="span-8">
                                            <label for="id_state"{% if form.state.field.required %} class="required"{% endif %}>{% trans "State" %}:</label>
                                            {{ form.state }}
                                            {{ form.state.errors }}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <!-- Add jquery-based Country autoselection -->
                                        <label for="id_country"{% if form.country.field.required %} class="required"{% endif %}>{% trans "Country" %}:</label>
                                        {{ form.country }}
                                        {{ form.country.errors }}
                                    </div>
                                </div>
                                <div>
                                    <div class="row">
                                        <iframe src="http://{{ site_settings.site.domain }}{% if request.META.SERVER_PORT %}{% ifnotequal request.META.SERVER_PORT 80 %}:{{ request.META.SERVER_PORT }}{% endifnotequal %}{% endif %}/gmap/" id="gmap" style="width: 430px; height: 300px; border: none; margin-bottom: 5px;"></iframe>
                                    </div>
                                    <div class="row{% if form.latitude.errors or form.longitude.errors or form.altitude.errors %} errors{% endif %}">
                                        <div class="cell">
                                            <div class="column span-4">
                                                <label for="id_latitude"{% if form.latitude.field.required %} class="required"{% endif %}>{% trans "Latitude" %}</label>
                                                {{ form.latitude }}
                                                {{ form.latitude.errors }}
                                            </div>
                                        </div>
                                        <div class="cell">
                                            <div class="column span-4">
                                                <label for="id_longitude"{% if form.longitude.field.required %} class="required"{% endif %}>{% trans "Longitude" %}</label>
                                                {{ form.longitude }}
                                                {{ form.longitude.errors }}
                                            </div>
                                        </div>
                                        <div class="cell">
                                            <div class="column span-4">
                                                <label for="id_altitude"{% if form.altitude.field.required %} class="required"{% endif %}>{% trans "Altitude" %}</label>
                                                {{ form.altitude }}
                                                {{ form.altitude.errors }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">&nbsp;</div>
                                </div>
                                <div style="clear: both;"></div>
                            </fieldset>
                            <fieldset class="module aligned phone nested">
                                <h2>{% trans "Phones" %}</h2>
                                <div class="phone-fields">
                                    <div class="row">
                                        <div>
                                            <div class="column span-4">&nbsp;</div>
                                            <div class="column span-4">
                                                <a href="../../../optionset/phonetype/add/" id="add_id_individualcontact_set-{{ forloop.counter0 }}-phone0_type" onclick="return showAddAnotherPopup(this);">{% trans "Type not listed?" %}</a>
                                            </div>
                                        
                                            <div class="column span-2">
                                                <div>{% trans "Country" %}</div>
                                            </div>
                                            
                                            <div class="column span-4">
                                                <div>{% trans "Area" %} {% ifequal LANGUAGE_CODE "de" %}<br/>{% endifequal %}{% trans "w/o (0)" %}</div>
                                            </div>
                                            
                                            <div class="column span-4">
                                                <div>{% ifequal LANGUAGE_CODE "de" %}{% trans "Number" %} <br/>{% endifequal %}{% trans "plus extension" %}</div>
                                            </div>
                                            
                                            <div class="column span-2">
                                                <div>{% trans "Default" %}</div>
                                            </div>
                                            
                                            <div class="column span-2">
                                                <div>{% trans "On hold" %}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row{% if form.phone0_type.errors or form.phone0_country.errors or form.phone0_area.errors or form.phone0_number.errors or form.is_phone0_default.errors or form.is_phone0_on_hold.errors %} errors{% endif %}">
                                        <div>
                                            <div class="column span-4">&nbsp;</div>
                                            <div class="column span-4">
                                                {{ form.phone0_type }}
                                                {{ form.phone0_type.errors }}
                                            </div>
                                        
                                            <div class="column span-2">
                                                + {{ form.phone0_country }}
                                                {{ form.phone0_country.errors }}
                                            </div>
                                            
                                            <div class="column span-4">
                                                {{ form.phone0_area }}
                                                {{ form.phone0_area.errors }}
                                            </div>
                                            
                                            <div class="column span-4">
                                                {{ form.phone0_number }}
                                                {{ form.phone0_number.errors }}
                                            </div>
                                            
                                            <div class="column span-2">
                                                {{ form.is_phone0_default }}
                                                {{ form.is_phone0_default.errors }}
                                            </div>
                                            
                                            <div class="column span-2">
                                                {{ form.is_phone0_on_hold }}
                                                {{ form.is_phone0_on_hold.errors }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row{% if form.phone1_type.errors or form.phone1_country.errors or form.phone1_area.errors or form.phone1_number.errors or form.is_phone1_default.errors or form.is_phone1_on_hold.errors %} errors{% endif %}">
                                        <div>
                                            <div class="column span-4">&nbsp;</div>
                                            <div class="column span-4">
                                                {{ form.phone1_type }}
                                                {{ form.phone1_type.errors }}
                                            </div>
                                        
                                            <div class="column span-2">
                                                + {{ form.phone1_country }}
                                                {{ form.phone1_country.errors }}
                                            </div>
                                            
                                            <div class="column span-4">
                                                {{ form.phone1_area }}
                                                {{ form.phone1_area.errors }}
                                            </div>
                                            
                                            <div class="column span-4">
                                                {{ form.phone1_number }}
                                                {{ form.phone1_number.errors }}
                                            </div>
                                            
                                            <div class="column span-2">
                                                {{ form.is_phone1_default }}
                                                {{ form.is_phone1_default.errors }}
                                            </div>
                                            
                                            <div class="column span-2">
                                                {{ form.is_phone1_on_hold }}
                                                {{ form.is_phone1_on_hold.errors }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row{% if form.phone2_type.errors or form.phone2_country.errors or form.phone2_area.errors or form.phone2_number.errors or form.is_phone2_default.errors or form.is_phone2_on_hold.errors %} errors{% endif %}">
                                        <div>
                                            <div class="column span-4">&nbsp;</div>
                                            <div class="column span-4">
                                                {{ form.phone2_type }}
                                                {{ form.phone2_type.errors }}
                                            </div>
                                        
                                            <div class="column span-2">
                                                + {{ form.phone2_country }}
                                                {{ form.phone2_country.errors }}
                                            </div>
                                            
                                            <div class="column span-4">
                                                {{ form.phone2_area }}
                                                {{ form.phone2_area.errors }}
                                            </div>
                                            
                                            <div class="column span-4">
                                                {{ form.phone2_number }}
                                                {{ form.phone2_number.errors }}
                                            </div>
                                            
                                            <div class="column span-2">
                                                {{ form.is_phone2_default }}
                                                {{ form.is_phone2_default.errors }}
                                            </div>
                                            
                                            <div class="column span-2">
                                                {{ form.is_phone2_on_hold }}
                                                {{ form.is_phone2_on_hold.errors }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset class="module aligned e-mail nested">
                                <h2>{% trans "E-mail Addresses" %}</h2>
                                <div class="row">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            <a href="../../../optionset/emailtype/add/" id="add_id_individualcontact_set-{{ forloop.counter0 }}-email0_type" onclick="return showAddAnotherPopup(this);">{% trans "Type not listed?" %}</a>
                                        </div>
                                        <div class="column span-10">
                                            <div>{% trans "Email Address" %}</div>
                                        </div>
                                        <div class="column span-2">
                                            <div>{% trans "Default" %}</div>
                                        </div>
                                        <div class="column span-2">
                                            <div>{% trans "On hold" %}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row{% if form.email0_type.errors or form.email0_address.errors or form.is_email0_default.errors or form.is_email0_on_hold.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            {{ form.email0_type }}
                                            {{ form.email0_type.errors }}
                                        </div>
                                        <div class="column span-10">
                                            {{ form.email0_address }}
                                            {{ form.email0_address.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_email0_default }}
                                            {{ form.is_email0_default.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_email0_on_hold }}
                                            {{ form.is_email0_on_hold.errors }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row{% if form.email1_type.errors or form.email1_address.errors or form.is_email1_default.errors or form.is_email1_on_hold.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            {{ form.email1_type }}
                                            {{ form.email1_type.errors }}
                                        </div>
                                        <div class="column span-10">
                                            {{ form.email1_address }}
                                            {{ form.email1_address.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_email1_default }}
                                            {{ form.is_email1_default.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_email1_on_hold }}
                                            {{ form.is_email1_on_hold.errors }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row{% if form.email2_type.errors or form.email2_address.errors or form.is_email2_default.errors or form.is_email2_on_hold.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            {{ form.email2_type }}
                                            {{ form.email2_type.errors }}
                                        </div>
                                        <div class="column span-10">
                                            {{ form.email2_address }}
                                            {{ form.email2_address.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_email2_default }}
                                            {{ form.is_email2_default.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_email2_on_hold }}
                                            {{ form.is_email2_on_hold.errors }}
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset class="module aligned websites nested">
                                <h2>{% trans "Websites" %}</h2>
                                <div class="row">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            <a href="../../../optionset/urltype/add/" id="add_id_individualcontact_set-{{ forloop.counter0 }}-url0_type" onclick="return showAddAnotherPopup(this);">{% trans "Type not listed?" %}</a>
                                        </div>
                                        <div class="column span-10">
                                            <div>{% trans "Website" %}</div>
                                        </div>
                                        <div class="column span-2">
                                            <div>{% trans "Default" %}</div>
                                        </div>
                                        <div class="column span-2">
                                            <div>{% trans "On hold" %}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row{% if form.url0_type.errors or form.url0_link.errors or form.is_url0_default.errors or form.is_url0_on_hold.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            {{ form.url0_type }}
                                            {{ form.url0_type.errors }}
                                        </div>
                                        <div class="column span-10">
                                            {{ form.url0_link }}
                                            {{ form.url0_link.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_url0_default }}
                                            {{ form.is_url0_default.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_url0_on_hold }}
                                            {{ form.is_url0_on_hold.errors }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row{% if form.url1_type.errors or form.url1_link.errors or form.is_url1_default.errors or form.is_url1_on_hold.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            {{ form.url1_type }}
                                            {{ form.url1_type.errors }}
                                        </div>
                                        <div class="column span-10">
                                            {{ form.url1_link }}
                                            {{ form.url1_link.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_url1_default }}
                                            {{ form.is_url1_default.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_url1_on_hold }}
                                            {{ form.is_url1_on_hold.errors }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row{% if form.url2_type.errors or form.url2_link.errors or form.is_url2_default.errors or form.is_url2_on_hold.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            {{ form.url2_type }}
                                            {{ form.url2_type.errors }}
                                        </div>
                                        <div class="column span-10">
                                            {{ form.url2_link }}
                                            {{ form.url2_link.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_url2_default }}
                                            {{ form.is_url2_default.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_url2_on_hold }}
                                            {{ form.is_url2_on_hold.errors }}
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset class="module aligned messengers nested">
                                <h2>{% trans "Instant Messengers" %}</h2>
                                <div class="row">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            <a href="../../../optionset/imtype/add/" id="add_id_individualcontact_set-{{ forloop.counter0 }}-im0_type" onclick="return showAddAnotherPopup(this);">{% trans "Type not listed?" %}</a>
                                        </div>
                                        <div class="column span-10">
                                            <div>{% trans "Instant Messenger" %}</div>
                                        </div>
                                        <div class="column span-2">
                                            <div>{% trans "Default" %}</div>
                                        </div>
                                        <div class="column span-2">
                                            <div>{% trans "On hold" %}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row{% if form.im0_type.errors or form.im0_address.errors or form.is_im0_default.errors or form.is_im0_on_hold.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            {{ form.im0_type }}
                                            {{ form.im0_type.errors }}
                                        </div>
                                        <div class="column span-10">
                                            {{ form.im0_address }}
                                            {{ form.im0_address.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_im0_default }}
                                            {{ form.is_im0_default.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_im0_on_hold }}
                                            {{ form.is_im0_on_hold.errors }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row{% if form.im1_type.errors or form.im1_address.errors or form.is_im1_default.errors or form.is_im1_on_hold.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            {{ form.im1_type }}
                                            {{ form.im1_type.errors }}
                                        </div>
                                        <div class="column span-10">
                                            {{ form.im1_address }}
                                            {{ form.im1_address.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_im1_default }}
                                            {{ form.is_im1_default.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_im1_on_hold }}
                                            {{ form.is_im1_on_hold.errors }}
                                        </div>
                                    </div>
                                </div>
                                <div class="row{% if form.im2_type.errors or form.im2_address.errors or form.is_im2_default.errors or form.is_im2_on_hold.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4">&nbsp;</div>
                                        <div class="column span-4">
                                            {{ form.im2_type }}
                                            {{ form.im2_type.errors }}
                                        </div>
                                        <div class="column span-10">
                                            {{ form.im2_address }}
                                            {{ form.im2_address.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_im2_default }}
                                            {{ form.is_im2_default.errors }}
                                        </div>
                                        <div class="column span-2">
                                            {{ form.is_im2_on_hold }}
                                            {{ form.is_im2_on_hold.errors }}
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </fieldset>
                    {% endblock %}
                        
                    {% block fieldset_opening_hours %}
                        {% include "extendedadmin/includes/fieldset_opening_hours.html" %}
                    {% endblock %}
                    
                    {% block fieldset_organizer %}
                        <fieldset class="module aligned collapse closed">
                            <h2 class="collapse-handler">{% trans "Organizer" %}</h2>
                            {% if form.organizing_institution %}
                                <div class="row{% if form.organizing_institution.errors %} errors{% endif %}">
                                    <div>
                                        <div class="column span-4"><label for="id_organizing_institution"{% if form.organizing_institution.field.required %} class="required"{% endif %}>{% trans "Organizing institution" %}:</label></div>
                                        <div class="column span-flexible">
                                            {{ form.organizing_institution }}
                                            {{ form.organizing_institution.errors }}
                                            <p class="help">{{ form.organizing_institution.help_text }}</p>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                            <div class="row{% if form.organizer_title.errors %} errors{% endif %}">
                                <div>
                                    <div class="column span-4"><label for="id_organizer_title"{% if form.organizer_title.field.required %} class="required"{% endif %}>{% trans "Organizer Title" %}:</label></div>
                                    <div class="column span-flexible">
                                        {{ form.organizer_title }}
                                        {{ form.organizer_title.errors }}
                                    </div>
                                </div>
                            </div>
                            <div class="row{% if form.organizer_url_link.errors %} errors{% endif %}">
                                <div>
                                    <div class="column span-4"><label for="id_organizer_url_link"{% if form.organizer_url_link.field.required %} class="required"{% endif %}>{% trans "Organizer Website" %}:</label></div>
                                    <div class="column span-flexible">
                                        {{ form.organizer_url_link }}
                                        {{ form.organizer_url_link.errors }}
                                    </div>
                                </div>
                            </div>
                            {% if form.organizing_person %}
                                <div class="row">
                                    <div>
                                        <div class="column span-4"><label for="id_organizing_person"{% if form.organizing_person.field.required %} class="required"{% endif %}>{% trans "Organizing person" %}:</label></div>
                                        <div class="column span-flexible">
                                            {{ form.organizing_person }}
                                            {{ form.organizing_person.errors }}
                                            <p class="help">{{ form.organizing_person.help_text }}</p>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </fieldset>
                    {% endblock %}
                    
                    {% block fieldset_additional_info %}
                        <fieldset class="module aligned collapse closed">
                            <h2 class="collapse-handler">{% trans "Additional Info" %}</h2>
                            {% if form.additional_info_en %}
                                <fieldset class="module aligned nested multilingual multilingual-set-12 multilingual-language-en">
                                    <h2>{% trans "Additional info (English)" %}</h2>
                                    <div class="row{% if form.additional_info_en.errors %} errors{% endif %}">
                                        <div>
                                            <div class="column span-4"><label for="id_additional_info_en"{% if form.additional_info_en.field.required %} class="required"{% endif %}>{% trans "Additional info" %}:</label></div>
                                            <div class="column span-flexible">
                                                {{ form.additional_info_en_markup_type }}
                                                {% if form.additional_info_en_markup_type.help_text %}<span class="help">{{ form.additional_info_en_markup_type.help_text|safe }}</span>{% endif %}
                                                <p>{{ form.additional_info_en }}</p>
                                                {{ form.additional_info_en.errors }}
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            {% endif %}
                            {% if form.additional_info_de %}
                                <fieldset class="module aligned nested multilingual multilingual-set-12 multilingual-language-de">
                                    <h2>{% trans "Additional info (German)" %}</h2>
                                    <div class="row{% if form.additional_info_de.errors %} errors{% endif %}">
                                        <div>
                                            <div class="column span-4"><label for="id_additional_info_de"{% if form.additional_info_de.field.required %} class="required"{% endif %}>{% trans "Additional info" %}:</label></div>
                                            <div class="column span-flexible">
                                                {{ form.additional_info_de_markup_type }}
                                                {% if form.additional_info_de_markup_type.help_text %}<span class="help">{{ form.additional_info_de_markup_type.help_text|safe }}</span>{% endif %}
                                                <p>{{ form.additional_info_de }}</p>
                                                {{ form.additional_info_de.errors }}
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            {% endif %}
                            <div class="row{% if form.related_events.errors %} errors{% endif %}">
                                <div>
                                    <div class="column span-4"><label for="id_related_events"{% if form.related_events.field.required %} class="required"{% endif %}>{% trans "Related events" %}:</label></div>
                                    <div class="column span-flexible">
                                        {{ form.related_events }}
                                        {{ form.related_events.errors }}
                                        <p class="help">{{ form.related_events.help_text }}</p>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    {% endblock %}

                    {% block fieldset_status %}
                        {% include "extendedadmin/includes/fieldset_status.html" %}
                    {% endblock %}
        
                    <!-- Submit-Row -->
                    <div class="module footer">
                        <ul class="submit-row">
                            <li class="left delete-link-container"><a href="delete/" class="delete-link">Delete</a></li>
                            <li class="submit-button-container"><input type="submit" value="{% trans 'Save' %}" class="default" name="_save" /></li>
                            <li class="submit-button-container"><input type="submit" value="{% trans 'Save and add another' %}" name="_addanother" /></li>
                            <li class="submit-button-container"><input type="submit" value="{% trans 'Save and continue editing' %}" name="_continue" /></li>
                        </ul>
                    </div>
                </div>
            </form>
            <script type="text/javascript">
            //<![CDATA[
            {% if form.title_en %}
            document.getElementById("id_title_en").focus();
            document.getElementById("id_title_en").onkeyup = function() {
                var e = document.getElementById("id_slug");
                if(!e._changed) {
                    e.value = URLify(document.getElementById("id_title_en").value, 255);
                }
            };
            {% else %}
            document.getElementById("id_title_de").focus();
            document.getElementById("id_title_de").onkeyup = function() {
                var e = document.getElementById("id_slug");
                if(!e._changed) {
                    e.value = URLify(document.getElementById("id_title_de").value, 255);
                }
            };
            {% endif %}
            document.getElementById("id_slug").onchange = function() {
                this._changed = true;
            };
            //]]>
            </script>
        </div>
    </div>
{% endblock %}
