{% load i18n fb_tags fb_versions image_mods_tags %}
{% load url from future %}

{% for fileobject in page.object_list %}

    <tr class="grp-row {% cycle 'grp-row-even' 'grp-row-odd' %}{% if fileobject.filetype == "Folder" %} fb_folder{% endif %}">
        {% with fileobject|file_description as f_description %}
            <!-- FILESELECT FOR FILEBROWSEFIELD -->
            {% if query.pop == "1" %}
                <td class="fb_icon">
                    {% selectable fileobject.filetype query.type %}
                    {% if selectable and fileobject.filetype != "Folder" %}
                        <!-- select original -->
                        <button class="grp-button fb_selectlink" onclick="FileSubmit('{{ fileobject.path }}', '{{ fileobject.url }}', '{{ MEDIA_URL }}{{ fileobject|modified_path:"filebrowser_thumbnail" }}', '{{ fileobject.filetype }}');">
                            {% trans "Select" %}
                        </button>
                    {% else %}
                        &nbsp;
                    {% endif %}
                </td>
            {% endif %}

            <!-- FILESELECT FOR RTE/TINYMCE -->
            <!-- we need to use the absolute url here -->
            {% if query.pop == "2" %}
                <td class="fb_icon">
                    {% selectable fileobject.filetype query.type %}
                    {% if selectable and fileobject.filetype != "Folder" %}
                        <!-- select original -->
                        <button class="grp-button fb_selectlink" onclick="FileBrowserDialogue.fileAndDescriptionSubmit({file_path: '{{ MEDIA_URL }}{{ fileobject.path|escapejs }}', title: '{{ f_description.title|escapejs }}', description: '{{ f_description.description|escapejs }}', author: '{{ f_description.author|escapejs }}'});">
                            {% trans "Select" %}
                        </button>
                        <!-- select versions -->
                        {% if fileobject.filetype == "Image" %}
                            <br/><br/>
                            <a href="{% url 'fb_versions' %}{% query_string "" "p" %}&amp;filename={{ fileobject.filename }}" class="fb_showversionslink" title="{% trans 'Show Versions' %}">
                                {% trans "Versions" %}
                            </a>
                        {% endif %}
                    {% else %}
                        &nbsp;
                    {% endif %}
                </td>
            {% endif %}

            <!-- FILESELECT FOR CKEDITOR -->
            {% if query.pop == "3" %}
                <td class="fb_icon">
                    {% selectable fileobject.filetype query.type %}
                    {% if selectable and fileobject.filetype != "Folder" %}
                        <!-- select original -->
                        <button class="grp-button fb_selectlink" onclick="OpenFile(ProtectPath('{{ fileobject.url|escapejs }}'), '{{ f_description.author|escapejs }}', '{{ f_description.title|escapejs }}');return false;">
                            {% trans "Select" %}
                        </button>
                        <!-- select versions -->
                        {% if fileobject.filetype == "Image" %}
                            <br/><br/>
                            <a href="{% url 'fb_versions' %}{% query_string "" "p" %}&amp;filename={{ fileobject.filename }}" class="fb_showversionslink" title="{% trans 'Show Versions' %}">
                                {% trans "Versions" %}
                            </a>
                        {% endif %}
                    {% else %}
                        &nbsp;
                    {% endif %}
                </td>
            {% endif %}

            <!-- FILEICON -->
            <td>
                {% if fileobject.filetype %}
                    <span class="fb_type {{ fileobject.filetype|lower }}">{% trans fileobject.filetype %}</span>
                {% else %}
                    <span class="fb_type none">&mdash;</span>
                {% endif %}
            </td>

            <!-- THUMBNAIL -->
            <td class="fb_thumbnail">
                {% if fileobject.filetype == "Image" %}
                    <a href="{{ fileobject.url }}" class="fb_viewlink">
                        {% with thumbnail_path=fileobject.path|modified_path:"filebrowser_thumbnail" %}
                            {% if thumbnail_path %}
                                <img src="{{ MEDIA_URL }}{{ thumbnail_path }}?now={% now "YmdHis" %}"
                                     title="{% trans 'View Image' %}" alt=""/>
                            {% else %}
                                <img src="{% url 'jetson_media_url' path='img/filebrowser/filebrowser_Image.gif' %}"
                                     title="{% trans 'View Image' %}" alt="" width="60"/>
                            {% endif %}
                        {% endwith %}
                    </a>
                {% endif %}
            </td>

            <!-- FILENAME/DIMENSIONS -->
            {% if fileobject.filetype == "Folder" %}
                <td><a href="{% url 'filebrowser:fb_browse' %}{% query_string "" "q,dir,p" %}&amp;dir={{ fileobject.directory|urlencode }}"><strong>{{ fileobject.filename }}</strong></a>
                    {% if f_description.title %}
                        <br/>{{ f_description.title }}
                    {% endif %}
                    {% if f_description.description %}
                        <br/>{{ f_description.description }}
                    {% endif %}
                </td>
            {% else %}
                <td>
                    <strong>{{ fileobject.filename }}</strong>
                    {% if fileobject.dimensions %}
                        <br/><span class="small">{{ fileobject.dimensions.0 }} x {{ fileobject.dimensions.1 }} px</span>
                    {% endif %}
                    {% if f_description.title %}
                        <br/>{{ f_description.title }}
                    {% endif %}
                    {% if f_description.description %}
                        <br/>{{ f_description.description }}
                    {% endif %}
                </td>
            {% endif %}

            <!-- FOLDER -->
            {% if query.q and settings_var.SEARCH_TRAVERSE %}
                <td><a href="{% url 'filebrowser:fb_browse' %}{% query_string "" "dir,p" %}&amp;dir={{ fileobject.folder|urlencode }}"><strong>{{ fileobject.folder }}</strong></a>
                </td>
            {% endif %}

            <!-- SIZE -->
            <td><span class="small">{% if fileobject.filesize %}{{ fileobject.filesize|filesizeformat }}{% else %}
                &mdash;{% endif %}</span></td>

            <!-- DATE -->
            <td><span class="small">{{ fileobject.datetime|date:"N j, Y" }}</span></td>

            <!-- EDIT -->
            <td>
                <ul class="grp-actions">
                    <li class="grp-change-link">
                        <a href="{% url 'filebrowser:fb_detail' %}{% query_string "" "p" %}&amp;filename={{ fileobject.filename }}">
                            <strong>{% trans "Change" %}</strong>
                        </a>
                    </li>
                </ul>
            </td>
        {% endwith %}
    </tr>
{% endfor %}
