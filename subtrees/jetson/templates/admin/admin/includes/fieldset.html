{% load base_tags %}
<fieldset class="grp-module {{ fieldset.classes }}{% if fieldset.level %} nested nesting-level-{{ fieldset.level }}{% endif %}">
    {% if fieldset.name %}<h2 class="grp-collapse-handler">{{ fieldset.name }}</h2>{% endif %}
    {% if fieldset.description %}
        <div class="grp-row"><p class="grp-description">{{ fieldset.description }}</p></div>
    {% endif %}
    {% for line in fieldset %}
        {% if line.is_fieldset %}
            {% include_parsed "admin/includes/fieldset.html" with line as fieldset %}
        {% else %}
            {% if "_markup_type" not in line.fields.0 %}
                <div class="grp-row grp-cells-{{ line.fields|length }}{% if not line.fields|length_is:"1" %} grp-cells{% else %}{% if line.errors %} errors{% endif %}{% endif %}{% for field in line %} field-{{ field.field.name }}{% endfor %} ">
            {% endif %}
                {% for field in line %}
                    {% if not field.is_markup_type %}
                        {% if line.fields|length_is:"1" %}
                            <div class="l-2c-fluid l-d-4">
                        {% else %}
                            <div class="grp-cell l-2c-fluid l-d-4 {{ field.field.name }}{% if field.field.errors %} grp-errors{% endif %}">
                        {% endif %}
                            {% if not field.is_markup_type %}
                                {% if field.is_checkbox %}
                                    <div class="c-1">&nbsp;</div>
                                    <div class="c-2">
                                        {{ field.field }}{{ field.label_tag }}
                                        {{ line.errors }}
                                        {% if field.field.field.help_text %}
                                            <p class="grp-help">{{ field.field.field.help_text|safe }}</p>
                                        {% endif %}
                                    </div>
                                {% else %}
                                    <div class="c-1">{{ field.label_tag }}</div>
                                    <div class="c-2">
                                        {% if field.is_readonly %}
                                            <div class="grp-readonly">{{ field.contents }}</div>
                                        {% else %}
                                            {% if field.has_markup_type %}
                                                {{ field.related_markup_type_field }}
                                                {% if field.related_markup_type_field.field.help_text %}<p class="grp-help markup-type-help">{{ field.related_markup_type_field.field.help_text|safe }}</p>{% endif %}
                                                <p>{{ field.field }}</p>
                                            {% else %}          
                                                {{ field.field }}
                                            {% endif %}
                                        {% endif %}
                                        {{ line.errors }}
                                        {% if field.field.field.help_text %}
                                            <p class="grp-help">{{ field.field.field.help_text|safe }}</p>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            {% if "_markup_type" not in line.fields.0 %}
                </div>
            {% endif %}
        {% endif %}
    {% endfor %}
</fieldset>