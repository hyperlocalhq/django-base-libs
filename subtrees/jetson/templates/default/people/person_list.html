{% extends "base.html" %}
{% load i18n base_tags navigation_tags %}

{% block extrahead %}
	<script type="text/javascript" src="{{ STATIC_URL }}site/js/website/generic.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/website/individual_relations.js"></script>
{% endblock %}


{% block title %}{% trans "People" %}{% endblock %}

{% block headline %}
	<h2 class="main">{% trans "People" %}</h2>
{% endblock %}

{% block content %}
    {% block tabs %}
        <div id="tabs">
            {% children_of "people" using "navigation/children_in_tabs.html" %}
        </div>
    {% endblock %}
    {% if object_list %}
        {% include "utils/sorting_view_pagination_header.html" %}
    
        {% block breadcrumbs %}
            <div class="breadcrumbs">
                <div>
                    {% include "utils/abc_filters.html" %}
                </div>
            </div>
        {% endblock %}
        {% for person in object_list %}
            <div class="vcard">
                <div class="list-item {% cycle odd,even %} expanded" onclick="redirect('{{ person.get_url_path }}');">
                    <div class="info-group-a">
                        <h5>
                            <a class="fn" href="{{ person.get_url_path }}">
                                {{ person.get_title|escape }}
                            </a>
                        </h5>
                        {% if person.get_contacts %}
                            {% with person.get_contacts.0 as contact %}
                                {% if contact %}
                                    {% if person.is_address_displayed %}
                                        {% with contact.postal_address as postal_address %}
                                            {% comment %}
                                            <a href="/vcard/{{ person|content_type_id }}/{{ person.id }}">vcard</a>
                                            {% endcomment %}
                                            {% if postal_address.street_address or postal_address.country_name %}
                                            <address class="adr">
                                                {% if contact.institution %}
                                                    <a class="org" href="{{ contact.institution.get_url_path }}">
                                                     {{ contact.institution.get_title|escape }}</a>
                                                     <br />
                                                {% endif %}
                                                {% if postal_address.street_address %}
                                                     <span class="street-address">
                                                     {{ postal_address.street_address|escape }}
                                                     </span><br />
                                                {% endif %}								
                                                {% if postal_address.street_address2 %}
                                                     <span class="street-address">
                                                     {{ postal_address.street_address2|escape }}</span><br />
                                                {% endif %}								
                                                {% if postal_address.street_address3 %}
                                                     <span class="street-address">{{ postal_address.street_address3|escape }}
                                                     </span><br />
                                                {% endif %}								
                                                {% if postal_address.postal_code %}	
                                                     <span class="postal-code">
                                                     {{ postal_address.postal_code|escape }} 
                                                     {{ postal_address.city|escape }}
                                                     </span><br />
                                                {% endif %}								
                                                {% if postal_address.country_name %}
                                                    <span class="country-name">
                                                    {{ postal_address.country_name }}
                                                    </span><br />
                                                {% endif %}
                                            </address>
                                            {% endif %}
                                        {% endwith %}
                                    {% endif %}
                                {% endif %}
                            {% endwith %}
                        {% endif %}
                    {% include "people/controls.html" %}
                    </div>
                    <div class="info-group-b">
                        {% if person.occupation %}
                            <div class="object-type">{{ person.occupation }}</div>
                        {% endif %}
                        {% if person.get_contacts %}
                            {% with person.get_contacts.0 as contact %}
                                {% if contact.get_phones %}
                                    {% for phone in contact.get_phones %}
                                        <span class="tel">
                                            {% if phone.type %}
                                                <abbr title="{{ phone.type.vcard_name }}" class="type">
                                                {{ phone.type }}
                                                </abbr>:
                                            {% endif %}
                                            <span class="value">+{{ phone.country }}-{{ phone.area }}-{{ phone.number }}</span><br />
                                        </span>
                                    {% endfor %}
                                {% endif %}
                                {% for url in contact.get_urls %}
                                <span class="url">
                                    {% if url.type %}{{ url.type }}: {% endif %}<a  href="{{ url.link|escape }}" onclick="open_new_window(event)">
                                    {% with url.link|slice:"0:27"|escape as sliced %}{{ sliced }}{% with url.link|escape as not_sliced %}{% ifnotequal sliced url.link|escape %}...{% endifnotequal %}{% endwith %}{% endwith %}</a><br />
                                </span>
                                {% endfor %}
                            {% endwith %}
                        {% endif %}
                        {% if person.get_description %}
                            {% with person.get_description|striptags|truncatewords:"60" as filtered_desc %}{% with filtered_desc|truncatewords:"40" as shortened_desc %}
                            <span class="description hidable">
                                {{ shortened_desc }}
                                {% ifnotequal shortened_desc filtered_desc %}
                                    <a href="{{ person.get_url_path }}">{% trans "read more" %}</a>
                                {% endifnotequal %}
                            </span>
                            {% endwith %}{% endwith %}
                        {% endif %}	
                    </div>
                </div>
            </div>
            <div class="cleaner"></div>
        {% endfor %}
        {% include "utils/pagination_footer.html" %}
	
    {% else %}
        <p class="nothing">{% trans "No objects found within the selected conditions." %}</p>
    {% endif %}
{% endblock %}

