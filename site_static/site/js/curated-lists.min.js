$(function(){$(".add_to_own_curated_lists").each(function(){var e=$(this),t=e.data("content_type_id"),n=e.data("object_id"),o="/"+settings.lang+"/helper/user-curated-lists/?content_type_id="+t+"&object_id="+n;$.get(o,function(o){var l=$('<select placeholder="Add to curated list" multiple></select>').wrap('<div class="add_to_own_curated_lists input-field select"></div>');for(i=0,ilen=o.length;i<ilen;i++){var s=o[i],r=s.owner,a=$('<optgroup label="'+r.title+'"></optgroup>');for(j=0,jlen=s.lists.length;j<jlen;j++){var d=s.lists[j];$option=$('<option value="'+d.token+'">'+d.title+"</option>"),d.item_included&&$option.attr("selected",!0),a.append($option)}$option=$('<option value="new-for-'+r.type+"."+r.id+'">New Curated List...</option>'),a.append($option),l.append(a)}l=l.parent(),l.replaceAll(e).each(function(){var e=$(this).find("select");e.data("previous-value",e.val()),new window.form_elements.SelectBox(e)}),l.on("changed",function(){var e,i=$(this).find("select"),o=i.val().filter(function(e){return-1===(i.data("previous-value")||[]).indexOf(e)}),l=(i.data("previous-value")||[]).filter(function(e){return-1===(i.val()||[]).indexOf(e)});if(console.log({newChoice:o.toString(),deletedChoice:l.toString()}),l.toString()&&(e=l.toString(),$.post("/"+settings.lang+"/helper/user-curated-lists/remove-item/",{curated_list_token:e,item_content_type_id:t,item_object_id:n},function(e){e.success&&console.log("Item deleted from the curated list")},"json")),o.toString())if(e=o.toString(),0===e.indexOf("new-for-")){var s=e.replace("new-for-","").split("."),r=prompt("Enter list title","My new list");$.post("/"+settings.lang+"/helper/user-curated-lists/add-item-to-new/",{owner_app_model:s[0]+"."+s[1],owner_pk:s[2],title:r,item_content_type_id:t,item_object_id:n},function(e){e.success&&(location.href=e.redirect_url)},"json")}else $.post("/"+settings.lang+"/helper/user-curated-lists/add-item-to-existing/",{curated_list_token:e,item_content_type_id:t,item_object_id:n},function(e){e.success&&(location.href=e.redirect_url)},"json");i.data("previous-value",i.val())})},"json")})});