$(function(){var a=function(k){var d=$('<div class="prompt"></div>');var c=$('<div class="prompt-content"><h2>'+trans["Enter list title"]+"</h2></div>");var h=$('<input type="text" value="'+trans["My new list"]+'"/>');var b=$('<button class="btn btn-success">'+trans.OK+"</button>");var g=$('<button class="btn btn-default">'+trans.cancel+"</button>");var f=function(){var l=h.val().trim();d.remove();if(l){k(l)}};var e=function(){d.remove();k(null)};b.click(f);g.click(e);c.append(h);c.append(b);c.append(g);d.append(c);$("body").append(d)};$(".add_to_own_curated_lists").each(function(){var c=$(this);var e=c.data("content_type_id");var d=c.data("object_id");var b="/"+settings.lang+"/helper/user-curated-lists/?content_type_id="+e+"&object_id="+d;$.get(b,function(m){var k=$('<select placeholder="'+trans["Add to curated list"]+'" multiple></select>').wrap('<div class="add_to_own_curated_lists input-field select"></div>');for(i=0,ilen=m.length;i<ilen;i++){var h=m[i];var f=h.owner;var g=$('<optgroup label="'+f.title+'"></optgroup>');for(j=0,jlen=h.lists.length;j<jlen;j++){var l=h.lists[j];$option=$('<option value="'+l.token+'">'+l.title+"</option>");if(l.item_included){$option.attr("selected",true)}g.append($option)}$option=$('<option value="new-for-'+f.type+"."+f.id+'">'+trans["New Curated List"]+"</option>");g.append($option);k.append(g)}k=k.parent();k.replaceAll(c).each(function(){var n=$(this).find("select");n.data("previous-value",n.val());new window.form_elements.SelectBox(n)});k.on("changed",function(){var q;var p=$(this).find("select");var o=p.val().filter(function(t){return -1===(p.data("previous-value")||[]).indexOf(t)});var n=(p.data("previous-value")||[]).filter(function(t){return -1===(p.val()||[]).indexOf(t)});if(n.toString()){q=n.toString();$.post("/"+settings.lang+"/helper/user-curated-lists/remove-item/",{curated_list_token:q,item_content_type_id:e,item_object_id:d},function(t){if(t.success){console.log("Item deleted from the curated list")}},"json")}if(o.toString()){q=o.toString();if(q.indexOf("new-for-")===0){var r=q.replace("new-for-","").split(".");var s=function(t){if(t){$.post("/"+settings.lang+"/helper/user-curated-lists/add-item-to-new/",{owner_app_model:r[0]+"."+r[1],owner_pk:r[2],title:t,item_content_type_id:e,item_object_id:d},function(u){if(u.success){location.href=u.redirect_url}},"json")}};a(s)}else{$.post("/"+settings.lang+"/helper/user-curated-lists/add-item-to-existing/",{curated_list_token:q,item_content_type_id:e,item_object_id:d},function(t){if(t.success){location.href=t.redirect_url}},"json")}}p.data("previous-value",p.val())})},"json")})});