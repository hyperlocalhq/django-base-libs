function redo_description(){var e=$("#container"),t=$("#item-preview");if(t.length){var i=t.find(".description"),a=t.position().left,n=e.width(),r=parseInt(e.css("margin-left"),10),l=parseInt(e.css("margin-right"),10);i.css({left:-a,width:n+r+l}),isotope_list()}}function reinit_infinite_scroll(){if(!navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|Opera Mini|webOS/i)){var e=$(".pagination").removeClass("item").hide(),t=$("#container").data("jscroll",null);e.length&&t.jscroll({loadingHtml:"<small>Loading...</small>",contentSelector:"#container .isotope",nextSelector:".next_page:last",pagingSelector:".pagination",debug:!0,callback:function(){$(".pagination").removeClass("item").hide(),isotope_list(),lazyload_images()}})}}$(function(){reinit_infinite_scroll(),$("#map-list-link").click(function(){return location.href=$(this).attr("href")+location.hash,!1}),$("#container .item > a").click(function(){var e=$(this).closest(".item");if(redo_description(),e.attr("id"))return $("#item-preview").attr("id",""),isotope_list(),lazyload_images(),!1;$("#item-preview").attr("id",""),e.attr("id","item-preview");var t=e.find(".description");return $.trim(t.text())?isotope_list():t.load(e.data("description-src"),function(){$("#container .item .cancel").click(function(){$("#item-preview").attr("id",""),isotope_list(),lazyload_images()}),redo_description(),window.init_share&&window.init_share()}),!1})}),$(window).bind("smartresize",redo_description),$(window).load(function(){var e=$("#container"),t={};if(e.length){var i=$("#filters"),a=$("#filter-summary"),n={};$(".filter a").click(function(i){i.preventDefault();var r=$(this),l=r.closest("li"),o=r.closest(".option-set"),s=o.attr("data-filter-group");t[s]=t[s]||[];var c=r.attr("data-filter-value"),d=o.attr("data-single-selection"),f=o.attr("data-hierarchical"),p=parseInt(l.attr("data-level"),10),u=r.attr("data-level-1-at"),m=r.attr("data-target"),v;u?v=$(u):1===p&&(v=r.closest(".level-1-container"));var g=r.data("param"),h=r.data("value");c&&(r.hasClass("selected")?(r.removeClass("selected"),l.removeClass("selected"),v&&0===p&&(v.find("a.selected").click(),v.find("ul.in").removeClass("in")),t[s]=jQuery.grep(t[s],function(e){return e!==c}),$('li[data-filter-group="'+s+'"][data-filter-value="'+c+'"]',a).remove(),1===a.children().length&&a.empty(),n[g]=!1,"category"===g&&(n.subcategory=!1)):(f?d?0===p?(o.find("a.selected").click(),v&&v.find("ul.in").removeClass("in"),t[s]=[c]):(v&&v.find("a.selected").click(),t[s].push(c)):t[s].push(c):d?(o.find("a.selected").click(),t[s]=[c]):t[s].push(c),n[g]=h,r.addClass("selected"),l.addClass("selected"),v&&v.find(m).addClass("in"),""===a.text()&&(l=$("<li><b>"+window.str_filter_selection+":</b></li>"),a.append(l)),l=$('<li data-filter-group="'+s+'" data-filter-value="'+c+'"><a href="">'+r.text()+"</a></li>"),a.append(l)));var _=[],w=[];for(var k in t)for(var y=0;y<t[k].length;y++){var C=t[k][y].replace(/\./,"");w.push(C)}var b="?"+window.append_to_get(n,!0);return window.history.pushState({},document.title,b),$("#container").load(b+" #container>*",function(){reinit_infinite_scroll(),isotope_list(),lazyload_images()}),e.trigger("map_filter",{filter:w}),!1}),a.on("click","a",function(){var e=$(this).closest("li"),t=e.data("param"),a=e.data("value");return t?$('a[data-param="'+t+'"][data-value="'+a+'"]',i).click():$("a.selected",i).click(),!1}),$("#filter-reset").on("click",function(){return $("a.selected",i).click(),!1})}}),$(window).load(function(){setTimeout(function(){$("body").removeClass("no-transition")},1e3)});