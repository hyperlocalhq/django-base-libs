!function(t,a){function e(){var a=t("#container").css("position","relative"),e=t("#item-preview");if(e.length){for(n&&n.css("clear",null).css("background",null),n=e.next();n&&e.position().top>=n.position().top;)n=n.next();n.css("clear","left").css("background","red");var i=e.find(".description"),r=e.position().left,l=a.width(),o=parseInt(a.css("margin-left"),10),s=parseInt(a.css("margin-right"),10);i.css({left:-r-10,width:l+o+s})}}function i(){if(!navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|Opera Mini|webOS/i)){var a=t(".pagination").removeClass("item").hide(),e=t("#container").data("jscroll",null);a.length&&e.jscroll({loadingHtml:"<small>Loading...</small>",padding:100,contentSelector:"#container .grid",nextSelector:".next_page:last",pagingSelector:".pagination",callback:function(){t(".pagination").removeClass("item").hide(),lazyload_images()}})}}var r="click";navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|Opera Mini|webOS/i)&&(r="touchstart");var n;t(function(){i(),t("#map-list-link").click(function(){return location.href=t(this).attr("href")+location.hash,!1}),t("#container").on("click",".item>a",function(){var a=t(this).closest(".item");if(e(),a.attr("id"))return t("#item-preview").attr("id",""),lazyload_images(),n&&(n.css("clear",null),n=null),!1;t("#item-preview").attr("id",""),n&&(n.css("clear",null),n=null),a.attr("id","item-preview");var i=a.find(".description");return t.trim(i.text())||i.load(a.data("description-src"),function(){t("#container .item .cancel").on("click",function(){t("#item-preview").attr("id",""),lazyload_images()}),e(),window.init_share&&window.init_share()}),!1})}),t(window).bind("smartresize",e),t(window).load(function(){var a=t("#container"),e={};if(a.length){var n=t("#filters"),l=t("#filter-summary"),o={},s=!1;t(".filter a").on(r,function(n,c){if(n.preventDefault(),!s||c){s=!0;var d=t(this),u=d.closest("li"),v=d.closest(".option-set"),p=v.attr("data-filter-group");e[p]=e[p]||[];var g=d.attr("data-filter-value"),f=v.attr("data-single-selection"),m=v.attr("data-hierarchical"),h=parseInt(u.attr("data-level"),10),w=d.attr("data-level-1-at"),y=d.attr("data-target"),_;w?_=t(w):1===h&&(_=d.closest(".level-1-container"));var b=u.data("param"),k=u.data("value");if(g)if(u.hasClass("active"))u.removeClass("active"),_&&0===h&&(t("li.active>a",_).trigger(r,[!0]),t("ul.in",_).removeClass("in")),e[p]=t.grep(e[p],function(t){return t!==g}),t('li[data-param="'+b+'"]',l).remove(),1===l.children().length&&l.empty(),o[b]=!1;else{m?f?0===h?(t("li.active>a",v).trigger(r,[!0]),_&&t("ul.in",_).removeClass("in"),e[p]=[g]):(_&&t("li.active>a",_).trigger(r,[!0]),e[p].push(g)):e[p].push(g):f?(t("li.active>a",v).trigger(r,[!0]),e[p]=[g]):e[p].push(g),o[b]=k,u.addClass("active"),_&&t(y,_).addClass("in");var C;""===l.text().trim()&&(C=t("<li><b>"+window.str_filter_selection+":</b></li>"),l.append(C)),C=t('<li data-filter-group="'+p+'" data-filter-value="'+g+'" data-param="'+b+'" data-value="'+k+'"><a href="">'+d.text()+"</a></li>"),l.append(C),l.css("display","block")}var j=[],x=[];for(var z in e)for(var P=0;P<e[z].length;P++){var S=e[z][P].replace(/\./,"");x.push(S)}o.page="";var I="?"+window.append_to_get(o,!0);return window.history.pushState({},document.title,I),c?s=!1:(t("#container").jscroll.destroy&&t("#container").jscroll.destroy(),t("#container").load(I+" #container>*",function(){i(),setTimeout(function(){lazyload_images(),s=!1},500)})),a.trigger("map_filter",{filter:x}),!1}}),l.on(r,"a",function(a){a.preventDefault();var e=t(this).closest("li"),i=e.data("param"),l=e.data("value");i?t('li.active[data-param="'+i+'"][data-value="'+l+'"]>a',n).trigger(r):t("li.active>a",n).trigger(r)}),t("#filter-reset").on(r,function(a){a.preventDefault(),t(t("li.active>a",n).get().reverse()).trigger(r,[!0]),t("#container").jscroll.destroy&&t("#container").jscroll.destroy(),t("#container").load("? #container>*",function(){i(),lazyload_images()})})}}),t(window).load(function(){setTimeout(function(){t("body").removeClass("no-transition")},1e3)})}(jQuery);