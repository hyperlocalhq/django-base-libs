function redo_description(){var i=$("#container"),t=$("#item-preview");if(t.length){var e=t.find(".description"),a=t.position().left,r=i.width(),n=parseInt(i.css("margin-left"),10),l=parseInt(i.css("margin-right"),10);e.css({left:-a,width:r+n+l}),isotope_list()}}function reinit_infinite_scroll(){if(!navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|Opera Mini|webOS/i)){var i=$(".pagination").removeClass("item").hide(),t=$("#container").data("jscroll",null);i.length&&t.jscroll({loadingHtml:"<small>Loading...</small>",contentSelector:"#container .isotope",nextSelector:".next_page:last",pagingSelector:".pagination",callback:function(){$(".pagination").removeClass("item").hide(),isotope_list(),lazyload_images()}})}}$(function(){reinit_infinite_scroll(),$("#map-list-link").click(function(){return location.href=$(this).attr("href")+location.hash,!1}),$("#container .item > a").click(function(){var i=$(this).closest(".item");if(redo_description(),i.attr("id"))return $("#item-preview").attr("id",""),isotope_list(),lazyload_images(),!1;$("#item-preview").attr("id",""),i.attr("id","item-preview");var t=i.find(".description");return $.trim(t.text())?isotope_list():t.load(i.data("description-src"),function(){$("#container .item .cancel").click(function(){$("#item-preview").attr("id",""),isotope_list(),lazyload_images()}),redo_description(),window.init_share&&window.init_share()}),!1})}),$(window).bind("smartresize",redo_description),$(window).load(function(){var i=$("#container"),t={};if(i.length){var e=$("#filters"),a=$("#filter-summary"),r={};$(".filter a").click(function(e,n){e.preventDefault();var l=$(this),o=l.closest("li"),c=l.closest(".option-set"),s=c.attr("data-filter-group");t[s]=t[s]||[];var d=l.attr("data-filter-value"),p=c.attr("data-single-selection"),v=c.attr("data-hierarchical"),f=parseInt(o.attr("data-level"),10),u=l.attr("data-level-1-at"),m=l.attr("data-target"),g;u?g=$(u):1===f&&(g=l.closest(".level-1-container"));var h=o.data("param"),_=o.data("value");if(d)if(o.hasClass("active"))o.removeClass("active"),g&&0===f&&($("li.active>a",g).trigger("click",[!0]),$("ul.in",g).removeClass("in")),t[s]=$.grep(t[s],function(i){return i!==d}),$('li[data-param="'+h+'"]',a).remove(),1===a.children().length&&a.empty(),r[h]=!1;else{v?p?0===f?($("li.active>a",c).trigger("click",[!0]),g&&$("ul.in",g).removeClass("in"),t[s]=[d]):(g&&$("li.active>a",g).trigger("click",[!0]),t[s].push(d)):t[s].push(d):p?($("li.active>a",c).trigger("click",[!0]),t[s]=[d]):t[s].push(d),r[h]=_,o.addClass("active"),g&&$(m,g).addClass("in");var w;""===a.text().trim()&&(w=$("<li><b>"+window.str_filter_selection+":</b></li>"),a.append(w)),w=$('<li data-filter-group="'+s+'" data-filter-value="'+d+'" data-param="'+h+'" data-value="'+_+'"><a href="">'+l.text()+"</a></li>"),a.append(w)}var k=[],y=[];for(var C in t)for(var b=0;b<t[C].length;b++){var z=t[C][b].replace(/\./,"");y.push(z)}var x="?"+window.append_to_get(r,!0);return window.history.pushState({},document.title,x),n||($("#container").jscroll.destroy(),$("#container").load(x+" #container>*",function(){reinit_infinite_scroll(),isotope_list(),lazyload_images()})),i.trigger("map_filter",{filter:y}),!1}),a.on("click","a",function(){var i=$(this).closest("li"),t=i.data("param"),a=i.data("value");return t?$('li.active[data-param="'+t+'"][data-value="'+a+'"]>a',e).click():$("li.active>a",e).click(),!1}),$("#filter-reset").on("click",function(){return $($("li.active>a",e).get().reverse()).trigger("click",[!0]),$("#container").jscroll.destroy(),$("#container").load("? #container>*",function(){reinit_infinite_scroll(),isotope_list(),lazyload_images()}),!1})}}),$(window).load(function(){setTimeout(function(){$("body").removeClass("no-transition")},1e3)});