!function(t,e){function a(){var e=t("#container").css("position","relative");if(l&&l.length){for(l.addClass("item-preview"),o&&o.removeClass("first_item_on_next_row"),o=l.nextAll(".item:visible:first");o.length&&l.position().top>=o.position().top;)o=o.nextAll(".item:visible:first");o.length&&o.addClass("first_item_on_next_row");var a=l.find(".description"),i=l.position().left,r=e.width(),n=parseInt(e.css("margin-left"),10),s=parseInt(e.css("margin-right"),10);a.css({left:-i-10,width:r+n+s})}}function i(){return l&&l.hasClass("item-preview")?(l.removeClass("item-preview"),o&&(o.removeClass("first_item_on_next_row"),o=null),l=null,lazyload_images(),!1):void 0}function r(){if(!navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|Opera Mini|webOS/i)){var e=t(".pagination").removeClass("item").hide(),a=t("#container").data("jscroll",null);e.length&&a.jscroll({loadingHtml:"<small>Loading...</small>",padding:100,contentSelector:"#container .grid",nextSelector:".next_page:last",pagingSelector:".pagination",callback:function(){t(".pagination").removeClass("item").hide(),lazyload_images()}})}}var n="click";navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|Opera Mini|webOS/i)&&(n="touchstart");var l,o;t(function(){r(),t("#map-list-link").click(function(){return location.href=t(this).attr("href")+location.hash,!1}),t("#container").on("click",".item>a",function(e){e.preventDefault();var r=t(this).closest(".item");if(r.hasClass("item-preview"))return i(),!1;l&&i(),l=r;var n=l.find(".description");return t.trim(n.text())?a():n.load(l.data("description-src"),function(){a(),window.init_share&&window.init_share()}),!1}).on("click",".item .cancel",function(t){t.preventDefault(),i()})}),t(window).bind("smartresize",a),t(window).load(function(){var e=t("#container"),a={};if(e.length){var i=t("#filters"),l=t("#filter-summary"),o={},s=!1;t(".filter a").on(n,function(i,c){if(i.preventDefault(),!s||c){s=!0;var d=t(this),v=d.closest("li"),f=d.closest(".option-set"),u=f.attr("data-filter-group");a[u]=a[u]||[];var p=d.attr("data-filter-value"),g=f.attr("data-single-selection"),m=f.attr("data-hierarchical"),h=parseInt(v.attr("data-level"),10),w=d.attr("data-level-1-at"),_=d.attr("data-target"),y;w?y=t(w):1===h&&(y=d.closest(".level-1-container"));var C=v.data("param"),b=v.data("value");if(p)if(v.hasClass("active"))v.removeClass("active"),y&&0===h&&(t("li.active>a",y).trigger(n,[!0]),t("ul.in",y).removeClass("in")),a[u]=t.grep(a[u],function(t){return t!==p}),t('li[data-param="'+C+'"]',l).remove(),1===l.children().length&&l.empty(),o[C]=!1;else{m?g?0===h?(t("li.active>a",f).trigger(n,[!0]),y&&t("ul.in",y).removeClass("in"),a[u]=[p]):(y&&t("li.active>a",y).trigger(n,[!0]),a[u].push(p)):a[u].push(p):g?(t("li.active>a",f).trigger(n,[!0]),a[u]=[p]):a[u].push(p),o[C]=b,v.addClass("active"),y&&t(_,y).addClass("in");var x;""===l.text().trim()&&(x=t("<li><b>"+window.str_filter_selection+":</b></li>"),l.append(x)),x=t('<li data-filter-group="'+u+'" data-filter-value="'+p+'" data-param="'+C+'" data-value="'+b+'"><a href="">'+d.text()+"</a></li>"),l.append(x),l.css("display","block")}var k=[];for(var j in a)for(var A=0;A<a[j].length;A++){var P=a[j][A].replace(/\./,"");k.push(P)}o.page="";var S="?"+window.append_to_get(o,!0);return window.history.pushState({},document.title,S),c?s=!1:(t("#container").jscroll.destroy&&t("#container").jscroll.destroy(),t("#container").load(S+" #container>*",function(){r(),setTimeout(function(){lazyload_images(),s=!1},500)})),e.trigger("map_filter",{filter:k}),!1}}),l.on(n,"a",function(e){e.preventDefault();var a=t(this).closest("li"),r=a.data("param"),l=a.data("value");r?t('li.active[data-param="'+r+'"][data-value="'+l+'"]>a',i).trigger(n):t("li.active>a",i).trigger(n)}),t("#filter-reset").on(n,function(e){e.preventDefault(),t(t("li.active>a",i).get().reverse()).trigger(n,[!0]),t("#container").jscroll.destroy&&t("#container").jscroll.destroy(),t("#container").load("? #container>*",function(){r(),lazyload_images()})})}}),t(window).load(function(){setTimeout(function(){t("body").removeClass("no-transition")},1e3)})}(jQuery);