$(document).ready(function(){$(".img img:in-viewport").lazyload().addClass("in")});$(function(){$(".grid .item > a").click(function(){var e=$(this).closest(".item");if(e.attr("id")){$("#item-preview").attr("id","");$("#container").isotope();return!1}$("#item-preview").attr("id","");e.attr("id","item-preview");var t=e.find(".description");$.trim(t.text())||t.load(e.data("description-src"),function(){$(".grid .item .cancel").click(function(){$("#item-preview").attr("id","");$("#container").isotope()});window.init_share&&window.init_share()});var n=e.position().left,r=$("#container").width();t.css({left:-n,width:r});$("#container").isotope();return!1})});window.onresize=function(){$("#container").isotope({onLayout:function(){var e=$("#item-preview");if(!e.length)return;var t=e.position().left,n=$("#container").width();e.find(".description").css({left:-t,width:n})}})};$(window).load(function(){var e=$("#container"),t={};if(!e.length)return;e.isotope({itemSelector:".item",layoutMode:"fitRows"});var n=$("#filters"),r=$("#filter_summary");$(".filter a").click(function(n){n.preventDefault();var i=$(this),s=i.closest("li"),o=i.closest(".option-set"),u=o.attr("data-filter-group");t[u]=t[u]||[];var a=i.attr("data-filter-value"),f=o.attr("data-single-selection"),l=o.attr("data-hierarchical"),c=parseInt(s.attr("data-level"),10),h=i.attr("data-level-1-at"),p=i.attr("data-target"),d;h?d=$(h):c===1&&(d=i.closest(".level-1-container"));if(a)if(i.hasClass("selected")){i.removeClass("selected");s.removeClass("selected");if(d&&c===0){d.find("a.selected").click();d.find("ul.in").removeClass("in")}t[u]=jQuery.grep(t[u],function(e){return e!==a});$('li[data-filter-group="'+u+'"][data-filter-value="'+a+'"]',r).remove();r.children().length===1&&r.empty()}else{if(l)if(f)if(c===0){o.find("a.selected").click();d&&d.find("ul.in").removeClass("in");t[u]=[a]}else{d&&d.find("a.selected").click();t[u].push(a)}else t[u].push(a);else if(f){o.find("a.selected").click();t[u]=[a]}else t[u].push(a);i.addClass("selected");s.addClass("selected");d&&d.find(p).addClass("in");if(r.text()===""){s=$("<li><b>"+window.str_filter_selection+":</b></li>");r.append(s)}s=$('<li data-filter-group="'+u+'" data-filter-value="'+a+'"><a href="">'+i.text()+"</a></li>");r.append(s)}var v=[],m=[],g=[];for(var y in t){m.push(t[y].join(""));for(var b=0;b<t[y].length;b++){var w=t[y][b].replace(/\./,"");g.push(w);v.push('[data-filter-categories~="'+w+'"]')}}var E=v.join("");$.bbq.pushState({filter:m.join("")});e.isotope({filter:".item"+E});$(".img img:in-viewport").lazyload().addClass("in");e.trigger("map_filter",{filter:g});$(".isotope-item:not(.isotope-hidden) .img",e).trigger("appear");return!1});$("a",r).live("click",function(e){e.preventDefault();var t=$(this).closest("li"),r=t.attr("data-filter-group"),i=t.attr("data-filter-value");!r&&!i?$("a.selected",n).click():$('.filter[data-filter-group="'+r+'"] a[data-filter-value="'+i+'"]').click()});$("#filter_reset").live("click",function(e){e.preventDefault();$("a.selected",n).click()});if(window.location.hash){var i=window.location.hash?$.deparam.fragment(window.location.hash,!0):{};i.filter&&$(i.filter.split(".")).each(function(){if(!this)return;$('a[data-filter-value=".'+this+'"]',n).click()})}});