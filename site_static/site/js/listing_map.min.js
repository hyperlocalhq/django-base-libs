/* jshint unused:false, eqnull:false *//* global self: false *//* global jQuery: false *//* global google: false *//* global lazyload_images: false *//* global MarkerWithLabel: false *//* global oMap: true *//* global oCurrentLocationMarker: true */(function(e){e.fn.autoscroll=function(){e("html,body").animate({scrollLeft:this.offset().left,scrollTop:this.offset().top},500);return this}})(jQuery);var oMap;(function(e,t){function f(){n&&n.close();self.aGeopositions=[];for(var e=0,t=r.length;e<t;e++)r[e].setMap(null);r=[]}function l(){function m(e,t){e.labelContent=t;e.label.setContent()}var t=500,n=500,i=-500,f=-500,l=[],c=new google.maps.MarkerImage(self.settings.STATIC_URL+"site/img/marker_default.png",null,null,null,new google.maps.Size(25,35)),p=new google.maps.MarkerImage(self.settings.STATIC_URL+"site/img/marker_selected.png",null,null,null,new google.maps.Size(25,35)),d=null;if(window.location.hash){var v=window.location.hash?e.deparam.fragment(window.location.hash,!0):{};u=""+v.object_id}e(self.aGeopositions).each(function(o,h){var v=h.latitude,g=h.longitude;i<v&&(i=v);v<t&&(t=v);f<g&&(f=g);g<n&&(n=g);var y=new google.maps.LatLng(v,g),b;if(s[h.geo]){b=s[h.geo];b.categories+=" "+h.categories;b.html_sources.push(h.html_src);b.object_ids.push(h.object_id);m(b,'<span class="marker_label">'+s[h.geo].html_sources.length+"</span>")}else{b=new MarkerWithLabel({position:y,map:oMap,icon:c,labelContent:"",labelAnchor:new google.maps.Point(0,40),labelClass:"marker_label_wrapper",labelInBackground:!1});b.categories=h.categories;b.html_sources=[h.html_src];b.object_ids=[h.object_id];s[h.geo]=b;google.maps.event.addListener(b,"click",function(){if(a)return;a=!0;if(d&&d!==b){d.setZIndex(d.old_z_index);d.setIcon(c);b.setIcon(p);d=b;d.old_z_index=d.getZIndex()||5;d.setZIndex(google.maps.Marker.MAX_ZINDEX+1)}u||(u=b.object_ids[0]);e.bbq.pushState({object_id:u});e("#map-description").html("");var t=0;e.each(b.html_sources,function(n,r){e.get(r,function(n){t++;e("#map-description").append(n);if(t===b.html_sources.length){e("body").removeClass("map-only");e("#map-sidebar").removeClass("map-list map-filter").addClass("map-description");setTimeout(lazyload_images,500);google.maps.event.trigger(oMap,"resize");a=!1}},"html")});u=""})}b.getZIndex()||b.setZIndex(5);r.push(b);l.push(y);h.object_id===u&&(d=b)});navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var n=new google.maps.MarkerImage(self.settings.STATIC_URL+"site/img/marker_current.gif",null,null,null,new google.maps.Size(16,16));o=new google.maps.Marker({position:new google.maps.LatLng(t.coords.latitude,t.coords.longitude),map:oMap,icon:n,optimized:!1});o.setZIndex(google.maps.Marker.MAX_ZINDEX+2);e("#show-current-location").removeClass("hidden")},function(){},{enableHighAccuracy:!0});if(d){oMap.setCenter(d.getPosition());google.maps.event.trigger(d,"click")}else document.location.search&&h(oMap,l)}function c(t,n){var i=n.filter;e(r).each(function(){var e=this,t=!0,n=i.length,r,s,o;for(r=0;r<n;r++){o=i[r];s=new RegExp("\\b"+o+"\\b");if(!e.categories.match(s)){t=!1;break}}e.setVisible(t)})}function h(e,t){var n=new google.maps.LatLngBounds;for(var r=0,i=t.length;r<i;r++)n.extend(t[r]);var s=n.getNorthEast();n.extend(new google.maps.LatLng(s.lat()-.005,s.lng()-.005));var o=n.getNorthEast();n.extend(new google.maps.LatLng(o.lat()+.005,o.lng()+.005));e.fitBounds(n)}var n,r=[],i=null,s={},o,u="",a=!1;e(document).ready(function(){var t=e("body");if(t.length){var n={zoom:14,panControl:!1,zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,overviewMapControl:!1,center:new google.maps.LatLng(52.515306,13.363863),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}},r=document.getElementById("gmap");r&&(oMap=new google.maps.Map(r,n));t.bind("before_list_load",f).bind("after_list_load",l).bind("map_filter",c);t.trigger("after_list_load")}});e(window).load(function(){setTimeout(function(){e("body").removeClass("no-transition")},100)});e(document).ready(function(){e("#container").find(".item a").click(function(){var t=e(this).closest(".item"),n=t.data("geo"),r=s[n];if(r){u=t.data("object_id");google.maps.event.trigger(r,"click");oMap.panTo(r.getPosition())}return!1});e(document).on("click","#cancel-description",function(){e("#map-sidebar").removeClass("map-description").addClass("map-list");return!1});e(document).on("click","#cancel-filter",function(){e("#map-sidebar").removeClass("map-filter").addClass("map-list");return!1});e(document).on("click","#cancel-list",function(){e("body").toggleClass("map-only");setTimeout(function(){google.maps.event.trigger(oMap,"resize")},500);return!1});e("#toggle-map-filter").click(function(){e("#map-sidebar").toggleClass("map-filter").removeClass("map-list");google.maps.event.trigger(oMap,"resize");return!1});e("#toggle-sidebar").click(function(){e("body").toggleClass("map-only");setTimeout(function(){google.maps.event.trigger(oMap,"resize")},500)});e("#map-sidebar").hammer().on("swiperight",function(){e("body").addClass("map-only");setTimeout(function(){google.maps.event.trigger(oMap,"resize")},500)});e("#show-current-location").click(function(){oMap.panTo(o.getPosition());return!1});var t=document.referrer;e("#cancel-map").click(function(){t||(t="../");location.href=t;return!1})})})(jQuery);