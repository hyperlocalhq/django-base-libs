!function(e){e.fn.autoscroll=function(){return e("html,body").animate({scrollLeft:this.offset().left,scrollTop:this.offset().top},500),this}}(jQuery);var oMap;!function(e,o){function t(){i&&i.close(),self.aGeopositions=[];for(var e=0,o=s.length;o>e;e++)s[e].setMap(null);s=[]}function n(){function o(e,o){e.labelContent=o,e.label.setContent()}var t=500,n=500,a=-500,i=-500,r=[],d=new google.maps.MarkerImage(self.settings.STATIC_URL+"site/img/marker_default.png",null,null,null,new google.maps.Size(25,35)),u=new google.maps.MarkerImage(self.settings.STATIC_URL+"site/img/marker_selected.png",null,null,null,new google.maps.Size(25,35)),f=null;if(window.location.hash){var h=window.location.hash?e.deparam.fragment(window.location.hash,!0):{};p=""+h.object_id}e(self.aGeopositions).each(function(l,c){var h=c.latitude,b=c.longitude;h>a&&(a=h),t>h&&(t=h),b>i&&(i=b),n>b&&(n=b);var _=new google.maps.LatLng(h,b),v;g[c.geo]?(v=g[c.geo],v.categories+=" "+c.categories,v.html_sources.push(c.html_src),v.object_ids.push(c.object_id),o(v,'<span class="marker_label">'+g[c.geo].html_sources.length+"</span>")):(v=new MarkerWithLabel({position:_,map:oMap,icon:d,labelContent:"",labelAnchor:new google.maps.Point(0,40),labelClass:"marker_label_wrapper",labelInBackground:!1}),v.categories=c.categories,v.html_sources=[c.html_src],v.object_ids=[c.object_id],g[c.geo]=v,google.maps.event.addListener(v,"click",function(){if(!m){m=!0,f&&f!==v&&(f.setZIndex(f.old_z_index),f.setIcon(d)),v.setIcon(u),f=v,f.old_z_index=f.getZIndex()||5,f.setZIndex(google.maps.Marker.MAX_ZINDEX+1),p||(p=v.object_ids[0]),e.bbq.pushState({object_id:p}),e("#map-description").html("");var o=0;e.each(v.html_sources,function(t,n){e.get(n,function(t){o++,e("#map-description").append(t),o===v.html_sources.length&&(e("body").removeClass("map-only"),e("#map-sidebar").removeClass("map-list map-filter").addClass("map-description"),setTimeout(lazyload_images,500),google.maps.event.trigger(oMap,"resize"),m=!1)},"html")}),p=""}})),v.getZIndex()||v.setZIndex(5),s.push(v),r.push(_),c.object_id===p&&(f=v)}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(o){var t=new google.maps.MarkerImage(self.settings.STATIC_URL+"site/img/marker_current.gif",null,null,null,new google.maps.Size(16,16));c=new google.maps.Marker({position:new google.maps.LatLng(o.coords.latitude,o.coords.longitude),map:oMap,icon:t,optimized:!1}),c.setZIndex(google.maps.Marker.MAX_ZINDEX+2),e("#show-current-location").removeClass("hidden")},function(){},{enableHighAccuracy:!0}),f?(oMap.setCenter(f.getPosition()),google.maps.event.trigger(f,"click")):document.location.search&&l(oMap,r)}function a(o,t){var n=t.filter;e(s).each(function(){var e=this,o=!0,t=n.length,a,l,i;for(a=0;t>a;a++)if(i=n[a],l=new RegExp("\\b"+i+"\\b"),!e.categories.match(l)){o=!1;break}e.setVisible(o)})}function l(e,o){for(var t=new google.maps.LatLngBounds,n=0,a=o.length;a>n;n++)t.extend(o[n]);var l=t.getNorthEast();t.extend(new google.maps.LatLng(l.lat()-.005,l.lng()-.005));var i=t.getNorthEast();t.extend(new google.maps.LatLng(i.lat()+.005,i.lng()+.005)),e.fitBounds(t)}var i,s=[],r=null,g={},c,p="",m=!1;e(document).ready(function(){var o=e("body");if(o.length){var l={zoom:14,panControl:!1,zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,overviewMapControl:!1,center:new google.maps.LatLng(52.515306,13.363863),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}},i=document.getElementById("gmap");i&&(oMap=new google.maps.Map(i,l)),o.bind("before_list_load",t).bind("after_list_load",n).bind("map_filter",a),o.trigger("after_list_load")}}),e(window).load(function(){setTimeout(function(){e("body").removeClass("no-transition")},100)}),e(document).ready(function(){e("#container").find(".item a").click(function(){var o=e(this).closest(".item"),t=o.data("geo"),n=g[t];return n&&(p=o.data("object_id"),google.maps.event.trigger(n,"click"),oMap.panTo(n.getPosition())),!1}),e(document).on("click","#cancel-description",function(){return e("body").toggleClass("map-only"),setTimeout(function(){google.maps.event.trigger(oMap,"resize")},500),!1}),e("#toggle-map-filter").click(function(){return e("#map-sidebar").toggleClass("map-filter").removeClass("map-list"),google.maps.event.trigger(oMap,"resize"),!1}),e("#toggle-sidebar").click(function(){e("body").toggleClass("map-only"),setTimeout(function(){google.maps.event.trigger(oMap,"resize")},500)}),e("#map-sidebar").hammer().on("swiperight",function(){e("body").addClass("map-only"),setTimeout(function(){google.maps.event.trigger(oMap,"resize")},500)}),e("#show-current-location").click(function(){return oMap.panTo(c.getPosition()),!1});var o=document.referrer;e("#cancel-map").click(function(){return o||(o="../"),location.href=o,!1}),e("#map-description").bind("scrollstop",lazyload_images)})}(jQuery);