!function(t,e){function o(){t("#photos").each(function(){var e=t(this).data("load-url");t(this).load(e+" #photos>*",function(){t("#photos").sortable({placeholder:"ui-state-highlight",update:function(o,i){var n=[];t(".item","#photos").each(function(){t(this).data("token")&&(n[n.length]=t(this).data("token"))}),t.post(e,{ordering:n.join(",")})},forcePlaceholderSize:!0,create:function(){var e=this;resize=function(){t(e).css("height","auto")},t(e).find("img").load(resize).error(resize)}}),t("#photos").disableSelection().find(".edit").click(function(){return t("#edit_photo").load(t(this).attr("href")+" .content form",i),t("#photos").closest(".fieldset").hide(),t(".form-actions:last").hide(),!1}),t("#photos").find(".crop").each(function(){t(this).attr("href")&&t(this).attr("href",t(this).attr("href").replace(/goto_next=.+$/gim,"goto_next="+location.href))}),t("#add_photo").click(function(){return t("#edit_photo").load(t(this).attr("href")+" .content form",i),t("#photos").closest(".fieldset").hide(),t(".form-actions:last").hide(),!1}),t(window).trigger("scrollstop")})}),t("#photos").closest(".fieldset").show(),t(".form-actions:last").show()}function i(){t("#button-id-cancel").click(function(){t("#edit_photo").html(""),o()}),t("#button-id-crop-photo").click(function(){location.href=t(this).data("href").replace(/goto_next=.+$/,"goto_next="+location.href)}),t("#button-id-delete-photo").click(function(){var e=t(this).data("href");t("#deleteConfirmation").modal("show"),t("#button-id-confirm-deletion").click(function(){return t.post(e,{},function(){t("#deleteConfirmation").modal("hide"),t("#edit_photo").html(""),o()}),!1})}),t("#edit_photo form").attr("target","hidden_iframe"),self.hidden_iframe_loaded=function(e){var n=t("<div>"+e+"</div>").find("form");n.length?(t("#edit_photo").html("").append(n),i()):(t("#edit_photo").html(""),o())};var e=t.extend(translatable_file_uploader_options,{allowedExtensions:["gif","jpg","png","tif","bmp"],action:"/helper/ajax-upload/",element:t("#image_uploader")[0],multiple:!1,onComplete:function(e,o,i){i.success&&(t(".messages").html(""),t("#id_media_file_path").val("uploads/"+o),t.post("/helper/modified-path/",{file_path:"uploads/"+o,mod_sysname:"one_column"},function(e,o,i){t("#image_preview").html('<img alt="" src="/media/'+e+'" />'),t("#image_uploader").hide(),t("#image_help_text").hide()},"text"))},onAllComplete:function(e){t(".qq-upload-success").fadeOut("slow",function(){t(this).remove()})},params:{csrf_token:t('input[name="csrfmiddlewaretoken"]').val(),csrf_name:"csrfmiddlewaretoken",csrf_xname:"X-CSRFToken"},showMessage:function(e){t(".messages").html('<div class="alert alert-error">'+e+"</div>")}}),n=new qq.FileUploader(e)}t(function(){o()})}(jQuery);