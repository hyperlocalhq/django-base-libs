function redo_description(){var t=$("#container"),e=$("#item-preview");if(e.length){var i=e.find(".description"),a=e.position().left,r=t.width(),l=parseInt(t.css("margin-left"),10),n=parseInt(t.css("margin-right"),10);i.css({left:-a,width:r+l+n}),isotope_list()}}$(function(){$("#map-list-link").click(function(){return location.href=$(this).attr("href")+location.hash,!1}),$("#container .item > a").click(function(){var t=$(this).closest(".item");if(redo_description(),t.attr("id"))return $("#item-preview").attr("id",""),isotope_list(),lazyload_images(),!1;$("#item-preview").attr("id",""),t.attr("id","item-preview");var e=t.find(".description");return $.trim(e.text())?isotope_list():e.load(t.data("description-src"),function(){$("#container .item .cancel").click(function(){$("#item-preview").attr("id",""),isotope_list(),lazyload_images()}),redo_description(),window.init_share&&window.init_share()}),!1})}),$(window).load(function(){var t=$("#container"),e={};if(t.length){var i=$("#filters"),a=$("#filter-summary");if($(".filter a").click(function(i){i.preventDefault();var r=$(this),l=r.closest("li"),n=r.closest(".option-set"),s=n.attr("data-filter-group");e[s]=e[s]||[];var o=r.attr("data-filter-value"),c=n.attr("data-single-selection"),d=n.attr("data-hierarchical"),f=parseInt(l.attr("data-level"),10),p=r.attr("data-level-1-at"),u=r.attr("data-target"),v;p?v=$(p):1===f&&(v=r.closest(".level-1-container")),o&&(r.hasClass("selected")?(r.removeClass("selected"),l.removeClass("selected"),v&&0===f&&(v.find("a.selected").click(),v.find("ul.in").removeClass("in")),e[s]=jQuery.grep(e[s],function(t){return t!==o}),$('li[data-filter-group="'+s+'"][data-filter-value="'+o+'"]',a).remove(),1===a.children().length&&a.empty()):(d?c?0===f?(n.find("a.selected").click(),v&&v.find("ul.in").removeClass("in"),e[s]=[o]):(v&&v.find("a.selected").click(),e[s].push(o)):e[s].push(o):c?(n.find("a.selected").click(),e[s]=[o]):e[s].push(o),r.addClass("selected"),l.addClass("selected"),v&&v.find(u).addClass("in"),""===a.text()&&(l=$("<li><b>"+window.str_filter_selection+":</b></li>"),a.append(l)),l=$('<li data-filter-group="'+s+'" data-filter-value="'+o+'"><a href="">'+r.text()+"</a></li>"),a.append(l)));var h=[],m=[],g=[];for(var w in e){m.push(e[w].join(""));for(var k=0;k<e[w].length;k++){var _=e[w][k].replace(/\./,"");g.push(_),h.push('[data-filter-categories~="'+_+'"]')}}var C=h.join("");return $.bbq.pushState({filter:m.join("")}),t.isotope({filter:".item"+C}),t.data("isotope").$filteredAtoms.length?(t.removeClass("empty"),$("#empty-container").removeClass("on")):(t.addClass("empty"),$("#empty-container").addClass("on")),lazyload_images(),t.trigger("map_filter",{filter:g}),$(".isotope-item:not(.isotope-hidden) .img",t).trigger("appear"),!1}),$("a",a).live("click",function(t){t.preventDefault();var e=$(this).closest("li"),a=e.attr("data-filter-group"),r=e.attr("data-filter-value");a||r?$('.filter[data-filter-group="'+a+'"] a[data-filter-value="'+r+'"]').click():$("a.selected",i).click()}),$("#filter-reset").live("click",function(t){t.preventDefault(),$("a.selected",i).click()}),window.location.hash){var r=window.location.hash?$.deparam.fragment(window.location.hash,!0):{};r.filter&&$(r.filter.split(".")).each(function(){this&&$('a[data-filter-value=".'+this+'"]',i).click()})}}}),$(window).load(function(){setTimeout(function(){$("body").removeClass("no-transition")},1e3)});