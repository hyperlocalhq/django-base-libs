(function(e,t){function f(e,t,n){e.setDraggable(!0);google.maps.event.addListener(e,"dragend",function(){var r=e.getPosition();t(r.lat(),r.lng(),n)})}function l(e,t){var n=new google.maps.Geocoder;n.geocode({address:e},function(e,n){n==google.maps.GeocoderStatus.OK?t(e):t(!1)})}var n=window.gettext||function(e){return e},r=window.settings.STATIC_URL+"site/img/gmap/",s,o,u,a;self.GMapManager={init:function(){var t=self.GMapManager,n=e("#gmap_wrapper").removeClass("hidden");if(n.length){e("#dyn_locate_geo").click(t.recognizeLocation);e("#dyn_remove_geo").click(t.removeGeoPos);var r=e('<div id="gmap">').prependTo(n),i={scrollwheel:!1,zoom:15,center:new google.maps.LatLng(52.523781,13.411895),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},disableDoubleClickZoom:!0};s=new google.maps.Map(r.get(0),i);google.maps.event.addListener(s,"dblclick",function(n){e("#id_latitude").val(n.latLng.lat());e("#id_longitude").val(n.latLng.lng());t.adjustGeoposition()});u=e('<ul id="gmap_locations">').appendTo(n).hide();t.adjustGeoposition();e("#id_street_address").blur(t.recognizeLocation);e("#id_street_address2").blur(t.recognizeLocation);e("#id_postal_code").blur(t.recognizeLocation);e("#id_city").blur(t.recognizeLocation);e("#id_country").change(t.recognizeLocation)}},recognizeLocation:function(){var e=self.GMapManager;l(e.getAddress4search(),e.autocompleteAddress)},removeGeoPos:function(){var t=self.GMapManager;e("#id_latitude").val("");e("#id_longitude").val("");o.setMap(null)},getAddress4search:function(){var t=[];t.push(e("#id_street_address").val()+" "+e("#id_street_address2").val());t.push(e("#id_city").val());t.push("Germany");t.push(e("#id_postal_code").val());return t.join(", ")},adjustGeoposition:function(){var t=self.GMapManager,n=e("#id_latitude"),r=e("#id_longitude");n.val()&&r.val()&&t.markGeoposition(n.val(),r.val())},drawMarker:function(e){var t=self.GMapManager,n=new google.maps.MarkerImage(window.settings.STATIC_URL+"site/img/gmap/markers_1-10.png",new google.maps.Size(20,34),new google.maps.Point(0,340),new google.maps.Point(10,34)),r=new google.maps.MarkerImage(window.settings.STATIC_URL+"site/img/gmap/marker_shadow.png",new google.maps.Size(37,34),new google.maps.Point(0,0),new google.maps.Point(8,25));o=new google.maps.Marker({position:e,map:s,shadow:r,icon:n})},markGeoposition:function(e,t){var n=self.GMapManager,r=new google.maps.LatLng(e,t);if(o){o.setMap(null);o=null}n.drawMarker(r);s.panTo(r,15);f(o,n.correctGeoposition,{bNoSuggest:!0})},correctGeoposition:function(t,n,r){t=Math.round(t*1e6)/1e6;n=Math.round(n*1e6)/1e6;e("#id_latitude").val(t);e("#id_longitude").val(n)},autocompleteAddress:function(t){a=t;u.html("");var r=t.length;if(a)if(r>1){for(i=0;i<r;i++)e('<a href="">'+t[i].formatted_address+"</a>").data("gmap_index",i).click(function(){var t=a[e(this).data("gmap_index")],n=t.address_components;GMapManager.extractFromXAL(n);var r=t.geometry.location,i=GMapManager.correctGeoposition(r.lat(),r.lng(),{});i||GMapManager.markGeoposition(r.lat(),r.lng());u.hide();return!1}).appendTo(e("<li>").appendTo(u));e('<a href="">'+n("None of the listed")+"</a>").click(function(){u.hide();return!1}).appendTo(e("<li>").appendTo(u));u.show()}else{u.hide();var s=a[0],o=s.address_components;GMapManager.extractFromXAL(o);var f=s.geometry.location,l=GMapManager.correctGeoposition(f.lat(),f.lng(),{});l||GMapManager.markGeoposition(f.lat(),f.lng())}},extractFromXAL:function(t){var n=self.GMapManager,r,i=t.length,s,o;for(r=0;r<i;r++){oObj=t[r];switch(oObj.types[0]){case"locality":document.getElementById("id_city").value=oObj.long_name;break;case"street_number":o=oObj.long_name;break;case"route":s=oObj.long_name;break;case"postal_code":document.getElementById("id_postal_code").value=oObj.long_name;break;case"country":}}if(s){var u=s;o&&(u+=" "+o);var a=e("#id_street_address");a.val(u)}},destruct:function(){}};e(document).ready(function(){self.GMapManager.init()});e(window).unload(function(){self.GMapManager.destruct()})})(jQuery);