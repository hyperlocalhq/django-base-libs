!function(t,e){function o(){lazyload_images(),t("#photos").each(function(){var e=t(this).data("load-url");t(this).load(e+" #photos>*",function(){t("#photos").sortable({placeholder:"ui-state-highlight",update:function(o,i){var n=[];t(".photo","#photos").each(function(){t(this).data("token")&&(n[n.length]=t(this).data("token"))}),t.post(e,{ordering:n.join(",")})},forcePlaceholderSize:!0,create:function(){var e=this,o=function(){t(e).css("height","auto")};t(e).find("img").load(o).error(o)}}),t("#photos").disableSelection().find(".edit").click(function(){return t("#edit_photo").load(t(this).attr("href")+" #edit_photo form",i),t("#photos").parents("fieldset:first").hide(),t(".form-actions:last").hide(),!1}),t("#add_photo").click(function(){return t("#edit_photo").load(t(this).attr("href")+" #edit_photo form",i),t("#photos").parents("fieldset:first").hide(),t(".form-actions:last").hide(),!1}),t("#photos").find(".crop").each(function(){t(this).attr("href")&&t(this).attr("href",t(this).attr("href").replace(/goto_next=.+$/gim,"goto_next="+location.href))}),t(window).trigger("scrollstop")})}),t("#photos").parents("fieldset:first").show(),t(".form-actions:last").show()}function i(){t("textarea").autosize(),activate_form_language(window.settings.lang),t("#button-id-cancel").click(function(){t("#edit_photo").html(""),o()}),t("#button-id-crop-photo").click(function(){location.href=t(this).data("href").replace(/goto_next=.+$/,"goto_next="+location.href)}),t("#button-id-delete-photo").click(function(){var e=t(this).data("href");t("#deleteConfirmation").modal("show"),t("#button-id-confirm-deletion").click(function(){return t.post(e,{},function(){t("#deleteConfirmation").modal("hide"),t("#edit_photo").html(""),o()}),!1})}),t("#edit_photo form").attr("target","hidden_iframe"),self.hidden_iframe_loaded=function(e){var n=t("<div>"+e+"</div>").find("form");n.length?(t("#edit_photo").html("").append(n),i()):(t("#edit_photo").html(""),o())};var e=t.extend(translatable_file_uploader_options,{allowedExtensions:["gif","jpg","png","tif","bmp"],action:"/"+self.settings.lang+"/helper/ajax-upload/",element:t("#image_uploader")[0],multiple:!1,onComplete:function(e,o,i){i.success&&(t(".messages").html(""),t("#id_media_file_path").val("uploads/"+o),t.post("/"+self.settings.lang+"/helper/modified-path/",{file_path:"uploads/"+o,mod_sysname:"medium"},function(e,o,i){t("#image_preview").html('<img class="img-responsive" alt="" src="/media/'+e+'" />'),t("#image_uploader").hide(),t("#image_help_text").hide()},"text"))},onAllComplete:function(e){t(".qq-upload-success").fadeOut("slow",function(){t(this).remove()})},params:{csrf_token:t('input[name="csrfmiddlewaretoken"]').val(),csrf_name:"csrfmiddlewaretoken",csrf_xname:"X-CSRFToken"},showMessage:function(e){t(".messages").html('<div class="alert alert-danger">'+e+"</div>")}}),n=new qq.FileUploader(e)}t(document).on("click","#crop_list_image",function(){return location.href=t("#photos").find(".crop_list_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href),!1}),t(document).on("click","#crop_cover_image",function(){return location.href=t("#photos").find(".crop_cover_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href),!1}),t(function(){o()})}(jQuery);