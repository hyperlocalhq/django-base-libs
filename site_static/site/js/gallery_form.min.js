(function(e,t){function n(){e("#photos").each(function(){var t=e(this).data("load-url");e(this).load(t+" #photos>*",function(){e("#photos").sortable({placeholder:"ui-state-highlight",update:function(n,r){var i=[];e(".item","#photos").each(function(){e(this).data("token")&&(i[i.length]=e(this).data("token"))});e.post(t,{ordering:i.join(",")})},forcePlaceholderSize:!0,create:function(){var t=this;resize=function(){e(t).css("height","auto")};e(t).find("img").load(resize).error(resize)}});e("#photos").disableSelection().find(".edit").click(function(){e("#edit_photo").load(e(this).attr("href")+" .content form",r);e("#photos").parents("fieldset:first").hide();e(".form-actions:last").hide();return!1});e("#photos").find(".crop").each(function(){e(this).attr("href")&&e(this).attr("href",e(this).attr("href").replace(/goto_next=.+$/gim,"goto_next="+location.href))});e("#add_photo").click(function(){e("#edit_photo").load(e(this).attr("href")+" .content form",r);e("#photos").parents("fieldset:first").hide();e(".form-actions:last").hide();return!1});e(window).trigger("scrollstop")})});e("#photos").parents("fieldset:first").show();e(".form-actions:last").show()}function r(){e("#button-id-cancel").click(function(){e("#edit_photo").html("");n()});e("#button-id-crop-photo").click(function(){location.href=e(this).data("href").replace(/goto_next=.+$/,"goto_next="+location.href)});e("#button-id-delete-photo").click(function(){var t=e(this).data("href");e("#deleteConfirmation").modal("show");e("#button-id-confirm-deletion").click(function(){e.post(t,{},function(){e("#deleteConfirmation").modal("hide");e("#edit_photo").html("");n()});return!1})});e("#edit_photo form").attr("target","hidden_iframe");self.hidden_iframe_loaded=function(t){var i=e("<div>"+t+"</div>").find("form");if(i.length){e("#edit_photo").html("").append(i);r()}else{e("#edit_photo").html("");n()}};var t=e.extend(translatable_file_uploader_options,{allowedExtensions:["gif","jpg","png","tif","bmp"],action:"/helper/ajax-upload/",element:e("#image_uploader")[0],multiple:!1,onComplete:function(t,n,r){if(r.success){e(".messages").html("");e("#id_media_file_path").val("uploads/"+n);e.post("/helper/modified-path/",{file_path:"uploads/"+n,mod_sysname:"one_column"},function(t,n,r){e("#image_preview").html('<img alt="" src="/media/'+t+'" />');e("#image_uploader").hide();e("#image_help_text").hide()},"text")}},onAllComplete:function(t){e(".qq-upload-success").fadeOut("slow",function(){e(this).remove()})},params:{csrf_token:e('input[name="csrfmiddlewaretoken"]').val(),csrf_name:"csrfmiddlewaretoken",csrf_xname:"X-CSRFToken"},showMessage:function(t){e(".messages").html('<div class="alert alert-error">'+t+"</div>")}}),i=new qq.FileUploader(t)}e(function(){n()})})(jQuery);