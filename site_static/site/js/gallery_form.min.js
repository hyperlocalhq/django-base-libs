!function(t,o){function e(){lazyload_images(),t("#photos").each(function(){var o=t(this).data("load-url");t(this).load(o+" #photos>*",function(){t("#photos").sortable({placeholder:"ui-state-highlight",update:function(e,i){var n=[];t(".photo","#photos").each(function(){t(this).data("token")&&(n[n.length]=t(this).data("token"))}),t.post(o,{ordering:n.join(",")})},forcePlaceholderSize:!0,create:function(){var o=this,e=function(){t(o).css("height","auto")};t(o).find("img").load(e).error(e)}}),t("#photos").disableSelection().find(".edit").click(function(){return t("#edit_photo").load(t(this).attr("href")+" #edit_photo form",i),t("#photos").parents("fieldset:first").hide(),t(".form-actions:last").hide(),!1}),t("#add_photo").click(function(){return t("#edit_photo").load(t(this).attr("href")+" #edit_photo form",i),t("#photos").parents("fieldset:first").hide(),t(".form-actions:last").hide(),!1}),t("#photos").find(".crop").each(function(){t(this).attr("href")&&t(this).attr("href",t(this).attr("href").replace(/goto_next=.+$/gim,"goto_next="+location.href))}),t(window).trigger("scrollstop")})}),t("#photos").parents("fieldset:first").show(),t(".form-actions:last").show()}function i(){t("textarea").autosize(),t("#button-id-cancel").click(function(){t("#edit_photo").html(""),e()}),t("#button-id-crop-photo").click(function(){location.href=t(this).data("href").replace(/goto_next=.+$/,"goto_next="+location.href)}),t("#button-id-delete-photo").click(function(){var o=t(this).data("href");t("#deleteConfirmation").modal("show"),t("#button-id-confirm-deletion").click(function(){return t.post(o,{},function(){t("#deleteConfirmation").modal("hide"),t("#edit_photo").html(""),e()}),!1})}),t("#edit_photo form").attr("target","hidden_iframe"),self.hidden_iframe_loaded=function(o){var n=t("<div>"+o+"</div>").find("form");n.length?(t("#edit_photo").html("").append(n),i()):(t("#edit_photo").html(""),e())};var o=t.extend(translatable_file_uploader_options,{allowedExtensions:["gif","jpg","png","tif","bmp"],action:"/"+self.settings.lang+"/helper/ajax-upload/",element:t("#image_uploader")[0],multiple:!1,onComplete:function(o,e,i){i.success&&(t(".messages").html(""),t("#id_media_file_path").val("uploads/"+e),t.post("/"+self.settings.lang+"/helper/modified-path/",{file_path:"uploads/"+e,mod_sysname:"medium"},function(o,e,i){t("#image_preview").html('<img class="img-responsive" alt="" src="/media/'+o+'" />'),t("#image_uploader").hide(),t("#image_help_text").hide()},"text"))},onAllComplete:function(o){t(".qq-upload-success").fadeOut("slow",function(){t(this).remove()})},params:{csrf_token:t('input[name="csrfmiddlewaretoken"]').val(),csrf_name:"csrfmiddlewaretoken",csrf_xname:"X-CSRFToken"},showMessage:function(o){t(".messages").html('<div class="alert alert-danger">'+o+"</div>")}}),n=new qq.FileUploader(o)}t(document).on("click","#crop_list_image",function(){return location.href=t("#photos").find(".crop_list_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href),!1}),t(document).on("click","#crop_cover_image",function(){return location.href=t("#photos").find(".crop_cover_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href),!1}),t(function(){e()})}(jQuery);