(function($, undefined) {    self.CollapsibleBlocks = {        // used for collapsible list-items        bAllCollapsed: false,        init: function() {            var oSelf = self.CollapsibleBlocks;            $(".visibility_toggler a").click(oSelf.toggle);            $(".collapse_all").click(oSelf.toggle_all);            $(".expand_all").click(oSelf.toggle_all);            $(".collapsed .hidable").hide();        },        destruct: function() {            self.CollapsibleBlocks = null;        },        toggle: function() {            var oSelf = self.CollapsibleBlocks;            var $oLink = $(this);            var $oBlock = $oLink.parents(".expanded,.collapsed");            $oBlock.toggleClass("expanded").toggleClass("collapsed");            $(".collapsed .hidable").slideUp();            $(".expanded .hidable").slideDown();            return false;        },        toggle_all: function() {            var oSelf = self.CollapsibleBlocks;            var $oLink = $(this);            oSelf.bAllCollapsed = !oSelf.bAllCollapsed;            if (oSelf.bAllCollapsed) {                $oLink.text(gettext("show details"));                $oLink.removeClass("collapse_all").addClass("expand_all");                $(".expanded").each(function(){                    $(this).removeClass("expanded").addClass("collapsed");                });            } else {                $oLink.text(gettext("hide details"));                $oLink.removeClass("expand_all").addClass("collapse_all");                $(".collapsed").each(function(){                    $(this).removeClass("collapsed").addClass("expanded");                });            }            $(".collapsed .hidable").slideUp();            $(".expanded .hidable").slideDown();            return false;        }    };        self.CollapsibleNavigationBlocks = {        preinit: function() {            var aCookies = document.cookie.split("; ");            dyn_css_rule(                ".nav_collapsed .hidable",                "display: none;"            );            var i = 0;            var iLen = aCookies.length;            for (i=0; i<iLen; i++) {                var aCookie = aCookies[i].split("=");                var sKey = aCookie[0];                var sValue = aCookie[1];                if (sKey.indexOf("_expanded") == sKey.length - 9) {                    if (sValue == "1") {                        dyn_css_rule(                            "#" + sKey.substr(0, sKey.length - 9) + " .hidable",                            "display: block;"                        );                    } else {                        dyn_css_rule(                            "#" + sKey.substr(0, sKey.length - 9) + " .hidable",                            "display: none;"                        );                    }                }            }        },        init: function() {            var oSelf = self.CollapsibleNavigationBlocks;            $(".open_but").live("click", oSelf.toggle);            var aCookies = document.cookie.split("; ");            var i = 0;            var iLen = aCookies.length;            for (i=0; i<iLen; i++) {                var aCookie = aCookies[i].split("=");                var sKey = aCookie[0];                var sValue = aCookie[1];                if (sKey.indexOf("_expanded") == sKey.length - 9) {                    var block_id = sKey.substr(0, sKey.length - 9);                    if (block_id) {                        if (sValue == "1") {                            $("#" + block_id).removeClass("nav_collapsed").addClass("nav_expanded");                        } else {                            $("#" + block_id).removeClass("nav_expanded").addClass("nav_collapsed");                        }                    }                }            }        },        destruct: function() {            self.CollapsibleNavigationBlocks = null;        },        toggle: function(event) {            var oSelf = self.CollapsibleNavigationBlocks;            var $oLink = $(this);            var $oBlock = $oLink.parents(".nav_collapsed,.nav_expanded");            if ($oBlock.find(".hidable").is(":hidden")) {                oSelf.expand($oBlock);            } else {                oSelf.collapse($oBlock);            }            return false;        },        collapse: function($oBlock) {            var oSelf = self.CollapsibleNavigationBlocks;            $oBlock.removeClass(                "nav_expanded"            ).addClass(                "nav_collapsed"            ).find(".hidable").show().slideUp("normal");            var sId = $oBlock.attr("id");            if (sId) {                $.cookie(                    sId + "_expanded",                    "0",                    {expires: 7, path: "/"}                );            }        },        expand: function($oBlock) {            var oSelf = self.CollapsibleNavigationBlocks;            $oBlock.removeClass(                "nav_collapsed"            ).addClass(                "nav_expanded"            ).find(".hidable").hide().slideDown("normal");            var sId = $oBlock.attr("id");            if (sId) {                $.cookie(                    sId + "_expanded",                    "1",                    {expires: 7, path: "/"}                );            }        }    };        self.CollapsibleNavigationBlocks.preinit();    $(document).ready(function() {        self.CollapsibleBlocks.init();        self.CollapsibleNavigationBlocks.init();    });        $(window).unload(function() {        self.CollapsibleBlocks.destruct();        self.CollapsibleNavigationBlocks.destruct();    });}(jQuery));