(function(e){function t(){var t=e(this).parent().parent().parent().parent().children("div.plugin-editor"),n=e(this).parent().attr("id").split("plugin_")[1];i(t,n);return!1}function n(){var t=e(this).parent().attr("id").split("plugin_")[1],n=gettext("Are you sure you want to delete this plugin?"),r=confirm(n,!0),i=window.location.href.split("/"),s=i[i.length-2];r&&e.post("remove-plugin/",{plugin_id:t,page_id:s},function(t){var n=t.split(",");id=n.shift();e("#plugin_"+id).remove();e("#iframe_"+id).parent().html("<p>"+n.join(",")+"</p>")},"html")}function r(){e("ul.plugin-list .text").unbind("click",t);e("ul.plugin-list span.delete").unbind("click",n);e("ul.plugin-list .text").click(t);e("ul.plugin-list span.delete").click(n)}function i(t,n){var r='<iframe id="iframe_'+n+'" src="edit-plugin/'+n+'/" frameborder="0"></iframe>';t.html(r);e("ul.plugin-list .active").removeClass("active");e("#plugin_"+n).addClass("active")}cms_plugin_editor_jQuery=e;e(document).ready(function(){e("span.add-plugin").click(function(){var t=e(this).parent().children("select[name=plugins]"),n=t.attr("value"),s=e(this).parent().parent().data("id"),o=e("input.language_button.selected").attr("name");o||(o=e("input[name=language]").attr("value"));!o;var u=e(this).parent().parent().parent().children("div.plugin-editor");if(n){var a=t.children("[selected]").text(),f=e(this).parent().parent().children("ul.plugin-list");e.ajax({url:"add-plugin/",dataType:"html",type:"POST",data:{placeholder:s,plugin_type:n,language:o},success:function(e){i(u,e);f.append('<li id="plugin_'+e+'" class="'+n+' active"><span class="drag"></span><span class="text">'+a+'</span><span class="delete"></span></li>');r()},error:function(e){e.status<500&&alert(e.responseText)}})}});e("span.copy-plugins").click(function(){var t=e(this).parent().children("select[name=copy-plugins]").attr("value"),n=e(this).parent().parent().data("id"),i=window.location.href.split("/"),s=i[i.length-2],o=e("input.language_button.selected").attr("name");o||(o=e("input[name=language]").attr("value"));!o;if(t&&t!=""){var u=e(this).parent().parent().children("ul.plugin-list");e.ajax({url:"copy-plugins/",dataType:"html",type:"POST",data:{page_id:s,placeholder:n,copy_from:t,language:o},success:function(e){u.empty().append(e);r()},error:function(e){e.status<500&&alert(e.responseText)}})}});e("ul.plugin-list").sortable({handle:"span.drag",axis:"y",opacity:.9,zIndex:2e3,dropOnEmpty:!0,connectWith:".plugin-list",update:function(t,n){var r=e(this).sortable("toArray"),i="";for(var s=0;s<r.length;s++){i+=r[s].split("plugin_")[1];s!=r.length-1&&(i+="_")}if(n.sender){var o=n.item.attr("id").split("plugin_")[1],u=n.item.parent().parent().data("name"),a=n.item.parent().parent().data("id");e.ajax({url:"move-plugin/",dataType:"html",type:"POST",data:{placeholder:u,placeholder_id:a,plugin_id:o,ids:i},error:function(e){e.status<500&&alert(e.responseText);n.sender.sortable("cancel")}})}else i&&e.post("move-plugin/",{ids:i},function(){},"json")}});r()});setiframeheight=function(t,n){e("#iframe_"+n).height(t+"px")};hide_iframe=function(t,n,r,i){html="<b>"+n+"</b>";r!=""&&r!=null&&(html+=" [ "+r+" ]");e("#plugin_"+t+" span.text").html(html);e("#iframe_"+t).parent().html("<p>"+i+"</p>")};removed_cancelled_plugin=function(t){e("#plugin_"+t).remove()}})(jQuery);