/*##################################################|*//* #CMS.TOOLBAR# */CMS.$(document).ready(function(e){e=CMS.$||e;CMS.Toolbar=CMS.Class.$extend({implement:[CMS.API.Helpers,CMS.API.Security],options:{debug:!1,items:[]},initialize:function(t,n){var r=this;if(e(t).length>2)throw new Error("Toolbar Error: one element expected, multiple elements given.");this.options=e.extend(this.options,n);this.wrapper=e(t);this.toolbar=this.wrapper.find("#cms_toolbar-toolbar");this.toolbar.left=this.toolbar.find(".cms_toolbar-left");this.toolbar.right=this.toolbar.find(".cms_toolbar-right");this.toggle=this.wrapper.find("#cms_toolbar-toggle");this.toggle.bind("click",function(e){e.preventDefault();r.toggleToolbar()});this._setup()},_setup:function(){var t=this;e.cookie("CMS_toolbar-collapsed")=="false"?this.toolbar.data("collapsed",!0):this.toolbar.data("collapsed",!1);this.toggleToolbar();this.wrapper.show();setTimeout(function(){t.wrapper.show()},50);this.options.items.length&&this.registerItems(this.options.items);this.csrf();if(e.browser.msie&&e.browser.version<="6.0"){e(window).bind("resize",function(){t.wrapper.css("width",e(window).width())});e(window).trigger("resize")}},isToolbarHidden:function(){return this.toolbar.data("collapsed")},toggleToolbar:function(){this.toolbar.data("collapsed")?this._showToolbar():this._hideToolbar();return this.toolbar.data("collapsed")},_showToolbar:function(){var t=parseInt(e(document.body).css("margin-top"),10);e(document.body).css("margin-top",t+43);this.toolbar.show();e("html").toggleClass("cms_toolbar-toolbar",!0);this.toolbar.data("collapsed",!1);this.toggle.addClass("cms_toolbar-collapsed");e.cookie("CMS_toolbar-collapsed",!1,{path:"/",expires:7});this.toolbar.trigger("cms.toolbar.show")},_hideToolbar:function(){var t=parseInt(e(document.body).css("margin-top"),10);e(document.body).css("margin-top",t-this.toolbar.height()-1);this.toolbar.hide();e("html").toggleClass("cms_toolbar-toolbar",!1);this.toolbar.data("collapsed",!0);this.toggle.removeClass("cms_toolbar-collapsed");e.cookie("CMS_toolbar-collapsed",!0,{path:"/",expires:7});this.toolbar.trigger("cms.toolbar.hide")},registerItem:function(e){if(typeof e!="object")return!1;e.order||(e.dir=0);switch(e.type){case"anchor":this._registerAnchor(e);break;case"html":this._registerHtml(e);break;case"switcher":this._registerSwitcher(e);break;case"button":this._registerButton(e);break;case"list":this._registerList(e);break;default:this.registerType(e)}return e},registerItems:function(t){if(typeof t!="object")return!1;var n=this;e(t).each(function(e,t){n.registerItem(t)});return t},removeItem:function(t){if(typeof t!="number")return!1;e(e(".cms_toolbar-item")[t]).remove();return t},_registerAnchor:function(e){var t=this._processTemplate("#cms_toolbar-item_anchor",e);t.find("a").bind("click",function(t){t.preventDefault();window.location.href=e.url});this._injectItem(t,e.dir,e.order)},_registerHtml:function(t){var n=t.html?e(t.html):e(t.htmlElement);n.data("order",t.order).css("display","block");t.cls&&n.addClass(t.cls);n.find(".cms_toolbar-btn").bind("click",function(n){n.preventDefault();t.redirect?document.location=t.redirect:e(this).parentsUntil("form").parent().submit()});this._injectItem(n,t.dir,t.order)},_registerSwitcher:function(t){var n=this,r=this._processTemplate("#cms_toolbar-item_switcher",t),i=r.find(".cms_toolbar-item_switcher-link span");t.state?i.data("state",!0).css("backgroundPosition","0px -198px"):i.data("state",!1).css("backgroundPosition","-40px -198px");e("html").toggleClass("cms_toolbar-switcher",t.state);r.find(".cms_toolbar-item_switcher-link").bind("click",function(e){e.preventDefault();i.data("state")?i.stop().animate({backgroundPosition:"-40px -198px"},function(){document.location=n.setUrl(document.location,{addParam:t.removeParameter,removeParam:t.addParameter})}):i.stop().animate({backgroundPosition:"0px -198px"},function(){document.location=n.setUrl(document.location,{addParam:t.addParameter,removeParam:t.removeParameter})})});this._injectItem(r,t.dir,t.order)},_registerButton:function(e){var t=this._processTemplate("#cms_toolbar-item_button",e);this._injectItem(t,e.dir,e.order)},_registerList:function(t){function a(){setTimeout(function(){e(document).bind("click",f)},100);s.show();o.addClass("cms_toolbar-btn-active").data("collapsed",!1)}function f(){e(document).unbind("click");s.hide();o.removeClass("cms_toolbar-btn-active").data("collapsed",!0)}var n=this._processTemplate("#cms_toolbar-item_list",t),r=n.find(".cms_toolbar-item_list").html();if(!r)return!1;var i="";e(t.items).each(function(t,n){var s=n.icon?' class="cms_toolbar_icon cms_toolbar_icon-enabled" style="background-image:url('+n.icon+');"':"";e.browser.msie&&e.browser.version<=7&&(n.url=n.url.replace("/",""));i+=r.replace("[list_title]",n.title).replace("[list_url]",n.url).replace("[list_method]",n.method).replace("[list_class]",n.cls).replace("<span>","<span"+s+">")});n.find(".cms_toolbar-item_list").html(e(i));var s=n.find(".cms_toolbar-item_list"),o=n.find(".cms_toolbar-btn");o.data("collapsed",!0).bind("click",function(t){t.preventDefault();e(this).data("collapsed")?a():f()});var u=s.find("a");u.attr("rel")==="POST"&&u.each(function(t,n){e(n).attr("rel")==="POST"&&e(n).unbind("click").bind("click",function(t){t.preventDefault();e.ajax({type:e(t.currentTarget).attr("rel"),url:e(t.currentTarget).attr("href"),data:e(t.currentTarget).attr("href").split("?")[1],success:function(){CMS.API.Helpers.reloadBrowser()},error:function(){throw new Error("CMS.Toolbar was unable to perform this ajax request. Try again or contact the developers.")}});f()})});this._injectItem(n,t.dir,t.order)},registerType:function(e){typeof e=="function"&&e();return e},_processTemplate:function(t,n){var r=this.wrapper.find(t).clone();r=e("<div>").append(r).clone().remove().html();n.title&&(r=r.replace("[title]",n.title));n.url&&(r=r.replace("[url]",n.url));!n.icon&&n.type==="button"&&(r=r.replace("&nbsp;","").replace("&nbsp;",""));r=n.action?r.replace("[action]",n.action):r.replace("[action]","");r=n.hidden?r.replace("[hidden]",n.hidden):r.replace("[hidden]","");r=e(r);n.cls&&r.addClass(n.cls);n.icon&&r.find(".cms_toolbar-btn_right .toolbar_icon-prefix").addClass("cms_toolbar_icon-enabled").css("background-image","url("+n.icon+")");r.find(".cms_toolbar-btn").bind("click",function(t){t.preventDefault();n.redirect?document.location=n.redirect:e(this).parentsUntil("form").parent().submit()});r.data("order",n.order).attr("id","").css("display","block");return r},_injectItem:function(t,n,r){var i=this.toolbar.left,s=this.toolbar.right;if(n==="left"){var o=i.find("> *");if(!o.length){i.append(t);return!1}t.insertBefore(e(o[0]));o.each(function(n,i){var s=e(i).data("order");(r>=s||r==s)&&t.insertAfter(e(i))})}if(n==="right"){var u=s.find("> *");if(!u.length){s.append(t);return!1}t.insertBefore(e(u[0]));u.each(function(n,i){var s=e(i).data("order");(r>=s||r==s)&&t.insertAfter(e(i))})}}})});