{% extends "base_redesign.html" %}
{% load i18n base_tags navigation_tags image_mods_tags auth_extended browsing favorites individual_relations activity_tags %}

{% block title %}
    {% if object.is_person %}
        {% ifequal request.user object.user %}
            {% trans "My Profile" %}
        {% else %}
            {{ object.get_title|escape }}
        {% endifequal %}
    {% elif object.is_institution %}
        {% if request.user.profile|in_list:object.get_groups.0.get_owners %}
            {% trans "My Institution" %}
        {% else %}
            {{ object.get_title|escape }}
        {% endif %}
    {% endif %}
{% endblock %}

{% block meta_description %}
    {{ block.super }}
    <meta name="description" content="{{ object.get_description|striptags|truncatewords:100 }}..."/>
{% endblock %}

{% block headline %}
    <h1>
        {% if object.is_person %}
            {{ object.get_title }}
        {% elif object.is_institution %}
            {{ object.get_title|escape }}
        {% endif %}
    </h1>
    <h2 class="smaller">
        {{ object.title2 }}
    </h2>
{% endblock %}

{% block content %}
    {% if object.is_person %}
        <div class="header">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12">
                        <h1>{% ifequal request.user object.user %}{% trans "My Profile" %}{% else %}{% trans "Person" %}{% endifequal %}</h1>
                        <div class="profile">

                            {% if object.image %}
                                <img src="{{ UPLOADS_URL }}{{ object.image|modified_path:"profile" }}{% if_has_perm "people.change_person" object %}?now={% now "YmdHis" %}{% end_if_has_perm %}" alt="{{ object.get_title|escape }}"/>
                            {% else %}
                                <img src="{{ STATIC_URL }}site/img/placeholder/profile.png" alt="{{ object.get_title|escape }}"/>
                            {% endif %}

                            <div class="content">
                                <h2>{{ object.get_title|escape }}</h2>
                                <h3>{{ object.occupation }}</h3>
                                <div class="buttons">

                                    {% ifequal request.user object.user %}
                                        {% navigation_links "menu_activities" %}
                                    {% else %}
                                        {% if request.user.is_authenticated %}
                                
                                            <a rel="nofollow" class="fawesome fa-more button text switch{% if request.user|is_following:object.user %} on{% endif %}" href="{% follow_all_url object.user %}?next={{ request.path }}"><span class="text">
                                                {% if request.user|is_following:object.user %}
                                                    {% trans "Unfollow" %}
                                                {% else %}
                                                    {% trans "Follow" %}
                                                {% endif %}
                                            </span></a>
                                            {% if object.is_contactable %}<a href="{{ object.get_url_path }}message/" class="fawesome fa-email button text"><span class="text">{% trans "Send Email" %}</span></a>{% endif %}
                                            {% if request.user.is_staff and perms.people.change_person %}
                                                <a href="/admin/people/person/{{ object.id }}/" class="fawesome fa-edit button text" target="_blank"><span class="text">{% trans "Edit Person" %}</span></a>
                                            {% endif %}
                                    
                                        {% else %}
                                
                                            <a rel="nofollow" class="fawesome fa-more button text switch" href="{% url 'login' %}?goto_next={% follow_all_url object.user %}%3Fnext%3D{{ request.path }}"><span class="text">{% trans "Follow" %}</span></a>
                                            {% if object.is_contactable %}
                                                <a rel="nofollow" href="{% url 'login' %}?goto_next={{ object.get_url_path }}message/" class="fawesome fa-email button text"><span class="text">{% trans "Send Email" %}</span></a>
                                            {% endif %}
                                    
                                        {% endif %}
                                    {% endifequal %}

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="menu tabs">
                <div class="container">
                    <div class="row">
                        <div class="hidden-xs col-sm-4 col-md-3 headline">
                            <h2>{% ifequal request.user object.user %}{% trans "My Profile" %}{% else %}{% trans "Person" %}{% endifequal %}</h2>
                        </div>
                        <div class="navi">
                            <nav>
                                <ul>
                                    {% navigation_links "member" using "navigation/includes/navigation_links_in_tabs.html" %}
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="header">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12">
                        <h1>{% ifequal request.user object.user %}{% trans "My Institution" %}{% else %}
                            {% trans "Institution" %}{% endifequal %}</h1>
                        <div class="profile">

                            {% if object.image %}
                                <img src="
                                    {{ UPLOADS_URL }}{{ object.image|modified_path:"profile" }}{% if_has_perm "institutions.change_institution" object %}?now={% now "YmdHis" %}{% end_if_has_perm %}"
                                    alt="{{ object.title|escape }}"/>
                            {% else %}
                                <img src="{{ STATIC_URL }}site/img/placeholder/profile.png"
                                    alt="{{ object.title|escape }}"/>
                            {% endif %}

                            <div class="content">
                                <h2>{{ object.title }}</h2>
                                <h3>{{ object.title2 }}</h3>
                                <div class="buttons">


                                    {% if request.user.is_authenticated %}
                                        <a rel="nofollow" class="fawesome fa-more button text switch{% if request.user|is_following:object %} on{% endif %}" href="{% follow_all_url object %}?next={{ request.path }}"><span class="text">
                                            {% if request.user|is_following:object %}
                                                {% trans "Unfollow" %}
                                            {% else %}
                                                {% trans "Follow" %}
                                            {% endif %}
                                        </span></a>
                                        {% if object.is_contactable %}
                                            <a href="{{ object.get_url_path }}message/" class="fawesome fa-email button text"><span class="text">{% trans "Send Email" %}</span></a>
                                        {% endif %}
                                        {% if request.user.is_staff and perms.institutions.change_institution %}
                                            <a href="/admin/institutions/institution/{{ object.id }}/" class="fawesome fa-edit button text" target="_blank"><span class="text">{% trans "Edit Institution" %}</span></a>
                                        {% endif %}
                                    {% else %}
                                        <a rel="nofollow" class="fawesome fa-more button text switch" href="{% url 'login' %}?goto_next={% follow_all_url object %}%3Fnext%3D{{ request.path }}"><span class="text">{% trans "Follow" %}</span></a>
                                        {% if object.is_contactable %}
                                            <a rel="nofollow" href="{% url 'login' %}?goto_next={{ object.get_url_path }}message/" class="fawesome fa-email button text"><span class="text">{% trans "Send Email" %}</span></a>
                                        {% endif %}
                                    {% endif %}
                                
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="menu tabs">
                <div class="container">
                    <div class="row">
                        <div class="hidden-xs col-sm-4 col-md-3 headline">
                            <h2>{% ifequal request.user object.user %}{% trans "My Profile" %}{% else %}
                                {% trans "Institution" %}{% endifequal %}</h2>
                        </div>
                        <div class="navi">
                            <nav>
                                <ul>
                                    {% navigation_links "member" using "navigation/includes/navigation_links_in_tabs.html" %}
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-4 col-md-3">
                {% block sidebar %}
                {% endblock %}
            </div>
            <div class="col-xs-12 col-sm-8 col-md-9">
                {% block details %}
                {% endblock %}
            </div>
        </div>
    </div>

{% endblock %}
