{% extends "base_redesign.html" %}
{% load i18n base_tags navigation_tags image_modifications auth_extended browsing favorites memos individual_relations %}

{% block title %}
    {% if object.is_person %}
        {% ifequal request.user object.user %}
            {% trans "My Profile" %}
        {% else %}
            {{ object.get_title|escape }}
        {% endifequal %}
    {% elif object.is_institution %}
        {% if request.user.profile|in_list:object.get_groups.0.get_owners %}
            {% trans "My Institution" %}
        {% else %}
            {{ object.get_title|escape }}
        {% endif %}
    {% endif %}
{% endblock %}

{% block meta_description %}
    {{ block.super }}
    <meta name="description" content="{{ object.get_description|striptags|truncatewords:100 }}..."/>
{% endblock %}




{% block headline %}
    <h1>
        {% if object.is_person %}
            {{ object.get_title }}
        {% elif object.is_institution %}
            {{ object.get_title|escape }}
        {% endif %}
    </h1>
    <h2 class="smaller">
        {{ object.title2 }}
    </h2>
{% endblock %}

{% block content %}
    {% if object.is_person %}
        <div class="header">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12">
                        <h1>{% ifequal request.user object.user %}{% trans "My Profile" %}{% else %}{% trans "Person" %}{% endifequal %}</h1>
                        <div class="profile">

                            {% if object.image %}
                                <img src="{{ UPLOADS_URL }}{{ object.image|modified_path:"profile" }}{% if_has_perm "people.change_person" object %}?now={% now "YmdHis" %}{% end_if_has_perm %}" alt="{{ object.get_title|escape }}"/>
                            {% else %}
                                <img src="{{ STATIC_URL }}site/img/placeholder/profile.png" alt="{{ object.get_title|escape }}"/>
                            {% endif %}

                            <div class="content">
                                <h2>{{ object.get_title|escape }}</h2>
                                <h3>{{ object.occupation }}</h3>
                                <div class="buttons">

                                    {% ifequal request.user object.user %}
                                        {% navigation_links "menu_activities" %}
                                    {% else %}
                                        {% if request.user.is_authenticated %}
                                            {% if object.is_addable_to_favorites %}
                                                {% with object|get_context_item as context_item %}
                                                    {% adding2favorites for context_item using "generic/favorite_contact.html" %}
                                                {% endwith %}
                                            {% endif %}
                                            {% if object.is_addable_to_memos %}{% adding2memos for object %}{% endif %}
                                            {% adding_individual_relation with object %}
                                            {% if person.is_contactable %}<a href="{{ person.get_url_path }}message/" class="fawesome fa-email button text"><span class="text">{% trans "send Email" %}</span></a>{% endif %}
                                            {% if request.user.is_staff and perms.people.change_person %}
                                                <a href="/admin/people/person/{{ object.id }}/" class="fawesome fa-edit button text hidden-xs" onclick="open_new_window(event)"><span class="text">{% trans "edit Person" %}</span></a>
                                            {% endif %}
                                        {% else %}
                                            {% adding2memos for object %}
                                            <a href="/login/?goto_next={{ request.path }}" class="fawesome fa-contact button text"><span class="text">{% trans "Contact" %}</span></a>
                                            {% if object.is_contactable %}<a href="/login/?goto_next={{ object.get_url_path }}message/" class="fawesome fa-email button text"><span class="text">{% trans "send Email" %}</span></a>{% endif %}
                                        {% endif %}
                                    {% endifequal %}

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="menu tabs">
                <div class="container">
                    <div class="row">
                        <div class="hidden-xs col-sm-4 col-md-3 headline">
                            <h2>{% ifequal request.user object.user %}{% trans "My Profile" %}{% else %}{% trans "Person" %}{% endifequal %}</h2>
                        </div>
                        <div class="navi">
                            <nav>
                                <ul>
                                    {% navigation_links "member" using "navigation/includes/navigation_links_in_tabs.html" %}
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="header">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12">
                        <h1>{% ifequal request.user object.user %}{% trans "My Institution" %}{% else %}
                            {% trans "Institution" %}{% endifequal %}</h1>
                        <div class="profile">

                            {% if object.image %}
                                <img src="
                                    {{ UPLOADS_URL }}{{ object.image|modified_path:"profile" }}{% if_has_perm "institutions.change_institution" object %}?now={% now "YmdHis" %}{% end_if_has_perm %}"
                                    alt="{{ object.title|escape }}"/>
                            {% else %}
                                <img src="{{ STATIC_URL }}site/img/placeholder/profile.png"
                                    alt="{{ object.title|escape }}"/>
                            {% endif %}

                            <div class="content">
                                <h2>{{ object.title }}</h2>
                                <h3>{{ object.title2 }}</h3>
                                <div class="buttons">


                                    {% if request.user.is_authenticated %}
                                        {% if object.is_addable_to_favorites or object.is_removable_from_favorites %}
                                            {% with object|get_context_item as context_item %}
                                                {% adding2favorites for context_item using "generic/favorite_contact.html" %}
                                            {% endwith %}
                                        {% endif %}
                                        {% if object.is_addable_to_memos %}{% adding2memos for object %}{% endif %}
                                        {% if object.is_contactable %}
                                            <a href="{{ object.get_url_path }}message/"
                                                class="fawesome fa-email button text">
                                                <span class="text">{% trans "send Email" %}</span></a>{% endif %}
                                        {% if request.user.is_staff and perms.institutions.change_institution %}
                                            <a href="/admin/institutions/institution/{{ institution.id }}/"
                                                class="fawesome fa-edit button text"
                                                onclick="open_new_window(event)">
                                                <span class="text">{% trans "edit Institution" %}</span></a>
                                        {% endif %}
                                    {% else %}
                                        {% adding2memos for object %}
                                        <a href="/login/?goto_next={{ request.path }}"
                                            class="fawesome fa-contact button text">
                                            <span class="text">{% trans "Contact" %}</span></a>
                                        {% if object.is_contactable %}
                                            <a href="/login/?goto_next={{ object.get_url_path }}message/"
                                                class="fawesome fa-email button text">
                                                <span class="text">{% trans "send Email" %}</span></a>{% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="menu tabs">
                <div class="container">
                    <div class="row">
                        <div class="hidden-xs col-sm-4 col-md-3 headline">
                            <h2>{% ifequal request.user object.user %}{% trans "My Profile" %}{% else %}
                                {% trans "Institution" %}{% endifequal %}</h2>
                        </div>
                        <div class="navi">
                            <nav>
                                <ul>
                                    {% navigation_links "member" using "navigation/includes/navigation_links_in_tabs.html" %}
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block content_old %}
    {% block tabs %}
        <div id="tabs">
            {% comment %}
                {% if object.is_person %}
                    {% children_of "person" using "navigation/children_in_tabs.html" %}
                {% elif object.is_institution %}
                    {% children_of "institution" using "navigation/children_in_tabs.html" %}
                {% endif %}
            {% endcomment %}
            {% navigation_links "member" using "navigation/includes/navigation_links_in_tabs.html" %}
        </div>
    {% endblock %}
    <div class="toolbox">
        {% include "site_specific/count_of.html" %}
        <div class="icons">
            {% block object_controls %}
                {% if object.is_person %}
                    {% with object as person %}
                        {% include "people/controls.html" %}
                    {% endwith %}
                {% elif object.is_institution %}
                    {% with object as institution %}
                        {% include "institutions/controls.html" %}
                    {% endwith %}
                {% endif %}
                <a class="addthis_button"
                    href="http://www.addthis.com/bookmark.php?v=250&amp;pub=xa-4ad8ac114ae54f07">
                    <span><span></span></span></a>
            {% endblock %}
            {% block additional_controls %}
            {% endblock %}
        </div>
    </div>
    <div id="details">
        {% block details %}
        {% endblock %}
    </div>
    <hr class="hidden"/>
{% endblock %}


{% block extrabody_old %}
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/website/generic.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/website/groups_networks.js"></script>
{% endblock %}

