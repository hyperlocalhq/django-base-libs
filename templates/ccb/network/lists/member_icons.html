{% extends "utils/lists/base_context_item.html" %}
{% load i18n base_tags image_mods_tags %}

{% block object_image %}
    <a href="{% url "member_detail" slug=member.slug %}">
        {% if member.content_object.image %}
            <img alt="{{ member.content_object.get_title|escape }}" width="97" height="97"
                src="{{ UPLOADS_URL }}{{ member.content_object.image|modified_path:"al" }}"/>
        {% else %}
            <img alt="{{ member.content_object.get_title|escape }}" width="97" height="97"
                src="{{ STATIC_URL }}site/img/website/placeholder/member_m.png"/>
        {% endif %}
    </a>
{% endblock %}


{% block object_title %}
    <a class="fn" href="{% url "member_detail" slug=member.slug %}">
        {{ member.content_object.get_title|escape }}
    </a>
{% endblock %}

{% block object_absolute_url %}{% url "member_detail" slug=member.slug %}{% endblock %}

{% block object_col1 %}
    {% if member.is_person %}
        {% with person=member.content_object %}
            {% if person.occupation %}
                <p class="object-type">{{ person.occupation }}</p>
            {% endif %}
            {% if person.get_contacts %}
                {% with person.get_contacts.0 as contact %}
                    {% if contact %}
                        {% if person.is_address_displayed %}
                            {% with contact.postal_address as postal_address %}
                                {% comment %}<!--
                                <a href="/vcard/{{ person|content_type_id }}/{{ person.id }}">vcard</a>
                                -->{% endcomment %}
                                {% if postal_address.street_address or postal_address.country_name %}
                                    <span class="type">{% trans "Address" %}: </span>
                                    <address class="adr">
                                        {% if contact.institution %}
                                            {% ifequal contact.institution.status.sysname "draft" %}
                                                {{ contact.institution.get_title|escape }}
                                            {% else %}
                                                <a class="org"
                                                    href="{{ contact.institution.get_url_path }}">{{ contact.institution.get_title|escape }}</a>
                                                ,
                                            {% endifequal %}
                                            <br/>
                                        {% endif %}
                                        {% if postal_address.street_address %}
                                            <span class="street-address">
                                        {{ postal_address.street_address|escape }}</span>,
                                        {% endif %}
                                        {% if postal_address.street_address2 %}
                                            <span class="street-address">
                                        {{ postal_address.street_address2|escape }}</span>,
                                        {% endif %}
                                        {% if postal_address.street_address3 %}
                                            <span class="street-address">{{ postal_address.street_address3|escape }}</span>,
                                        {% endif %}
                                        {% if postal_address.postal_code %}
                                            <span class="postal-code">
                                        {{ postal_address.postal_code|escape }}
                                                {{ postal_address.city|escape }}</span>{% endif %}
                                        {% if postal_address.country_name %},<span class="country-name">
                                        {{ postal_address.country_name }}
                                        </span>
                                        {% endif %}
                                    </address>
                                    <br/>
                                {% endif %}
                            {% endwith %}
                        {% endif %}
                    {% endif %}
                {% endwith %}
            {% endif %}
        {% endwith %}
    {% elif member.is_institution %}
        {% with institution=member.content_object %}
            {% if institution.get_institution_types %}
                <p class="object-type">
                    {% for institution_type in institution.get_institution_types %}{% if not forloop.first %}, {% endif %}
                        {{ institution_type.get_title|escape }}{% endfor %}</p>
            {% endif %}

            {% with institution.get_primary_contact as contact %}
                {% if contact %}
                    {% if contact.street_address or contact.country_name %}
                        <span class="type">{% trans "Address" %}: </span>
                        <address class="adr">
                            {% if contact.street_address %}
                                <span class="street-address">
                            {{ contact.street_address|escape }}</span>,
                            {% endif %}
                            {% if contact.street_address2 %}
                                <span class="street-address">
                            {{ contact.street_address2|escape }}</span>,
                            {% endif %}
                            {% if contact.street_address3 %}
                                <span class="street-address">
                            {{ contact.street_address3|escape }}</span>,
                            {% endif %}
                            {% if contact.postal_code %}
                                <span class="postal-code">
                             {{ contact.postal_code|escape }} {{ contact.city|escape }}
                             </span>{% endif %}{% if contact.country_name %}, <span class="country-name">
                            {{ contact.country_name }}
                            </span>
                        {% endif %}
                        </address>
                    {% endif %}
                {% endif %}
            {% endwith %}
        {% endwith %}
    {% endif %}
{% endblock %}

{% block object_col2 %}
    {% if member.is_person %}
        {% with person=member.content_object %}
            {% if person.get_contacts %}
                {% with person.get_contacts.0 as contact %}
                    <p>
                        {% if contact.get_phones %}
                            {% for phone in contact.get_phones %}
                                <span class="tel">
                                {% if phone.type %}
                                    <abbr title="{{ phone.type.vcard_name }}" class="type">
                                        {{ phone.type }}: </abbr>
                                {% endif %}
                                    <span class="value">+{{ phone.country }}-{{ phone.area }}-{{ phone.number }}</span><br/>
                            </span>
                            {% endfor %}
                        {% endif %}
                        {% for url in contact.get_urls %}
                            <span>
                        {% if url.type %}<span class="type">{{ url.type }}: </span>{% endif %}
                                <a href="{{ url.link|escape }}" onclick="open_new_window(event)"
                                    class="url">{{ url.link }}</a><br/>
                    </span>
                        {% endfor %}
                    </p>
                {% endwith %}
            {% endif %}
        {% endwith %}
    {% elif member.is_institution %}
        {% with institution=member.content_object %}
            {% if institution.get_contacts %}
                <p>
                    {% for phone in institution.get_contacts.0.get_phones %}
                        <span class="tel">
                        {% if phone.type %}
                            <abbr title="{{ phone.type.vcard_name }}" class="type">
                                {{ phone.type }}: </abbr>{% endif %}
                            <span class="value">+{{ phone.country }}-{{ phone.area }}-{{ phone.number }}</span><br/>
                    </span>
                    {% endfor %}
                    {% for url in institution.get_contacts.0.get_urls %}
                        <span class="url">
                        {% if url.type %}<span class="type">{{ url.type }}: </span>{% endif %}
                            <a href="{{ url.link|escape }}" onclick="open_new_window(event)">{{ url.link }}</a><br/>
                    </span>
                    {% endfor %}
                </p>
            {% endif %}
        {% endwith %}
    {% endif %}
{% endblock %}

{% block object_controls %}
    {% if member.is_person %}
        {% with person=member.content_object %}
            {% include "people/controls.html" %}
        {% endwith %}
    {% elif member.is_institution %}
        {% with institution=member.content_object %}
            {% include "institutions/controls.html" %}
        {% endwith %}
    {% endif %}
{% endblock %}

