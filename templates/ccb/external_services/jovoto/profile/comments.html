{% load i18n base_tags auth_extended comments babel image_modifications %}

{% get_comment_list for jovoto.idea object.id as comment_list %}
<div id="comments">
    <div>
        {% if comment_list %}
            <a class="left" href="{{ object.get_url_path }}#comments">
                    <span>
                        {% blocktrans count comment_list|length as counter %}1 comment{% plural %}{{ counter }}
                            comments{% endblocktrans %}
                    </span>
            </a>
        {% else %}
            <span class="left">{% trans "No comments" %}</span>
        {% endif %}
        <a class="right" href="#last">{% trans "Post a comment" %}</a>
    </div>

    {% for comment in comment_list %}
        <div class="comments">
            <div>
                {% if comment.user.get_profile.image %}
                    <img class="left" src="{{ UPLOADS_URL }}{{ comment.user.get_profile.image|modified_path:"at" }}"
                         alt="{{ comment.user.get_profile.get_title|escape }}"/>
                {% else %}
                    {% if comment.user %}
                        <img class="left" src="{{ STATIC_URL }}site/img/website/placeholder/person_s.png"
                             alt="{{ comment.user.get_profile.get_title|escape }}"/>
                    {% else %}
                        <img class="left" src="{{ STATIC_URL }}site/img/website/placeholder/person_s.png"
                             alt="{{ comment.name|escape }}"/>
                    {% endif %}
                {% endif %}
                <p>
                    {% if comment.user %}
                        <a href='{{ comment.user.get_profile.get_url_path }}'>
                            {{ comment.user.get_profile.get_title|escape }}
                        </a><br/>
                    {% else %}
                        <span class="no_link">
                                {{ comment.name }}
                            </span><br/>
                    {% endif %}
                    {{ comment.submit_date|datefmt:"long" }}
                </p>
            </div>
            <div>{{ comment.get_comment|disarm_user_input }}
                {% comment %}
                        TODO COMMENT MODERATION!!!!!!
                    {% if_has_perm "blog.moderate_blog_comments" blog %}
                    {% endcomment %}
                <ul class="toolbar">
                    {% if not comment.is_removed %}
                        <li id="refuseComment_{{ comment.id }}" class="refuseComment"><a class="refuseComment_but"
                                                                                         href="{{ obj.get_url_path }}comment/{{ comment.id }}/refuse/"><span>{% trans "Refuse" %}</span></a>
                        </li>
                        <li id="markAsSpamComment_{{ comment.id }}" class="markAsSpamComment"><a
                            class="markAsSpamComment_but"
                            href="{{ obj.get_url_path }}comment/{{ comment.id }}/mark_as_spam/"><span>{% trans "Mark as Spam" %}</span></a>
                        </li>
                    {% else %}
                        <li id="acceptComment_{{ comment.id }}" class="acceptComment"><a class="acceptComment_but"
                                                                                         href="{{ obj.get_url_path }}comment/{{ comment.id }}/accept/"><span>{% trans "Accept" %}</span></a>
                        </li>
                    {% endif %}
                </ul>
                {% comment %}
                        TODO COMMENT MODERATION!!!!!!
                    {% end_if_has_perm %}
                    {% endcomment %}
            </div>
        </div>
    {% endfor %}
    <div id="id_dyn_add_comment">
        {% comment_form using "external_services/jovoto/comments/form.html" for jovoto.idea object.id %}
    </div>
</div>



