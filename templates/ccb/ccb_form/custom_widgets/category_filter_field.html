{% load crispy_forms_filters %}
{% load l10n %}

{# TODO: find a way to check the current category without referencing to the field by name #}
{% with html_name=field.html_name value=field.value|add:"0" choices=field.field.choices attrs=field.field.widget.attrs current_category=field.form.cleaned_data.category %}
<li class="accordion-inside accordion-trigger" id="{{ html_name }}">
    <input type="hidden" name="{{ html_name }}" value="{% if value|add:"0" != 0 %}{{ value }}{% endif %}" />
    <div class="child accordion-trigger">{{ field.label }}</div>
    <ul class="accordion">
        {% for choice_value, choice_instance in choices %}
            {% if not choice_instance.level %}
                <li data-level="{{ choice_instance.level|default:0 }}"><a href="javascript:void(0);" data-value="{{ choice_value }}" {% if value == choice_value|add:"0" or value == choice_value %}class="active"{% endif %}>{{ choice_instance.title }}</a></li>
            {% elif current_category and choice_instance.tree_id == current_category.tree_id %}
                <li data-level="{{ choice_instance.level }}"><a href="javascript:void(0);" data-value="{{ choice_value }}" {% if value == choice_value|add:"0" or value == choice_value %}class="active"{% endif %}>{% if choice_instance.level == 1 %} - {% endif %}{{ choice_instance.title }}</a></li>
            {% endif %}
        {% endfor %}
    </ul>
</li>
{% endwith %}
