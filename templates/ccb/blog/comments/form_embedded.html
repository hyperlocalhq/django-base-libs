{% load base_tags babel i18n image_modifications uni_form_tags %}

<form action="{{ current_post.get_url }}comments/add/" method="post" class="uniForm">{% csrf_token %}
    <fieldset class="inlineLabels">
        <h3>{% trans "Post a comment" %}</h3>
        {% if comment_form.is_valid %}
            <div class="preview">
                <div class="comment-author">
                    {% if comment.user.profile.image %}
                        <img src="{{ UPLOADS_URL }}{{ comment.user.profile.image|modified_path:"at" }}"
                            alt="{{ comment.user.profile.get_title|escape }}"/>
                    {% else %}
                        {% if comment.user %}
                            <img src="{{ STATIC_URL }}site/img/website/placeholder/person_s.png"
                                alt="{{ comment.user.profile.get_title|escape }}"/>
                        {% else %}
                            <img src="{{ STATIC_URL }}site/img/website/placeholder/person_s.png"
                                alt="{{ comment.name|escape }}"/>
                        {% endif %}
                    {% endif %}
                    <div>
                        {% if comment.user %}
                            <a href='{{ comment.user.profile.get_url_path }}'>
                                {{ comment.user.profile.get_title|escape }}
                            </a><br/>
                        {% else %}
                            <span class="no_link">
                                {{ comment.name }}
                            </span><br/>
                        {% endif %}
                        {{ comment.submit_date|datefmt:"long" }}
                    </div>
                </div>
                <div class="comment-text">
                    <div class="post_comment">
                        {{ comment.comment|disarm_user_input }}
                    </div>
                </div>
                <div class="buttonHolder">
                    <input type="submit" id="but_post" class="primaryAction" name="post"
                        value='{% filter upper %}{% trans "Post public comment" %}{% endfilter %}'/>
                </div>
            </div>
        {% endif %}

        {% if not request.user.is_authenticated %}
            {{ comment_form.name|as_uni_field }}
            {{ comment_form.email|as_uni_field }}
            {{ comment_form.url_link|as_uni_field }}
        {% endif %}
        {{ comment_form.comment|as_uni_field }}

        {{ comment_form.prevent_spam }}
        <p class="disclaimer"><span id="last">*{% trans "required fields" %}</span></p>

        <div class="buttonHolder">
            <input type="hidden" class="form_hidden" name="goto_next"
                value="{% if goto_next %}{{ goto_next }}{% else %}{{ request.get_full_path }}{% endif %}"/>
            <input type="hidden" class="form_hidden" name="options" value="{{ options }}"/>
            <input type="hidden" class="form_hidden" name="target" value="{{ target }}"/>
            <input type="hidden" class="form_hidden" name="gonzo" value="{{ hash }}"/>
            <input type="submit" id="but_preview" class="primaryAction" name="preview"
                value="{% filter upper %}{% trans "Preview" %}{% endfilter %}"/>
            {% if comment_form.is_valid %}
                <input type="button" id="but_cancel" class="secondaryAction"
                    value='{% filter upper %}{% trans "Cancel" %}{% endfilter %}'/>
            {% endif %}
        </div>
    </fieldset>
</form>

