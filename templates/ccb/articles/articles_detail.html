{% extends "articles/articles_base.html" %}
{% load base_tags blog babel i18n auth_extended image_mods_tags favorites %}

{% block meta_tags %}
    <meta name="description" content="{{ article.get_rendered_content|striptags|truncatewords:100 }}..."/>
{% endblock %}

{% block open_graph %}
    {% parse article.get_rendered_content as content %}
    <!-- Open Graph -->
    <meta property="og:title" content="{{ article.get_title }}"/>
    <meta property="og:type" content="article"/>
    {% if article.image %}
        <meta property="og:image" content="{{ website_url|slice:":-1" }}{{ UPLOADS_URL }}{{ article.image.path }}"/>
    {% endif %}
    {% with content|get_first_media|get_media_src as media_src %}
        {% if media_src %}
            {% if "http://"|in_list:media_src %}
                <meta property="og:image" content="{{ media_src }}"/>
            {% else %}
                <meta property="og:image" content="{{ website_url|slice:":-1" }}{{ media_src }}"/>
            {% endif %}
        {% endif %}
    {% endwith %}
    <meta property="og:image" content="{{ website_url|slice:":-1" }}{{ STATIC_URL }}site/img/website/c_logo.png"/>
    <meta property="og:url" content="{{ article.get_url }}"/>
    <meta property="og:site_name" content="Creative City Berlin"/>
    <meta property="og:description" content='{{ content|striptags|truncatewords:20|escape }}'/>
{% endblock %}

{% block tabs %}
{% endblock %}

{% block sidebar %}
    <div class="button-group">
        {% if request.user.is_authenticated %}
            {% adding2favorites for article %}
        {% else %}
            <a rel="nofollow" href="{% url 'login' %}?goto_next={{ request.path }}" class="fawesome fa-favorite button text"><span class="text">{% trans "Favorite" %}</span></a>
        {% endif %}
        <br/><br/>
    </div>
{% endblock %}

{% block details %}
    <h3>
        {% if article.content_provider %}
            {% if article.content_provider.url %}
                <a href="{{ article.content_provider.url }}" target="_blank">{{ article.content_provider.title }}</a>
            {% else %}
                {{ article.content_provider.title }}
            {% endif %}
        {% elif article.article_type %}
            {{ article.article_type.title|escape }}
        {% else %}
            {% trans "News" %}
        {% endif %}
        <time datetime="{{article.published_from|date:"Y-m-d"}}">{{ article.published_from|datefmt:"long" }}</time>
    </h3>
    
    <div class="entry-details clearfix">

        <h2>{{ article.get_title|escape }}</h2>
        
        {% if article.get_subtitle %}
            <h4 class="type">{{ article.get_subtitle }}</h4>
        {% endif %}
        
        {% if article.description %}
            <p class="intro">{% parse article.get_rendered_description %}</p>
        {% endif %}


        {% if article.image %}
            <img src="{{ UPLOADS_URL }}{{ article.image|modified_path:"article" }}" alt="{{ article.get_title|escape }}"/>
        {% endif %}

        {% parse article.get_rendered_content %}

        {% if article.is_excerpt %}
            <p><a href="{{ article.external_url }}" target="_blank">{% trans "Read full article" %}</a></p>
        {% endif %}

        <p>{% trans "Category" %}:
            {% if article.article_type.get_root.slug == "interviews" %}
                <a href="{% url "article_archive_for_interviews_by_type" type_sysname=article.article_type.slug %}">{{ article.article_type.title }}</a>
            {% else %}
                <a href="{% url "article_archive_for_news_by_type" type_sysname=article.article_type.slug %}">{{ article.article_type.title }}</a>
            {% endif %}
        </p>

        <div class="button-group padding-40">
            {% if article.article_type.get_root.slug == "interviews" %}
                <a href="{% url "article_feed_for_interviews" feed_type="rss" %}" class="fawesome fa-rss smaller button"><span class="sr-only">rss</span></a>
            {% else %}
                <a href="{% url "article_feed_for_news" feed_type="rss" %}" class="fawesome fa-rss smaller button"><span class="sr-only">rss</span></a>
            {% endif %}
        </div>

    </div>
    
    <hr/>
    
   
    {% if links_to_articles %}
    
        <div class="center padding-10">
            <div class="fawesome fa-heart big padding-10"></div>
            <p class="color-black bold">{% trans 'Also a good read' %}</p>
        </div>
    
        <div class="row article-list">
            {% for list_article in links_to_articles %}
                {% include "articles/articles_brief.html" %}
            {% endfor %}
        </div>
        
    {% endif %}
    
{% endblock %}

{% block breadcrumbs %}
    <li><a href="/news/">{% trans "News" %}</a></li>
    <li><a href="/news/{{ article.published_from|date:"Y" }}/">{{ article.published_from|date:"Y" }}</a></li>
    <li><a href="/news/{{ article.published_from|date:"Y" }}/{{ article.published_from|date:"m" }}/">{{ article.published_from|datefmt:"MMM" }} </a></li>
    <li><a href="/news/{{ article.published_from|date:"Y" }}/{{ article.published_from|date:"m" }}/{{ article.published_from|date:"d" }}/">{{ article.published_from|date:"d" }}</a></li>
    <li>{{ article.get_title|escape }}</li>
{% endblock %}

