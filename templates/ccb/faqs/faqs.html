{% extends base_template %}
{% comment %}<!-- UNUSED -->{% endcomment %}

{% load base_tags i18n infoblocks faqs nav_menu %}

{% comment %}<!--
    This is the main template rendered by the handle_request view in the
    faqs application. To minimize code, this is the "main template".
     
    context vars used:
    
    base_template   A "base template" used for template inheritance.
    object          The object related to the faqs (or None)
    container       The faqs container (defined by the rel. object)
    root_category   The "root category": Children of that faq category should be 
                    displayed (or None)
    category_path   The "Path" from the current category through all its parents.
                    We need that for the breadcrumbs.
    category_list   List of faq categories
-->{% endcomment %}

{% block extrahead %}
    {{ block.super }}
{% endblock %}

{% block sidebar-a %}
    <div class="sidebar-box">
        <h5>
            <b>{% trans "Questions and Answers" %}</b>
        </h5>

        <div>
            {% children_of "menu_faq" using "navigation/multilevel.html" %}
        </div>
    </div>
{% endblock %}

{% block details %}
    <div class="faq{% if not root_category and not category_list|length_is:"1" %} faq-overview{% endif %} txt">

        {% if category_list|length_is:"1" %}
            {% get_faqs for category_list.0.id as faqs %}
            {% include_selected "questions_answers_list.html" for object under "faqs" %}
        {% else %}

            {% infoblock "faq_info" using "blocks/highlighted_infoblock.html" %}

            {% if not category_path %}
                <div>
                    {% infoblock "faq_intro" %}
                </div>
                <hr/>
            {% endif %}

            {% if root_category %}
                <div class="faqs-block">
                    <h3>{{ root_category.title|escape }}</h3>
                </div>
            {% endif %}

            {% comment %}<!-- DISPLAY FAQS of ROOT Category (IF THERE IS ONE) -->{% endcomment %}
            {% if root_category and root_category.has_faqs %}
                {% get_faqs for root_category.id as faqs %}
                {% include_selected "questions_answers_list.html" for object under "faqs" %}
            {% endif %}


            {% for child0_category in category_list %}
                <div>
                    {% if child0_category.has_link %}
                        {% if root_category %}
                            <h4 class="{{ forloop.first|yesno:"first-faq," }}">
                                <a href="{{ child0_category.get_url_path }}">
                                    {{ child0_category.title }}
                                </a>
                            </h4>
                        {% else %}
                            <h3>
                                <a href="{{ child0_category.get_url_path }}">
                                    {{ child0_category.title }}
                                </a>
                            </h3>
                        {% endif %}
                    {% else %}
                        {% if root_category %}
                            <h4>
                                <a href="{{ child0_category.get_url_path }}">
                                    {{ child0_category.title }}
                                </a>
                            </h4>
                        {% else %}
                            <h3 class="{{ forloop.first|yesno:"first-faq," }}">
                                <a href="{{ child0_category.get_url_path }}">
                                    {{ child0_category.title }}
                                </a>
                            </h3>
                        {% endif %}
                    {% endif %}

                    {% comment %}<!--
                        CARSTEN HEIN FROM KULTURPROJEKTE WANTS THE CATEGORY DESCRIPTION HERE, BUT
                        ONLY, IF THERE IS NO ROOT_CATEGORY (THAT IS THE "FAQS OVERVIEW PAGE")
                    -->{% endcomment %}
                    {% if not root_category %}
                        {{ child0_category.description|safe }}
                    {% endif %}

                    {% comment %}<!-- DISPLAY FAQS -->{% endcomment %}
                    {% if THIS_IS_USED_AS_A_COMMENT_root_category %}
                        {% if child0_category.has_faqs %}
                            {% if not child0_category.faqs_on_separate_page %}
                                {% get_faqs for child0_category.id as faqs %}
                                {% include_selected "questions_answers_list.html" for object under "faqs" %}
                            {% endif %}
                        {% endif %}
                    {% endif %}

                    {% comment %}<!-- RECURSE THE CATEGORIES -->{% endcomment %}

                    {% comment %}<!--
                        CARSTEN HEIN FROM KULTURPROJEKTE WANTS, THAT CHILDREN ARE NOT DISPLAYED AT THE OVERVIEW PAGE
                    -->{% endcomment %}

                    {% if root_category %}
                        {% get_faq_category_children in container.id for child0_category.id using "faqs/faqs_list_level_0.html" %}
                    {% endif %}

                </div>
                <hr/>
            {% endfor %}
        {% endif %}
    </div>
{% endblock %}

{% block breadcrumbs %}
    <div class="breadcrumbs">
        <a href="/">{% trans "Home" %}</a>
        {% if category_path %}
            <span class="b-sep"><span>::</span></span><a {% if not root_category %}class="active_toplevel"{% endif %}
                                                         href="{{ container.get_url_path }}">{{ container.title }}</a>
        {% else %}
            <span class="b-sep"><span>::</span></span><span>{{ container.title }}</span>
        {% endif %}
        {% for category in category_path %}
            {% if forloop.last %}
                {% if category.has_link %}
                    <span class="b-sep"><span>::</span></span><span>{{ category.short_title }}</span>
                {% else %}
                    <span class="b-sep"><span>::</span></span><span>{{ category.short_title }}</span>
                {% endif %}
            {% else %}
                {% if category.has_link %}
                    <span class="b-sep"><span>::</span></span>
                    <a {% ifequal root_category category %} class="active"{% endifequal %}
                                                            href="{{ category.get_url_path }}">{{ category.short_title }}</a>
                {% else %}
                    <span class="b-sep"><span>::</span></span>
                    <a {% ifequal root_category category %} class="active"{% endifequal %}
                                                            href="#">{{ category.short_title }}</a>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}

{% block extrabody %}
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/website/faqs.js"></script>
{% endblock %}
