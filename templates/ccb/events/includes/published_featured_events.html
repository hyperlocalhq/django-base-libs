{% extends "utils/includes/base_latest_objects.html" %}
{% load i18n base_tags site_specific babel image_mods_tags %}
{% comment %}<!--
Usage in any template:
    {% load base_tags %}
    
    Simple:
    {% include_parsed "events/includes/published_featured_events.html" %}
    
    Customized:
    {% include_parsed "events/includes/published_featured_events.html" with 5 as amount %}
    
-->{% endcomment %}

{% block block_title %}
    <h3>
        <a href="/{{ URL_ID_EVENTS }}/">{% trans "New Events" %}</a>
        <a href="/{{ URL_ID_EVENTS }}/"
            class="newevents"></a>
    </h3>{% endblock %}

{% block block_content %}
    {% with amount|default:3 as amount %}
        {% get_objects published_featured events.Event amount as newest_objects %}
        {% if newest_objects %}
            <ul class="list-block clearfix">
                {% for event in newest_objects %}
                    <li class="clearfix" onclick="redirect('{{ event.get_url_path }}')">
                        <a href="{{ event.get_url_path }}">
                            {% if event.image %}
                                <img alt="{{ event.get_title|escape }}" width="97" height="97"
                                    src="{{ UPLOADS_URL }}{{ event.image|modified_path:"al" }}"/>
                            {% else %}
                                <span class="event-date">
                                <span>
                                    {% if event.get_nearest_occurrence %}
                                        {% with event.get_nearest_occurrence as time %}
                                            {{ time.start_dd|default:1|stringformat:"02d" }}.
                                            {{ time.start_mm|default:1|stringformat:"02d" }}<br/>
                                            {{ time.start_yyyy|default:"0000" }}
                                        {% endwith %}
                                    {% endif %}
                                </span>
                            </span>
                            {% endif %}
                        </a>

                        <div class="list-item-details">
                            <p class="date">
                                {% if event.has_start_date or event.has_end_date %}
                                    {% if event.has_start_date and event.has_end_date and event.get_start_date != event.get_end_date %}
                                        {% if event.get_start_date %}
                                            <abbr class="dtstart" title="{{ event.get_start_date|date:"Y-m-d" }}">
                                                {{ event.get_start_date|datefmt:"long" }}
                                            </abbr>
                                        {% else %}
                                            <abbr class="dtstart"
                                                title="{{ event.start_yyyy }}-{{ event.start_mm|default:"01" }}-01">
                                                {% if event.start_mm %}
                                                    {{ event.get_start_mm_display }}
                                                {% endif %}
                                                {{ event.start_yyyy }}
                                            </abbr>
                                        {% endif %}
                                        -
                                        {% if event.get_end_date %}
                                            <abbr class="dtend" title="{{ event.get_end_date|date:"Y-m-d" }}">
                                                {{ event.get_end_date|datefmt:"long" }}
                                            </abbr>
                                        {% else %}
                                            <abbr class="dtend"
                                                title="{{ event.end_yyyy }}-{{ event.end_mm|default:"01" }}-01">
                                                {% if event.end_mm %}{{ event.get_end_mm_display }}{% endif %}
                                                {{ event.end_yyyy }}
                                            </abbr>
                                        {% endif %}
                                    {% else %}
                                        {% if event.has_start_date %}
                                            {% if event.get_start_date %}
                                                <abbr class="dtstart" title="{{ event.get_start_date|date:"Y-m-d" }}">
                                                    {{ event.get_start_date|datefmt:"long" }}
                                                    {{ event.get_start_date|time:"H:i" }}
                                                </abbr>
                                            {% else %}
                                                <abbr class="dtstart"
                                                    title="{{ event.start_yyyy }}-{{ event.start_mm|default:"01" }}-01">
                                                    {% if event.start_mm %}
                                                        {{ event.get_start_mm_display }}
                                                    {% endif %}
                                                    {{ event.start_yyyy }}
                                                </abbr>
                                            {% endif %}
                                        {% endif %}
                                        {% if event.has_end_date %}
                                            {% ifnotequal event.get_start_date event.get_end_date %}
                                                -
                                                {% if event.get_end_date %}
                                                    <abbr class="dtend" title="{{ event.get_end_date|date:"Y-m-d" }}">
                                                        {{ event.get_end_date|datefmt:"long" }}
                                                        {{ event.get_end_date|time:"H:i" }}
                                                    </abbr>
                                                {% else %}
                                                    <abbr class="dtend"
                                                        title="{{ event.end_yyyy }}-{{ event.end_mm|default:"01" }}-01">
                                                        {% if event.end_mm %}{{ event.get_end_mm_display }}{% endif %}
                                                        {{ event.end_yyyy }}
                                                    </abbr>
                                                {% endif %}
                                            {% endifnotequal %}{% endif %}
                                    {% endif %}
                                {% endif %}
                            </p>
                            <h5>
                                <a href="{{ event.get_url_path }}">
                                    {{ event.get_title|escape|truncatewords:7 }}
                                </a>
                            </h5>

                            <p>{{ event.venue.get_title|default:event.venue_title }}<br/>
                                {% for cat in event.get_object_types %}
                                    {{ cat.get_title|escape }}<br/>
                                    {% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </p>
                        </div>
                    </li>
                {% endfor %}
            </ul>
            <hr class="hidden"/>
        {% else %}
            <p>{% trans "There are no public events." %}</p>
            <hr class="hidden"/>
        {% endif %}
    {% endwith %}
{% endblock %}
