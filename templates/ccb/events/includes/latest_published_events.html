{% load i18n base_tags site_specific babel image_mods_tags %}
{% comment %}<!--
Usage in any template:
    {% load base_tags %}
    
    Simple:
    {% include_parsed "events/includes/latest_published_events.html" %}
    
    Customized:
    {% include_parsed "events/includes/latest_published_events.html" with 5 as amount %}
    
-->{% endcomment %}

{% with amount|default:4 as amount %}
    {% get_latest_published_objects_cs events.Event amount as newest_objects %}
    {% if newest_objects %}
        <div class="row event-grid">
            {% for event in newest_objects %}
                <div class="col-xs-12 col-sm-6 col-md-3">
                    <a class="content tap-hover tap-hover-trigger" href="#">
                        <img src="{{ UPLOADS_URL }}{{ event.image|modified_path:"event_row" }}" alt="{{ event.get_title|escape }}"/>
                        <h2>event.get_title|escape</h2>
                        {% with event.get_nearest_occurrence as date %}
                            <p><time datetime="{{ date|date:'Y-m-d' }}">{{ date|date:'D, d. m. Y' }}</time>{% if event.venue %}{{ event.venue.title }}{% else %}event.venue_title{% endif %}</p>
                        {% endwith %}
                    </a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="intro">{% trans "There are no public events." %}</p>
    {% endif %}
{% endwith %}        


{% block block_content_old %}
    {% comment %}
    {% with amount|default:3 as amount %}
        {% get_latest_published_objects_cs events.Event amount as newest_objects %}
        {% if newest_objects %}
            <ul class="list-block clearfix">
                {% for event in newest_objects %}
                    <li class="clearfix" onclick="redirect('{{ event.get_url_path }}')">
                        <a href="{{ event.get_url_path }}">
                            {% if event.image %}
                                <img alt="{{ event.get_title|escape }}" width="97" height="97"
                                    src="{{ UPLOADS_URL }}{{ event.image|modified_path:"al" }}"/>
                            {% else %}
                                <span class="event-date">
                                <span>
                                    {% if event.get_nearest_occurrence %}
                                        {% with event.get_nearest_occurrence as time %}
                                            {{ time.start_dd|default:1|stringformat:"02d" }}.
                                            {{ time.start_mm|default:1|stringformat:"02d" }}<br/>
                                            {{ time.start_yyyy|default:"0000" }}
                                        {% endwith %}
                                    {% endif %}
                                </span>
                            </span>
                            {% endif %}
                        </a>

                        <div class="list-item-details">
                            <p class="date">
                                {% if event.has_start_date or event.has_end_date %}
                                    {% if event.has_start_date and event.has_end_date and event.get_start_date != event.get_end_date %}
                                        {% if event.get_start_date %}
                                            <abbr class="dtstart" title="{{ event.get_start_date|date:"Y-m-d" }}">
                                                {{ event.get_start_date|datefmt:"long" }}
                                            </abbr>
                                        {% else %}
                                            <abbr class="dtstart"
                                                title="{{ event.start_yyyy }}-{{ event.start_mm|default:"01" }}-01">
                                                {% if event.start_mm %}
                                                    {{ event.get_start_mm_display }}
                                                {% endif %}
                                                {{ event.start_yyyy }}
                                            </abbr>
                                        {% endif %}
                                        -
                                        {% if event.get_end_date %}
                                            <abbr class="dtend" title="{{ event.get_end_date|date:"Y-m-d" }}">
                                                {{ event.get_end_date|datefmt:"long" }}
                                            </abbr>
                                        {% else %}
                                            <abbr class="dtend"
                                                title="{{ event.end_yyyy }}-{{ event.end_mm|default:"01" }}-01">
                                                {% if event.end_mm %}{{ event.get_end_mm_display }}{% endif %}
                                                {{ event.end_yyyy }}
                                            </abbr>
                                        {% endif %}
                                    {% else %}
                                        {% if event.has_start_date %}
                                            {% if event.get_start_date %}
                                                <abbr class="dtstart" title="{{ event.get_start_date|date:"Y-m-d" }}">
                                                    {{ event.get_start_date|datefmt:"long" }}
                                                    {{ event.get_start_date|time:"H:i" }}
                                                </abbr>
                                            {% else %}
                                                <abbr class="dtstart"
                                                    title="{{ event.start_yyyy }}-{{ event.start_mm|default:"01" }}-01">
                                                    {% if event.start_mm %}
                                                        {{ event.get_start_mm_display }}
                                                    {% endif %}
                                                    {{ event.start_yyyy }}
                                                </abbr>
                                            {% endif %}
                                        {% endif %}
                                        {% if event.has_end_date %}
                                            {% ifnotequal event.get_start_date event.get_end_date %}
                                                -
                                                {% if event.get_end_date %}
                                                    <abbr class="dtend" title="{{ event.get_end_date|date:"Y-m-d" }}">
                                                        {{ event.get_end_date|datefmt:"long" }}
                                                        {{ event.get_end_date|time:"H:i" }}
                                                    </abbr>
                                                {% else %}
                                                    <abbr class="dtend"
                                                        title="{{ event.end_yyyy }}-{{ event.end_mm|default:"01" }}-01">
                                                        {% if event.end_mm %}{{ event.get_end_mm_display }}{% endif %}
                                                        {{ event.end_yyyy }}
                                                    </abbr>
                                                {% endif %}
                                            {% endifnotequal %}{% endif %}
                                    {% endif %}
                                {% endif %}
                            </p>
                            <h5>
                                <a href="{{ event.get_url_path }}">
                                    {{ event.get_title|escape|truncatewords:7 }}
                                </a>
                            </h5>

                            <p>{{ event.venue.get_title|default:event.venue_title }}<br/>
                                {% for cat in event.get_object_types %}
                                    {{ cat.get_title|escape }}<br/>
                                    {% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </p>
                        </div>
                    </li>
                {% endfor %}
            </ul>
            <hr class="hidden"/>
        {% else %}
            <p>{% trans "There are no public events." %}</p>
            <hr class="hidden"/>
        {% endif %}
    {% endwith %}
    {% endcomment %}
{% endblock %}
