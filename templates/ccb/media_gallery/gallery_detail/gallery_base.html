{% extends "media_gallery/portfolio_base.html" %}
{% load i18n base_tags babel auth_extended infoblocks image_mods_tags %}
{% load favorites %}

{% block open_graph %}
    <meta property="og:title" content="{{ gallery.get_title }}"/>
    <meta property="og:type" content="album"/>
    {% if gallery.cover_image %}
        <meta property="og:image" content="{{ website_url|slice:":-1" }}{{ UPLOADS_URL }}{{ gallery.cover_image.path }}"/>
    {% elif gallery.mediafile_set.all.0.get_list_image_url %}
        <meta property="og:image" content="{{ website_url|slice:":-1" }}{{ gallery.mediafile_set.all.0.get_list_image_url }}"/>
    {% else %}
        <meta property="og:image" content="{{ website_url|slice:":-1" }}{{ STATIC_URL }}site/img/default/ccb_logo.gif"/>
    {% endif %}
    <meta property="og:url" content="{{ gallery.get_url }}"/>
    <meta property="og:site_name" content="{{ site_settings.site.name }}"/>
    <meta property="og:description" content="{{ gallery.get_title }} {% trans "of" %} {{ gallery.content_object }}"/>
{% endblock %}


{% block sidebar %}
    
    {{ block.super }}

    <div class="button-group">
        {% if perms.media_gallery.change_media_gallery %}
            <a class="fawesome fa-edit button text" href="{{ request.path }}manage/" >
                <span class="text">{% trans "Manage Project" %}</span>
            </a>
        {% endif %}
        <br/><br/>
    </div>

{% endblock %}

{% block details %}
    <h2>{{ gallery.title }}</h2>

    {% if gallery.cover_image %}
        <img src="{{ UPLOADS_URL }}{{ gallery.cover_image.path|modified_path:"article" }}" alt=""/>
    {% endif %}
    
    {{ gallery.description|linebreaks }}
    
    {% block gallery_detail %}
    {% endblock %}
    
{% endblock %}



{% block breadcrumbs_details %}
    <li><a href="{{ object.get_url_path }}portfolio/">{% trans "Portfolio" %}</a></li>
    <li>{{ gallery.title }}</li>
{% endblock %}


{% block extrahead_old %}
    {{ block.super }}
    <script type="text/javascript">
        // preloading portfolio images
        {% for f in list_of_files %}
            var oImg_{{ forloop.counter0 }} = new Image();
            oImg_{{ forloop.counter0 }}.src = "{{ UPLOADS_URL }}{{ f.path|modified_path:"gd" }}";
        {% endfor %}
    </script>
{% endblock %}

{% block object_controls_old %}
    <ul class="toolbar">
        {% if user.is_authenticated %}
            <li class="favorites">{% adding2favorites for gallery %}</li>
        {% endif %}
    </ul>
    <a class="addthis_button" href="http://www.addthis.com/bookmark.php?v=250&amp;pub=xa-4ad8ac114ae54f07">Share</a>
{% endblock %}

{% block details_old %}
    <h4>{{ gallery.title }}</h4>
    <div>{{ gallery.description|linebreaks }}</div>

    <div class="gallery-detail">
        {% block gallery_detail_old %}
        {% endblock %}
    </div>

    {% load comments %}
    {% get_comment_list for media_gallery.mediagallery gallery.id as comment_list %}
    <div id="comments">
        <div class="subline">
            {% if comment_list %}
                <p class="comment-count">
                    {% blocktrans count comment_list|length as counter %}1 comment{% plural %}{{ counter }}
                        comments{% endblocktrans %}
                </p>
            {% else %}
                <p class="comment-count">{% trans "No comments" %}</p>
            {% endif %}
            {% if request.user.is_authenticated %}
                <a class="post-comment" href="#last">{% trans "Post a comment" %}</a>
            {% endif %}
        </div>

        {% for comment in comment_list %}
            <div class="comment" id="c{{ comment.pk }}">
                <div class="comment-author">
                    {% if comment.user.profile.image %}
                        <img class="left" src="{{ UPLOADS_URL }}{{ comment.user.profile.image|modified_path:"at" }}"
                            alt="{{ comment.user.profile.get_title|escape }}"/>
                    {% else %}
                        {% if comment.user %}
                            <img class="left" src="{{ STATIC_URL }}site/img/website/placeholder/person_s.png"
                                alt="{{ comment.user.profile.get_title|escape }}"/>
                        {% else %}
                            <img class="left" src="{{ STATIC_URL }}site/img/website/placeholder/person_s.png"
                                alt="{{ comment.name|escape }}"/>
                        {% endif %}
                    {% endif %}
                    <p>
                        {% if comment.user %}
                            <a href='{{ comment.user.profile.get_url_path }}'>
                                {{ comment.user.profile.get_title|escape }}
                            </a><br/>
                        {% else %}
                            <span class="no_link">
                                {{ comment.name }}
                            </span><br/>
                        {% endif %}
                        {{ comment.submit_date|datefmt:"long" }}
                    </p>
                </div>
                <div class="comment-text">{{ comment.get_comment|disarm_user_input }}
                    {% if can_manage_portfolio %}
                        <ul class="toolbar">
                            {% if not comment.is_removed %}
                                <li id="refuseComment_{{ comment.id }}" class="refuseComment">
                                    <a class="refuseComment_but"
                                        href="{{ object.get_url_path }}{{ URL_ID_PORTFOLIO }}/album/{{ gallery.get_token }}/comment/{{ comment.id }}/refuse/">
                                        <span><span>{% trans "Refuse" %}</span></span>
                                    </a>
                                </li>
                                <li id="markAsSpamComment_{{ comment.id }}" class="markAsSpamComment">
                                    <a class="markAsSpamComment_but"
                                        href="{{ object.get_url_path }}{{ URL_ID_PORTFOLIO }}/album/{{ gallery.get_token }}/comment/{{ comment.id }}/mark_as_spam/">
                                        <span><span>{% trans "Mark as Spam" %}</span></span>
                                    </a>
                                </li>
                            {% else %}
                                <li id="acceptComment_{{ comment.id }}" class="acceptComment">
                                    <a class="acceptComment_but"
                                        href="{{ object.get_url_path }}{{ URL_ID_PORTFOLIO }}/album/{{ gallery.get_token }}/comment/{{ comment.id }}/accept/">
                                        <span><span>{% trans "Accept" %}</span></span>
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    {% endif %}
                </div>
            </div>
            <hr class="hidden"/>
        {% endfor %}
        {% if request.user.is_authenticated %}
            <div id="id_dyn_add_comment" class="comment-form">
                {% comment_form using "media_gallery/comments/form.html" for media_gallery.mediagallery gallery.id %}
            </div>
        {% endif %}
    </div>
{% endblock %}

