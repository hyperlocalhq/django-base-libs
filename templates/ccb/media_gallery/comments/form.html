{% load base_tags babel i18n image_modifications uni_form_tags %}
<form action="{{ object.get_url_path }}portfolio/album/{{ gallery.get_token }}/comments/add/" method="post"
    class="uniForm">{% csrf_token %}
    <fieldset class="inlineLabels">
        <h3>{% trans "Post a comment" %}</h3>
        {% if comment_form.is_valid %}
            <div class="preview">
                {% if comment.user.get_profile.image %}
                    <img class="left" src="{{ UPLOADS_URL }}{{ comment.user.get_profile.image|modified_path:"at" }}"
                        alt="{{ comment.user.get_profile.get_title|escape }}"/>
                {% else %}
                    {% if comment.user %}
                        <img class="left" src="{{ STATIC_URL }}site/img/website/placeholder/person_s.png"
                            alt="{{ comment.user.get_profile.get_title|escape }}"/>
                    {% else %}
                        <img class="left" src="{{ STATIC_URL }}site/img/website/placeholder/person_s.png"
                            alt="{{ comment.name|escape }}"/>
                    {% endif %}
                {% endif %}
                <div class="left">
                    {% if comment.user %}
                        <a href='{{ comment.user.get_profile.get_url_path }}'>
                            {{ comment.user.get_profile.get_title|escape }}
                        </a><br/>
                    {% else %}
                        <span class="no_link">
                            {{ comment.name }}
                        </span><br/>
                    {% endif %}
                    {{ comment.submit_date|datefmt:"long" }}
                </div>
                <div class="post_comment">
                    {{ comment.comment|disarm_user_input }}
                </div>
                <div class="buttonHolder">
                    <input type="submit" id="but_post" class="primaryAction" name="post"
                        value='{% filter upper %}{% trans "Post public comment" %}{% endfilter %}'/>
                </div>
            </div>
        {% endif %}

        {% if not request.user.is_authenticated %}
            {{ comment_form.name|as_uni_field }}
            {{ comment_form.email|as_uni_field }}
            {{ comment_form.url_link|as_uni_field }}
        {% endif %}

        {{ comment_form.comment|as_uni_field }}
        {{ comment_form.prevent_spam.error_tag }}
        {% comment %} Hidden Field for spam protection {% endcomment %}
        {{ comment_form.prevent_spam }}
        <span id="last">*{% trans "required fields" %}</span>

        <div class="buttonHolder">
            <input type="hidden" class="form_hidden" name="goto_next"
                value="{% if goto_next %}{{ goto_next }}{% else %}{{ request.get_full_path }}{% endif %}"/>
            <input type="hidden" class="form_hidden" name="options" value="{{ options }}"/>
            <input type="hidden" class="form_hidden" name="target" value="{{ target }}"/>
            <input type="hidden" class="form_hidden" name="gonzo" value="{{ hash }}"/>
            <input type="submit" id="but_preview" class="primaryAction" name="preview"
                value="{% filter upper %}{% trans "Preview" %}{% endfilter %}"/>
            {% if comment_form.is_valid %}
                <input type="button" id="but_cancel" class="secondaryAction"
                    value='{% filter upper %}{% trans "Cancel" %}{% endfilter %}'/>
            {% endif %}
        </div>

    </fieldset>
</form>

