{% load i18n base_tags auth_extended %}


{% if object.are_contacts_displayed or perms.people.change_person %}
    {% if object.get_contacts and perms.people.change_person %}{# TODO: change "and" to "or" when it is possible to add new contact by JavaScript #}
        <div class="fieldset {% if_has_perm "people.change_person" object %}editable switch{% else %}not-editable{% end_if_has_perm %}" data-edit-url="{% url 'edit_profile' object_type='person' slug=object.slug %}contact/0/">
            <fieldset disabled>
                <h2>{% trans "Contact Data" %}</h2>
                {% for contact in object.get_contacts %}
                    
                        {% if object.is_address_displayed %}
                        
                            {% if contact.location_title %}<h3>{{ contact.location_title }}</h3>{% endif %}
                            <dl class="input-fields">
                                {% if contact.institution_id %}
                                    <dt>{% trans 'Institution' %}</dt>
                                    <dd>
                                        <div class="text-field">
                                            {% ifequal contact.institution.status.sysname "draft" %}
                                                {{ contact.institution.get_title|escape }}
                                            {% else %}
                                                <a href="{{ contact.institution.get_url_path }}">{{ contact.institution.get_title|escape }}</a>
                                            {% endifequal %}
                                        </div>
                                    </dd>
                                    <dd class="clearfix"></dd>
                                {% endif %}
                                {% with contact.postal_address as address %}
                                    {% if address.street_address or address.street_address2 or address.street_address3 %}
                                        <dt>{% trans 'Address' %}</dt>
                                        <dd>
                                            <div class="text-field">
                                                {% if address.street_address %}<div>{{ address.street_address|escape }}</div>{% endif %}
                                                {% if address.street_address2 %}<div>{{ address.street_address2|escape }}</div>{% endif %}
                                                {% if address.street_address3 %}<div>{{ address.street_address3|escape }}</div>{% endif %}
                                            </div>
                                        </dd>
                                        <dd class="clearfix"></dd>
                                    {% endif %}
                                    {% if address.postal_code or address.city %}
                                        <dt>{% trans 'ZIP, City' %}</dt>
                                        <dd>
                                            <div class="text-field">
                                                {% if address.postal_code %}{{ address.postal_code|escape }} {% endif %}
                                                {% if address.city %}{{ address.city|escape }}{% endif %}
                                            </div>
                                        </dd>
                                        <dd class="clearfix"></dd>
                                    {% endif %}
                                    {% if address.country %}
                                        <dt>{% trans 'Country' %}</dt>
                                        <dd><div class="text-field">{{ address.country.get_name }}</div></dd>
                                        <dd class="clearfix"></dd>
                                    {% endif %}
                                {% endwith %}
                            </dl>
                            
                        {% else %}
                        
                            {% if contact.location_title %}
                                <h3>{{ contact.location_title }}</h3>
                            {% else %}
                                <h3>{{ contact.location_type }}</h3>
                            {% endif %}
                            
                            {% if contact.institution_id %}
                                <dl class="input-fields">
                                    <dt>{% trans 'Institution' %}</dt>
                                    <dd>
                                        <div class="text-field">
                                            {% ifequal contact.institution.status.sysname "draft" %}
                                                {{ contact.institution.get_title|escape }}
                                            {% else %}
                                                <a href="{{ contact.institution.get_url_path }}">{{ contact.institution.get_title|escape }}</a>
                                            {% endifequal %}
                                        </div>
                                    </dd>
                                    <dd class="clearfix"></dd>
                                </dl>
                            {% endif %}
                                
                        {% endif %}
                        
                        {% if contact.get_phones %}
                            <dl class="input-fields">
                                {% for phone in contact.get_phones %}
                                    <dt>{% if phone.type %}{{ phone.type }}{% else %}{% trans 'Phone' %}{% endif %}</dt>
                                    <dd>
                                        <div class="text-field">
                                            <a href="tel:+{{ phone.country }}{{ phone.area }}{{ phone.number }}">+{{ phone.country }}-{{ phone.area }}-{{ phone.number }}</a>
                                        </div>
                                    </dd>
                                    <dd class="clearfix"></dd>
                                {% endfor %}
                            </dl>
                        {% endif %}
                        
                        {% if contact.get_urls %}
                            <dl class="input-fields">
                                {% for url in contact.get_urls %}
                                    <dt>{% if url.type %}{{ url.type }}{% else %}{% trans 'Website' %}{% endif %}</dt>
                                    <dd>
                                        <div class="text-field">
                                            <a href="{{ url.link|escape }}" onclick="open_new_window(event)" target="_blank">{{ url.link }}</a>
                                        </div>
                                    </dd>
                                    <dd class="clearfix"></dd>
                                {% endfor %}
                            </dl>
                        {% endif %}
                        
                        {% if contact.get_ims %}
                            <dl class="input-fields">
                                {% for im in contact.get_ims %}
                                    <dt>{{ im.type }}</dt>
                                    <dd><div class="text-field">{{ im.address }}</div></dd>
                                    <dd class="clearfix"></dd>
                                {% endfor %}
                            </dl>
                        {% endif %}
                        
                {% endfor %}
            </fieldset>
        </div>
    {% endif %}
{% endif %}


{% comment %}
<div class="section-details {% if not forloop.last %}address_field{% else %}address_field_last{% endif %}">
    <div class="adr">
        {% if object.is_address_displayed %}
            <dl>
                {% if contact.location_title %}
                    <dt><span class="type">{{ contact.location_title }}</span></dt>
                {% endif %}
                <dd>
                    {% if contact.institution_id %}
                        {% ifequal contact.institution.status.sysname "draft" %}
                            {{ contact.institution.get_title|escape }}
                        {% else %}
                            <a class="org"
                                href="{{ contact.institution.get_url_path }}">{{ contact.institution.get_title|escape }}</a>
                        {% endifequal %}
                        <br/>
                    {% endif %}
                    <span class="fn hidden">{{ object.get_title|escape }}<br/> </span>

                    {% with contact.postal_address as address %}
                        {% if address.street_address %}
                            <span class="street-address">{{ address.street_address|escape }}, </span>
                        {% endif %}
                        {% if address.street_address2 %}
                            <span class="street-address">{{ address.street_address2|escape }}, </span>
                        {% endif %}
                        {% if address.street_address3 %}
                            <span class="street-address">{{ address.street_address3|escape }}, </span>
                        {% endif %}
                        {% if address.postal_code %}
                            <span class="postal-code">{{ address.postal_code|escape }} </span>
                            <span class="locality">{{ address.city|escape }}, </span>
                        {% endif %}
                        {% if address.country %}
                            <span class="country-name">{{ address.country.get_name }}</span>
                        {% endif %}
                    {% endwith %}
                </dd>
            </dl>
        {% else %}
            <dl>
                {% if contact.location_title %}
                    <dt><span class="type">{{ contact.location_title }}</span></dt>
                {% else %}
                    <dt><span class="type">{{ contact.location_type }}</span></dt>
                {% endif %}
                <dd>
                    {% if contact.institution_id %}
                        {% ifequal contact.institution.status.sysname "draft" %}
                            {{ contact.institution.get_title|escape }}
                        {% else %}
                            <a class="org"
                                href="{{ contact.institution.get_url_path }}">{{ contact.institution.get_title|escape }}</a>
                        {% endifequal %}
                        <br/>
                    {% endif %}
                </dd>
            </dl>
        {% endif %}


        {% if contact.get_phones %}
            {% for phone in contact.get_phones %}
                {% if forloop.first %}
                    <dl>
                {% endif %}
            <dd class="tel">
                {% if phone.type %}
                    <abbr class="type"
                        title="{% ifequal phone.type.slug "mobile" %}Cell{% else %}{% endifequal %}">{{ phone.type }}</abbr>
                    :
                {% endif %}
                <span class="value">+{{ phone.country }}-{{ phone.area }}-{{ phone.number }}</span></dd>
            {% if forloop.last %}
                </dl>
            {% endif %}

            {% endfor %}
        {% endif %}

        {% for url in contact.get_urls %}
            {% if forloop.first %}
                <dl>
            {% endif %}
        {% if url.type %}
            <dd><span class="type">{{ url.type }}: </span>
                <a class="url" href="{{ url.link|escape }}" onclick="open_new_window(event)">
                    {{ url.link }}</a>
            </dd>
        {% else %}
            <dd>
                <a class="url" href="{{ url.link|escape }}" onclick="open_new_window(event)">{{ url.link }}</a>
            </dd>
        {% endif %}
        {% if forloop.last %}
            </dl>
        {% endif %}
        {% endfor %}
        {% if contact.get_ims %}
            <dl>
                {% for im in contact.get_ims %}
                    <dd><span class="type">{{ im.type }}: </span>{{ im.address }}</dd>
                {% endfor %}
            </dl>
        {% endif %}
    </div>
</div>
{% endcomment %}