{% load base_tags %}
<fieldset class="module {{ fieldset.classes }}{% if fieldset.level %} nested nesting-level-{{ fieldset.level }}{% endif %}">
	{% if fieldset.name %}<h2 class="collapse-handler">{{ fieldset.name }}</h2>{% endif %}
	{% if fieldset.description %}<div class="description">{{ fieldset.description }}</div>{% endif %}
	{% for line in fieldset %}
        {% if line.is_fieldset %}
            {% include_parsed "admin/includes/fieldset.html" with line as fieldset %}
        {% else %}
            {% for field in line %}
                {% if not field.is_markup_type %}
                    <div class="row cells-{{ line.fields|length }}{% if not line.fields|length_is:"1" %} cells{% else %}{% if line.errors %} errors{% endif %}{% endif %}{% for field in line %} field-{{ field.field.name }}{% endfor %} ">
                    {{ line.errors }}
                {% endif %}
            {% endfor %}
            {% for field in line %}
                <div{% if not line.fields|length_is:"1" %} class="cell"{% endif %}>
                    {% if not field.is_markup_type %}
                        {% if field.is_checkbox %}
                            <div class="column span-4">&nbsp;</div>
                            <div class="column span-flexible">
                                {{ field.field }}{{ field.label_tag }}
                                {{ line.errors }}
                                {% if field.field.field.help_text %}
                                    <p class="help">{{ field.field.field.help_text|safe }}</p>
                                {% endif %}
                            </div>
                        {% else %}
                            <div class="column span-4">{{ field.label_tag }}</div>
                            <div class="column span-flexible">
                                {% if field.is_readonly %}
                                    <p>{{ field.contents }}</p>
                                {% else %}
                                    {% if field.has_markup_type %}
                                        {{ field.related_markup_type_field }}
                                        {% if field.related_markup_type_field.field.help_text %}<p class="help">{{ field.related_markup_type_field.field.help_text|safe }}</p>{% endif %}
                                        <p>{{ field.field }}</p>
                                    {% else %}          
                                        {{ field.field }}
                                    {% endif %}
                                {% endif %}
                                {{ line.errors }}
                                {% if field.field.field.help_text %}
                                    <p class="help">{{ field.field.field.help_text|safe }}</p>
                                {% endif %}
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            {% endfor %}
            {% for field in line %}
                {% if not field.is_markup_type %}
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}
	{% endfor %}
</fieldset>