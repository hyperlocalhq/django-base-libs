{% extends "people/details_base.html" %}
{% load i18n base_tags navigation_tags auth_extended babel %}


{% block details %}
    {% include "site_specific/count_of.html" %}
        {% if object_list %}
            {% include "utils/sorting_view_pagination_header.html" %}
        
            {% block breadcrumbs %}
                <div class="breadcrumbs">
                    <div>
                        <a class="active" href="#">{% trans "Events" %}</a>
                    </div>
                </div>
            {% endblock %}
            {% for event in object_list %}
                <div class="vevent">
                    <div class="list-item {% cycle odd,even %} expanded" onclick="redirect('{{ event.get_url_path }}');">
                        <div class="info-group-a">
                            <h5>
                                <a class="summary" href="{{ event.get_url_path }}">
                                    {{ event.get_title|escape }}
                                </a>
                            </h5>
                                {% if event.postal_address %}
                                    {% with event.postal_address.get_dict as postal_address %}
                                        {% if postal_address.street_address or postal_address.country_name %}
                                            <address class="location">
                                                {% if event.venue %}
                                                    <a href="{{ object.venue.get_url_path }}">
                                                        <span>{{ event.venue.title }}</span><br />
                                                    </a>
                                                {% else %}
                                                   {{ event.venue_title }}<br />
                                                {% endif %} 
                                                {% if postal_address.street_address %}
                                                    {{ postal_address.street_address|escape }}<br />
                                                {% endif %}								
                                                {% if postal_address.street_address2 %}
                                                    {{ postal_address.street_address2|escape }}<br />
                                                {% endif %}								
                                                {% if postal_address.street_address3 %}
                                                  {{ postal_address.street_address3|escape }}<br />
                                                {% endif %}								
                                                {% if postal_address.postal_code %}	
                                                    {{ postal_address.postal_code|escape }} {{ postal_address.city|escape }}<br />
                                                {% endif %}
                                                {% if postal_address.country_name %}
                                                    {{ postal_address.country_name }}<br />
                                                {% endif %}
                                            </address>
                                        {% endif %}
                                    {% endwith %}
                                {% endif %}
                            {% if event.get_contacts %}
                                {% with event.get_contacts.0 as contact %}
                                    {% if contact %}
                                        {% if event.is_address_displayed %}
                                            {% with contact.postal_address as postal_address %}
                                                <a href="/vcard/{{ event|content_type_id }}/{{ event.id }}">vcard</a>
                                                {% if postal_address.street_address or postal_address.country_name %}
                                                <div class="hidable">
                                                <address>
                                                    {% if contact.institution %}
                                                        <a href="{{ contact.institution.get_url_path }}">
                                                         <span class="org">
                                                         {{ contact.institution.get_title|escape }}</span></a>
                                                         <br />
                                                    {% endif %}
                                                    {% if postal_address.street_address %}
                                                         <span class="street-address">
                                                         {{ postal_address.street_address|escape }}
                                                         </span><br />
                                                    {% endif %}								
                                                    {% if postal_address.street_address2 %}
                                                         <span class="street-address">
                                                         {{ postal_address.street_address2|escape }}</span><br />
                                                    {% endif %}								
                                                    {% if postal_address.street_address3 %}
                                                         <span class="street-address">{{ postal_address.street_address3|escape }}
                                                         </span><br />
                                                    {% endif %}								
                                                    {% if postal_address.postal_code %}	
                                                         <span class="postal-code">{{ postal_address.postal_code|escape }} {{ postal_address.city|escape }}</span><br />
                                                    {% endif %}								
                                                    {% if postal_address.country_name %}
                                                        <span class="country-name">{{ postal_address.country_name }}
                                                        </span><br />
                                                    {% endif %}
                                                </address>
                                                </div>
                                                {% endif %}
                                            {% endwith %}
                                        {% endif %}
                                    {% endif %}
                                {% endwith %}
                            {% endif %}
                        {% include "events/controls.html" %}
                        </div>
                        <div class="item-eventual info-group-b">
                            {% if event.event_type.get_title %}
                                <div class="object-type">{{ event.event_type.get_title|escape }}</div>
                            {% endif %}
                            {% if event.has_start_date or event.has_end_date %}
                                
                                {% if event.label %}{{ event.label }}: {% else %}{% trans "Date" %}:{% endif %}
                                
                                {% if event.has_start_date %}
                                    {% if event.get_start_date %}
                                        <abbr class="dtstart" title="{{ event.get_start_date|date:"Y-m-d" }}">
                                            {{ event.get_start_date|datefmt:"long" }}
                                        </abbr>
                                    {% else %}
                                         <abbr class="dtstart" title="{{ event.start_yyyy }}-{{ event.start_mm|default:"01" }}-01">
                                        {% if event.start_mm %}
                                        {{ event.get_start_mm_display }}
                                        {% endif %}                    
                                        {{ event.start_yyyy }}</abbr>
                                    {% endif %}
                                {% endif %}
                                {% if event.has_end_date %}
                                {% ifnotequal event.get_start_date event.get_end_date %}
                                    -
                                    {% if event.get_end_date %}
                                        <abbr class="dtend" title="{{ event.get_end_date|date:"Y-m-d" }}">
                                            {{ event.get_end_date|datefmt:"long" }}
                                        </abbr>
                                    {% else %}
                                        <abbr class="dtend" title="{{ event.end_yyyy }}-{{ event.end_mm|default:"01" }}-01">
                                        {% if event.end_mm %}{{ event.get_end_mm_display }}{% endif %}
                                        {{ event.end_yyyy }}
                                        </abbr>
                                    {% endif %}
                                {% endifnotequal %}
                                <br />
                                {% endif %}
                                
                            {% endif %}	
                            
                            {% if event.get_contacts %}
                                {% with event.get_contacts.0 as contact %}
                                    {% if contact.get_phones %}
                                        {% for phone in contact.get_phones %}
                                            <span class="tel">
                                                    {% if phone.type %}
                                                    <abbr title="{{ phone.type.vcard_name }}" class="type">
                                                    {{ phone.type }}
                                                    </abbr>: {% endif %}
                                                    <span class="value">+{{ phone.country }}-{{ phone.area }}-{{ phone.number }}</span><br />
                                            </span>
                                        {% endfor %}
                                    {% endif %}
                                    {% for url in contact.get_urls %}
                                    <span>
                                        {% if url.type %}{{ url.type }}: {% endif %}<a  class="url" href="{{ url.link|escape }}" onclick="open_new_window(event)">
                                        {% with url.link|slice:"0:27"|escape as sliced %}{{ sliced }}{% with url.link|escape as not_sliced %}{% ifnotequal sliced url.link|escape %}...{% endifnotequal %}{% endwith %}{% endwith %}</a><br />
                                    </span>
                                    {% endfor %}
                                {% endwith %}
                            {% endif %}
                            {% if event.get_description %}
                                {% with event.get_description|striptags|truncatewords:"60" as filtered_desc %}{% with filtered_desc|truncatewords:"40" as shortened_desc %}
                                <span class="description hidable">{{ shortened_desc }}
                                    {% ifnotequal shortened_desc filtered_desc %}
                                    <a href="{{ event.get_url_path }}">{% trans "read more" %}</a>
                                    {% endifnotequal %}
                                </span>
                                {% endwith %}{% endwith %}
                            {% endif %}	
                        </div>
                    </div>
                </div>
            {% endfor %}
            {% include "utils/pagination_footer.html" %}
	
         {% else %}
            <p class="nothing">{% trans "No objects found within the selected conditions." %}</p>
        {% endif %}
{% endblock %}

