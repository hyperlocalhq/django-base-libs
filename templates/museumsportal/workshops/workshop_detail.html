{% extends "base.html" %}
{% load base_tags i18n image_modifications tagging_tags babel auth_extended %}
{% block title %}{% trans "Guided Tour" %} â€“ {{ object.title }}{% endblock %}
{% block bodyclass %}workshop-detail{% endblock %}

{% block js %}
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/favorites.js" defer="defer"></script>
    <script type="text/javascript">
        var aGeopositions = [];
        var settings = {
            STATIC_URL: "{{ STATIC_URL }}"
        }

        $(document).ready(function(){
            $(".toggle_bvg").click(function () {
                $("#bvg_widget").toggleClass("on");
                return false;
            });
        });
    </script>
{% endblock %}

{% block edit_item %}
    {% if_has_perm "workshops.change_workshop" object %}
    <li><a class="edit icon icon-edit" rel="tooltip" data-placement="bottom" data-original-title="{% trans "Edit" %}" href="{{ request.path }}change/">&nbsp;<span>{% trans "Edit" %}</span></a></li>
    {% end_if_has_perm %}
{% endblock %}


{% block content %}
{% include "utils/gmap.html" %}
{% with object as workshop %}
<div class="content clearfix">
  <div class="inner">
        {% include "utils/cover_image.html" %}
        <section class="sidebar">
            <ul class="accordion" id="accordion2">  

                <!-- ======= Location ======= -->

                {% if workshop.street_address or workshop.museum.street_address or workshop.organizing_museum or workshop.organizer_title or workshop.exhibition %}
                    <li class="accordion-group">  
                        <h4 class="accordion-heading">  
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-location">  
                                {% trans "Location" %}
                            </a>
                        </h4>
                        <ul id="collapse-location" class="accordion-body collapse">  
                            <li class="accordion-inner">
                                {% if workshop.museum %}
                                    {% with workshop.museum as museum %}
                                        <dl class="address">
                                            <dt><a href="{{ museum.get_url_path }}">{{ museum.title }}</a> </dt>
                                            <dd>{{ museum.street_address }}</dd>
                                            {% if museum.street_address2 %}<dd>{{ museum.street_address2 }}</dd>{% endif %} 
                                            <dd>{{ museum.postal_code }} {{ museum.city }}</dd>
                                        </dl>
                                    {% endwith %}
                                {% else %}
                                    <dl class="address">
                                        <dt>{{ workshop.location_name }}</dt>
                                        <dd>{{ workshop.street_address }}</dd>
                                        {% if workshop.street_address2 %}<dd>{{ workshop.street_address2 }}</dd>{% endif %} 
                                        <dd>{{ workshop.postal_code }} {{ workshop.city }}</dd>
                                    </dl>
                                {% endif %}
                                {% if workshop.organizing_museum %}
                                    <dl>
                                        <dt>{% trans "Organizer" %}</dt>
                                        <dd><a href="{{ workshop.organizing_museum.get_url_path }}">{{ workshop.organizing_museum.title }}</a></dd>
                                    </dl>
                                {% else %}
                                    {% if workshop.organizer_title %}
                                        <dl>
                                            <dt>{% trans "Organizer" %}</dt>
                                            {% if workshop.organizer_url_link %}
                                                <dd><a href="{{ workshop.organizer_url_link }}">{{ workshop.organizer_title }}</a></dd>
                                            {% else %}
                                                <dd>{{ workshop.organizer_title }}</dd>
                                            {% endif %}
                                        </dl>
                                    {% endif %}
                                {% endif %}
                                {% if workshop.exhibition %}
                                    <dl>
                                        <dt>{% trans "Related exhibition" %}</dt>
                                        <dd><a href="{{ workshop.exhibition.get_url_path }}">{{ workshop.exhibition.title }}</a></dd>
                                    </dl>
                                {% endif %}
                            </li>
                            <li class="accordion-inner">
                                {% with workshop as list_item %}
                                    <a href="#" class="location">{% trans "Show location on map" %}</a>
                                    {% include "utils/geo_position.html" %}
                                {% endwith %}
                            </li>
                        </ul>  
                    </li>
                {% endif %}

                <!-- ======= Prices ======= -->

                {% if workshop.admission_price or workshop.admission_price_info or workshop.reduced_price or workshop.reduced_price_info or workshop.booking_info %}
                    <li class="accordion-group">  
                        <h4 class="accordion-heading">  
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-prices">  
                                {% trans "Prices" %} 
                            </a>  
                        </h4>  
                        <ul id="collapse-prices" class="accordion-body collapse">  
                            <li class="accordion-inner">
                                {% if workshop.free_entrance %}
                                    <dl>
                                        <dt>{% trans "Free entrance" %}</dt>
                                    </dl>
                                {% else %}
                                    {% if workshop.admission_price or workshop.admission_price_info%}
                                        <dl>
                                        {% if workshop.admission_price %}
                                            <dt>{% trans "Admission price" %}: {{ workshop.admission_price|currencyfmt:"EUR" }}</dt>
                                        {% endif %}
                                        {% if workshop.admission_price_info %}
                                            <dd class="admission_price_info">{{ workshop.get_rendered_admission_price_info }}</dd>
                                        {% endif %}
                                        </dl>
                                    {% endif %}

                                    {% if workshop.reduced_price or workshop.reduced_price_info%}
                                        <dl>
                                        {% if workshop.reduced_price %}
                                            <dt>{% trans "Reduced price" %}: {{ workshop.reduced_price|currencyfmt:"EUR" }}</dt>
                                        {% endif %}
                                        {% if workshop.reduced_price_info %}
                                            <dd class="reduced_price_info">{{ workshop.get_rendered_reduced_price_info }}</dd>
                                        {% endif %}
                                        </dl>
                                    {% endif %}
                                {% endif %}
                            </li>
                            {% if workshop.booking_info %}
                            <li class="accordion-inner">
                                <dl>
                                    <dt>{% trans "Booking info" %}</dt>
                                    <dd class="booking_info">{{ workshop.get_rendered_booking_info }}</dd>
                                </dl>
                            </li>
                            {% endif %}
                        </ul>  
                    </li>
                {% endif %}

                <!-- ======= DATES ======= -->

                <li class="accordion-group">  
                    <h4 class="accordion-heading">  
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-dates">  
                            {% trans "DATES" %} 
                        </a>  
                    </h4>  
                    <ul id="collapse-dates" class="accordion-body collapse">  
                        <li class="accordion-inner">
                            {% for workshop_time in workshop.workshoptime_set.all %}
                            <dl>
                                <dt>{{ workshop_time.workshop_date|date:"j. F Y" }}
                                {{ workshop_time.start|time:"H:i" }}{% if workshop_time.end %} {% trans "till" %} {{ workshop_time.end|time:"H:i" }}{% endif %}</dt>
                            </dl>
                               
                            {% endfor %}
                        </li>
                    </ul>  
                </li>

                <!-- ======= Other Information ======= -->

                {% if workshop.meeting_place or workshop.age_groups.all or workshop.get_languages %}
                    <li class="accordion-group">  
                        <h4 class="accordion-heading">  
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-other-info">  
                                {% trans "Other Information" %} 
                            </a>  
                        </h4>  
                        <ul id="collapse-other-info" class="accordion-body collapse">  
                            <li class="accordion-inner">
                                {% if workshop.meeting_place %}
                                    <dl>
                                        <dt>{% trans "Meeting point" %}</dt>
                                        <dd class="meeting_place">{{ workshop.meeting_place }}</dd>
                                    </dl>
                                {% endif %}

                                {% if workshop.age_groups %}
                                    <dt>{% trans "Age groups" %}</dt>
                                    <dd class="meeting_place">
                                        {% for cat in workshop.age_groups.all %}
                                            {{ cat.title }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </dd>
                                {% endif %}
                                
                                {% if workshop.get_languages %}
                                    <dl>
                                        <dt>{% trans "Languages" %}</dt>
                                        <dd class="languages">{{ workshop.get_languages|join:", " }}</dd>
                                    </dl>
                                {% endif %}
                            </li>
                        </ul>  
                    </li>
                {% endif %}
            </ul> 
        </section>
        
        <article class="with_sidebar">
            <header>
                <time>
                    {% with workshop.workshoptime_set.all.0 as workshop_time %}
                        {{ workshop_time.workshop_date|date:"j. F Y" }}
                        {{ workshop_time.start|time:"H:i" }}{% if workshop_time.end %} {% trans "till" %} {{ workshop_time.end|time:"H:i" }}{% endif %}
                    {% endwith %}
                <time>
                <h1>{{ workshop.title }}</h1>
                {% if workshop.subtitle %}
                    <h2>{{ workshop.subtitle }}</h2>
                {% endif %}
                {% if workshop.workshop_type %}
                    <h3>{{ workshop.workshop_type }}</h3>
                {% endif %}
                
                {% if workshop.museum %}
                    <a href="{{ workshop.museum.get_url_path }}"><h3>{{ workshop.museum.title }}</h3></a>
                {% endif %}
            </header>
            {{ workshop.get_rendered_description }}
            
            <ul class="tags">
                {% if workshop.categories.count %}
                    {% for cat in workshop.categories.all %}
                        <li class="cat"><a href="{% if LANGUAGE_CODE == "de" %}/de/ausstellungen/{% else %}/en/workshops/{% endif %}#filter=.cat_{{ cat.title|slugify }}">{{ cat.title }}</a></li>
                    {% endfor %}
                {% endif %}
                {% tags_for_object workshop as tags %}
                {% if tags %}
                    {% for tag in tags %}
                        <li><a href="{% if LANGUAGE_CODE == "de" %}/de/ausstellungen/{% else %}/en/workshops/{% endif %}#filter=.tag_{{ tag.slug }}">{{ tag.name }}</a></li>
                    {% endfor %}
                {% endif %}
            </ul>   
        </article>
  </div>
</div>


{% if object.get_other_workshops %}
    <div class="content" class="clearfix">
        <div class="inner">
            <h2>{% trans "Other Workshops of" %} 
    {% if workshop.museum %} {% with workshop.museum as museum %} {{ museum.title }} {% endwith %} {% else %} {{ workshop.location_name }} {% endif %}
            </h2>
            <ul class="list rows clearfix">
                {% for workshop in object.get_other_workshops %}
                    <li class="item">
                        <a class="img" href="{% if workshop.cover_image %}{{ workshop.get_url_path }}" data-background="{{ MEDIA_URL }}{{ workshop.cover_image|modified_path:"workshop_list" }}{% endif %}"><span class="spinner loading"></span></a>

                        <a href="{{ workshop.get_url_path }}">
                            {% with workshop.workshoptime_set.all.0 as workshop_time %}
                                <h4>{{ workshop_time.workshop_date|date:"j. F Y" }} {{ workshop_time.start|date:"H:i" }}</h4>
                            {% endwith %}
                            <h3>{{ workshop.title }}</h3>
                            {% if workshop.subtitle %}
                                <h4>{{ workshop.subtitle }}</h4>
                            {% endif %}
                            <h5>{{ workshop.museum.title }}</h5>
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>  
    {% endif %} 
{% endwith %}


{% include "utils/gallery.html" %}
{% include "utils/page_controls.html" %}
{% include "utils/gmap_scripts.html" %}
{% include "utils/gallery_scripts.html" %}
{% endblock %}
