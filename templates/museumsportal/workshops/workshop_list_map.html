{% extends "base_map.html" %}
{% load i18n image_modifications base_tags tagging_tags favorites auth_extended infoblocks %}
{% block title %}{% trans "Guided Tours, Workshops and educational offers" %} â€“ {% endblock %}
{% block bodyclass %}workshop-list{% endblock %}

{% block js %}
  <script type="text/javascript" src="{{ STATIC_URL }}site/js/GetSet.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}site/js/list.min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}site/js/favorites.js" defer="defer"></script>
  <script type="text/javascript">
    var str_filter_selection = "{% trans "Filter selection" %}";
  </script>
{% endblock %}

{% block filters %}
  {% include "utils/filter_workshops.html" %}
{% endblock %}

{% block list-title %}
  {% trans "Guided Tours, Workshops and educational offers" %}
{% endblock %}

{% block map-list %}
  <div id="container">
    {% for workshop in object_list %}
        {% tags_for_object workshop as tags %}
        <div class="item" data-filter-categories="initial_{{ workshop.title|slugify|slice:"0:1" }}{% for cat in workshop.categories.all %} cat_{{ cat.title|slugify }}{% endfor %}{% if tags %}{% for tag in tags %} tag_{{ tag.slug }}{% endfor %}{% endif %}{% if workshop.has_group_offer %} has_group_offer{% endif %}{% if workshop.is_for_preschool %} is_for_preschool{% endif %}{% if workshop.is_for_primary_school %} is_for_primary_school{% endif %}{% if workshop.is_for_youth %} is_for_youth{% endif %}{% if workshop.is_for_families %} is_for_families{% endif %}{% if workshop.is_for_wheelchaired %} is_for_wheelchaired{% endif %}{% if workshop.is_for_deaf %} is_for_deaf{% endif %}{% if workshop.is_for_blind %} is_for_blind{% endif %}{% if workshop.is_for_learning_difficulties %} is_for_learning_difficulties{% endif %}{% if workshop.is_for_dementia_sufferers %} is_for_dementia_sufferers{% endif %}{% if workshop.free_admission %} is_free_admission{% endif %}{% if workshop.is_today %} is_today{% endif %}{% if workshop.is_tomorrow %} is_tomorrow{% endif %}{% if workshop.is_within_7_days %} is_within_7_days{% endif %}{% if workshop.is_within_30_days %} is_within_30_days{% endif %}" style="cursor: pointer" data-geo="{% if workshop.latitude %}{{ workshop.latitude|stringformat:"f" }}{% else %}{{ workshop.museum.latitude|stringformat:"f" }}{% endif %},{% if workshop.longitude %}{{ workshop.longitude|stringformat:"f" }}{% else %}{{ workshop.museum.longitude|stringformat:"f" }}{% endif %}" data-object_id="{{ workshop.pk }}">
          <a href="{{ workshop.get_url_path }}">
            {% if workshop.has_group_offer or not workshop.workshoptime_set.count %}
              <h4>{% for t in workshop.types.all %}{{ t.title }}{% if not forloop.last %}, {% else %}:{% endif %}{% endfor %} {% trans "Bookable Offer" %}. {{ workshop.get_particularities|join:'. ' }}</h4>
            {% else %}
              <h4>{% for t in workshop.types.all %}{{ t.title }}{% if not forloop.last %}, {% else %}:{% endif %}{% endfor %}
                {% with workshop.get_closest_workshop_time as workshop_time %}
                  {{ workshop_time.workshop_date|date:"j. F Y" }}
                  {{ workshop_time.start|time:"H:i" }}{% if workshop_time.end %} {% trans "till" %} {{ workshop_time.end|time:"H:i" }}{% endif %}{% if LANGUAGE_CODE == "de" %} Uhr{% endif %}.
                {% endwith %}
                {{ workshop.get_particularities|join:'. ' }}
              </h4>
            {% endif %}

            <h3>{{ workshop.title }}</h3>
            <h4>{{ workshop.subtitle }}</h4>
            
            {% if workshop.exhibition %}
              <h5>{% blocktrans with workshop.exhibition.title as exhibition_title %}Accompanying program for exhibition "{{ exhibition_title }}"{% endblocktrans %}:
                <span class="from_date">{{ workshop.exhibition.start|date:"d.m.Y" }}</span> {% if workshop.exhibition.permanent %}{% trans "until further notice" %}{% else %}{% if workshop.exhibition.end %}{% trans "till" %} {{ workshop.exhibition.end|date:"d.m.Y" }}{% endif %}{% endif %}
              </h5>
            {% endif %}

            {% if workshop.location_name %}
              <h5>{{ workshop.location_name }}</h5>
            {% else %}
              <h5>{{ workshop.museum.title }}</h5>
            {% endif %}
          </a>
        </div>
        {% endfor %}
  </div><!-- for the project.list.min.js script to work -->
  <script>
    var aGeopositions = [];
    {% for workshop in object_list %}
      {% if workshop.latitude or workshop.museum.latitude %}
        {% tags_for_object workshop as tags %}
        aGeopositions.push({
            object_id: '{{ workshop.pk }}',
            html_src: '{{ workshop.get_url_path }}ajax/map/',
            latitude: {% if workshop.latitude %}{{ workshop.latitude|stringformat:"f" }}{% else %}{{ workshop.museum.latitude|stringformat:"f" }}{% endif %},
            longitude: {% if workshop.longitude %}{{ workshop.longitude|stringformat:"f" }}{% else %}{{ workshop.museum.longitude|stringformat:"f" }}{% endif %},
            geo: "{% if workshop.latitude %}{{ workshop.latitude|stringformat:"f" }}{% else %}{{ workshop.museum.latitude|stringformat:"f" }}{% endif %},{% if workshop.longitude %}{{ workshop.longitude|stringformat:"f" }}{% else %}{{ workshop.museum.longitude|stringformat:"f" }}{% endif %}",
            categories: 'initial_{{ workshop.title|slugify|slice:"0:1" }}{% for cat in workshop.categories.all %} cat_{{ cat.title|slugify }}{% endfor %}{% if tags %}{% for tag in tags %} tag_{{ tag.slug }}{% endfor %}{% endif %}{% if workshop.has_group_offer %} has_group_offer{% endif %}{% if workshop.is_for_preschool %} is_for_preschool{% endif %}{% if workshop.is_for_primary_school %} is_for_primary_school{% endif %}{% if workshop.is_for_youth %} is_for_youth{% endif %}{% if workshop.is_for_families %} is_for_families{% endif %}{% if workshop.is_for_wheelchaired %} is_for_wheelchaired{% endif %}{% if workshop.is_for_deaf %} is_for_deaf{% endif %}{% if workshop.is_for_blind %} is_for_blind{% endif %}{% if workshop.is_for_learning_difficulties %} is_for_learning_difficulties{% endif %}{% if workshop.is_for_dementia_sufferers %} is_for_dementia_sufferers{% endif %}{% if workshop.free_admission %} is_free_admission{% endif %}{% if workshop.is_today %} is_today{% endif %}{% if workshop.is_tomorrow %} is_tomorrow{% endif %}{% if workshop.is_within_7_days %} is_within_7_days{% endif %}{% if workshop.is_within_30_days %} is_within_30_days{% endif %}'
        });
      {% endif %}
    {% endfor %}
  </script>
  {% include "utils/gmap_scripts.html" %}
{% endblock %}