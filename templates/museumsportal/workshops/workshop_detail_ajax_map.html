{% load base_tags i18n image_modifications tagging_tags babel auth_extended favorites %}
{% with object as workshop %}
  {% tags_for_object workshop as tags %}
  <div class="map-ajax-detail">
    <header>
      <h2>
        <time>
          {% if workshop.has_group_offer or not workshop.workshoptime_set.count %}
            {% for t in workshop.types.all %}{{ t.title }}{% if not forloop.last %}, {% else %}:{% endif %}{% endfor %}
            {% trans "Bookable Offer" %}
          {% else %}
            {% for t in workshop.types.all %}{{ t.title }}{% if not forloop.last %}, {% else %}:{% endif %}{% endfor %}
            {% with workshop.get_closest_workshop_time as workshop_time %}
              <nobr>{{ workshop_time.workshop_date|date:"j. F Y" }}
              {{ workshop_time.start|time:"H:i" }}{% if workshop_time.end %} {% trans "till" %} {{ workshop_time.end|time:"H:i" }}{% endif %}{% if LANGUAGE_CODE == "de" %} Uhr{% endif %}</nobr>
            {% endwith %}
          {% endif %}
        </time>
      </h2>

      <h1>{{ workshop.title }}</h1>

      {% if workshop.subtitle %}
        <h2>{{ workshop.subtitle }}</h2>
      {% endif %}

      {% if workshop.location_name %}
        <h3>{{ workshop.location_name }}</h3>
      {% else %}
        {% if workshop.museum %}
            <a href="{{ workshop.museum.get_url_path }}"><h3>{{ workshop.museum.title }}</h3></a>
        {% endif %}
      {% endif %}


    </header>
    
    <div class="tools">
      {% if request.user.is_authenticated %}
        {% adding2favorites for workshop %}
      {% endif %}
      {% if_has_perm "workshops.change_workshop" workshop %}
        {% if workshop.cover_image %}
          <button data-toggle="tooltip" data-placement="top" data-original-title="{% trans "Crop image" %}" class="crop btn btn-default btn-round" onclick="location.href='{% cropping_url workshop.cover_image "workshop_list" request request.path %}';">
            <span class="icon icon-tool-crop"></span>
            <span class="sr-only">{% trans "Crop Image" %}</span>
          </button>
        {% else %}{% if workshop.museum.cover_image %}
          <button data-toggle="tooltip" data-placement="top" data-original-title="{% trans "Crop image" %}" class="crop btn btn-default btn-round" onclick="location.href='{% cropping_url workshop.museum.cover_image "workshop_list" request request.path %}';">
            <span class="icon icon-tool-crop"></span>
            <span class="sr-only">{% trans "Crop Image" %}</span>
          </button>
        {% endif %}{% endif %}
      {% end_if_has_perm %}
    </div>

    <p>{{ workshop.get_rendered_description|striptags|truncatewords:"45"|urlize }}</p>
    <a class="btn btn-info" href="{{ workshop.get_url_path }}">{% trans "more" %}</a>
  </div>
{% endwith %}