{% extends "base.html" %}
{% load i18n image_modifications base_tags %}

{% block js %}
	<script type="text/javascript" src="{{ STATIC_URL }}site/js/StickyScroller.min.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}site/js/GetSet.js"></script>
	<script type="text/javascript">
	$(function() {

        var scroller = new StickyScroller("#filter", {
            start: 428,
            margin: 0
        });

	});
    var aGeopositions = [];
    var settings = {
        STATIC_URL: "{{ STATIC_URL }}"
    }
    </script>
{% endblock %}

{% block content %}

    <div id="museum_list_map">
        <div id="gmap" style="width:1000px; height:350px"></div>
    </div>

	{% include "utils/abc_filters.html" %}

    <div class="marginal">
        <ul id="filter">
            <li class="catHead">→ Filter</li>
            {% for cat in facets.categories.categories %}
                {% if cat == facets.selected.category %}
                    <li class="active">{{ cat.title }}<a class="cancel" href="{% append_to_get category="" %}">×</a></li>
                {% else %}
                    <li><a href="{% append_to_get category=cat.pk %}">{{ cat.title }}</a></li>
                {% endif %}
            {% endfor %}
            {% if facets.selected.open_on_mondays %}
                <li class="open_on_mondays active">{{ facets.categories.open_on_mondays }}<a href="{% append_to_get open_on_mondays="" %}">×</a></li>
            {% else %}
                <li class="open_on_mondays"><a class="cancel" href="{% append_to_get open_on_mondays=1 %}">{{ facets.categories.open_on_mondays }}</a></li>
            {% endif %}
            {% if facets.selected.free_entrance %}
                <li class="free_entrance active">{{ facets.categories.free_entrance }}<a href="{% append_to_get free_entrance="" %}">×</a></li>
            {% else %}
                <li class="free_entrance"><a class="cancel" href="{% append_to_get free_entrance=1 %}">{{ facets.categories.free_entrance }}</a></li>
            {% endif %}
        </ul>
    </div>
    
    <div id="museum_list">
        <div id="object_list">
        {% for museum in object_list %}
            <div class="article" onclick="location.href='{% url museum_detail slug=museum.slug %}';" style="cursor: pointer">
                
                <a class="proceed" href="{% url museum_detail slug=museum.slug %}">{% trans "more" %}</a>
                <h2>{{ museum.title }}</h2>
                {% if museum.latitude %}
                    <script type="text/javascript">
                    //<![CDATA[
                    (function(undefined) {
                        var iIndex = aGeopositions.length;
                        aGeopositions[iIndex] = {
                            latitude: {{ museum.latitude }},
                            longitude: {{ museum.longitude }},
                            content: '<div class="contact-mapped" onclick="location.href=\'{% url museum_detail slug=museum.slug %}\';">'
                            + '{% if museum.image %}<img src="{{ UPLOADS_URL }}{{ museum.image.path|modified_path:"map_item" }}" alt="{{ museum.title }}" width="52" height="52" />{% endif %}'
                            + '<h4>{{ museum.title|truncatewords:5 }}</h4>'
                            + '<p>{{ museum.street_address }} {{ museum.street_address2 }}</p>'
                            + '<hr />'
                            + '<a href="{% url museum_detail slug=museum.slug %}">{% trans "more" %}</a>'
                            + '</div>'
                        }
                    }());
                    //]]>
                    </script>
                    <div class="marker-link"></div>
                {% endif %}
            </div>
        {% endfor %}
        </div>
    </div>
    
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;language=de&amp;region=DE"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/styledinfowindow.js"></script>    
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/listing_map.js"></script>    
{% endblock %}
