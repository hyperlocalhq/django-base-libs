{% extends "base.html" %}
{% load i18n image_modifications base_tags %}

{% block js %}
	<script type="text/javascript" src="{{ STATIC_URL }}site/js/StickyScroller.min.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}site/js/GetSet.js"></script>
	
    <script type="text/javascript">
        var aGeopositions = [];
        var settings = {
            STATIC_URL: "{{ STATIC_URL }}"
        }
    </script> 
{% endblock %}

{% block bodyclass %}map_visible{% endblock %}

{% block content %}

	<div>
		<div id="gmap_toggle" class="">&nbsp;</div>
		<div id="gmap_wrapper" class="">
			<div id="gmap" style="width:1000px; height:400px"></div>
		</div>
    </div>

    <h1>Museen, Schlösser und Gedenkstätten</h1>

    <!-- <ul class="filter clearfix" id="cathegories">
        <li class="title">Filter</li>

        <li class="special {% if not facets.selected.category and not facets.selected.open_on_mondays and not facets.selected.free_entrance %}active{% endif %} filter-all" id="all"><a href="{% append_to_get category="",open_on_mondays="",free_entrance="" %}">Alle Museen</a></li>
        
        {% if facets.selected.open_on_mondays %}
            <li class="open_on_mondays active"><a class="cancel" href="{% append_to_get open_on_mondays="" %}">{{ facets.categories.open_on_mondays }}
            </a></li>
        {% else %}
            <li class="open_on_mondays special"><a href="{% append_to_get open_on_mondays=1 %}">{{ facets.categories.open_on_mondays }}</a></li>
        {% endif %}
        {% if facets.selected.free_entrance %}
            <li class="free_entrance active">
            <a class="cancel" href="{% append_to_get free_entrance="" %}">
            {{ facets.categories.free_entrance }}</a></li>
        {% else %}
            <li class="free_entrance special"><a href="{% append_to_get free_entrance=1 %}">{{ facets.categories.free_entrance }}</a></li>
        {% endif %}
        
        
        {% for cat in facets.categories.categories %}
            {% if cat == facets.selected.category %}
                <li class="active"><a class="cancel" href="{% append_to_get category="" %}">{{ cat.title }}</a></li>
            {% else %}
                <li><a href="{% append_to_get category=cat.pk %}">{{ cat.title }}</a></li>
            {% endif %}
        {% endfor %}
    </ul>
 -->

    <ul class="filter option-set clearfix" id="alphabetical" data-filter-group="alphabetical">
    {% for item in abc_list %}
      <li><a data-filter-value="{% if item.0 %}.initial_{{ item.0|slugify }}{% endif %}" class="{% if forloop.first %} first_item{% endif %}{% if item.3 %} selected{% endif %}" href="">{{ item.1 }}</a></li>           
    {% endfor %}
    </ul>

    <ul class="filter option-set clearfix" id="category" data-filter-group="category">
        <li><a data-filter-value="" href="#any-category" class="selected">Alle</a></li>
        {% for cat in facets.categories.categories %}
        <li><a data-filter-value=".cat_{{ cat.title|slugify }}" href="#{{ cat.title|slugify }}" >{{ cat.title }}</a></li>
        {% endfor %}
    </ul>

    <ul id="container" class="list tiles clearfix">
        {% for museum in object_list %}
            <li class="item initial_{{ museum.title|slugify|slice:"0:1" }} {% for cat in museum.categories.all %}cat_{{ cat.title|slugify }}{% if not forloop.last %} {% endif %}{% endfor %}">
                
                {% if museum.image %}
                    <a class="img" href="{{ museum.get_url_path }}"  data-background="{{ MEDIA_URL }}{{ museum.image }}">
                        <span class="spinner loading"></span>
                        <span class="overlay"></span>
                    </a>
                {% endif %}

                <ul class="actions">
                    <li><a href="#" rel="tooltip" data-placement="top" data-original-title="Add to Favorites" class="add-favorite"></a></li>
                    <li><a href="#" rel="tooltip" data-placement="top" data-original-title="Show location on map" class="marker-link show-location"></a></li>
                </ul>

                <a href="{{ museum.get_url_path }}">
                     <h3>{{ museum.title }}</h3>
                    {% if museum.subtitle %}
                        <h4>{{ museum.subtitle }}</h4>
                    {% endif %}
                </a>
                

                {% if museum.latitude %}
                    <script type="text/javascript">
                    //<![CDATA[
                    (function(undefined) {
                        var iIndex = aGeopositions.length;
                        aGeopositions[iIndex] = {
                            latitude: {{ museum.latitude }},
                            longitude: {{ museum.longitude }},
                            categories: "initial_{{ museum.title|slugify|slice:"0:1" }}{% for cat in museum.categories.all %} cat_{{ cat.title|slugify }}{% endfor %}",
                            content: '<div class="inner" onclick="location.href=\'{{ museum.get_url_path }}\';">'
                            + '{% if museum.image %}<span class="img" style="background-image: url({{ UPLOADS_URL }}{{ museum.image.path }})"></span>{% endif %}'
                            + '<h3>{{ museum.title }}</h3>'
                            + '{% if museum.subtitle %}<h4>{{ museum.subtitle }}</h4>{% endif %}'
                            + '<h5>{{ museum.street_address }} {{ museum.street_address2 }}</h5>'
                            + '<a class="btn small" href="{{ museum.get_url_path }}">{% trans "more" %}</a>'
                            + '</div>'
                        }
                    }());
                    //]]>
                    </script> 
                    
                {% endif %}
            </li>
        {% endfor %}
    </ul>
    
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;language=de&amp;region=DE"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/styledinfowindow.js"></script>    
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/listing_map.js"></script>
    <script type="text/javascript">
    //<![CDATA[
    (function($, undefined) {
        $(function() {
            $('.article').click(function() {
                var link = $(this).find('a').attr('href');
                location.href = link;
            });
        });
    }(jQuery));
    //]]>
    </script>
    <script type="text/javascript">
    //<![CDATA[
    (function($, undefined) {
        $(function() {
           
            $('#gmap_toggle').click(function() {
                $('body').toggleClass('map_visible');
            });
        });
    }(jQuery));
    //]]>
    </script>

{% endblock %}
