{% extends "base.html" %}
{% load i18n image_modifications base_tags %}

{% block js %}
	<script type="text/javascript" src="{{ STATIC_URL }}site/js/StickyScroller.min.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}site/js/GetSet.js"></script>
	<script type="text/javascript">
	$(function() {

        var scroller = new StickyScroller("#head_filter", {
            start: $('#head_filter').offset().top,
            margin: 0
        });

	});
    var aGeopositions = [];
    var settings = {
        STATIC_URL: "{{ STATIC_URL }}"
    }
    </script>
{% endblock %}

{% block bodyclass %}map_visible{% endblock %}

{% block content %}

	
	<div id="head_filter">
		<div id="gmap_toggle" class="">&nbsp;</div>
		<div id="gmap_wrapper" class="">
			<div id="gmap" style="width:1000px; height:200px"></div>
		</div>
	    <ul class="filter">
	        <li class="special {% if not facets.selected.category and not facets.selected.open_on_mondays and not facets.selected.free_entrance %}active{% endif %} filter-all" id="all"><a href="{% append_to_get category="",open_on_mondays="",free_entrance="" %}">Alle Museen</a></li>
	        
	        {% if facets.selected.open_on_mondays %}
	            <li class="open_on_mondays active"><a class="cancel" href="{% append_to_get open_on_mondays="" %}">{{ facets.categories.open_on_mondays }}
	            </a></li>
	        {% else %}
	            <li class="open_on_mondays special"><a href="{% append_to_get open_on_mondays=1 %}">{{ facets.categories.open_on_mondays }}</a></li>
	        {% endif %}
	        {% if facets.selected.free_entrance %}
	            <li class="free_entrance active">
	            <a class="cancel" href="{% append_to_get free_entrance="" %}">
	            {{ facets.categories.free_entrance }}</a></li>
	        {% else %}
	            <li class="free_entrance special"><a href="{% append_to_get free_entrance=1 %}">{{ facets.categories.free_entrance }}</a></li>
	        {% endif %}
	        
	        
	        {% for cat in facets.categories.categories %}
	            {% if cat == facets.selected.category %}
	                <li class="active"><a class="cancel" href="{% append_to_get category="" %}">{{ cat.title }}</a></li>
	            {% else %}
	                <li><a href="{% append_to_get category=cat.pk %}">{{ cat.title }}</a></li>
	            {% endif %}
	        {% endfor %}
	    </ul>
	    {% include "utils/abc_filters.html" %}
    </div>
    <div id="museum_list" class="">
        <div id="object_list">
        {% for museum in object_list %}
            <div class="article">
                
                <a class="proceed" href="{{ museum.get_url_path }}">{% trans "more" %}</a>
                <h2>{{ museum.title }}</h2>
                {% if museum.latitude %}
                    <script type="text/javascript">
                    //<![CDATA[
                    (function(undefined) {
                        var iIndex = aGeopositions.length;
                        aGeopositions[iIndex] = {
                            latitude: {{ museum.latitude }},
                            longitude: {{ museum.longitude }},
                            content: '<div class="contact-mapped" onclick="location.href=\'{{ museum.get_url_path }}\';">'
                            + '{% if museum.image %}<img src="{{ UPLOADS_URL }}{{ museum.image.path|modified_path:"map_item" }}" alt="{{ museum.title }}" width="52" height="52" />{% endif %}'
                            + '<h4>{{ museum.title|truncatewords:5 }}</h4>'
                            + '<p>{{ museum.street_address }} {{ museum.street_address2 }}</p>'
                            + '<hr />'
                            + '<a href="{{ museum.get_url_path }}">{% trans "more" %}</a>'
                            + '</div>'
                        }
                    }());
                    //]]>
                    </script>
                    <div class="marker-link">location</div>
                {% endif %}
            </div>
        {% endfor %}
        </div>
    </div>
    
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;language=de&amp;region=DE"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/styledinfowindow.js"></script>    
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/listing_map.js"></script>
    <script type="text/javascript">
    //<![CDATA[
    (function($, undefined) {
        $(function() {
            $('.article').click(function() {
                var link = $(this).find('a').attr('href');
                location.href = link;
            });
        });
    }(jQuery));
    //]]>
    </script>
    <script type="text/javascript">
    //<![CDATA[
    (function($, undefined) {
        $(function() {
           
            $('#gmap_toggle').click(function() {
                $('body').toggleClass('map_visible');
            });
        });
    }(jQuery));
    //]]>
    </script>
{% endblock %}
