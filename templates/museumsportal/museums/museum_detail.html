{% extends "base.html" %}
{% load base_tags i18n image_modifications tagging_tags babel auth_extended fb_tags %}
{% block title %}{% trans "Museum" %} – {{ object.title }} – {% endblock %}
{% block bodyclass %}museum-detail{% endblock %}

{% block js %}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;language={{ LANGUAGE_CODE }}"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/swipe.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/twitter.js"></script>
    <script type="text/javascript">
        var aGeopositions = [];
        var settings = {
            STATIC_URL: "{{ STATIC_URL }}"
        }

        $(document).ready(function(){
            $(".toggle_bvg").click(function () {
                $("#bvg_widget").toggleClass("on");
                return false;
            });
        });
    </script>
{% endblock %}

{% block edit_item %}
    {% if_has_perm "museums.change_museum" object %}
    <li><a class="edit icon icon-edit" rel="tooltip" data-placement="bottom" data-original-title="{% trans "Edit" %}" href="{{ request.path }}change/">&nbsp;<span>{% trans "Edit" %}</span></a></li>
    {% end_if_has_perm %}
{% endblock %}

{% block content %}
{% include "utils/gmap.html" %}

    {% with object as museum %}
<div class="content clearfix">
    <div class="inner">

        {% include "utils/cover_image.html" %}

        <section class="sidebar">
            <ul class="accordion" id="accordion2">  
                <li class="accordion-group">  
                    <h4 class="accordion-heading">  
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-location">  
                            {% trans "Location" %}  
                        </a>  
                    </h4>  
                    <ul id="collapse-location" class="accordion-body collapse" style="height: 0px; ">  
                        <li class="accordion-inner">  
                            <dl>
                                <dt>{{ museum.title }}</dt>
                                <dd>{{ museum.street_address }}</dd>
                                {% if museum.street_address2 %}<dd>{{ museum.street_address2 }}</dd>{% endif %}
                                {% if museum.district %}<dd>{{ museum.district }}</dd>{% endif %}
                                <dd>{{ museum.postal_code }} {{ museum.city }}</dd>
                            </dl>
                        
                            {% if museum.phone_number %}
                            <dl>
                                <dt>{% trans "Tel" %}</dt>
                                <dd>+{{ museum.phone_country }} ({{ museum.phone_area }}) {{ museum.phone_number }}</dd>
                            </dl>
                            {% endif %} 
                            
                            {% if museum.fax_number %}
                            <dl>
                                <dt>{% trans "Fax" %}</dt>
                                <dd>+{{ museum.fax_country }} ({{ museum.fax_area }}) {{ museum.fax_number }}</dd>
                            </dl>
                            {% endif %} 
                            
                            {% if museum.website %}
                            <dl>
                                <dt>{% trans "Web" %}</dt>
                                <dd><a href="{{ museum.website }}">{{ museum.website }}</a></dd>
                            </dl>
                            {% endif %}
                            
                            {% for social in museum.socialmediachannel_set.all %}
                                <dl class="social-{{ social.channel_type|slugify }} inset">
                                    <dt><a href="{{ social.url }}">{{ social.channel_type }}</a></dt>
                                </dl>
                            {% endfor %}
                            
                            {% if museum.contact_name %}
                                <dl>
                                {% if museum.contact_phone_number %}
                                    <dt>{% trans "Contact phone" %}</dt>
                                    <dd>{{ museum.contact_phone_country }} {{ museum.contact_phone_area }} {{ museum.contact_phone_number }} </dd>
                                {% endif %}
                                </dl>

                                {% if museum.contact_email %}
                                    <dl>
                                        <dt>{% trans "Contact email" %}</dt>
                                        <dd>{{ museum.contact_email }} </dd>
                                    </dl>
                                {% endif %}
                            {% endif %}
                            
                            {% if museum.post_street_address %}
                                <dl>
                                    <dt>{% trans "Postal address" %}</dt>
                                    <dd>{{ museum.post_street_address }}</dd>
                                    {% if museum.post_street_address2 %}<dd>{{ museum.post_street_address2 }}</dd>{% endif %} 
                                    <dd>{{ museum.post_postal_code }} {{ museum.post_city }}</dd>
                                </dl>
                            {% endif %}
                            
                        </li>
                        <li class="accordion-inner">  
                            <button rel="tooltip" data-placement="top" data-original-title="{% trans "Show location on map" %}" class="location icon icon-location"></button>

                            {% if museum.latitude %}
                                <script type="text/javascript">
                                //<![CDATA[
                                (function(undefined) {
                                    var iIndex = aGeopositions.length;
                                    aGeopositions[iIndex] = {
                                        latitude: {{ museum.latitude }},
                                        longitude: {{ museum.longitude }},
                                        categories: "initial_{{ museum.title|slugify|slice:"0:1" }}{% for cat in museum.categories.all %} cat_{{ cat.title|slugify }}{% endfor %}",
                                        content:
                                        '<a href="{{ museum.get_url_path }}">{{ museum.title }} <span>{% trans "more" %}…</span></a>'
                                    }
                                }());
                                //]]>
                                </script> 
                            {% endif %}

                            <a class="" onclick="openGoogleMaps();" id="map_link" title="Karte" href="#">Googlemaps</a>
                            <a class="toggle_bvg" href="#">{% if LANGUAGE_CODE == "de" %}BVG Suche{% else %}BVG Search{% endif %}</a>
                        </li>
                    </ul>  
                </li>

                {% if museum.season_set.count or museum.specialopeningtime_set.count %}
                    <li class="accordion-group">  
                        <h4 class="accordion-heading">  
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-opening-times">
                                {% trans "Opening hours" %}
                            </a>  
                        </h4>  
                        <ul id="collapse-opening-times" class="accordion-body collapse" style="height: 0px; ">
                            <li class="accordion-inner">
                                {% if museum.season_set.count == 1 %}
                                    {% with museum.season_set.all.0 as season %}
                                        {% if season.is_appointment_based %}
                                            <p>{% trans "Based on appointment" %}</p>
                                        {% else %}
                                            {% regroup season.get_opening_hours by times as opening_hours %}
                                            {% for same_hours in opening_hours %}
                                                {% if forloop.first %}<dl>{% endif %}
                                                <dt>{% for day in same_hours.list %}{% if forloop.first %}{{ day.weekday }}{% endif %}{% if forloop.last %}{% if forloop.counter0 %}-{{ day.weekday }}{% endif %}{% endif %}{% endfor %}</dt>
                                                <dd>
                                                    {% if same_hours.list.0.open %}
                                                         {{ same_hours.list.0.open|time:"H:i" }}
                                                         {% if same_hours.list.0.break_close %}
                                                            - {{ same_hours.list.0.break_close|time:"H:i" }}
                                                              / {{ same_hours.list.0.break_open|time:"H:i" }}
                                                            - {{ same_hours.list.0.close|time:"H:i" }}
                                                         {% else %}
                                                            - {{ same_hours.list.0.close|time:"H:i" }}
                                                         {% endif %}
                                                    {% else %}				 
                                                        {% trans "closed" %}
                                                    {% endif %}
                                                </dd>
                                                {% if forloop.last %}</dl>{% endif %}
                                            {% endfor %}                                   
                                        {% endif %}
                                        {% if season.last_entry %}
                                            <dt>{% trans "Last entry" %}</dt>
                                            <dd>{{ season.last_entry }}</dd>
                                        {% endif %}
                                        {% if season.exceptions %}
                                            <p>{{ season.get_rendered_exceptions }}</p>
                                        {% endif %}
                                    {% endwith %}
                                {% else %}
                                    {% for season in museum.season_set.all %}
                                        <dt>{% trans "Season" %}</dt>
                                        <dd>{{ season.start|date:"j. F Y" }} - {{ season.end|date:"j. F Y" }}</dd>
                                        {% if season.is_appointment_based %}
                                            <dd>{% trans "Based on appointment" %}</dd>
                                        {% else %}
                                            {% regroup season.get_opening_hours by times as opening_hours %}
                                            {% for same_hours in opening_hours %}
                                                {% if forloop.first %}<dl>{% endif %}
                                                <dt>{% for day in same_hours.list %}{% if forloop.first %}{{ day.weekday }}{% endif %}{% if forloop.last %}{% if forloop.counter0 %}-{{ day.weekday }}{% endif %}{% endif %}{% endfor %}</dt>
                                                <dd>
                                                    {% if same_hours.list.0.open %}
                                                         {{ same_hours.list.0.open|time:"H:i" }}
                                                         {% if same_hours.list.0.break_close %}
                                                            - {{ same_hours.list.0.break_close|time:"H:i" }}
                                                              / {{ same_hours.list.0.break_open|time:"H:i" }}
                                                            - {{ same_hours.list.0.close|time:"H:i" }}
                                                         {% else %}
                                                            - {{ same_hours.list.0.close|time:"H:i" }}
                                                         {% endif %}
                                                    {% else %}				 
                                                        {% trans "closed" %}
                                                    {% endif %}
                                                </dd>
                                                {% if forloop.last %}</dl>{% endif %}
                                            {% endfor %}                                   
                                        {% endif %}
                                        {% if season.last_entry %}
                                        <dl>
                                            <dt>{% trans "Last entry" %}</dt>
                                            <dd>{{ season.last_entry }}</dd>
                                        </dl>
                                        {% endif %}
                                        {% if season.exceptions %}
                                            <p>{{ season.get_rendered_exceptions }}</p>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                                
                                {% if museum.specialopeningtime_set.count %}
                                    {% for special_opening in museum.specialopeningtime_set.all %}
                                    <dl>
                                        <dt>{% if special_opening.day_label %}{{ special_opening.day_label }}{% endif %}
                                        {{ special_opening.dd }}. {{ special_opening.get_mm_display }} {{ special_opening.yyyy|default:"" }}
                                        </dt>
                                        {% if special_opening.is_closed %}
                                            <dd>{% trans "Closed" %}</dd>
                                        {% else %}
                                            {% if special_opening.is_regular %}
                                                <dd>{% trans "Regular Opening hours" %}</dd>
                                            {% else %}
                                                <dd>{{ special_opening.opening|time:"H:i" }} - {{ special_opening.closing|time:"H:i" }}</dd>
                                                {% if season.sun_break_close %}
                                                    <dt>{% trans "Break:" %}</dt>
                                                    <dd>{{ special_opening.break_close|time:"H:i" }} - {{ special_opening.break_open|time:"H:i" }}</dd>
                                                {% endif %}
                                            {% endif %}
                                        {% endif %}
                                    </dl>
                                    {% endfor %}
                                {% endif %}
                            </li>
                        </ul>  
                    </li>
                {% endif %}


                <li class="accordion-group">  
                    <h4 class="accordion-heading">  
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-prices">  
                            {% trans "Tickets" %} 
                        </a>  
                    </h4>  
                    <ul id="collapse-prices" class="accordion-body collapse" style="height: 0px; ">  
                        <li class="accordion-inner">
                            {% if museum.free_entrance %}
                                {% trans "Free entrance" %}
                            {% else %}
                                {% if museum.admission_price %}
                                    <dt>{% trans "Admission price" %}</dt><dd>{{ museum.admission_price|currencyfmt:"EUR" }}</dd>
                                    {% if museum.admission_price_info %}
                                        <dd> {{ museum.get_rendered_admission_price_info }}</dd>
                                    {% endif %}
                                {% endif %}
                                {% if museum.reduced_price %}
                                    <dt>{% trans "Reduced price" %}</dt><dd>{{ museum.reduced_price|currencyfmt:"EUR" }}</dd>
                                {% endif %}
                                {% if museum.reduced_price_info %}
                                    <dd> {{ museum.get_rendered_reduced_price_info }} </dd>
                                {% endif %}
                                {% if museum.arrangements_for_children %}
                                    <dt>{% trans "Arrangements for children" %}</dt>
                                    <dd class="arrangements_for_children">
                                        {{ museum.get_rendered_arrangements_for_children }}
                                    </dd>
                                {% endif %}
                                {% if museum.free_entrance_for %}
                                    <dt>{% trans "Free entrance for" %}</dt>
                                    <dd class="free_entrance_for">
                                        {{ museum.get_rendered_free_entrance_for }}
                                    </dd>
                                {% endif %}
                                {% if museum.family_ticket %}
                                    <dt>{% trans "Family ticket" %}</dt>
                                    <dd class="family_ticket">
                                        {{ museum.get_rendered_family_ticket }}
                                    </dd>
                                {% endif %}
                                {% if museum.group_ticket %}
                                    <dt>{% trans "Group ticket" %}:</dt>
                                    <dd class="group_ticket">
                                        {{ museum.get_rendered_group_ticket }}
                                    </dd>
                                {% endif %}
                                {% if museum.free_entrance_times %}
                                    <dt>{% trans "Free entrance times" %}:</dt>
                                    <dd class="free_entrance_times">
                                        {{ museum.get_rendered_free_entrance_times }}
                                    </dd>
                                {% endif %}
                                {% if museum.yearly_ticket %}
                                    <dt>{% trans "Yearly ticket" %}:</dt>
                                    <dd class="yearly_ticket">
                                        {{ museum.get_rendered_yearly_ticket }}
                                    </dd>
                                {% endif %}
                                {% if museum.other_tickets %}
                                <dl>
                                    <dt>{% trans "Other tickets" %}:</dt>
                                    <dd class="other_tickets">
                                        {{ museum.get_rendered_other_tickets }}
                                    </dd>
                                </dl>
                                {% endif %}
                                {% if museum.member_of_museumspass %}
                                    <dd>{% trans "Member of Museumspass Berlin" %}</dd>
                                {% endif %}
                            {% endif %}


                            {% if museum.group_booking_phone_number %}
                                <dl class="phone inset">
                                    <dt>{% trans "Phone for group booking" %}</dt>
                                    <dd>+{{ museum.group_booking_phone_country }} ({{ museum.group_booking_phone_area }}) {{ museum.group_booking_phone_number }}</dd>
                                </dl>
                            {% endif %} 
                            {% if museum.service_phone_number %}
                                <dl class="phone inset">
                                    <dt>{% trans "Service Phone" %}</dt>
                                    <dd>+{{ museum.service_phone_country }} ({{ museum.service_phone_area }}) {{ museum.service_phone_number }}</dd>
                                </dl>
                            {% endif %} 
                        </li>
                    </ul>  
                </li>  



                <li class="accordion-group">  
                    <h4 class="accordion-heading">  
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-services">  
                            {% filter fix_ampersands %}{% trans "Services" %}{% endfilter %} 
                        </a>  
                    </h4>  
                    <ul id="collapse-services" class="accordion-body collapse" style="height: 0px; ">
                        <li class="accordion-inner">
                            {% if museum.service_shop or museum.service_books or museum.service_restaurant or museum.service_cafe or museum.service_library or musuem.service_archive or musuem.service_studio or museum.service_online or museum.service_diaper_changing_table or musuem.service_birthdays or museum.service_rent or musuem.service_other %}
                                 <dl>
                                    {% if museum.service_shop %}
                                    <span class="icon icon-shop" rel="tooltip" data-placement="top" data-original-title="{% trans "Shop" %}" >{% trans "Shop" %}</span>
                                {% endif %}
                                {% if museum.service_restaurant %}
                                    <span class="icon icon-restaurant" rel="tooltip" data-placement="top" data-original-title="{% trans "Restaurant" %}" >{% trans "Restaurant" %}</span>
                                {% endif %}
                                {% if museum.service_cafe %}
                                    <span class="icon icon-cafe" rel="tooltip" data-placement="top" data-original-title="{% trans "Cafe" %}" >{% trans "Cafe" %}</span>
                                {% endif %}
                                {% if museum.service_library %}
                                    <span class="icon icon-library" rel="tooltip" data-placement="top" data-original-title="{% trans "Library" %}" >{% trans "Library" %}</span>
                                {% endif %}
                                {% if musuem.service_archive %}
                                    <span class="icon icon-archive" rel="tooltip" data-placement="top" data-original-title="{% trans "Archive" %}" >{% trans "Archive" %}</span>
                                {% endif %}
                                {% if museum.service_diaper_changing_table %}
                                    <span class="icon icon-diaper" rel="tooltip" data-placement="top" data-original-title="{% trans "Diaper changing table" %}" >{% trans "Diaper changing table" %}</span>
                                {% endif %}
                                </dl>
                            {% endif %}
                        </li>
                    </ul>  
                </li>  
                <li class="accordion-group">  
                    <h4 class="accordion-heading">  
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-accessibility">  
                            {% filter fix_ampersands %}{% trans "Accessibility" %}{% endfilter %} 
                        </a>  
                    </h4>  
                    <ul id="collapse-accessibility" class="accordion-body collapse" style="height: 0px; ">
                        <li class="accordion-inner">
                            {% if museum.accessibility or museum.accessibility_options.count %}
                                <h5>{% trans "Accessibility" %}</h5>
                                {% for opt in museum.accessibility_options.all %}
                                    <img alt="{{ opt.title|escape }}" title="{{ opt.title|escape }}" src="{{ MEDIA_URL }}{{ opt.image }}" />
                                {% endfor %}
                                {% if museum.accessibility %}
                                    <div class="accessibility">
                                        {{ museum.get_rendered_accessibility }}
                                    </div>
                                {% endif %}
                            {% endif %}
                        </li>
                    </ul>  
                </li>  

                <!-- ======= Audioguides ======= -->

                {% if museum.has_audioguide or museum.has_audioguide_for_children or museum.has_audioguide_for_learning_difficulties or museum.group_bookings_phone_number or museum.service_phone_number %}
                    <li class="accordion-group">  
                        <h4 class="accordion-heading">  
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-mediation-offer">   {% trans "Audioguides" %} 
                            </a>  
                        </h4>  
                        <ul id="collapse-mediation-offer" class="accordion-body collapse" style="height: 0px; ">
                            <li class="accordion-inner">
                                {% if museum.has_audioguide %}
                                    <dt>{% trans "Audioguide" %}</dt>
                                    {% for lang in museum.get_audioguide_languages %}
                                        <dd>{{ lang }}</dd>
                                    {% endfor %}
                                {% endif %}
                                {% if museum.has_audioguide_for_children %}
                                    <dt>{% trans "Audioguide for children." %}</dt>
                                {% endif %}
                                {% if museum.has_audioguide_for_learning_difficulties %}
                                    <dt>{% trans "Audioguide for people with learning difficulties." %}</dt>
                                {% endif %}

                                {% with museum.get_workshops as workshops %}
                                    {% if workshops %}
                                        <h6>{% trans "Guided Tours" %}</h6>
                                        {% for workshop in workshops %}
                                            <dt><a href="{{ workshop.get_url_path }}">{{ workshop.title }}</a></dt>
                                            {% with workshop.workshoptime_set.all.0 as wtime %}
                                                <dd>{{ wtime.workshop_date|date:"j. F Y" }} {{ wtime.start|time:"H:i" }} - {{ wtime.end|time:"H:i" }}</dd>
                                            {% endwith %}
                                        {% endfor %}
                                    {% endif %}
                                {% endwith %}
                            </li>
                        </ul>  
                    </li>  
                {% endif %}

                <li class="accordion-group">  
                    <h4 class="accordion-heading">  
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-twitterfeed">{% trans "Twitter" %}</a>  
                    </h4>  
                    <ul id="collapse-twitterfeed" class="accordion-body collapse">
                        <li class="accordion-inner">
                            <ul id="tweets" data-twitter-username="Vielfalt2013"></ul>
                            <!-- <ul>
                                <li>
                                    <span class="text">Onlinetickets für die Lange Nacht der Museen gibt es ab heute bei uns auf dem Museumsportal: <a href="http://t.co/qEI1suuo">http://t.co/qEI1suuo</a> <a href="http://twitter.com/MuseumsnachtB">@MuseumsnachtB</a></span>
                                    <a class="time" href="http://twitter.com/#!/museumsportal/status/303496870301421568">15 Stunden, 19 Minuten ago</a>
                                </li>
                                <li>
                                    <span class="text">Onlinetickets für die Lange Nacht der Museen gibt es ab heute bei uns auf dem Museumsportal: <a href="http://t.co/qEI1suuo">http://t.co/qEI1suuo</a> <a href="http://twitter.com/MuseumsnachtB">@MuseumsnachtB</a></span>
                                    <a class="time" href="http://twitter.com/#!/museumsportal/status/303496870301421568">15 Stunden, 19 Minuten ago</a>
                                </li>
                                <li>
                                    <span class="text">Onlinetickets für die Lange Nacht der Museen gibt es ab heute bei uns auf dem Museumsportal: <a href="http://t.co/qEI1suuo">http://t.co/qEI1suuo</a> <a href="http://twitter.com/MuseumsnachtB">@MuseumsnachtB</a></span>
                                    <a class="time" href="http://twitter.com/#!/museumsportal/status/303496870301421568">15 Stunden, 19 Minuten ago</a>
                                </li>
                            </ul> -->
                        </li>
                    </ul>  
                </li> 
            </ul> 
        </section>

<!-- Article ================================================== -->
           
        <article class="with_sidebar">
            <header>
                <h1>{{ museum.title }} 
                    {% if museum.subtitle %}
                    <span>{{ museum.subtitle }}</span>
                    {% endif %}
                </h1>
            </header>
            
            {{ museum.get_rendered_description }}

            <ul class="tags">
                {% if museum.categories.count %}
                    {% for cat in museum.categories.all %}
                        <li class="cat"><a href="{% if LANGUAGE_CODE == "de" %}/de/museen/{% else %}/en/museums/{% endif %}#filter=.cat_{{ cat.title|slugify }}">{{ cat.title }}</a></li>
                    {% endfor %}
                {% endif %}

                {% tags_for_object museum as tags %}
                {% if tags %}
                    {% for tag in tags %}
                        <li><a href="{% if LANGUAGE_CODE == "de" %}/de/museen/{% else %}/en/museums/{% endif %}#filter=.tag_{{ tag.slug }}">{{ tag.name }}</a></li>
                    {% endfor %}
                {% endif %}
            </ul>   
        </article>
    </div>
</div>

{% endwith %}


<!-- ======= Exhibitions ======= -->

{% if object.get_published_exhibitions %}
<div class="content clearfix">
    <div class="inner clearfix">
        <h2>{% trans "Exhibitions" %}</h2>
        <ul id="container" class="list tiles small clearfix"> 
            {% for exhibition in object.get_published_exhibitions %}
                <li class="item">
                    <a class="img" href="{{ museum.get_url_path }}" {% if museum.cover_image %} data-background="{{ MEDIA_URL }}{{ exhibition.cover_image }}|modified_path:"museum_list" }}"{% endif %}>

                    <nav class="actions">
                        <button rel="tooltip" data-placement="top" data-original-title="{% trans "Add to Favorites" %}" class="favorite icon icon-favorite"></button>
                        <button href="#" rel="tooltip" data-placement="top" data-original-title="{% trans "Show location on map" %}" class="location icon icon-location"></button>
                    </nav>
                    <a href="{{ exhibition.get_url_path }}">
                        <h4>{{ exhibition.museum.title }}</h4>
                        <h3>{{ exhibition.title }}</h3>
                        <h5>{{ exhibition.start|date:"d.m.Y" }} {% trans "till" %} {{ exhibition.end|date:"d.m.Y" }}</h5>
                    </a>
                </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endif %} 

{% include "utils/gallery.html" %}
{% include "utils/page_controls.html" %}
{% include "utils/gmap_scripts.html" %}
{% include "utils/gallery_scripts.html" %}
{% endblock %}
