{% block doctype %}<!DOCTYPE html>{% endblock %}
{% load cms_tags menu_tags compressed sekizai_tags i18n image_modifications %}
<html lang="{{ LANGUAGE_CODE }}"> 
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>{% block title %}{% endblock %} Berliner Museumsportal</title>
	<link rel="icon" href="{{ STATIC_URL }}site/img/favicon.ico" type="image/png">
	
    {% block meta_tags %}
        {{ site_settings.get_meta_tags|safe }}
    {% endblock %}	
	
    {% block stylesheet %}
    <link href="{{ STATIC_URL }}site/css/bootstrap.css" rel="stylesheet" media="screen" type="text/css" />
    <link href="{{ STATIC_URL }}site/css/style.css" rel="stylesheet" media="screen" type="text/css" />
    <link href="{{ STATIC_URL }}site/css/media.css" rel="stylesheet" media="screen" type="text/css" />
    {% endblock %}
	
    {% render_block "css" %}

    <script type="text/javascript" src="/jssettings/"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/jquery.ba-bbq.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/jquery.isotope.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/jquery.scrollstop.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/jquery.lazyload.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/jquery.viewport.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/bootstrap/bootstrap.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/bootstrap/bootstrap-modal.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}site/js/modernizr.custom.52849.js"></script>
	<script type="text/javascript" src="{{ jetson_media_url }}js/jquery/jquery.cookie.js"></script>
	<script>
        var csrftoken = $.cookie('csrftoken');
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
            crossDomain: false, // obviates need for sameOrigin test
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type)) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
	</script>
    {{ site_settings.extra_head|safe }}
    {% block js %}{% endblock %}
</head>





<body class="{% block bodyclass %}{% endblock %} lang_{{ LANGUAGE_CODE }}">

    {% block toolbar %}
        {% cms_toolbar %}
    {% endblock %}

	<div id="wrapper">


        <!-- Header
        ================================================== -->
        {% block header %}
		<header id="header" class="clearfix">
            <div class="inner">

                <a class="logo" href="/">
                    <span class="img">Museumsportal Berlin / Alle Informationen zu Berlins Museen, Schlössern und Gedenkstätten.</span>
                </a>
                <ul id="meta" class="clearfix">
                    <li id="user" class="clearfix">
                        <ul>
                            {% if request.user.is_authenticated %} 
                                <li><p>{% blocktrans with first_name=request.user.first_name|default:request.user.username %}Hello, {{ first_name }}{% endblocktrans %}</p></li>
                                <li><a class="logout" href="/{{ LANGUAGE_CODE }}/logout/">{% trans "Logout" %}</a></li>
                            {% else %}
                                <li><a class="login" href="/{{ LANGUAGE_CODE }}/login/">{% trans "Login" %}</a></li>
                                <li><a class="signup" href="/{{ LANGUAGE_CODE }}/signup/">{% trans "Signup" %}</a></li>
                            {% endif %}
                        </ul>
                    </li>
                    <li id="tools" class="clearfix">
                        <ul>
                            <li><a class="icon icon-home"  rel="tooltip" data-placement="bottom" data-original-title="Home" href="/">{% trans "Home" %}</a> </li>

                            {% block edit_item %}{% endblock %}
                            
                            {% if request.user.is_authenticated %} 
                            <li><a class="dashboard icon icon-dashboard" rel="tooltip" data-placement="bottom" data-original-title="{% trans "Dashboard" %}" href="/{{ LANGUAGE_CODE }}/dashboard/">&nbsp;<span>{% trans "Dashboard" %}</span></a></li>
                            {% endif %}
                            
                            <li><a class="favorites icon icon-favorites" rel="tooltip" data-placement="bottom" data-original-title="{% trans "Favorites" %}" href="/{{ LANGUAGE_CODE }}/my-profile/favorites/">&nbsp;<span>{% trans "Favorites" %}</span></a></li>
                        </ul>
                    </li>
                    <li>
                        <ul id="lang">
                        {% block language_chooser %}
                            {% language_chooser %}
                        {% endblock %}
                        </ul>
                    </li>
                <ul/>
            </div>
		</header>
		
        <nav id="navigation">
            <ul>
                <li{% if request.path == "/" %} class="selected"{% endif %}><a href="/">Home</a></li>
                {% show_menu_below_id "start_page" 0 100 100 100 %}
            </ul>
        </nav>
        {% endblock %}



        <!-- Content
        ================================================== -->

    		    {% block content %}
    			{% endblock %}
		
        <!-- Footer
        ================================================== -->
        
        <a href="#top" id="to-top">
            <span>
                {% if LANGUAGE_CODE == "de" %}
                    Zum Seitenanfang
                {% else %}
                    Back to Top
                {% endif %}
            </span>
        </a>

        {% block footer %}
        <footer id="footer" class="clearfix">
            <div class="inner">
                <ul class="navigation">
                    {% show_menu_below_id "start_page" 0 0 1 1 %}
                    {% if LANGUAGE_CODE == "de" %}
                        <li><a href="/de/impressum/">Impressum</a></li>
                    {% else %}
                        <li><a href="/en/imprint/">Imprint</a></li>
                    {% endif %}
                </ul>
            </div>
        </footer>
        {% endblock %}

	</div>

    {% render_block "js" %}

    {{ site_settings.extra_body|safe }}

    <script type="text/javascript">
	$(function() {
        $("a[href^='http://']").attr("target","_blank");	        
	        
	    if ($('#cms_toolbar').length) { // cms toolbar fix
	        if ($('body').css('margin-top') == "-43px") {
	            $('body').css('margin-top', 0);
	        }
	    }
	});
	</script>

    <script type="text/javascript">
    $(function() {
        $('#to-top').click(function(e){
            $('html, body').animate({scrollTop:0}, 'slow');
            return false;
        });
        
        $(window).scroll(function() {
            if ($('body').offset().top < $(window).scrollTop()) {
                $('#to-top').addClass('on');
            } else {
                $('#to-top').removeClass('on');
            }
        });
    });
    window.onresize = function(event) {}
    </script>

    <script type="text/javascript">
    $(window).load(function() {
        var $container = $('#container'),
            filters = {};

        $container.isotope({
            itemSelector : '.item',
            layoutMode : 'fitRows' 
        });

        // filter buttons
        $('.filter a').click(function(e){
            e.preventDefault();
            var $this = $(this);

            var $optionSet = $this.parents('.option-set');
            // store filter value in object
            // i.e. filters.category = ['.cat_history']
            var group = $optionSet.attr('data-filter-group');
            filters[group] = filters[group] || [];
            var value = $this.attr('data-filter-value');
            
            if (value) {
                if ($this.hasClass('selected')) {
                    $this.removeClass('selected');
                    filters[group] = jQuery.grep(filters[group], function(v) {
                        return v != value;
                    });
                } else {
                    $optionSet.find('.all.selected').removeClass('selected');
                    filters[group].push(value);
                    // change selected class
                    $this.addClass('selected');
                }
            } else {
                $optionSet.find('.selected').removeClass('selected');
                filters[group] = []
                // change selected class
                $this.addClass('selected');
            }
            
            // convert object into array
            var isoFilters = [];
            for (var prop in filters) {
                isoFilters.push(filters[prop].join(''));
            }
            var selector = isoFilters.join('');

            $container.isotope({filter: selector});            
            $(".list .img:in-viewport").lazyload();
            $container.trigger("map_filter", { filter: isoFilters});
            $(".isotope-item:not(.isotope-hidden) .img", $container).trigger("appear");
            
            return false;
        });
        
        var hashChanged = false;
        $(window).bind( 'hashchange', function( event ){
            if (!window.location.hash) {
                return;
            }
            // get options object from hash
            var hashOptions = window.location.hash ? $.deparam.fragment( window.location.hash, true ) : {},
                // do not animate first call
                aniEngine = hashChanged ? 'best-available' : 'none',
                // apply defaults where no option was specified
                options = $.extend( {}, hashOptions, { animationEngine: aniEngine } );
            // apply options from hash
            $container.isotope( options );
            $(".list .img:in-viewport").lazyload();
            // save options
            hashChanged = true;
            if (hashOptions) {
                var $categories = $('#categories');
                $('a[href="#any-category"]', $categories).removeClass("selected");
                $('a[href="' + window.location.hash + '"]', $categories).addClass("selected");
            }
            
          })
            // trigger hashchange to capture any hash data on init
            .trigger('hashchange');
        
        
    });
    $(window).load(function(){
        $(".list .img").lazyload();
    });

    $(window).bind('scrollstop', function(e){
        $(".list .img:in-viewport").lazyload();
    });

    $(window).load(function() {
       if ($("[rel=tooltip]").length) {
           $("[rel=tooltip]").tooltip();
       }
    
       $('.accordion-body').collapse('show');
    });

    </script>

</body>
</html>

<!-- 
<li><a class="facebook icon icon-facebook" href="https://www.facebook.com/pages/Museumsportal-Berlin/44199608380">&nbsp;<span>Facebook</span></a></li>
<li><a class="twitter icon icon-twitter" href="https://twitter.com/museumsportal">&nbsp;<span>Twitter</span></a></li> -->