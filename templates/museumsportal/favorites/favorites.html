{% extends "base.html" %}{% load i18n base_tags image_modifications tagging_tags favorites %}{% block js %}    {{ block.super }}    <script type="text/javascript" src="{{ STATIC_URL }}site/js/favorites.js" defer="defer"></script>{% endblock %}{% block title %}{% trans "Favorites" %}{% endblock %}{% block content %}    <div class="content clearfix">        <div id="favorites" class="inner">            {% regroup object_list by content_type as favorites_by_content_type %}            {% for content_type in favorites_by_content_type %}                {% if content_type.grouper.app_label == "museums" and content_type.grouper.model == "museum" %}                    <fieldset>                        <legend>{% trans "Museums" %}</legend>                        <ul>                            {% for favorite_object in content_type.list %}                                {% with favorite_object.content_object as museum %}                                    {% tags_for_object museum as tags %}                                    <li class="item initial_{{ museum.title|slugify|slice:"0:1" }}{% for cat in museum.categories.all %} cat_{{ cat.title|slugify }}{% endfor %}{% if tags %}{% for tag in tags %} tag_{{ tag.slug }}{% endfor %}{% endif %}">                                                                                <a href="{{ museum.get_url_path }}">                                             <h3>{{ museum.title }}</h3>                                            {% if museum.subtitle %}                                                <h4>{{ museum.subtitle }}</h4>                                            {% endif %}                                        </a>                                                            <nav class="actions">                                            {% if request.user.is_authenticated %}                                                {% adding2favorites for museum %}                                            {% endif %}                                        </nav>                                    </li>                                {% endwith %}                            {% endfor %}                        </ul>                    </fieldset>                {% endif %}                {% if content_type.grouper.app_label == "exhibitions" and content_type.grouper.model == "exhibition" %}                    <fieldset>                        <legend>{% trans "Exhibitions" %}</legend>                        <ul>                            {% for favorite_object in content_type.list %}                                {% with favorite_object.content_object as exhibition %}                                    {% tags_for_object exhibition as tags %}                                    <li class="item {% cycle "class1" "class2" "class3" %} initial_{{ exhibition.title|slugify|slice:"0:1" }} {% if exhibition.closing_soon %} closing_soon{% endif %}{% if exhibition.newly_opened %} newly_opened{% endif %}{% for cat in exhibition.categories.all %} cat_{{ cat.title|slugify }}{% endfor %}{% if tags %}{% for tag in tags %} tag_{{ tag.slug }}{% endfor %}{% endif %}">                                                                <a href="{{ exhibition.get_url_path }}">                                          <h3>{{ exhibition.museum.title }}</h3>                                          <h4>{{ exhibition.title }}</h4>                                          <h5><span class="from_date">{{ exhibition.start|date:"d.m.Y" }}</span> {% trans "till" %} {{ exhibition.end|date:"d.m.Y" }}</h5>                                        </a>                                            <nav class="actions">                                            {% if request.user.is_authenticated %}                                                {% adding2favorites for exhibition %}                                            {% endif %}                                        </nav>                                    </li>                                {% endwith %}                            {% endfor %}                        </ul>                    </fieldset>                {% endif %}                {% if content_type.grouper.app_label == "events" and content_type.grouper.model == "event" %}                    <fieldset>                        <legend>{% trans "Events" %}</legend>                        <ul>                            {% for favorite_object in content_type.list %}                                {% with favorite_object.content_object as event %}                                    {% tags_for_object event as tags %}                                    <li class="item initial_{{ event.title|slugify|slice:"0:1" }} {% if event.closing_soon %} closing_soon{% endif %}{% if event.newly_opened %} newly_opened{% endif %}{% for cat in event.categories.all %} cat_{{ cat.title|slugify }}{% endfor %}{% if tags %}{% for tag in tags %} tag_{{ tag.slug }}{% endfor %}{% endif %}">                                                                    <a href="{{ event.get_url_path }}">                                            {% if event.museum.title %}<h3>{{ event.museum.title }}<h4>{% endif %}                                            {% if event.title %}<h4>{{ event.title }}<h4>{% endif %}                                            {% with event.eventtime_set.all.0 as event_time %}                                                <h5>{{ event_time.event_date|date:"j. F Y" }} {{ event_time.start|date:"H:i" }}</h5>                                            {% endwith %}                                        </a>                                            <nav class="actions">                                            {% if request.user.is_authenticated %}                                                {% adding2favorites for event %}                                            {% endif %}                                        </nav>                                    </li>                                {% endwith %}                            {% endfor %}                        </ul>                    </fieldset>                {% endif %}                {% if content_type.grouper.app_label == "workshops" and content_type.grouper.model == "workshop" %}                    <fieldset>                        <legend>{% trans "Guided Tours" %}</legend>                        <ul>                            {% for favorite_object in content_type.list %}                                {% with favorite_object.content_object as workshop %}                                    {% tags_for_object workshop as tags %}                                    <li class="item {% cycle "class1" "class2" "class3" %} initial_{{ workshop.title|slugify|slice:"0:1" }} {% if workshop.closing_soon %} closing_soon{% endif %}{% if workshop.newly_opened %} newly_opened{% endif %}{% for cat in workshop.categories.all %} cat_{{ cat.title|slugify }}{% endfor %}{% if tags %}{% for tag in tags %} tag_{{ tag.slug }}{% endfor %}{% endif %}">                                                                    <a href="{{ workshop.get_url_path }}">                                            {% if workshop.museum.title %}                                                <h3>{{ workshop.museum.title }}</h3>                                            {% endif %}                                            <h4>{{ workshop.title }}</h4>                                            {% with workshop.workshoptime_set.all.0 as workshop_time %}                                                <h5>{{ workshop_time.workshop_date|date:"j. F Y" }} {{ workshop_time.start|date:"H:i" }}</h5>                                            {% endwith %}                                        </a>                                                                <nav class="actions">                                            {% if request.user.is_authenticated %}                                                {% adding2favorites for workshop %}                                            {% endif %}                                        </nav>                                    </li>                                {% endwith %}                            {% endfor %}                        </ul>                    </fieldset>                {% endif %}            {% endfor %}                    </div>    </div>{% endblock %}