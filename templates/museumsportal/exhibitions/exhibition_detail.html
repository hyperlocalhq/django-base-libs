{% extends "base.html" %}
{% load base_tags i18n image_modifications %}


{% block js %}
<link href="{{ STATIC_URL }}site/shadowbox/shadowbox.css" rel="stylesheet" media="screen" type="text/css" />
<script type="text/javascript" src="{{ STATIC_URL }}site/shadowbox/shadowbox.js"></script>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;language={{ LANGUAGE_CODE }}"></script>

    {% with object as exhibition %}

<script type="text/javascript">
function openGoogleMaps() {
        Shadowbox.open({
            player:     "html",
            content:    "",
            height:     $(window).height(),
            width:      $(window).width(),
            options:    {
                onFinish: function(item) {
                    /*var body = document.getElementById();*/
                    var latlng = new google.maps.LatLng({{ exhibition.museum.latitude }}, {{ exhibition.museum.longitude }});
                    var myOptions = {
                    mapTypeControl: true,
                    zoomControl: true,
                    streetViewControl: true,
                    zoom: 16,
                    center: latlng,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                    };
                    var map = new google.maps.Map(
                        document.getElementById(Shadowbox.playerId),
                        myOptions
                    );
                    var oImage = new google.maps.MarkerImage(
                        "{{ STATIC_URL }}site/img/gmap/markers_1-10.png",
                        // This marker is 20 pixels wide by 32 pixels tall.
                        new google.maps.Size(20, 34),
                        // The origin for this image is 0,0.
                        new google.maps.Point(0, 0),
                        // The anchor for this image is the base of the flagpole at 0,32.
                        new google.maps.Point(10, 34)
                    );                                
                    var oShadow = new google.maps.MarkerImage(
                        "{{ STATIC_URL }}site/img/gmap/marker_shadow.png",
                        // The shadow image is larger in the horizontal dimension
                        // while the position and offset are the same as for the main image.
                        new google.maps.Size(37, 34),
                        new google.maps.Point(0, 0),
                        new google.maps.Point(8, 25)
                    );
                    var marker = new google.maps.Marker({
                        map: map, 
                        position: latlng,
                        shadow: oShadow,
                        icon: oImage
                    });
                    /*var map = new GMap2(body);
                    map.setCenter(new GLatLng(37.4419, -122.1419), 13);

                    // add 10 markers to the map at random locations
                    var bounds = map.getBounds();
                    var southWest = bounds.getSouthWest();
                    var northEast = bounds.getNorthEast();
                    var lngSpan = northEast.lng() - southWest.lng();
                    var latSpan = northEast.lat() - southWest.lat();
                    for (var i = 0; i < 10; i++) {
                        var point = new GLatLng(southWest.lat() + latSpan * Math.random(),
                            southWest.lng() + lngSpan * Math.random());
                        map.addOverlay(new GMarker(point));
                    }

                    // add some simple controls
                    map.addControl(new GSmallMapControl());
                    map.addControl(new GMapTypeControl());*/
                }
            }
        });
}

Shadowbox.init({
    overlayColor:   "#f8f6f2",
    overlayOpacity: 0.9,
    continuous:     true,
    animate:     true
});
</script>
{% endwith %}

{% endblock %}
{% block content %}
    <div class="marginal">
        <div id="kurze_zeit">
	        <h2 class="catHead">â†’ Nur noch kurze Zeit</h2>
	        {% get_objects closing_soon exhibitions.Exhibition 5 as exhibitions_closing_soon %}
	        {% for exhibition in exhibitions_closing_soon %}
	            <div class="article">
	                {% if exhibition.image %}
	                    <a class="img" href="{{ exhibition.get_url_path }}"><img src="{{ MEDIA_URL }}{{ exhibition.image|modified_path:"exhibition_thumbnail" }}" alt="" /></a>
	                {% endif %}
	                <h4>{{ exhibition.museum.title }}</h4>
	                <h3><a href="{{ exhibition.get_url_path }}">{{ exhibition.title }}</a></h3>
	                <h5>{{ exhibition.start|date:"d.m.Y" }} {% trans "till" %} {{ exhibition.end|date:"d.m.Y" }}</h5>
	            </div>
	        {% endfor %}
        </div>
    </div>
    
    <div id="detail" class="clearfix">
    {% with object as exhibition %}
        <div class="article">
        
            <div class="leftCol">
          	            {% if exhibition.image %}
	                <div class="article_img">
	                    <img src="{{ MEDIA_URL }}{{ exhibition.image|modified_path:"exhibition_list" }}" />
	                    <div class="image_caption">
	                        {{ exhibition.get_rendered_image_caption }}
	                    </div>
	                </div>
	            {% endif %}
                <dl class="address">
                    <dt>{% trans "Location" %}</dt>
                    <dd><a href="{{ exhibition.museum.get_url_path }}">{{ exhibition.museum.title }}</a></dd>
                    <dd>{{ exhibition.museum.street_address }}</dd>
                    {% if exhibition.museum.street_address2 %}<dd>{{ exhibition.museum.street_address2 }}</dd>{% endif %} 
                    <dd>{{ exhibition.museum.postal_code }} {{ exhibition.museum.city }}</dd>
                    <dd><a onclick="openGoogleMaps();" id="map_link" title="Karte" href="#">Googlemaps</a></dd>
                </dl>
	           	
	            <dl class="von">
	                <dt>{% trans "Start" %}</dt>
	                <dd>{{ exhibition.start|date:"d.m.Y" }}</a></dd>
	            </dl>
	            <dl class="bis">
	                <dt>{% trans "End" %}</dt>
	                <dd>{{ exhibition.end|date:"d.m.Y" }}</a></dd>
	            </dl>
	            {% if exhibition.website %}
	                <dl class="website">
	                    <dt>{% trans "Website" %}</dt>
	                    <dd><a href="{{ exhibition.website }}">{{ exhibition.website }}</a></dd>
	                </dl>
	            {% endif %}
	            	
	            	
	            	
	            	
                <script type="text/javascript">
                    //<![CDATA[
                    (function($, undefined) {
                        $(document).ready(function() {
                            var latlng = new google.maps.LatLng({{ exhibition.museum.latitude }}, {{ exhibition.museum.longitude }});
                            var myOptions = {
                            mapTypeControl: false,
                            zoomControl: false,
                            streetViewControl: false,
                            zoom: 16,
                            center: latlng,
                            mapTypeId: google.maps.MapTypeId.ROADMAP
                            };
                            var map = new google.maps.Map(
                                document.getElementById("gmap"),
                                myOptions
                            );
                            var oImage = new google.maps.MarkerImage(
                                "{{ STATIC_URL }}site/img/gmap/markers_1-10.png",
                                // This marker is 20 pixels wide by 32 pixels tall.
                                new google.maps.Size(20, 34),
                                // The origin for this image is 0,0.
                                new google.maps.Point(0, 0),
                                // The anchor for this image is the base of the flagpole at 0,32.
                                new google.maps.Point(10, 34)
                            );                                
                            var oShadow = new google.maps.MarkerImage(
                                "{{ STATIC_URL }}site/img/gmap/marker_shadow.png",
                                // The shadow image is larger in the horizontal dimension
                                // while the position and offset are the same as for the main image.
                                new google.maps.Size(37, 34),
                                new google.maps.Point(0, 0),
                                new google.maps.Point(8, 25)
                            );
                            var marker = new google.maps.Marker({
                                map: map, 
                                position: latlng,
                                shadow: oShadow,
                                icon: oImage
                            });
                            
                        });
                    }(jQuery));
                    //]]>
                </script>
	            
            </div>
            
            <div class="rightCol">
                <h2>{{ exhibition.title }}</h2>
                {% if exhibition.subtitle %}
                    <h2 class="subtitle">{{ exhibition.subtitle }}</h2>
                {% endif %}
                <h3><a href="{{ exhibition.museum.get_url_path }}">{{ exhibition.museum.title }}</a></h3>
                
                <div class="text">{{ exhibition.get_rendered_description }}</div>
            </div>
        </div>
    {% endwith %}
    </div>
{% endblock %}
