{% extends "base.html" %}
{% load base_tags i18n image_modifications %}


{% block js %}
<link href="{{ STATIC_URL }}site/shadowbox/shadowbox.css" rel="stylesheet" media="screen" type="text/css" />
<script type="text/javascript" src="{{ STATIC_URL }}site/shadowbox/shadowbox.js"></script>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;language={{ LANGUAGE_CODE }}"></script>

{% with object as exhibition %}
    <script type="text/javascript">
    function openGoogleMaps() {
        Shadowbox.open({
            player:     "html",
            content:    "",
            height:     $(window).height(),
            width:      $(window).width(),
            options:    {
                onFinish: function(item) {
                    /*var body = document.getElementById();*/
                    var latlng = new google.maps.LatLng({{ exhibition.museum.latitude }}, {{ exhibition.museum.longitude }});
                    var myOptions = {
                    mapTypeControl: true,
                    zoomControl: true,
                    streetViewControl: true,
                    zoom: 16,
                    center: latlng,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                    };
                    var map = new google.maps.Map(
                        document.getElementById(Shadowbox.playerId),
                        myOptions
                    );
                    var oImage = new google.maps.MarkerImage(
                        "{{ STATIC_URL }}site/img/gmap/markers_1-10.png",
                        // This marker is 20 pixels wide by 32 pixels tall.
                        new google.maps.Size(20, 34),
                        // The origin for this image is 0,0.
                        new google.maps.Point(0, 0),
                        // The anchor for this image is the base of the flagpole at 0,32.
                        new google.maps.Point(10, 34)
                    );                                
                    var oShadow = new google.maps.MarkerImage(
                        "{{ STATIC_URL }}site/img/gmap/marker_shadow.png",
                        // The shadow image is larger in the horizontal dimension
                        // while the position and offset are the same as for the main image.
                        new google.maps.Size(37, 34),
                        new google.maps.Point(0, 0),
                        new google.maps.Point(8, 25)
                    );
                    var marker = new google.maps.Marker({
                        map: map, 
                        position: latlng,
                        shadow: oShadow,
                        icon: oImage
                    });
                    /*var map = new GMap2(body);
                    map.setCenter(new GLatLng(37.4419, -122.1419), 13);
    
                    // add 10 markers to the map at random locations
                    var bounds = map.getBounds();
                    var southWest = bounds.getSouthWest();
                    var northEast = bounds.getNorthEast();
                    var lngSpan = northEast.lng() - southWest.lng();
                    var latSpan = northEast.lat() - southWest.lat();
                    for (var i = 0; i < 10; i++) {
                        var point = new GLatLng(southWest.lat() + latSpan * Math.random(),
                            southWest.lng() + lngSpan * Math.random());
                        map.addOverlay(new GMarker(point));
                    }
    
                    // add some simple controls
                    map.addControl(new GSmallMapControl());
                    map.addControl(new GMapTypeControl());*/
                }
            }
        });
    }
    
    Shadowbox.init({
        overlayColor:   "#f8f6f2",
        overlayOpacity: 0.9,
        continuous:     true,
        animate:     true
    });
    
    $(document).ready(function(){
    	$(".toggle_bvg").click(function () {
    	    	$("#bvg_widget").toggleClass("on");
    	    	return false
    	    });
    });
    </script>
{% endwith %}

{% endblock %}
{% block content %}
    
    {% with object as exhibition %}
        
            <section>
                <dl class="address">
                    <dt>{% trans "Location" %}</dt>
                    <dd><a href="{{ exhibition.museum.get_url_path }}">{{ exhibition.museum.title }}</a></dd>
                    <dd>{{ exhibition.museum.street_address }}</dd>
                    {% if exhibition.museum.street_address2 %}<dd>{{ exhibition.museum.street_address2 }}</dd>{% endif %} 
                    <dd>{{ exhibition.museum.postal_code }} {{ exhibition.museum.city }}</dd>
                    <dd><a onclick="openGoogleMaps();" class="button" id="map_link" title="Karte" href="#">Googlemaps</a>
                    <a class="toggle_bvg button" href="#">{% if LANGUAGE_CODE == "de" %}BVG Suche{% else %}BVG Search{% endif %}</a></dd>
                </dl>
                <dl id="bvg_widget" class="bvg">
                    {% if LANGUAGE_CODE == "de" %}
                        <dt>So erreichen Sie uns</dt>
                        <dd>
                            <a id="bvg_logo" href="http://www.bvg.de/index.php/de/9430/name/Widgets.html" target="_blank" name="logo">&nbsp;</a>
                        
                            <form method="post" target="_blank" action="http://www.fahrinfo-berlin.de/Fahrinfo/bin/" name="fahrinfo_formular" id="fahrinfo_formular">
                                <fieldset class="clearfix">
                                
                                    <input type="hidden" name="REQ0JourneyStopsS0ALocation" value="1" />
                                    <input type="hidden" name="REQ0JourneyStopsS0AAddress" value="1" />
                                    <input type="hidden" name="REQ0JourneyStopsS0APOI" value="1" />
                                    <input type="hidden" name="REQ0JourneyStopsZ0ALocation" value="1" />
                                    <input type="hidden" name="REQ0JourneyStopsZ0AAddress" value="1" />
                                    <input type="hidden" name="REQ0JourneyStopsZ0APOI" value="1" />
                                
                                    <input type="hidden" name="REQ0JourneyStopsZA1" value="7"/>
                                    <input type="hidden" name="_charset_" value="utf-8"/>
                                    <input type="hidden" value="yes" name="start"/>
                                
                                    <ul>
                                        <li>
                                            <label for="wdgt_from">Von</label>
                                            <input placeholder="Standort" type="text" name="from" id="wdgt_from" value="">
                                        </li>
                                        
                                        <li>
                                            <label for="wdgt_to">Nach</label>
                                            
                                            <textarea name="to" id="wdgt_to" >{{ exhibition.museum.street_address }}, {% if exhibition.museum.street_address2 %}{{ exhibition.museum.street_address2 }}, {% endif %}&#10;{{ exhibition.museum.postal_code }} {{ exhibition.museum.city }}</textarea>
                                        </li>
                                        
                                        <li>
                                            <label for="wdgt_date">Am</label>
                                            <input type="text" name="date" id="wdgt_date" value="{% now "d.m.Y" %}">
                                        </li>
                                        
                                        <li>
                                            <label for="wdgt_time">Um</label>
                                            <input type="text" name="time" id="wdgt_time" value="{% now "H:i" %}">
                                        </li>
                                        
                                        <li class="radios">
                                            <label for="wdgt_arr">Ankunft</label>
                                            <input id="wdgt_arr" type="radio" class="radio" name="timesel" value="arrive">
                                            
                                            <label for="wdgt_dep">Abfahrt</label>
                                            <input id="wdgt_dep" type="radio" class="radio" name="timesel" value="depart" checked="checked">
                                        </li>
                                        <li>
                                            <input id="submit" type="submit" name="start" value="Anfrage abschicken">
                                        </li>
                                    </ul>
                                </fieldset>
                            </form>
                         </dd>
                    {% else %}
                        <dt>How to get there</dt>
                        <dd>
                            <a id="bvg_logo" href="http://www.bvg.de/index.php/de/9430/name/Widgets.html" target="_blank" name="logo">&nbsp;</a>
                        
                            <form method="post" target="_blank" action="http://www.fahrinfo-berlin.de/Fahrinfo/bin/query.bin/en?ld=0.1" name="fahrinfo_formular" id="fahrinfo_formular">
                                <fieldset class="clearfix">
                                
                                    <input type="hidden" name="REQ0JourneyStopsS0ALocation" value="1" />
                                    <input type="hidden" name="REQ0JourneyStopsS0AAddress" value="1" />
                                    <input type="hidden" name="REQ0JourneyStopsS0APOI" value="1" />
                                    <input type="hidden" name="REQ0JourneyStopsZ0ALocation" value="1" />
                                    <input type="hidden" name="REQ0JourneyStopsZ0AAddress" value="1" />
                                    <input type="hidden" name="REQ0JourneyStopsZ0APOI" value="1" />
                                    
                                    <input type="hidden" name="REQ0JourneyStopsZA1" value="7"/>
                                    <input type="hidden" name="_charset_" value="utf-8"/>
                                    <input type="hidden" value="yes" name="start"/>
                                
                                    <ul>
                                        <li>
                                            <label for="wdgt_from">From</label>
                                            <input placeholder="Location" type="text" name="from" id="wdgt_from" value="">
                                        </li>
                                        
                                        <li>
                                            <label for="wdgt_to">To</label>
                                            
                                            <textarea name="to" id="wdgt_to" >{{ museum.street_address }},&#10;{{ museum.postal_code }}, {{ museum.city }}</textarea>
                                        </li>
                                        
                                        <li>
                                            <label for="wdgt_date">Date</label>
                                            <input type="text" name="date" id="wdgt_date" value="{% now "d.m.Y" %}">
                                        </li>
                                        
                                        <li>
                                            <label for="wdgt_time">Time</label>
                                            <input type="text" name="time" id="wdgt_time" value="{% now "H:i" %}">
                                        </li>
                                        
                                        <li class="radios">
                                            <label for="wdgt_arr">Arrival</label>
                                            <input id="wdgt_arr" type="radio" class="radio" name="timesel" value="arrive">
                                            
                                            <label for="wdgt_dep">Departure</label>
                                            <input id="wdgt_dep" type="radio" class="radio" name="timesel" value="depart" checked="checked">
                                        </li>
                                        <li>
                                            <input id="submit" type="submit" name="start" value="Submit request">
                                        </li>
                                    </ul>
                                </fieldset>
                            </form>
                         </dd>
                    {% endif %}
                    <script type="text/javascript">
                    $('#fahrinfo_formular').submit(function() {
                        $('#wdgt_from').val($('#wdgt_from').val().replace(/([Ss]tr)a(ß|ss)e/, "$1."));
                        $('#wdgt_to').val($('#wdgt_to').val().replace(/([Ss]tr)a(ß|ss)e/, "$1."));
                    })
                    </script>
                </dl>
	           	
	            <dl class="von">
	                <dt>{% if LANGUAGE_CODE == "de" %}Von{% else %}From{% endif %}</dt>
	                <dd>{{ exhibition.start|date:"d.m.Y" }}</a></dd>
	            </dl>
	            <dl class="bis">
	                <dt>{% if LANGUAGE_CODE == "de" %}Bis{% else %}Till{% endif %}</dt>
	                <dd>{{ exhibition.end|date:"d.m.Y" }}</a></dd>
	            </dl>
	            {% if exhibition.website %}
	                <dl class="website">
	                    <dt>{% trans "Website" %}</dt>
	                    <dd><a href="{{ exhibition.website }}">{{ exhibition.website }}</a></dd>
	                </dl>
	            {% endif %}
            </section>
            
            <article>

                {% if exhibition.image %}
                    <ul id="slide">
                        <li>
                            <a class="img" href="{{ exhibition.get_url_path }}" style="background-image: url({{ MEDIA_URL }}{{ exhibition.image|modified_path:"exhibition_list" }})"></a>
                            <p class="small">{{ exhibition.get_rendered_image_caption|striptags }}</p>
                        </li>
                        <li>
                            <a class="img" href="{{ exhibition.get_url_path }}" style="background-image: url({{ MEDIA_URL }}{{ exhibition.image|modified_path:"exhibition_list" }})"></a>
                            <p class="small">{{ exhibition.get_rendered_image_caption|striptags }}</p>
                        </li>
                    </ul>
                {% endif %}

                <h1>
                    {{ exhibition.title }}
                     {% if exhibition.subtitle %}
                        <span>{{ exhibition.subtitle }}</span>
                    {% endif %}
                </h1>

                <a href="{{ exhibition.museum.get_url_path }}"><h3>{{ exhibition.museum.title }}</h3></a>
                
                {{ exhibition.get_rendered_description }}
            </article>
    {% endwith %}
        
    <h2 class="catHead">→ Nur noch kurze Zeit</h2>
    <ul id="kurze_zeit" class="list tiles small clearfix">
        {% get_objects closing_soon exhibitions.Exhibition 5 as exhibitions_closing_soon %}
        {% for exhibition in exhibitions_closing_soon %}
            <li class="item">
                {% if exhibition.image %}
                    <a class="img" href="{{ exhibition.get_url_path }}" style="background-image: url({{ MEDIA_URL }}{{ exhibition.image|modified_path:"exhibition_list" }})"></a>
                {% endif %}
                <a href="{{ exhibition.get_url_path }}">
                    <h4>{{ exhibition.museum.title }}</h4>
                    <h3>{{ exhibition.title }}</h3>
                    <h5>{% trans "till" %} {{ exhibition.end|date:"d.m.Y" }}</h5>
                </a>
            </li>
        {% endfor %}
    </ul>
        
    <div id="controls">
        {% if prev_item %}
            <a href="{{ prev_item.get_url_path }}" id="prev">&lt;</a>
        {% endif %}
        {% if next_item %}
            <a href="{{ next_item.get_url_path }}" id="next">&gt;</a>
        {% endif %}
    </div>
        
{% endblock %}
