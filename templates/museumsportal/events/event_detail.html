{% extends "base.html" %}
{% load base_tags i18n image_modifications tagging_tags babel auth_extended favorites %}
{% block title %}{% trans "Event" %} – {{ object.title }} – {% endblock %}
{% block bodyclass %}event-detail{% endblock %}

{% block js %}
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/favorites.js" defer="defer"></script>
    <script type="text/javascript">
        var aGeopositions = [];
        var settings = {
            STATIC_URL: "{{ STATIC_URL }}"
        }

        $(document).ready(function(){
            $(".toggle_bvg").click(function () {
                $("#bvg_widget").toggleClass("on");
                return false;
            });
        });
    </script>
{% endblock %}

{% block map %}
    {% include "utils/gmap.html" %}
{% endblock %}

{% block edit_item %}
    {% if_has_perm "events.change_event" object %}
    <div>
        <a class="btn btn-default" data-toggle="tooltip" data-placement="bottom" data-original-title="{% trans "Edit" %}" href="{{ request.path }}change/">
            <span class="sr-only">{% trans "Edit" %}</span>
            <span class="icon icon-pencil"></span>
        </a>
    </div>
    {% end_if_has_perm %}
{% endblock %}

{% block content %}
{% with object as event %}
<div class="container">
    <div class="container">
        {% include "utils/cover_image.html" %}
        <section class="sidebar">
            <div class="panel-group" id="accordion2">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse-location">
                            {% trans "Venue" %}
                        </a>
                    </h4>
                    <ul id="collapse-location" class="panel-collapse collapse in">
                        <div class="panel-body">
                            {% if event.museum %}
                                {% with event.museum as museum %}
                                    <dl class="address">
                                        <dt>{% trans "Address" %}</dt>
                                        <dd><a href="{{ museum.get_url_path }}">{{ museum.title }}</a></dd>
                                        <dd>{{ museum.street_address }}</dd>
                                        {% if museum.street_address2 %}<dd>{{ museum.street_address2 }}</dd>{% endif %}
                                        <dd>{{ museum.postal_code }} {{ museum.city }}</dd>

                                        {% with event as list_item %}
                                            <dd><a href="#" class="location">{% trans "Show location on map" %}</a>
                                            {% include "utils/geo_position.html" %}</dd>
                                        {% endwith %}
                                    </dl>
                                {% endwith %}
                            {% else %}
                                <dl class="address">
                                    <dt>{% trans "Address" %}</dt>
                                    <dd>{{ event.location_name }}</dd>
                                    <dd>{{ event.street_address }}</dd>
                                    {% if event.street_address2 %}<dd>{{ event.street_address2 }}</dd>{% endif %}
                                    <dd>{{ event.postal_code }} {{ event.city }}</dd>

                                    {% with event as list_item %}
                                        <dd><a href="#" class="location">{% trans "Show location on map" %}</a>
                                        {% include "utils/geo_position.html" %}</dd>
                                    {% endwith %}
                                </dl>
                            {% endif %}

                            {% if event.exhibition %}
                                <dl>
                                    <dt>{% trans "Related exhibition" %}</dt>
                                    <dd><a href="{{ event.exhibition.get_url_path }}">{{ event.exhibition.title }}</a></dd>
                                </dl>
                            {% endif %}

                            <dl>
                                {% if event.museum.service_phone_number %}
                                    <dt>{% trans "Service Telephone" %}
                                        <span class="right">+{{ event.museum.service_phone_country }} ({{ event.museum.service_phone_area }}) {{ event.museum.service_phone_number }}</span>
                                    </dt>
                                {% endif %}

                                {% if event.museum.phone_number %}
                                    <dt>{% trans "Telephone" %}
                                        <span class="right">+{{ event.museum.phone_country }} ({{ event.museum.phone_area }}) {{ event.museum.phone_number }}</span>
                                    </dt>
                                {% endif %}

                                {% if event.museum.group_bookings_phone_number %}
                                    <dt>{% trans "Booking Telephone" %}
                                        <span class="right">+{{ event.museum.group_bookings_phone_country }} ({{ event.museum.group_bookings_phone_area }}) {{ event.museum.group_bookings_phone_number }}</span>
                                    </dt>
                                {% endif %}

                                {% if event.museum.fax_number %}
                                    <dt>{% trans "Fax" %}
                                        <span class="right">+{{ event.museum.fax_country }} ({{ event.museum.fax_area }}) {{ event.museum.fax_number }}</span>
                                    </dt>
                                {% endif %}

                                {% if event.website %}
                                    <dt>{% trans "Website" %}
                                         <span class="right"><a class="crop" href="{{ event.website }}">{{ event.website|humanize_url:"25" }}</a></span>
                                    </dt>
                                {% endif %}

                            </dl>

                            {% if event.organizer_set.count %}
                                <dl>
                                    <dt>{% trans "Organizer" %}</dt>
                                    {% for organizer in event.organizer_set.all %}
                                        {% if organizer.organizing_museum %}
                                        <dd><a href="{{ organizer.organizing_museum.get_url_path }}">{{ organizer.organizing_museum.title }}</a></dd>
                                        {% endif %}

                                        {% if organizer.organizer_title %}
                                            {% if organizer.organizer_url_link %}
                                                <dd><a href="{{ organizer.organizer_url_link }}">{{ organizer.organizer_title }}</a></dd>
                                            {% else %}
                                                <dd>{{ organizer.organizer_title }}</dd>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </dl>
                            {% endif %}
                        </li>
                    </ul>
                </li>

                {% if event.museum %}
                    {% with event.museum as list_item %}
                        {% include "utils/bvg.html" %}
                    {% endwith %}
                {% else %}
                    {% with event as list_item %}
                        {% include "utils/bvg.html" %}
                    {% endwith %}
                {% endif %}

                <!-- ======= Date and Time ======= -->

                {% if event.get_upcoming_event_times.count %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion2" href="#collapse-times">
                                {% trans "Date and Time" %}
                            </a>
                        </h4>
                        <ul id="collapse-times" class="panel-collapse collapse">
                            {% for event_time in event.get_upcoming_event_times %}
                                <li class="accordion-inner tight">
                                    <dl>
                                        <dt>
                                        {{ event_time.event_date|date:"j. F Y" }}
                                         <span class="right">{{ event_time.start|time:"H:i" }}{% if event_time.end %} {% trans "till" %} {{ event_time.end|time:"H:i" }}{% endif %}{% if LANGUAGE_CODE == "de" %} Uhr{% endif %}</span>
                                        </dt>
                                    </dl>
                                </li>
                            {% endfor %}
                        </ul>
                    </li>
                {% endif %}

                <!-- ======= Prices ======= -->

                {% if event.free_admission or event.admission_price or event.admission_price_info or event.reduced_price or event.reduced_price_info or event.booking_info %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion2" href="#collapse-prices">
                                {% trans "Prices" %}
                            </a>
                        </h4>
                        <ul id="collapse-prices" class="panel-collapse collapse">
                            <div class="panel-body">
                                <dl>
                                {% if event.free_admission %}
                                    <dt>{% trans "Free entrance" %}</dt>
                                {% else %}
                                    {% if event.admission_price %}
                                        <dt>{% trans "Admission price" %}: {{ event.admission_price|currencyfmt:"EUR" }}</dt>
                                    {% endif %}
                                    {% if event.admission_price_info %}
                                        <dd class="admission_price_info">{{ event.get_rendered_admission_price_info }}</dd>
                                    {% endif %}
                                    {% if event.reduced_price %}
                                        <dt>{% trans "Reduced price" %}: {{ event.reduced_price|currencyfmt:"EUR" }}</dt>
                                    {% endif %}
                                    {% if event.reduced_price_info %}
                                        <dd class="reduced_price_info">{{ event.get_rendered_reduced_price_info }}</dd>
                                    {% endif %}
                                {% endif %}
                                </dl>
                            </li>
                            {% if event.booking_info %}
                            <div class="panel-body">
                                <dl>
                                    <dt>{% trans "Booking info" %}</dt>
                                    <dd class="booking_info">{{ event.get_rendered_booking_info }}</dd>
                                </dl>
                            </li>
                            {% endif %}
                        </ul>
                    </li>
                {% endif %}

                <!-- ======= Other Information ======= -->

                {% if event.meeting_place or event.get_languages %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion2" href="#collapse-other-info">
                                {% trans "Other info" %}
                            </a>
                        </h4>
                        <ul id="collapse-other-info" class="panel-collapse collapse">
                            <div class="panel-body">
                                {% if event.meeting_place %}
                                    <dl>
                                        <dt>{% trans "Meeting point" %}</dt>
                                        <dd class="meeting_place">{{ event.meeting_place }}</dd>
                                    </dl>
                                {% endif %}
                                {% if event.get_languages %}
                                    <dl>
                                        <dt>{% trans "Languages" %}</dt>
                                        <dd class="languages">{{ event.get_languages|join:", " }}</dd>
                                    </dl>
                                {% endif %}
                            </li>
                        </ul>
                    </li>
                {% endif %}
            </ul>

            {% if request.user.is_authenticated %}
                <div class="tools">
                {% adding2favorites for event using "favorites/includes/favorite_detail.html" %}
                </div>
            {% endif %}
        </section>

        <article class="with_sidebar">
            <header>

                <time>{% for cat in event.categories.all %}{{ cat.title }}{% if not forloop.last %}, {% else %}: {% endif %}{% endfor %}
                    {% with event.get_closest_event_time as event_time %}
                        {{ event_time.event_date|date:"j. F Y" }}
                        {{ event_time.start|time:"H:i" }}{% if LANGUAGE_CODE == "de" %} Uhr{% endif %}
                        </br>
                    {% endwith %}
                </time>

                <h1> {{ event.title }} </h1>
                {% if event.subtitle %}
                    <h2>{{ event.subtitle }}</h2>
                {% endif %}

              <!--   {% if event.event_type %}
                    <h3>{{ event.event_type }}</h3>
                {% endif %} -->
                {% if event.location_name %}
                    <h3>{{ event.location_name }}</h3>
                {% else %}
                    {% if event.museum %}
                        <a href="{{ event.museum.get_url_path }}"><h3>{{ event.museum.title }}</h3></a>
                    {% endif %}
                {% endif %}
            </header>
            {{ event.get_rendered_description }}

            {% comment %}
            <!-- <ul class="tags">
                {% if event.categories.count %}
                    {% for cat in event.categories.all %}
                        <li class="cat"><a href="{% if LANGUAGE_CODE == "de" %}/de/ausstellungen/{% else %}/en/events/{% endif %}#filter=.cat_{{ cat.title|slugify }}">{{ cat.title }}</a></li>
                    {% endfor %}
                {% endif %}
                {% tags_for_object event as tags %}
                {% if tags %}
                    {% for tag in tags %}
                        <li><a href="{% if LANGUAGE_CODE == "de" %}/de/ausstellungen/{% else %}/en/events/{% endif %}#filter=.tag_{{ tag.slug }}">{{ tag.name }}</a></li>
                    {% endfor %}
                {% endif %}
            </ul> -->
            {% endcomment %}
        </article>
  </div>
</div>

<!-- ======= Other Events ======= -->

{% if object.get_other_events %}
<div class="content" class="clearfix">
    <div class="inner">
        <h2>{% trans "More Events" %}</h2>
        <div class="list">
            {% for event in object.get_other_events %}
                <div class="item">
                    {% if event.cover_image %}
                        <a class="img" href="{{ event.get_url_path }}" style="background-image: url({{ MEDIA_URL }}{{ event.cover_image|modified_path:"event_list" }})"></a>
                    {% endif %}

                    <a href="{{ event.get_url_path }}">
                        {% with event.get_closest_event_time as event_time %}
                            <h4>
                                {% for cat in event.categories.all %}{{ cat.title }}{% if not forloop.last %}, {% else %}: {% endif %}{% endfor %}
                                {% with event.get_closest_event_time as event_time %}{{ event_time.event_date|date:"j. F Y" }} {{ event_time.start|time:"H:i" }}{% if LANGUAGE_CODE == "de" %} Uhr{% endif %}{% endwith %}
                            </h4>
                        {% endwith %}
                        <h3>{{ event.title }}</h3>
                        <h4>{{ event.subtitle }}</h4>
                    </a>
                    {% with event as list_item %}
                        {% include "utils/geo_position.html" %}
                    {% endwith %}
                </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endif %}

{% endwith %}

{% include "utils/gallery.html" %}
{% include "utils/page_controls.html" %}
{% include "utils/gmap_scripts.html" %}
{% include "utils/gallery_scripts.html" %}
{% endblock %}
