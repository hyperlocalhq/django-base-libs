{% extends "site_specific/dashboard.html" %}

{% block bodyclass %}{{ block.super }} dashboard{% endblock %}

{% load base_tags i18n sekizai_tags %}

{% block title %}
    {% if project %}
        {{ project.title }}
    {% else %}
        {% trans "New project" %}
    {% endif %}
{% endblock %}

{% block edit_item %}
    {% if project.slug %}
        <li>
            <a class="preview icon icon-white icon-view"
               data-toggle="tooltip"
               data-placement="bottom"
               data-original-title="{% trans "Preview" %}"
               href="{% url "project_detail" slug=project.slug %}?preview">
                &nbsp;<span>{% trans "Preview" %}</span></a>
        </li>
    {% endif %}
{% endblock %}

{% block form_steps %}
    <div class="dashboard-header container relative">
        {% block dashboard_title %}
            {% if project %}
                <h4>{{ project.title }}</h4>
            {% else %}
                <h4>{% trans "Add new educational project" %}</h4>
            {% endif %}
        {% endblock %}
        <div id="form-meta">
            {% if project %}
                <div id="pub-status" class="status">
                    <label>
                        <select class="status-switch" data-url="{% url "change_project_status" slug=project.slug %}">
                            <option value="draft"{% if project.status == "draft" %}
                                    selected="selected"{% endif %}>{% trans "Draft" %}</option>
                            <option value="published"{% if project.status == "published" %}
                                    selected="selected"{% endif %}>{% trans "Published" %}</option>
                            <option value="not_listed"{% if project.status == "not_listed" %}
                                    selected="selected"{% endif %}>{% trans "Not listed" %}</option>
                            <option value="expired"{% if project.status == "expired" %}
                                    selected="selected"{% endif %}>{% trans "Expired" %}</option>
                        </select>
                    </label>
                </div>
                {% now "uuuu" as microseconds %}
                <script nonce="{{ microseconds|to_base64 }}">
                    $(function () {
                        $('.status').hover(function () {
                            $(this).addClass('hover');
                        }, function () {
                            $(this).removeClass('hover');
                        }).mouseleave();
                        $('.status-switch').change(function () {
                            var $this = $(this);
                            $.post($this.attr('data-url'), {'status': $this.val()}, function (data) {
                            });
                        });
                    });
                </script>
                {% add_data "script_nonces" microseconds|to_base64 %}
            {% endif %}

            {% if project.slug %}
                <a class="btn btn-primary"
                   id="preview_page"
                   href="{% url "project_detail" slug=project.slug %}?preview"
                   target="_blank"><span>{% trans "Preview" %}</span></a>
            {% endif %}
        </div>

        {% include "utils/step_list.html" %}
    </div>
{% endblock %}

{% block dashboard_content %}
    <div class="container">
        <div class="dashboard-content">
            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="alert alert-{% if message.tags %}{{ message.tags }}{% endif %}">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="messages">
                    <div class="alert alert-warning">
                        {% trans "Fields with * are required." %}
                    </div>
                </div>
            {% endif %}
            {% block multistep_form %}
            {% endblock %}
        </div>
    </div>
{% endblock %}

{% block footer %}
    {{ block.super }}
    {% now "uuuu" as microseconds %}
    <script nonce="{{ microseconds|to_base64 }}">
        $(function () {
            $("select:visible").not('[name*="__prefix__"]').selectbox();
        });
    </script>
    {% add_data "script_nonces" microseconds|to_base64 %}
{% endblock %}
