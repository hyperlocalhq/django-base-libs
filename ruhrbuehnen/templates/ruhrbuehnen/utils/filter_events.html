{% load i18n base_tags mptt_tags %}

<div class="sidebar filter accordion">

    <div class="accordion-item underline">
        <div class="accordion-head h4">{% trans "Location" %}</div>
        <div class="accordion-body">
            <ul>
                {% for cat in facets.categories.locations %}
                    {% if cat in facets.selected.locations %}
                        <li>
                            <a class="active" href="{% remove_from_query "page" locations=cat.pk %}">{{ cat.title }}</a>
                        </li>
                    {% else %}
                        <li>
                            <a class="" href="{% add_to_query "page" locations=cat.pk %}">{{ cat.title }}</a>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="accordion-item underline">
        <div class="accordion-head h4">{% trans "Language" %}</div>
        <div class="accordion-body">
            <ul>
                {% for cat in facets.categories.language_and_subtitles %}
                    {% if cat in facets.selected.language_and_subtitles %}
                        <li>
                            <a class="active"
                               href="{% remove_from_query "page" language_and_subtitles=cat.pk %}">{{ cat.title }}</a>
                        </li>
                    {% else %}
                        <li>
                            <a class=""
                               href="{% add_to_query "page" language_and_subtitles=cat.pk %}">{{ cat.title }}</a>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    </div>

    {% full_tree_for_model productions.ProductionCategory as categories %}
    {% recursetree categories %}
        {% with cat=node %}
            {% if cat.is_root_node %}{# Categories #}
                <div class="accordion-item underline">
                    <div class="accordion-head h4">{{ cat.title }}</div>
                    <div class="accordion-body">
                        <ul>
                            {% if cat in facets.selected.categories %}
                                <li>
                                    <a class="active parent"
                                       href="{% remove_from_query "page" categories=cat.pk %}">{% trans "All" %}</a>
                                </li>
                            {% else %}
                                <li>
                                    <a class="remove parent"
                                       href="{% add_to_query "page" categories=cat.pk %}">{% trans "All" %}</a>
                                </li>
                            {% endif %}
                            {{ children }}
                        </ul>
                    </div>
                </div>
                {% else %}{# Subcategories #}
                {% if cat in facets.selected.subcategories %}
                    <li>
                        <a class="active child"
                           href="{% remove_from_query "page" subcategories=cat.pk %}">{{ cat.title }}</a>
                    </li>
                {% else %}
                    <li>
                        <a class="remover child"
                           href="{% add_to_query "page" subcategories=cat.pk %}">{{ cat.title }}</a>
                    </li>
                {% endif %}
            {% endif %}
        {% endwith %}
    {% endrecursetree %}

</div>
