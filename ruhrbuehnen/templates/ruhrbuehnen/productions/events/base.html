{% extends "site_specific/dashboard.html" %}
{% block bodyclass %}{{ block.super }} dashboard{% endblock %}
{% load base_tags i18n sekizai_tags %}

{% block title %}
    {% if production %}
        {{ production.title }}
    {% else %}
        {% trans "New production" %}
    {% endif %}
{% endblock %}

{% block edit_item %}
    <li><a class="preview icon icon-white icon-view" data-toggle="tooltip" data-placement="bottom" data-original-title="{% trans "Preview" %}" href="{% url "production_detail" slug=production.slug %}?preview">&nbsp;<span>{% trans "Preview" %}</span></a></li>
{% endblock %}

{% block form_steps %}
    <div class="dashboard-header container relative">
        {% block dashboard_title %}
            {% if production %}
                <h4>{{ production.title }}
                    {% if event %}
                        - {{ event.start_date|date:"j. F Y" }}, {{ event.start_time|time:"H:i" }}
                    {% endif %}
                </h4>
            {% else %}
                <h4>{% trans "Add new production" %}</h4>
            {% endif %}
        {% endblock %}
        <div id="form-meta">
            {% if production %}
                <div id="pub-status" class="status">
                    <select class="status-switch" data-url="{% url "change_production_status" slug=production.slug %}">
                        <option value="draft"{% if production.status == "draft" %} selected="selected"{% endif %}>{% trans "Draft" %}</option>
                        <option value="published"{% if production.status == "published" %} selected="selected"{% endif %}>{% trans "Published" %}</option>
                        <option value="not_listed"{% if production.status == "not_listed" %} selected="selected"{% endif %}>{% trans "Not listed" %}</option>
                    </select>
                </div>
                {% now "uuuu" as microseconds %}
                <script nonce="{{ microseconds|to_base64 }}">
                    $(function() {
                        $('.status').hover(function() {
                            $(this).addClass('hover');
                        }, function() {
                            $(this).removeClass('hover');
                        }).mouseleave();
                        $('.status-switch').change(function() {
                            var $this = $(this);
                            $.post($this.attr('data-url'), {'status': $this.val()}, function(data) {});
                        });
                    });
                </script>
                {% add_data "script_nonces" microseconds|to_base64 %}
            {% endif %}
            {% if event.pk %}
                <a class="btn btn-primary" id="preview_page" href="{% url "event_detail" slug=production.slug event_id=event.pk %}?preview" target="_blank" ><span>{% trans "Preview" %}</span></a>
            {% elif production.slug %}
                <a class="btn btn-primary" id="preview_page" href="{% url "production_detail" slug=production.slug %}?preview" target="_blank"><span>{% trans "Preview" %}</span></a>
            {% endif %}
        </div>

        {% if 'new_production=1' in request.get_full_path %}
            <ul class="nav nav-tabs form-steps pull-left">
                <li><a class="txt" href="{% url "add_production" %}?step=1"> {% trans "Production" %} </a></li>
                <li><a class="txt" href="{% url "add_production" %}?step=2"> {% trans "Description" %} </a></li>
                <li><a class="txt" href="{% url "add_production" %}?step=3"> {% trans "Media" %} </a></li>
                <li class="active"><a class="txt" href="{% url "add_production" %}?step=4"> {% trans "Events" %} </a></li>
            </ul>
        {% else %}
            <ul class="nav nav-tabs form-steps pull-left">
                <li><a class="txt" href="{% url "change_production" slug=production.slug %}?step=1"> {% trans "Production" %} </a></li>
                <li><a class="txt" href="{% url "change_production" slug=production.slug %}?step=2"> {% trans "Description" %} </a></li>
                <li><a class="txt" href="{% url "change_production" slug=production.slug %}?step=3"> {% trans "Media" %} </a></li>
                <li class="active"><a class="txt" href="{% url "change_production" slug=production.slug %}?step=4"> {% trans "Events" %} </a></li>
            </ul>
        {% endif %}
        <ul class="nav nav-tabs form-steps pull-right">
            {% block event_tabs %}{% endblock %}
        </ul>
    </div>
{% endblock %}

{% block dashboard_content %}
<div class="container">
    <div class="dashboard-content">
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="alert alert-{% if message.tags %}{{ message.tags }}{% endif %}">
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                    {{ message }}
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="messages">
                <div class="alert alert-warning">
                    {% trans "Fields with * are required." %}
                </div>
            </div>
        {% endif %}
        {% block multistep_form %}
        {% endblock %}
    </div>
</div>
{% endblock %}

{% block footer %}
    {{ block.super }}
    {% now "uuuu" as microseconds %}
    <script nonce="{{ microseconds|to_base64 }}">
        $(function() {
            $("select:visible").not('[name*="__prefix__"]').selectbox();
        });
    </script>
    {% add_data "script_nonces" microseconds|to_base64 %}
{% endblock %}
