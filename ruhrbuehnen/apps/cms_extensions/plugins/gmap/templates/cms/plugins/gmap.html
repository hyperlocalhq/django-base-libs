{% load i18n %}
<div class="plugin_gmap">
    <!--  ATTENTION: set a height for this div in CSS -->
    <div id="gmap-{{ object.id }}" class="gmap-map"></div>

    <script type="text/javascript">
        //<![CDATA[
        (function ($, undefined) {
            $(document).ready(function () {
                var geocoder;
                var map;

                var title = "{{ object.get_title }}";
                var address = "{{ object.address }}, {{ object.zipcode }} {{ object.city }}";
                var zoom = {{ object.get_zoom_level }};

                {% if object.get_lat_lng %}
                    var latlng = new google.maps.LatLng({{ object.get_lat_lng|join:", " }});
                    var myOptions = {
                        zoom: zoom,
                        center: latlng,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    };
                    map = new google.maps.Map(
                        document.getElementById("gmap-{{ object.id }}"),
                        myOptions
                    );
                    var marker = new google.maps.Marker({
                        map: map,
                        position: latlng
                    });
                {% else %}
                    geocoder = new google.maps.Geocoder();
                    geocoder.geocode({'address': address}, function (results, status) {
                        if (status === google.maps.GeocoderStatus.OK) {
                            var latlng = results[0].geometry.location;
                            var myOptions = {
                                zoom: zoom,
                                center: latlng,
                                mapTypeId: google.maps.MapTypeId.ROADMAP
                            };
                            var map = new google.maps.Map(
                                document.getElementById("gmap-{{ object.id }}"),
                                myOptions
                            );
                            var marker = new google.maps.Marker({
                                map: map,
                                position: latlng
                            });
                        }
                    });
                {% endif %}
            });
        }(jQuery));
        //]]>
    </script>
    {% if object.route_planer %}
        <form method="get" action="http://maps.google.ch/" class="googlemap-routeplaner">
            <p>{{ object.route_planer_title }}:</p>
            <fieldset>
                <label for="saddr">{% trans "Your address" %}:</label>
                <input id="saddr" name="saddr" class="textinput" value="" type="text"/>
                <input name="daddr" value="{{ object.address }}, {{ object.zipcode }} {{ object.city }}" type="hidden"/>
                <input value="{% trans "Calculate route" %}" class="input_submit" type="submit"/>
            </fieldset>
        </form>
    {% endif %}
</div>