(function(g,e){function b(){var k=false;g("#videos").each(function(){var l=g(this).data("load-url");g(this).load(l+" #videos>*",function(){g("#videos").sortable({start:function(){k=true},stop:function(){setTimeout(function(){k=false},500)},placeholder:"ui-state-highlight",update:function(m,n){var o=[];g(".video","#videos").each(function(){if(g(this).data("token")){o[o.length]=g(this).data("token")}});g.post(l,{ordering:o.join(",")})},forcePlaceholderSize:true,create:function(){var n=this;var m=function(){g(n).css("height","auto")};g(n).find("img").load(m).error(m)}});g("#videos").disableSelection().find(".edit").click(function(){if(k){return false}g("#edit_media_item").load(g(this).attr("href")+" #edit_media_item form",d);g("#media_item_overviews").hide();g(".form-actions:last").hide();return false});g(window).trigger("scrollstop")})});g("#media_item_overviews").show();g(".form-actions:last").show()}g("#add_video").click(function(){g("#edit_media_item").load(g(this).attr("href")+" #edit_media_item form",d);g("#media_item_overviews").hide();g(".form-actions:last").hide();return false});function d(){g("select").not('[name*="__prefix__"]').selectbox();g("textarea").autosize();g("#submit-id-cancel").click(function(k){k.preventDefault();g("#edit_media_item").html("");b()});g("#button-id-delete-video").click(function(){var k=g(this).data("href");g("#deleteConfirmation").removeClass("hide").modal("show");g("#button-id-confirm-deletion").click(function(){g.post(k,{},function(){g("#deleteConfirmation").modal("hide");g("#edit_media_item").html("");b()});return false})});g("#edit_media_item form").attr("target","hidden_iframe");self.hidden_iframe_loaded=function(l){var k=g("<div>"+l+"</div>").find("form");if(k.length){g("#edit_media_item").html("").append(k);d()}else{g("#edit_media_item").html("");b()}}}function i(){var k=false;g("#streamings").each(function(){var l=g(this).data("load-url");g(this).load(l+" #streamings>*",function(){g("#streamings").sortable({start:function(){k=true},stop:function(){setTimeout(function(){k=false},500)},placeholder:"ui-state-highlight",update:function(m,n){var o=[];g(".streaming","#streamings").each(function(){if(g(this).data("token")){o[o.length]=g(this).data("token")}});g.post(l,{ordering:o.join(",")})},forcePlaceholderSize:true,create:function(){var n=this;var m=function(){g(n).css("height","auto")};g(n).find("img").load(m).error(m)}});g("#streamings").disableSelection().find(".edit").click(function(){if(k){return false}g("#edit_media_item").load(g(this).attr("href")+" #edit_media_item form",a);g("#media_item_overviews").hide();g(".form-actions:last").hide();return false});g(window).trigger("scrollstop")})});g("#media_item_overviews").show();g(".form-actions:last").show()}g("#add_streaming").click(function(){g("#edit_media_item").load(g(this).attr("href")+" #edit_media_item form",a);g("#media_item_overviews").hide();g(".form-actions:last").hide();return false});function a(){g("select").not('[name*="__prefix__"]').selectbox();g("textarea").autosize();g("#submit-id-cancel").click(function(k){k.preventDefault();g("#edit_media_item").html("");i()});g("#button-id-delete-streaming").click(function(){var k=g(this).data("href");g("#deleteConfirmation").removeClass("hide").modal("show");g("#button-id-confirm-deletion").click(function(){g.post(k,{},function(){g("#deleteConfirmation").modal("hide");g("#edit_media_item").html("");i()});return false})});g("#edit_media_item form").attr("target","hidden_iframe");self.hidden_iframe_loaded=function(l){var k=g("<div>"+l+"</div>").find("form");if(k.length){g("#edit_media_item").html("").append(k);a()}else{g("#edit_media_item").html("");i()}}}function h(){lazyload_images();var k=false;g("#photos").each(function(){var l=g(this).data("load-url");g(this).load(l+" #photos>*",function(){g("#photos").sortable({start:function(){k=true},stop:function(){setTimeout(function(){k=false},500)},placeholder:"ui-state-highlight",update:function(m,n){var o=[];g(".photo","#photos").each(function(){if(g(this).data("token")){o[o.length]=g(this).data("token")}});g.post(l,{ordering:o.join(",")})},forcePlaceholderSize:true,create:function(){var n=this;var m=function(){g(n).css("height","auto")};g(n).find("img").load(m).error(m)}});g("#photos").disableSelection().find(".edit").click(function(){if(k){return false}g("#edit_media_item").load(g(this).attr("href")+" #edit_media_item form",c);g("#media_item_overviews").hide();g(".form-actions:last").hide();return false});g("#photos").find(".crop").each(function(){if(g(this).attr("href")){g(this).attr("href",g(this).attr("href").replace(/goto_next=.+$/gim,"goto_next="+location.href))}});g(window).trigger("scrollstop")})});g("#media_item_overviews").show();g(".form-actions:last").show()}g("#add_photo").click(function(){g("#edit_media_item").load(g(this).attr("href")+" #edit_media_item form",c);g("#media_item_overviews").hide();g(".form-actions:last").hide();return false});g(document).on("click","#crop_list_image",function(){location.href=g("#photos").find(".crop_list_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href);return false});g(document).on("click","#crop_cover_image",function(){location.href=g("#photos").find(".crop_cover_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href);return false});function c(){g("select").not('[name*="__prefix__"]').selectbox();g("textarea").autosize();g("#submit-id-cancel").click(function(m){m.preventDefault();g("#edit_media_item").html("");h()});g("#button-id-crop-photo").click(function(){location.href=g(this).data("href").replace(/goto_next=.+$/,"goto_next="+location.href)});g("#button-id-delete-photo").click(function(){var m=g(this).data("href");g("#deleteConfirmation").removeClass("hide").modal("show");g("#button-id-confirm-deletion").click(function(){g.post(m,{},function(){g("#deleteConfirmation").modal("hide");g("#edit_media_item").html("");h()});return false})});g("#edit_media_item form").attr("target","hidden_iframe");self.hidden_iframe_loaded=function(n){var m=g("<div>"+n+"</div>").find("form");if(m.length){g("#edit_media_item").html("").append(m);c()}else{g("#edit_media_item").html("");h()}};if(g("#image_uploader").length){var k=g.extend(translatable_file_uploader_options,{allowedExtensions:["gif","jpg","png"],action:"/"+self.settings.lang+"/helper/ajax-upload/",element:g("#image_uploader")[0],multiple:false,onComplete:function(o,n,m){if(m.success){g(".messages").html("");g("#id_media_file_path").val(m.path);g.post("/"+self.settings.lang+"/helper/modified-path/",{file_path:self.settings.media_url+m.path,mod_sysname:"gallery_image"},function(q,r,p){g("#image_preview").html('<img class="img-responsive" alt="" src="'+q+'" />');g("#image_uploader").hide();g("#image_help_text").hide()},"text")}},onAllComplete:function(m){g(".qq-upload-success").fadeOut("slow",function(){g(this).remove()})},params:{csrf_token:g('input[name="csrfmiddlewaretoken"]').val(),csrf_name:"csrfmiddlewaretoken",csrf_xname:"X-CSRFToken"},showMessage:function(m){g(".messages").html('<div class="alert alert-danger">'+m+"</div>")}});var l=new qq.FileUploader(k)}}function j(){var k=false;g("#pdfs").each(function(){var l=g(this).data("load-url");g(this).load(l+" #pdfs>*",function(){g("#pdfs").sortable({start:function(){k=true},stop:function(){setTimeout(function(){k=false},500)},placeholder:"ui-state-highlight",update:function(m,n){var o=[];g(".pdf","#pdfs").each(function(){if(g(this).data("token")){o[o.length]=g(this).data("token")}});g.post(l,{ordering:o.join(",")})},forcePlaceholderSize:true,create:function(){var n=this;var m=function(){g(n).css("height","auto")};g(n).find("img").load(m).error(m)}});g("#pdfs").disableSelection().find(".edit").click(function(){if(k){return false}g("#edit_media_item").load(g(this).attr("href")+" #edit_media_item form",f);g("#media_item_overviews").hide();g(".form-actions:last").hide();return false});g(window).trigger("scrollstop")})});g("#media_item_overviews").show();g(".form-actions:last").show()}g("#add_pdf").click(function(){g("#edit_media_item").load(g(this).attr("href")+" #edit_media_item form",f);g("#media_item_overviews").hide();g(".form-actions:last").hide();return false});function f(){g("select").not('[name*="__prefix__"]').selectbox();g("textarea").autosize();g("#submit-id-cancel").click(function(m){m.preventDefault();g("#edit_media_item").html("");j()});g("#button-id-delete-pdf").click(function(){var m=g(this).data("href");g("#deleteConfirmation").removeClass("hide").modal("show");g("#button-id-confirm-deletion").click(function(){g.post(m,{},function(){g("#deleteConfirmation").modal("hide");g("#edit_media_item").html("");j()});return false})});g("#edit_media_item form").attr("target","hidden_iframe");self.hidden_iframe_loaded=function(n){var m=g("<div>"+n+"</div>").find("form");if(m.length){g("#edit_media_item").html("").append(m);f()}else{g("#edit_media_item").html("");j()}};if(g("#pdf_uploader").length){var k=g.extend(translatable_file_uploader_options,{allowedExtensions:["pdf"],action:"/"+self.settings.lang+"/helper/ajax-upload/",element:g("#pdf_uploader")[0],multiple:false,onComplete:function(o,n,m){if(m.success){g(".messages").html("");g("#id_media_file_path").val(m.path);g.post("/"+self.settings.lang+"/helper/modified-path/",{file_path:m.path,mod_sysname:"medium"},function(q,r,p){g("#pdf_preview").html('<img class="img-responsive" alt="" src="'+window.settings.STATIC_URL+'site/img/pdf.png" />');g("#pdf_uploader").hide();g("#pdf_help_text").hide()},"text")}},onAllComplete:function(m){g(".qq-upload-success").fadeOut("slow",function(){g(this).remove()})},params:{csrf_token:g('input[name="csrfmiddlewaretoken"]').val(),csrf_name:"csrfmiddlewaretoken",csrf_xname:"X-CSRFToken"},showMessage:function(m){g(".messages").html('<div class="alert alert-danger">'+m+"</div>")}});var l=new qq.FileUploader(k)}}g(function(){b();i();h();j()})})(jQuery);