function SortingByOrder(b,d,c){if(!SortingByOrder.prototype.interval){SortingByOrder.prototype.interval=window.setInterval(SortingByOrder.prototype.onInterval,200)}var a=this;a.$wrapper=$("#"+b);a.formset_class=d;a.order_field=c;a.wrapper_height=a.$wrapper.height();a.dont_order=false;a.$current_position=null;a.$current_drag=null;a.current_drag=null;a.drag_position=null;a.drop_zones=null;$(document).ready(function(){a.setOrder()});$("body").mousemove(function(e){a.onMouseMove(e)}).mouseup(function(e){a.onMouseUp(e)});SortingByOrder.prototype.instances.push(a)}SortingByOrder.prototype.instances=[];SortingByOrder.prototype.interval=null;SortingByOrder.prototype.onInterval=function(){for(var c=0,d=SortingByOrder.prototype.instances.length;c<d;c++){var b=SortingByOrder.prototype.instances[c];var a=b.$wrapper.height();if(a==b.wrapper_height){continue}b.wrapper_height=a;b.setOrder()}};SortingByOrder.prototype.setOrder=function(){var c=this;if(c.dont_order){return}var a=0;var b=$("."+c.formset_class,c.$wrapper);b.each(function(){var d=$(this);if(d.css("display")=="none"){return true}d.off("mousedown");d.mousedown(function(e){c.onMouseDown(e)});$(".form_hidden",d).each(function(){var g=$(this);var f=g.attr("id");var e=f.split("-");if(e.pop()==c.order_field){g.attr("value",a);a++;return false}})});b.addClass("dragable").removeClass("draging")};SortingByOrder.prototype.onMouseDown=function(b){var a=this;if(b.target.tagName.toLowerCase()=="input"){a.current_drag=null;a.drag_position=null;$("body").removeClass("dragzone");a.dont_order=false;return}a.current_drag=b.delegateTarget;a.drag_position=[b.pageX,b.pageY]};SortingByOrder.prototype.onMouseUp=function(c){var b=this;b.current_drag=null;b.drag_position=null;$("body").removeClass("dragzone");b.dont_order=false;if(!b.$current_drag){return}var d=$(c.target);if(d.hasClass("dropzone")){d.after(b.$current_drag);b.setOrder()}else{b.$current_position.after(b.$current_drag)}$(".dropzone",b.$wrapper).remove();b.$current_position.remove();b.$current_drag=null;b.$current_position=null;var a=$("."+b.formset_class,b.$wrapper);a.addClass("dragable").removeClass("draging")};SortingByOrder.prototype.onMouseMove=function(e){var d=this;if(!d.current_drag||d.$current_drag){return}if(Math.sqrt(Math.pow(e.pageX-d.drag_position[0],2)+Math.pow(e.pageY-d.drag_position[1],2))<5){return}d.dont_order=true;d.$current_drag=$(d.current_drag);d.$current_position=$('<div style="visibility:hidden; height:1px;"></div>');d.$current_drag.after(d.$current_position);d.$current_drag.detach();$("body").addClass("dragzone");var c=$("."+d.formset_class,d.$wrapper);var b=null;c.each(function(){b=$(this);if(b.css("display")=="none"){return true}b.before('<div class="dropzone">DROPZONE</div>')});if(b){b.after('<div class="dropzone">DROPZONE</div>')}c.removeClass("dragable").addClass("draging");var f=d.$current_position.offset().top;var a=$(window).height();$(window).scrollTop(f-Math.round(a/2))};