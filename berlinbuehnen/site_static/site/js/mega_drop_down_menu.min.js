/* global window:false, lscache:false */
$(window).load(function(){function t(e){o.html(e),$(".calendar",o).each(function(){var t=$(this).html(p.template),e=$('<input type="hidden" />'),a=new s(e,t,{format:"yyyy-mm-dd",weekStart:1,callback:function(e){location.href=t.data("url")+"?selected_date="+e}});e.data("datepicker",a),a.show()}),i=!0,n.hover(function(){767<window.innerWidth&&($(".navbar-wrapper").is(".on")?o.css("position","fixed"):o.css("position","absolute"),o.addClass("show"))},function(){o.removeClass("show"),$("ul.nav>li",n).removeClass("mega-menu-active")}),$("ul.nav>li",n).hover(function(){if(767<window.innerWidth){$(".mega_drop_down",o).removeClass("show"),$("ul.nav>li",n).removeClass("mega-menu-active");var e,t=($(this).attr("class")||"").match(/\bmenu-\S+/);t&&$("#"+a[t[0]]).addClass("show").length&&$(this).addClass("mega-menu-active")}})}function e(){$.get("/"+window.settings.LANGUAGE_CODE+"/helper/menu/",function(e){t(e),lscache.set(h,e,10)},"html")}var a={
// de
"menu-museen":"mega_locations","menu-ausstellungen":"mega_exhibitions","menu-veranstaltungen":"mega_events","menu-fuhrungen":"mega_workshops","menu-planen-organisieren":"mega_plan_your_visit",
// en
"menu-locations":"mega_locations","menu-exhibitions":"mega_exhibitions","menu-events":"mega_events","menu-guided-tours":"mega_workshops","menu-plan-your-visit":"mega_plan_your_visit",
// pl
"menu-muzea":"mega_locations","menu-wystawy":"mega_exhibitions","menu-wydarzenia":"mega_events","menu-oprowadzanie":"mega_workshops","menu-planowanie-organizacja":"mega_plan_your_visit",
// fr
"menu-musees":"mega_locations","menu-expositions":"mega_exhibitions","menu-spectacles":"mega_events","menu-visites-guidees":"mega_workshops","menu-planifier-organiser":"mega_plan_your_visit"},s=function(e,t,a){if(this.element=$(e),this.format=p.parseFormat(a.format||this.element.data("date-format")||"mm/dd/yyyy"),this.picker=t.on({click:$.proxy(this.click,this),mousedown:$.proxy(this.mousedown,this)}),this.isInput=this.element.is("input"),this.component=!!this.element.is(".date")&&this.element.find(".add-on"),this.callback=a.callback,this.isInput||(this.component?this.component.on("click",$.proxy(this.show,this)):this.element.on("click",$.proxy(this.show,this))),this.minViewMode=a.minViewMode||this.element.data("date-minviewmode")||0,"string"==typeof this.minViewMode)switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0;break}if(this.viewMode=a.viewMode||this.element.data("date-viewmode")||0,"string"==typeof this.viewMode)switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0;break}this.startViewMode=this.viewMode,this.weekStart=a.weekStart||this.element.data("date-weekstart")||0,this.weekEnd=0===this.weekStart?6:this.weekStart-1,this.fillDow(),this.fillMonths(),this.update(),this.showMode(),this.set()};s.prototype={constructor:s,show:function(e){this.height=this.component?this.component.outerHeight():this.element.outerHeight(),e&&(e.stopPropagation(),e.preventDefault()),this.element.trigger({type:"show",date:this.date})},set:function(){var e=p.formatDate(this.date,this.format);$("date",this.picker).text(e)},setValue:function(e){this.date="string"==typeof e?p.parseDate(e,this.format):new Date(e),this.set(),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0),this.fill()},update:function(e){this.date=p.parseDate("string"==typeof e?e:this.isInput?this.element.prop("value"):this.element.data("date"),this.format),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0),this.fill()},fillDow:function(){for(var e=this.weekStart,t="<tr>";e<this.weekStart+7;)t+='<th class="dow">'+p.dates.daysMin[e++%7]+"</th>";t+="</tr>",this.picker.find(".datepicker-days thead").append(t)},fillMonths:function(){for(var e="",t=0;t<12;)e+='<span class="month">'+p.dates.monthsShort[t++]+"</span>";this.picker.find(".datepicker-months td").append(e)},fill:function(){var e=new Date(this.viewDate),t=e.getFullYear(),a=e.getMonth(),s=this.date.valueOf();this.picker.find(".datepicker-days th:eq(1)").text(p.dates.months[a]+" "+t);var i=new Date(t,a-1,28,0,0,0,0),n=p.getDaysInMonth(i.getFullYear(),i.getMonth());i.setDate(n),i.setDate(n-(i.getDay()-this.weekStart+7)%7);var o=new Date(i);o.setDate(o.getDate()+42),o=o.valueOf();for(var h=[],r;i.valueOf()<o;)i.getDay()===this.weekStart&&h.push("<tr>"),r="",i.getMonth()<a?r+=" old":i.getMonth()>a&&(r+=" new"),i.valueOf()===s&&(r+=" active"),h.push('<td class="day'+r+'">'+i.getDate()+"</td>"),i.getDay()===this.weekEnd&&h.push("</tr>"),i.setDate(i.getDate()+1);this.picker.find(".datepicker-days tbody").empty().append(h.join(""));var d=this.date.getFullYear(),l=this.picker.find(".datepicker-months").find("th:eq(1)").text(t).end().find("span").removeClass("active");d===t&&l.eq(this.date.getMonth()).addClass("active"),h="",t=10*parseInt(t/10,10);var m=this.picker.find(".datepicker-years").find("th:eq(1)").text(t+"-"+(t+9)).end().find("td");t-=1;for(var c=-1;c<11;c++)h+='<span class="year'+(-1===c||10===c?" old":"")+(d===t?" active":"")+'">'+t+"</span>",t+=1;m.html(h)},click:function(e){e.stopPropagation(),e.preventDefault();var t=$(e.target).closest("span, td, th"),a,s,i;if(1===t.length)switch(t[0].nodeName.toLowerCase()){case"th":switch(t[0].className){case"switch":this.showMode(1);break;case"prev":case"next":this.viewDate["set"+p.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+p.modes[this.viewMode].navFnc].call(this.viewDate)+p.modes[this.viewMode].navStep*("prev"===t[0].className?-1:1)),this.fill(),this.set();break}break;case"span":t.is(".month")?(s=t.parent().find("span").index(t),this.viewDate.setMonth(s)):(i=parseInt(t.text(),10)||0,this.viewDate.setFullYear(i)),0!==this.viewMode&&(this.date=new Date(this.viewDate),this.element.trigger({type:"changeDate",date:this.date,viewMode:p.modes[this.viewMode].clsName})),this.showMode(-1),this.fill(),this.set();break;case"td":if(t.is(".day")){if(a=parseInt(t.text(),10)||1,s=this.viewDate.getMonth(),t.is(".old")?s-=1:t.is(".new")&&(s+=1),i=this.viewDate.getFullYear(),this.date=new Date(i,s,a,0,0,0,0),this.viewDate=new Date(i,s,Math.min(28,a),0,0,0,0),this.fill(),this.set(),this.callback){var n=p.formatDate(this.date,this.format);this.callback(n)}this.element.trigger({type:"changeDate",date:this.date,viewMode:p.modes[this.viewMode].clsName})}break}},mousedown:function(e){e.stopPropagation(),e.preventDefault()},showMode:function(e){e&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+e))),this.picker.find(".datepicker>div").hide().filter(".datepicker-"+p.modes[this.viewMode].clsName).show()}};var p={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:window.WEEKDAYS,daysShort:window.WEEKDAYS_SHORT,daysMin:window.WEEKDAYS_SHORT,months:window.MONTHS,monthsShort:window.MONTHS_SHORT},isLeapYear:function(e){return e%4==0&&e%100!=0||e%400==0},getDaysInMonth:function(e,t){return[31,p.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},parseFormat:function(e){var t=e.match(/[\-.\/\s].*?/),a=e.split(/\W+/);if(!t||!a||0===a.length)throw new Error("Invalid date format.");return{separator:t,parts:a}},parseDate:function(e,t){var a=e.split(t.separator),s;if((e=new Date).setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),a.length===t.parts.length)for(var i=0,n=t.parts.length;i<n;i++)switch(s=parseInt(a[i],10)||1,t.parts[i]){case"dd":case"d":e.setDate(s);break;case"mm":case"m":e.setMonth(s-1);break;case"yy":e.setFullYear(2e3+s);break;case"yyyy":e.setFullYear(s);break}return e},formatDate:function(e,t){var a={d:e.getDate(),m:e.getMonth()+1,yy:e.getFullYear().toString().substring(2),yyyy:e.getFullYear()};a.dd=(a.d<10?"0":"")+a.d,a.mm=(a.m<10?"0":"")+a.m,e=[];for(var s=0,i=t.parts.length;s<i;s++)e.push(a[t.parts[s]]);return e.join(t.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};p.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+p.headTemplate+'<tbody></tbody></table></div><div class="datepicker-months"><table class="table-condensed">'+p.headTemplate+p.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+p.headTemplate+p.contTemplate+"</table></div></div>";var i=!1,n=$("#top_nav"),o=$("#mega_drop_down_menu"),h="mega-drop-down-menu:"+window.settings.LANGUAGE_CODE,r=lscache.get(h);r?t(r):e(r)});