!function(){function t(t){var e=this;this.me=e,e.loading=!1,e.$main=t;var i=e.$main.attr("id").split("_",2);e.connect_id=i[0],e.date=null,e.$list=$("#"+e.connect_id+"_list"),e.$dateslider=$("#"+e.connect_id+"_dateslider"),e.reinit(),e.$suboptions.addClass("closed"),e.$main.data("filter",e)}function e(){$(".filter").each(function(){new t($(this))})}t.prototype.reinit=function(){if(this.me)var t=this.me;t.$options_wrapper=$(".filter-options-wrapper",t.$main),t.$search_wrapper=$(".filter-search-wrapper",t.$main),t.$set_wrapper=$(".filter-set-wrapper",t.$main),t.$options=$(".filter-option",t.$options_wrapper),t.$suboptions=$(".filter-suboptions",t.$options_wrapper),t.$singletons=$(".singleton",t.$options_wrapper),t.$options.click(function(){t.onOptionClicked($(this))}),$("a",t.$main).click(function(e){t.onLinkClicked(e)})},t.prototype.resetDate=function(t){if(this.me)var e=this.me;var i=t.getFullYear(),a=t.getMonth()+1,s=t.getDate();a<10&&(a="0"+a),s<10&&(s="0"+s);var r=i+"-"+a+"-"+s;e.date=r},t.prototype.onOptionClicked=function(t){if(this.me)var e=this.me;e.$options.removeClass("active"),t.addClass("active");var i=$(t.data("target"),e.$main);i.hasClass("closed")&&(e.$suboptions.addClass("closed"),i.removeClass("closed"))},t.prototype.onLinkClicked=function(t){if($(t.delegateTarget).hasClass("filter-option"))return location.href=$(t.delegateTarget).attr("href"),!0;if(this.me)var e=this.me;if(!e.$list.length)return!0;if(t.preventDefault(),e.loading)return!1;e.loading=!0;var i=$(t.target),a=i.attr("href");e.$list.jscroll.destroy&&e.$list.jscroll.destroy();var s=a.split("#",2);a=s[0],s=2===s.length?s=s[1]:"";var r=a.split("?",2);a=r[0],r=2===r.length?r[1].split("&"):"";for(var n={},o=0,l=r.length;o<l;o++){var p=r[o].split("=",2);n.hasOwnProperty(p[0])?("object"!=typeof n[p[0]]&&(n[p[0]]=[n[p[0]]]),n[p[0]].push(p[1])):n[p[0]]=p[1]}console.log(n);var d=i.closest(".filter-suboptions");if(d.length){var c=[],h=d.get(0),f=i.closest(".parent",h);f.length&&!f.hasClass("active")&&$(".child.active",d).each(function(){c.push($(this).data("value"))});var u=i.closest(".child",h);u.length&&!u.hasClass("active")&&$(".parent.active",d).each(function(){c.push($(this).data("value"))});for(var o=0,l=c.length;o<l;o++){var v=c[o].split("="),p=n[v[0]];if("object"==typeof p){for(var g=0;g<p.length;g++)if(p[g]===v[1]){p[g]="";break}}else p===v[1]&&(n[v[0]]="")}}n.reset&&($(".active",e.$suboptions).each(function(){i=$(this);var t=i.data("value").split("=");delete n[t[0]]}),e.$singletons.each(function(){if(i=$(this),i.hasClass("active")){var t=i.data("value").split("=");delete n[t[0]]}})),!e.date&&n.date&&(e.date=n.date),delete n.page,delete n.date,delete n.reset;var m="?";for(var p in n)if("object"==typeof n[p])for(var o=0,l=n[p].length;o<l;o++)""!==n[p][o]&&(m+=p+"="+n[p][o]+"&");else""!==n[p]&&(m+=p+"="+n[p]+"&");var y=m.substr(1,m.length-2);e.date&&(m+="date="+e.date+"&"),m=m.substr(0,m.length-1),a+=m,s&&(a+="#"+s);var b=function(t,i,a){var s,r,n;if("error"===i){return alert("Error loading filtered list: "+a.status+" "+a.statusText),e.loading=!1,!1}var o=$(t),p=$("#"+e.$main.attr("id"),o),d=$(".filter-options-wrapper",p),c=$(".filter-option",d),h=$(".filter-suboptions",d);for(s=0,l=c.length;s<l;s++)r=$(c.get(s)),n=$(e.$options.get(s)),r.attr("class",n.attr("class"));for(s=0,l=h.length;s<l;s++)r=$(h.get(s)),n=$(e.$suboptions.get(s)),r.attr("class",n.attr("class"));e.$main.html(p.html()),e.reinit(),e.$list.data("list").reinitByFilter(),e.$dateslider.length&&e.$dateslider.data("dateslider").reinitByFilter(y),e.loading=!1};""===a&&(a="?"),history.pushState&&history.pushState({},document.title,a),e.$list.load(a+" #"+e.connect_id+"_list",b)},$(document).ready(e)}();