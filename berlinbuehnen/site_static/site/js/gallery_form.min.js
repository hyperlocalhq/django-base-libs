/* jshint unused:false, eqnull:false */
/* global self: false */
/* global jQuery: false */
/* global qq: false */
/* global translatable_file_uploader_options: false */
/* global lazyload_images: false */
!function(a,e){function i(){var e=!1;a("#videos").each(function(){var o=a(this).data("load-url");a(this).load(o+" #videos>*",function(){a("#videos").sortable({start:function(){
// On drag set that flag to true
e=!0},stop:function(){
// On stop of dragging reset the flag back to false
setTimeout(function(){e=!1},500)},placeholder:"ui-state-highlight",update:function(e,t){var i=[];a(".video","#videos").each(function(){a(this).data("token")&&(i[i.length]=a(this).data("token"))}),a.post(o,{ordering:i.join(",")})},forcePlaceholderSize:!0,create:function(){var e=this,t=function(){a(e).css("height","auto");
//$(list).height($(list).height());
};
// $(list).height($(list).height());
a(e).find("img").load(t).error(t)}}),a("#videos").disableSelection().find(".edit").click(function(){return e||(a("#edit_media_item").load(a(this).attr("href")+" #edit_media_item form",n),a("#media_item_overviews").hide(),a(".form-actions:last").hide()),!1}),a(window).trigger("scrollstop")})}),a("#media_item_overviews").show(),a(".form-actions:last").show()}function n(){a("select").not('[name*="__prefix__"]').selectbox(),a("textarea").autosize(),a("#submit-id-cancel").click(function(e){e.preventDefault(),a("#edit_media_item").html(""),i()}),a("#button-id-delete-video").click(function(){var e=a(this).data("href");a("#deleteConfirmation").removeClass("hide").modal("show"),a("#button-id-confirm-deletion").click(function(){return a.post(e,{},function(){a("#deleteConfirmation").modal("hide"),a("#edit_media_item").html(""),i()}),!1})}),a("#edit_media_item form").attr("target","hidden_iframe"),self.hidden_iframe_loaded=function(e){var t=a("<div>"+e+"</div>").find("form");t.length?(a("#edit_media_item").html("").append(t),n()):(a("#edit_media_item").html(""),i())}}function o(){var e=!1;a("#streamings").each(function(){var o=a(this).data("load-url");a(this).load(o+" #streamings>*",function(){a("#streamings").sortable({start:function(){
// On drag set that flag to true
e=!0},stop:function(){
// On stop of dragging reset the flag back to false
setTimeout(function(){e=!1},500)},placeholder:"ui-state-highlight",update:function(e,t){var i=[];a(".streaming","#streamings").each(function(){a(this).data("token")&&(i[i.length]=a(this).data("token"))}),a.post(o,{ordering:i.join(",")})},forcePlaceholderSize:!0,create:function(){var e=this,t=function(){a(e).css("height","auto");
//$(list).height($(list).height());
};
// $(list).height($(list).height());
a(e).find("img").load(t).error(t)}}),a("#streamings").disableSelection().find(".edit").click(function(){return e||(a("#edit_media_item").load(a(this).attr("href")+" #edit_media_item form",d),a("#media_item_overviews").hide(),a(".form-actions:last").hide()),!1}),a(window).trigger("scrollstop")})}),a("#media_item_overviews").show(),a(".form-actions:last").show()}function d(){a("select").not('[name*="__prefix__"]').selectbox(),a("textarea").autosize(),a("#submit-id-cancel").click(function(e){e.preventDefault(),a("#edit_media_item").html(""),o()}),a("#button-id-delete-streaming").click(function(){var e=a(this).data("href");a("#deleteConfirmation").removeClass("hide").modal("show"),a("#button-id-confirm-deletion").click(function(){return a.post(e,{},function(){a("#deleteConfirmation").modal("hide"),a("#edit_media_item").html(""),o()}),!1})}),a("#edit_media_item form").attr("target","hidden_iframe"),self.hidden_iframe_loaded=function(e){var t=a("<div>"+e+"</div>").find("form");t.length?(a("#edit_media_item").html("").append(t),d()):(a("#edit_media_item").html(""),o())}}function r(){lazyload_images();var e=!1;a("#photos").each(function(){var o=a(this).data("load-url");a(this).load(o+" #photos>*",function(){a("#photos").sortable({start:function(){
// On drag set that flag to true
e=!0},stop:function(){
// On stop of dragging reset the flag back to false
setTimeout(function(){e=!1},500)},placeholder:"ui-state-highlight",update:function(e,t){var i=[];a(".photo","#photos").each(function(){a(this).data("token")&&(i[i.length]=a(this).data("token"))}),a.post(o,{ordering:i.join(",")})},forcePlaceholderSize:!0,create:function(){var e=this,t=function(){a(e).css("height","auto");
//$(list).height($(list).height());
};
// $(list).height($(list).height());
a(e).find("img").load(t).error(t)}}),a("#photos").disableSelection().find(".edit").click(function(){return e||(a("#edit_media_item").load(a(this).attr("href")+" #edit_media_item form",s),a("#media_item_overviews").hide(),a(".form-actions:last").hide()),!1}),a("#photos").find(".crop").each(function(){a(this).attr("href")&&a(this).attr("href",a(this).attr("href").replace(/goto_next=.+$/gim,"goto_next="+location.href))}),a(window).trigger("scrollstop")})}),a("#media_item_overviews").show(),a(".form-actions:last").show()}function s(){if(a("select").not('[name*="__prefix__"]').selectbox(),a("textarea").autosize(),a("#submit-id-cancel").click(function(e){e.preventDefault(),a("#edit_media_item").html(""),r()}),a("#button-id-crop-photo").click(function(){location.href=a(this).data("href").replace(/goto_next=.+$/,"goto_next="+location.href)}),a("#button-id-delete-photo").click(function(){var e=a(this).data("href");a("#deleteConfirmation").removeClass("hide").modal("show"),a("#button-id-confirm-deletion").click(function(){return a.post(e,{},function(){a("#deleteConfirmation").modal("hide"),a("#edit_media_item").html(""),r()}),!1})}),a("#edit_media_item form").attr("target","hidden_iframe"),self.hidden_iframe_loaded=function(e){var t=a("<div>"+e+"</div>").find("form");t.length?(a("#edit_media_item").html("").append(t),s()):(a("#edit_media_item").html(""),r())},a("#image_uploader").length)var e=a.extend(translatable_file_uploader_options,{allowedExtensions:["gif","jpg","png"],action:"/"+self.settings.LANGUAGE_CODE+"/helper/ajax-upload/",element:a("#image_uploader")[0],multiple:!1,onComplete:function(e,t,i){i.success&&(a(".messages").html(""),
// set the original to media_file_path
a("#id_media_file_path").val(i.path),
// load the modified version for the preview
a.post("/"+self.settings.LANGUAGE_CODE+"/helper/modified-path/",{file_path:self.settings.MEDIA_URL+i.path,mod_sysname:"gallery_image"},function(e,t,i){a("#image_preview").html('<img class="img-responsive" alt="" src="'+e+'" />'),a("#image_uploader").hide(),a("#image_help_text").hide()},"text"))},onAllComplete:function(e){
// uploads is an array of maps
// the maps look like this: {file: FileObject, response: JSONServerResponse}
a(".qq-upload-success").fadeOut("slow",function(){a(this).remove()})},params:{csrf_token:a('input[name="csrfmiddlewaretoken"]').val(),csrf_name:"csrfmiddlewaretoken",csrf_xname:"X-CSRFToken"},showMessage:function(e){a(".messages").html('<div class="alert alert-danger">'+e+"</div>")}}),t=new qq.FileUploader(e)}function l(){var e=!1;a("#pdfs").each(function(){var o=a(this).data("load-url");a(this).load(o+" #pdfs>*",function(){a("#pdfs").sortable({start:function(){
// On drag set that flag to true
e=!0},stop:function(){
// On stop of dragging reset the flag back to false
setTimeout(function(){e=!1},500)},placeholder:"ui-state-highlight",update:function(e,t){var i=[];a(".pdf","#pdfs").each(function(){a(this).data("token")&&(i[i.length]=a(this).data("token"))}),a.post(o,{ordering:i.join(",")})},forcePlaceholderSize:!0,create:function(){var e=this,t=function(){a(e).css("height","auto");
//$(list).height($(list).height());
};
// $(list).height($(list).height());
a(e).find("img").load(t).error(t)}}),a("#pdfs").disableSelection().find(".edit").click(function(){return e||(a("#edit_media_item").load(a(this).attr("href")+" #edit_media_item form",m),a("#media_item_overviews").hide(),a(".form-actions:last").hide()),!1}),a(window).trigger("scrollstop")})}),a("#media_item_overviews").show(),a(".form-actions:last").show()}function m(){if(a("select").not('[name*="__prefix__"]').selectbox(),a("textarea").autosize(),a("#submit-id-cancel").click(function(e){e.preventDefault(),a("#edit_media_item").html(""),l()}),a("#button-id-delete-pdf").click(function(){var e=a(this).data("href");a("#deleteConfirmation").removeClass("hide").modal("show"),a("#button-id-confirm-deletion").click(function(){return a.post(e,{},function(){a("#deleteConfirmation").modal("hide"),a("#edit_media_item").html(""),l()}),!1})}),a("#edit_media_item form").attr("target","hidden_iframe"),self.hidden_iframe_loaded=function(e){var t=a("<div>"+e+"</div>").find("form");t.length?(a("#edit_media_item").html("").append(t),m()):(a("#edit_media_item").html(""),l())},a("#pdf_uploader").length)var e=a.extend(translatable_file_uploader_options,{allowedExtensions:["pdf"],action:"/"+self.settings.LANGUAGE_CODE+"/helper/ajax-upload/",element:a("#pdf_uploader")[0],multiple:!1,onComplete:function(e,t,i){i.success&&(a(".messages").html(""),
// set the original to media_file_path
a("#id_media_file_path").val(i.path),
// load the modified version for the preview
a.post("/"+self.settings.LANGUAGE_CODE+"/helper/modified-path/",{file_path:i.path,mod_sysname:"medium"},function(e,t,i){a("#pdf_preview").html('<img class="img-responsive" alt="" src="'+window.settings.STATIC_URL+'site/img/pdf.png" />'),a("#pdf_uploader").hide(),a("#pdf_help_text").hide()},"text"))},onAllComplete:function(e){
// uploads is an array of maps
// the maps look like this: {file: FileObject, response: JSONServerResponse}
a(".qq-upload-success").fadeOut("slow",function(){a(this).remove()})},params:{csrf_token:a('input[name="csrfmiddlewaretoken"]').val(),csrf_name:"csrfmiddlewaretoken",csrf_xname:"X-CSRFToken"},showMessage:function(e){a(".messages").html('<div class="alert alert-danger">'+e+"</div>")}}),t=new qq.FileUploader(e)}a("#add_video").click(function(){return a("#edit_media_item").load(a(this).attr("href")+" #edit_media_item form",n),a("#media_item_overviews").hide(),a(".form-actions:last").hide(),!1}),a("#add_streaming").click(function(){return a("#edit_media_item").load(a(this).attr("href")+" #edit_media_item form",d),a("#media_item_overviews").hide(),a(".form-actions:last").hide(),!1}),a("#add_photo").click(function(){return a("#edit_media_item").load(a(this).attr("href")+" #edit_media_item form",s),a("#media_item_overviews").hide(),a(".form-actions:last").hide(),!1}),a(document).on("click","#crop_list_image",function(){return location.href=a("#photos").find(".crop_list_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href),!1}),a(document).on("click","#crop_cover_image",function(){return location.href=a("#photos").find(".crop_cover_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href),!1}),a("#add_pdf").click(function(){return a("#edit_media_item").load(a(this).attr("href")+" #edit_media_item form",m),a("#media_item_overviews").hide(),a(".form-actions:last").hide(),!1}),a(function(){i(),o(),r(),l()})}(jQuery);