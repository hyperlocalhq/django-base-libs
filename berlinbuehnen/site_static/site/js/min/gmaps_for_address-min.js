!function($,e){function o(e,o,a){e.setDraggable(!0),google.maps.event.addListener(e,"dragend",function(){var t=e.getPosition();o(t.lat(),t.lng(),a)})}function a(e,o){var a=new google.maps.Geocoder;a.geocode({address:e},function(e,a){o(a===google.maps.GeocoderStatus.OK?e:!1)})}var t=window.gettext||function(e){return e},n,i,d,r,l=self.GMapManager={init:function(){var e=self.GMapManager,o=$(".gmap-wrapper").removeClass("hidden");if(o.length){$(".dyn_locate_geo").click(e.recognizeLocation),$(".dyn_remove_geo").click(e.removeGeoPos);var a=$('<div class="gmap">').prependTo(o),t={mapTypeControl:!1,zoomControl:!0,streetViewControl:!0,scrollwheel:!1,zoom:15,center:new google.maps.LatLng(52.523781,13.411895),mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},disableDoubleClickZoom:!0};n=new google.maps.Map(a.get(0),t),google.maps.event.addListener(n,"dblclick",function(o){$('[id^="id_"][id$="latitude"]').val(o.latLng.lat()),$('[id^="id_"][id$="longitude"]').val(o.latLng.lng()),e.adjustGeoposition()}),d=$('<ul class="gmap_locations">').appendTo(o).hide(),e.adjustGeoposition()}},recognizeLocation:function(){var e=self.GMapManager;a(e.getAddress4search(),e.autocompleteAddress)},removeGeoPos:function(){$('[id^="id_"][id$="latitude"]').val(""),$('[id^="id_"][id$="longitude"]').val(""),i&&i.setMap(null)},getAddress4search:function(){var e=[];return e.push($('[id^="id_"][id$="street_address"]').val()+" "+$('[id^="id_"][id$="street_address2"]').val()),e.push($('[id^="id_"][id$="city"]').val()),e.push("Germany"),e.push($('[id^="id_"][id$="postal_code"]').val()),e.join(", ")},adjustGeoposition:function(){var e=self.GMapManager,o=$('[id^="id_"][id$="latitude"]'),a=$('[id^="id_"][id$="longitude"]');o.val()&&a.val()&&e.markGeoposition(o.val(),a.val())},drawMarker:function(e){i=new google.maps.Marker({position:e,map:n})},markGeoposition:function(e,a){var t=self.GMapManager,d=new google.maps.LatLng(e,a);i&&(i.setMap(null),i=null),t.drawMarker(d),n.panTo(d,15),o(i,t.correctGeoposition,{bNoSuggest:!0})},correctGeoposition:function(e,o){e=Math.round(1e6*e)/1e6,o=Math.round(1e6*o)/1e6,$('[id^="id_"][id$="latitude"]').val(e),$('[id^="id_"][id$="longitude"]').val(o)},autocompleteAddress:function(e){function o(){var e=r[$(this).data("gmap_index")],o=e.address_components;l.extractFromXAL(o);var a=e.geometry.location,t=l.correctGeoposition(a.lat(),a.lng(),{});return t||l.markGeoposition(a.lat(),a.lng()),d.hide(),!1}r=e,d.html("");var a,n=e.length;if(r)if(n>1){for(a=0;n>a;a++)$('<a href="">'+e[a].formatted_address+"</a>").data("gmap_index",a).click(o).appendTo($("<li>").appendTo(d));$('<a href="">'+t("None of the listed")+"</a>").click(function(){return d.hide(),!1}).appendTo($("<li>").appendTo(d)),d.show()}else{d.hide();var i=r[0],s=i.address_components;l.extractFromXAL(s);var c=i.geometry.location,p=l.correctGeoposition(c.lat(),c.lng(),{});p||l.markGeoposition(c.lat(),c.lng())}},extractFromXAL:function(e){var o,a=e.length,t,n;for(o=0;a>o;o++){var i=e[o];switch(i.types[0]){case"locality":$('[id^="id_"][id$="city"]').val(i.long_name);break;case"street_number":n=i.long_name;break;case"route":t=i.long_name;break;case"postal_code":$('[id^="id_"][id$="postal_code"]').val(i.long_name);break;case"country":}}if(t){var d=t;n&&(d+=" "+n);var r=$('[id^="id_"][id$="street_address"]');r.val(d)}},destruct:function(){}};$(document).ready(function(){self.GMapManager.init()}),$(window).unload(function(){self.GMapManager.destruct()})}(jQuery);