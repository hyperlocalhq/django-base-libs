!function(){function t(t){var e=this;this.me=e,e.loading=!1,e.$main=t;var i=e.$main.attr("id").split("_",2);e.connect_id=i[0],e.date=null,e.$list=$("#"+e.connect_id+"_list"),e.$dateslider=$("#"+e.connect_id+"_dateslider"),e.reinit(),e.$suboptions.addClass("closed"),e.$main.data("filter",e)}function e(){$(".filter").each(function(){new t($(this))})}t.prototype.reinit=function(){if(this.me)var t=this.me;t.$options_wrapper=$(".filter-options-wrapper",t.$main),t.$search_wrapper=$(".filter-search-wrapper",t.$main),t.$set_wrapper=$(".filter-set-wrapper",t.$main),t.$options=$(".filter-option",t.$options_wrapper),t.$suboptions=$(".filter-suboptions",t.$options_wrapper),t.$singletons=$(".singleton",t.$options_wrapper),t.$options.click(function(){t.onOptionClicked($(this))}),$("a",t.$main).click(function(e){t.onLinkClicked(e)})},t.prototype.resetDate=function(t){if(this.me)var e=this.me;var i=t.getFullYear(),a=t.getMonth()+1,r=t.getDate();a<10&&(a="0"+a),r<10&&(r="0"+r);var s=i+"-"+a+"-"+r;e.date=s},t.prototype.onOptionClicked=function(t){if(this.me)var e=this.me;e.$options.removeClass("active"),t.addClass("active");var i=$(t.data("target"),e.$main);i.hasClass("closed")&&(e.$suboptions.addClass("closed"),i.removeClass("closed"))},t.prototype.onLinkClicked=function(t){if($(t.delegateTarget).hasClass("filter-option"))return location.href=$(t.delegateTarget).attr("href"),!0;if(this.me)var e=this.me;if(!e.$list.length)return!0;if(t.preventDefault(),e.loading)return!1;e.loading=!0;var i=$(t.target),a=i.attr("href");e.$list.jscroll.destroy&&e.$list.jscroll.destroy();var r=a.split("#",2);a=r[0],r=2==r.length?r=r[1]:"";var s=a.split("?",2);a=s[0],s=2==s.length?s[1].split("&"):"";for(var n={},l=0,o=s.length;l<o;l++){var p=s[l].split("=",2);n.hasOwnProperty(p[0])?("object"!=typeof n[p[0]]&&(n[p[0]]=[n[p[0]]]),n[p[0]].push(p[1])):n[p[0]]=p[1]}var d=i.closest(".filter-suboptions");if(d.length){var c=[],f=d.get(0),h=i.closest(".parent",f);h.length&&!h.hasClass("active")&&$(".child.active",d).each(function(){c.push($(this).data("value"))});var v=i.closest(".child",f);v.length&&!v.hasClass("active")&&$(".parent.active",d).each(function(){c.push($(this).data("value"))});for(var l=0,o=c.length;l<o;l++){var u=c[l].split("="),p=n[u[0]];if("object"==typeof p){for(var g=0;g<p.length;g++)if(p[g]==u[1]){p[g]="";break}}else p==u[1]&&(n[u[0]]="")}}n.reset&&($(".active",e.$suboptions).each(function(){i=$(this);var t=i.data("value").split("=");delete n[t[0]]}),e.$singletons.each(function(){if(i=$(this),i.hasClass("active")){var t=i.data("value").split("=");delete n[t[0]]}})),!e.date&&n.date&&(e.date=n.date),delete n.page,delete n.date,delete n.reset;var m="?";for(var p in n)if("object"==typeof n[p])for(var l=0,o=n[p].length;l<o;l++)""!==n[p][l]&&(m+=p+"="+n[p][l]+"&");else""!==n[p]&&(m+=p+"="+n[p]+"&");var b=m.substr(1,m.length-2);e.date&&(m+="date="+e.date+"&"),m=m.substr(0,m.length-1),a+=m,r&&(a+="#"+r);var C=function(t,i,a){if("error"==i){return alert("Error loading filtered list: "+a.status+" "+a.statusText),e.loading=!1,!1}for(var r=$(t),s=$("#"+e.$main.attr("id"),r),n=$(".filter-options-wrapper",s),l=$(".filter-option",n),o=$(".filter-suboptions",n),p=0,d=l.length;p<d;p++){var c=$(l.get(p)),f=$(e.$options.get(p));c.attr("class",f.attr("class"))}for(var p=0,d=o.length;p<d;p++){var c=$(o.get(p)),f=$(e.$suboptions.get(p));c.attr("class",f.attr("class"))}e.$main.html(s.html()),e.reinit(),e.$list.data("list").reinitByFilter(),e.$dateslider.length&&e.$dateslider.data("dateslider").reinitByFilter(b),e.loading=!1};""==a&&(a="?"),e.$list.load(a+" #"+e.connect_id+"_list",C)},$(document).ready(e)}();