var gettext=self.gettext||function(e){return e};!function($,e){self.reinit_maps=function(){$(".map_canvas").each(function(){function e(){var e=[],a=$('[id^="id_"][id$="street_address2"]',d).val();return a&&(a=" "+a),e.push($('[id^="id_"][id$="street_address"]',d).val()+a),e.push($('[id^="id_"][id$="city"]',d).val()),e.push($('[id^="id_"][id$="postal_code"]',d).val()),e.join(", ")}function a(e,a){var t=new google.maps.LatLng(e,a);l?l.setPosition(t):l=new google.maps.Marker({position:t,map:o}),o.panTo(t,15),l.setDraggable(!0),google.maps.event.addListener(l,"dragend",function(){var e=l.getPosition();i(e.lat(),e.lng())})}function i(e,a){e=Math.round(1e6*e)/1e6,a=Math.round(1e6*a)/1e6,$('[id^="id_"][id$="latitude"]',d).val(e),$('[id^="id_"][id$="longitude"]',d).val(a)}function t(e){var t=$(".map_locations",d).html(""),o,l=e.length;if(e)if(l>1){for(o=0;l>o;o++)$('<a href="">'+e[o].formatted_address+"</a>").data("gmap_index",o).click(function(d){d.preventDefault();var o=e[$(this).data("gmap_index")];n(o.address_components);var l=o.geometry.location;i(l.lat(),l.lng()),a(l.lat(),l.lng()),t.hide()}).appendTo($("<li>").appendTo(t));$('<a href="">'+gettext("None of the listed")+"</a>").click(function(e){e.preventDefault(),t.hide()}).appendTo($("<li>").appendTo(t)),t.show()}else{t.hide();var s=e[0];n(s.address_components);var r=s.geometry.location;i(r.lat(),r.lng()),a(r.lat(),r.lng())}}function n(e){var a,i=e.length,t,n;for(a=0;i>a;a++){var o=e[a],l=o.types[0];"locality"===l&&$('[id^="id_"][id$="city"]',d).val(o.long_name),"street_number"===l&&(n=o.long_name),"route"===l&&(t=o.long_name),"postal_code"===l&&$('[id^="id_"][id$="postal_code"]',d).val(o.long_name)}if(t){var s=t;n&&(s+=" "+n),$('[id^="id_"][id$="street_address"]',d).val(s)}}if(!$(this).data("initialized")){var d=$(this).closest("fieldset");if(-1===$('[id^="id_"][id$="latitude"]',d).attr("id").indexOf("__prefix__")){var o,l;$(".locate_address").click(function(){var a=new google.maps.Geocoder;a.geocode({address:e()},function(e,a){t(a===google.maps.GeocoderStatus.OK?e:!1)})}),$(".remove_geo").click(function(){$('[id^="id_"][id$="latitude"]',d).val(""),$('[id^="id_"][id$="longitude"]',d).val(""),l.setMap(null),l=null}),o=new google.maps.Map($(".map_canvas",d).get(0),{scrollwheel:!1,zoom:16,center:new google.maps.LatLng(52.523781,13.411895),disableDoubleClickZoom:!0}),google.maps.event.addListener(o,"dblclick",function(e){i(e.latLng.lat(),e.latLng.lng()),a(e.latLng.lat(),e.latLng.lng())}),$(".map_locations",d).hide();var s=$('[id^="id_"][id$="latitude"]',d),r=$('[id^="id_"][id$="longitude"]',d);s.val()&&r.val()&&a(s.val(),r.val()),$(this).data("initialized",!0),$(this).data("gmap",o)}}})},$(document).ready(self.reinit_maps)}(jQuery);