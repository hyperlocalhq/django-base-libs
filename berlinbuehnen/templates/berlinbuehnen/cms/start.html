{% extends "cms/default.html" %}
{% load base_tags cms_tags i18n image_modifications slideshows_tags production_tags favorites auth_extended infoblocks mailchimp_tags %}

{% block js %}
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/list.js" defer="defer"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/slider.js" defer="defer"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/date_slider.js" defer="defer"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/add_to_calender_1.5_atc.min.js" defer="defer"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/favorites.min.js" defer="defer"></script>
{% endblock %}

{% block location_login %}
    <li><a href="/{{ LANGUAGE_CODE }}/login/">{% trans "Login for Theaters" %}</a></li>
{% endblock %}

{% block content %}
    {% top_slideshow "start_page" %}
    <div class="content home">
        <div class="container">
            
            <div class="row main">
                <h1 class="bottom-line calender-headline">{% trans "Schedule" %}</h1>
                {% date_slider page='event_list' %}
                
                <!-- event list -->
                <div class="col-xs-12 print-padding">
                    {% get_objects published_upcoming productions.Event 4 as newest_events %}
                    <div id="main_list" class="list row print-small">
                        {% for event in newest_events %}
                            {% ifchanged event.start_date %}<h1 class="list-headline">{{ event.start_date|date:"D, j. F Y" }}</h1>{% endifchanged %}
                            <div class="list-item col-xs-12">
                                <div class="row">

                                    <!-- list item head (date and image) -->
                                    <div class="list-item-head col-xs-12 col-sm-5 col-md-4 col-lg-3">
                                        <div class="row">

                                            <!-- date -->
                                            <div class="list-item-head-date col-xs-12 col-sm-4">
                                                <div class="row">
                                                    <div class="list-item-head-date-day col-xs-3 col-sm-12">
                                                        {{ event.start_date|date:"D" }}
                                                    </div>
                                                    <div class="list-item-head-date-month col-xs-3 col-sm-12">
                                                        <span class="hidden-xs">{{ event.start_date|date:"j. F" }}</span>
                                                        <span class="visible-xs">{{ event.start_date|date:"j. M" }}</span>
                                                    </div>
                                                    <div class="list-item-head-date-type col-xs-3 col-sm-12">
                                                        {% if event.production.get_categories %}
                                                            {{ event.production.get_categories.0.title }}
                                                        {% endif %}
                                                    </div>
                                                    <div class="list-item-head-date-time col-xs-3 col-sm-12">
                                                        {{ event.start_time|time:"H:i" }}
                                                    </div>
                                                    <div class="list-item-head-date-icons col-xs-3 col-sm-12">
                                                        {% if request.user.is_authenticated %}
                                                            {% adding2favorites for event using "favorites/includes/favorite_detail.html" %}
                                                        {% endif %}
                                                        {% add_to_calender event=event %}
                                                        {% if event.ev_or_prod_tickets_website %}
                                                            <a class="fawesome tickets" href="{{ event.ev_or_prod_tickets_website }}" target="_blank"></a>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- image -->
                                            <div class="list-item-head-image img hidden-xs col-sm-8">
                                                {% if event.first_image %}
                                                    <img src="{{ MEDIA_URL }}{{ event.first_image.path|modified_path:"list_image" }}{% if_has_perm "events.change_event" event %}?now={% now "YmdHis" %}{% end_if_has_perm %}" alt="" />
                                                {% elif event.ev_or_prod_images %}
                                                    {% with event.ev_or_prod_images|first as image %}
                                                        <img src="{{ MEDIA_URL }}{{ image.path|modified_path:"list_image" }}{% if_has_perm "events.change_event" event %}?now={% now "YmdHis" %}{% end_if_has_perm %}" alt="" />
                                                    {% endwith %}
                                                {% else %}
                                                    <img src="{{ STATIC_URL }}site/img/placeholder_event.png" />
                                                {% endif %}
                                            </div>

                                        </div>
                                    </div>

                                    <!-- list item body -->
                                    <div class="list-item-body col-xs-12 col-sm-7 col-md-8 col-lg-9">
                                        <a class="list-item-link" href="{{ event.get_url_path }}">
                                            {% if event.production.in_program_of.exists or event.location_title or event.production.location_title or event.ev_or_prod_play_locations|length > 0 or event.ev_or_prod_play_stages|length > 0 %}
                                                <dl>
                                                    {% with event.get_festivals as festivals %}
                                                        {% if festivals %}
                                                            <dd class="festivals">
                                                                {% for festival in festivals %}
                                                                    <span class="festival" data-url="{{ festival.get_url_path }}">{% if forloop.counter == 1 %}{% trans "Festival" %}: {% endif %}{{ festival.title }}</span>
                                                                {% endfor %}
                                                            </dd>
                                                        {% endif %}
                                                    {% endwith %}
                                                    {% if event.production.in_program_of.exists %}
                                                        {% for location in event.production.in_program_of.all %}
                                                            <dd>
                                                                {{ location.title }}
                                                            </dd>
                                                        {% endfor %}
                                                    {% endif %}
                                                    {% if event.location_title %}
                                                        <dd>
                                                            {{ event.location_title }}
                                                        </dd>
                                                    {% elif event.production.location_title %}
                                                        <dd>
                                                            {{ event.production.location_title }}
                                                        </dd>
                                                    {% endif %}
                                                    {% for location in event.ev_or_prod_play_locations %}
                                                        <dd>
                                                            {{ location.title }}
                                                        </dd>
                                                    {% endfor %}
                                                    {% for stage in event.ev_or_prod_play_stages %}
                                                        <dd>
                                                            {{ stage.title }}
                                                        </dd>
                                                    {% endfor %}
                                                </dl>
                                            {% endif %}
                                            {% if event.production.prefix %}<h4>{{ event.production.prefix }}</h4>{% endif %}
                                            {% if event.production.title %}<h2>{{ event.production.title }}</h2>{% endif %}
                                            {% if event.production.subtitle %}<h3>{{ event.production.subtitle }}</h3>
                                            {% elif event.ev_or_prod_subtitles_text %}<h3>{{ event.ev_or_prod_subtitles_text }}</h3>{% endif %}
                                            {% if event.production.original %}<h3>{{ event.production.original }}</h3>{% endif %}
                                            {% if event.ev_or_prod_teaser %}<div class="copy"><p>{{ event.ev_or_prod_teaser }}</p></div>{% endif %}
                                            {% if event.get_special_text %}<div class="extra"><span>{{ event.get_special_text }}</span></div>{% endif %}
                                        </a>
                                    </div>

                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="more-date"><a href="{% url 'event_list' %}" class="fawesome more">{% trans "more dates" %}</a></div>
                </div>
            </div>
            
            <div class="row info">
                
                <!-- news -->
                <div class="col-xs-12 col-sm-6 col-md-8 news">
                    <h1 class="bottom-line">{% trans "News" %}</h1>
                    <div class="row">
                        
                        <!-- NEWS -->
                        {% get_objects objects.latest_published theater_of_the_week.TheaterOfTheWeek 1 as newest_theater %}
                        {% for article in newest_theater %}
                            <div class="col-xs-12 col-md-6 news-item">
                                <a href="{% url 'theater_of_the_week' %}">
                                    <h3>{% trans "Theater of the week" %}</h3>
                                    {% if article.image %}
                                        <div class="img"><img src="{{ STATIC_URL }}site/img/placeholder_rectangle.gif" data-original="{{ MEDIA_URL }}{{ article.image.path|modified_path:"news_image"  }}" alt="{{ article.image_description|escape }}" /></div> 
                                    {% elif article.theater.cover_image %}
                                        <div class="img"><img src="{{ STATIC_URL }}site/img/placeholder_rectangle.gif" data-original="{{ MEDIA_URL }}{{article.theater.cover_image.path|modified_path:"news_image"  }}" alt="{% trans "Theater of the week" %}" /></div>
                                    {% elif article.theater.image_set.exists %}
                                        {% with article.theater.image_set.all|first as first %}
                                            <div class="img"><img src="{{ STATIC_URL }}site/img/placeholder_rectangle.gif" data-original="{{ MEDIA_URL }}{{first.path|modified_path:"news_image"  }}" alt="{% trans "Theater of the week" %}" /></div>
                                        {% endwith %}
                                    {% endif %}
                                    <h2>{% if article.short_title %}{{ article.short_title }}{% else %}{{ article.title }}{% endif %}</h2>
                                    <p>
                                        {% if article.description %}
                                            {{ article.get_rendered_description|striptags }}
                                        {% else %}
                                            {{ article.get_rendered_content|striptags|wordwrap:30|truncatewords:"25" }}
                                        {% endif %}
                                    </p>
                                    <p class="more fawesome">{% trans "read on" %}</p>
                                </a>
                            </div>
                        {% endfor %}
                        
                        {% get_objects objects.latest_published articles.Article 3 as newest_articles %}
                        {% for article in newest_articles %}
                            <div class="col-xs-12 col-md-6 news-item">
                                <a href="{{ article.get_url_path }}">
                                    <h3>{% if article.category.title %}{{ article.category.title }}{% else %}{% trans "News" %}{% endif %}</h3>
                                    {% if article.image %}
                                        <div class="img"><img src="{{ STATIC_URL }}site/img/placeholder_rectangle.gif" data-original="{{ MEDIA_URL }}{{ article.image.path|modified_path:"news_image"  }}" alt="{{ article.image_description|escape }}" /></div> 
                                    {% endif %}
                                    <h2>{% if article.short_title %}{{ article.short_title }}{% else %}{{ article.title }}{% endif %}</h2>
                                    <p>
                                        {% if article.description %}
                                            {{ article.get_rendered_description|striptags }}
                                        {% else %}
                                            {{ article.get_rendered_content|striptags|wordwrap:30|truncatewords:"25" }}
                                        {% endif %}
                                    </p>
                                    <p class="more fawesome">{% trans "read on" %}</p>
                                </a>
                            </div>
                            {% if newest_theater|length > 0 %}
                                {% if not forloop.counter|divisibleby:2 %}
                                    <div class="clearfix"></div>
                                {% endif %}
                            {% else %}
                                {% if forloop.counter|divisibleby:2 %}
                                    <div class="clearfix"></div>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        
                        <div class="clearfix"></div>
                        
                        <!-- BLOG -->
                        {% get_objects published_objects.all blog.Post 2 as newest_posts %}
                        {% for post in newest_posts %}
                            <div class="col-xs-12 col-md-6 news-item">
                                <h3>{% trans "Blog" %}</h3>
                                {% if post.image %}
                                    <div class="img"><img src="{{ STATIC_URL }}site/img/placeholder_rectangle.gif" data-original="{{ MEDIA_URL }}{{ post.image.path|modified_path:"news_image"  }}" alt="{{ article.image_description|escape }}" /></div> 
                                {% endif %}
                                <h2>{{ post.title }}</h2>
                                <p>{{ post.get_rendered_body }}</p>
                                <a class="more fawesome" href="{{ post.get_url_path }}" >{% trans "read on" %}</a>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Ads -->
                <div class="col-xs-12 col-sm-6 col-md-4 ads">

                    {% load advertising_tags %}
                    {% if "start_page"|not_empty_ad_zone %}
                        <h1 class="bottom-line">{% trans "Ad" %}</h1>
                        {% random_zone_ad "start_page" %}
                    {% endif %}
                    {#% infoblock "start_page_ad" %#}
                    {% subscribe %}
                </div>
                
            </div>
                
                
        </div>
    </div>

    <div class="twitter_wrapper">
        <div class="twitter_icon fawesome twitter"></div>
        <div class="container">
            <div id="twitter-tweets" data-twitter-username="berlinbuehnen" class="row"></div>
        </div>
         <script src="{{ STATIC_URL }}site/js/twitter.min.js"></script>
    </div>

{% endblock %}