{% extends "base.html" %}
{% load url from future %}
{% load i18n image_modifications base_tags tagging_tags production_tags favorites auth_extended %}
{% block title %}{% trans "Events" %} - {% endblock %}
{% block bodyclass %}event-list no-transition{% endblock %}


{% block js %}
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/list.js" defer="defer"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/list_filter.js" defer="defer"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/date_slider.js" defer="defer"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/favorites.js" defer="defer"></script>
{% endblock %}

{% block content %}
    <div class="content overview">
        <div class="filter-wrapper">
            <div class="container">
                <button class="filter-button fawesome down pull-right" data-toggle="collapse" data-target="#main_filter">
                    <span class="sr-only">{% trans "open filter" %}</span>
                </button>
            </div>
            <div class="filter-space">
                <div id="main_filter" class="filter container relative collapse in">
                    <button class="filter-button fawesome up pull-right" data-toggle="collapse" data-target="#main_filter">
                        <span class="sr-only">{% trans "close filter" %}</span>
                    </button>
                    <div class="row">
                        
                        <!-- filters -->
                        <div class="filter-options-wrapper col-xs-12 col-md-9 col-lg-10">
                            <h4>{%trans "Filter" %}:</h4>
                            {% include "utils/filter_events.html" %}
                        </div>
                        
                        <!-- search -->
                        <div class="filter-search-wrapper col-xs-12 col-md-3 col-lg-2">
                            &nbsp;
                        </div>
                        
                        <div class="clearfix"></div>
                        
                        <!-- filter sets -->
                        {% if facets.selected.abc or facets.selected.categories or facets.selected.subcategories or language_and_subtitles or production_characteristics or event_characteristics or facets.selected.locations %}
                            <div class="filter-set-wrapper col-xs-12">
                                <ul class="filter-set">
                                    <li>{% trans "Current selection" %}:</li>
                                    {% comment %}{% if facets.selected.abc %}
                                        {% for cat in facets.selected.abc %}
                                            <li><a class="fawesome delete" href="{% remove_from_query "page" abc=cat %}">{{ cat }}</a></li>
                                        {% endfor %}
                                    {% endif %}{% endcomment %}
                                    {% if facets.selected.categories %}
                                        {% for cat in facets.selected.categories %}
                                            <li><a class="fawesome delete" href="{% remove_from_query "page" categories=cat.pk %}">{{ cat.title }}</a></li>
                                        {% endfor %}
                                    {% endif %}
                                    {% if facets.selected.subcategories %}
                                        {% for cat in facets.selected.subcategories %}
                                            <li><a class="fawesome delete" href="{% remove_from_query "page" subcategories=cat.pk %}">{{ cat.title }}</a></li>
                                        {% endfor %}
                                    {% endif %}
                                    {% if facets.selected.language_and_subtitles %}
                                        {% for cat in facets.selected.language_and_subtitles %}
                                            <li><a class="fawesome delete" href="{% remove_from_query "page" language_and_subtitles=cat.pk %}">{{ cat.title }}</a></li>
                                        {% endfor %}
                                    {% endif %}
                                    {% if facets.selected.production_characteristics %}
                                        {% for cat in facets.selected.production_characteristics %}
                                            <li><a class="fawesome delete" href="{% remove_from_query "page" production_characteristics=cat.pk %}">{{ cat.title }}</a></li>
                                        {% endfor %}
                                    {% endif %}
                                    {% if facets.selected.event_characteristics %}
                                        {% for cat in facets.selected.event_characteristics %}
                                            <li><a class="fawesome delete" href="{% remove_from_query "page" event_characteristics=cat.pk %}">{{ cat.title }}</a></li>
                                        {% endfor %}
                                    {% endif %}
                                    {% if facets.selected.locations %}
                                        {% for cat in facets.selected.locations %}
                                            <li><a class="fawesome delete" href="{% remove_from_query "page" locations=cat.pk %}">{{ cat.title }}</a></li>
                                        {% endfor %}
                                    {% endif %}
                                </ul>
                                <a class="filter-reset-button fawesome more" href="{% add_to_query "page" reset=1 %}">{% trans "Reset filter" %}</a>
                            </div>
                        {% endif %}
                            
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <div class="row">
                
                <h1 class="bottom-line">{% trans "Schedule" %}</h1>
                {% date_slider page='event_list' id='main_dateslider' active=facets.selected.date %}
                
                <div class="col-xs-12">
                    
                    <!-- the list -->
                    <div id="main_list" class="list list-autoload row">
                        {% if object_list %}
                            {% for event in object_list %}
                                {% ifchanged event.start_date %}<h1 class="list-headline">{{ event.start_date|date:"D, j. F Y" }}</h1>{% endifchanged %}
                                <div class="list-item col-xs-12">
                                    <div class="row">
                                        
                                        <!-- list item head (date and image) -->
                                        <div class="list-item-head col-xs-12 col-sm-5 col-md-4 col-lg-3">
                                            <div class="row">
                                                
                                                <!-- date -->
                                                <div class="list-item-head-date col-xs-12 col-sm-4">
                                                    <div class="row">
                                                        <div class="list-item-head-date-day col-xs-3 col-sm-12">
                                                            {{ event.start_date|date:"D" }}
                                                        </div>
                                                        <div class="list-item-head-date-month col-xs-3 col-sm-12">
                                                            <span class="hidden-xs">{{ event.start_date|date:"j. F" }}</span>
                                                            <span class="visible-xs">{{ event.start_date|date:"j. M" }}</span>
                                                        </div>
                                                        <div class="list-item-head-date-type col-xs-3 col-sm-12">
                                                            {% if event.production.get_categories %}
                                                                {{ event.production.get_categories.0.title }}
                                                            {% endif %}
                                                        </div>
                                                        <div class="list-item-head-date-time col-xs-3 col-sm-12">
                                                            {{ event.start_time|time:"H:i" }}
                                                        </div>
                                                        <div class="list-item-head-date-icons col-xs-3 col-sm-12">
                                                            {% if event.ev_or_prod_tickets_website %}
                                                                <a class="fawesome tickets" href="{{ event.ev_or_prod_tickets_website }}" target="_blank"></a>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- image -->
                                                <div class="list-item-head-image img hidden-xs col-sm-8">
                                                    {% if event.cover_image %}
                                                        <img src="{{ MEDIA_URL }}{{ event.cover_image|modified_path:"list_image" }}{% if_has_perm "events.change_event" event %}?now={% now "YmdHis" %}{% end_if_has_perm %}" alt="{{ event.production.title|escape }}" />
                                                    {% elif event.ev_or_prod_images %}
                                                        {% with event.ev_or_prod_images|first as image %}
                                                            <img src="{{ MEDIA_URL }}{{ image.path|modified_path:"list_image" }}{% if_has_perm "events.change_event" event %}?now={% now "YmdHis" %}{% end_if_has_perm %}" alt="{{ event.production.title|escape }}" />
                                                        {% endwith %}
                                                    {% else %}
                                                        <img src="{{ STATIC_URL }}site/img/placeholder_event.png" />
                                                    {% endif %}
                                                </div>
                                                
                                            </div>
                                        </div>
                                        
                                        <!-- list item body -->
                                        <div class="list-item-body col-xs-12 col-sm-7 col-md-8 col-lg-9">
                                            <a class="list-item-link" href="{{ event.get_url_path }}">
                                                {% if event.production.in_program_of.exists or event.location_title or event.ev_or_prod_play_locations %}
                                                    <dl>
                                                        {% if event.production.in_program_of.exists %}
                                                            {% for location in event.production.in_program_of.all %}
                                                                <dd>
                                                                    {{ location.title }}
                                                                </dd>
                                                            {% endfor %}
                                                        {% endif %}
                                                        {% if event.location_title %}
                                                            <dd">
                                                                {{ event.location_title }}
                                                            </dd>
                                                        {% endif %}
                                                        {% for location in event.ev_or_prod_play_locations %}
                                                            <dd>
                                                                {{ location.title }}
                                                            </dd>
                                                        {% endfor %}
                                                    </dl>
                                                {% endif %}
                                                {% if event.production.title %}<h2>{% if event.production.prefix %}{{ event.production.prefix }} {% endif %}{{ event.production.title }}</h2>{% endif %}
                                                {% if event.production.subtitle %}<h3>{{ event.production.subtitle }}</h3>
                                                {% elif event.ev_or_prod_subtitles_text %}<h3>{{ event.ev_or_prod_subtitles_text }}</h3>{% endif %}
                                                {% if event.production.original %}<h3>{{ event.production.original }}</h3>{% endif %}
                                                {% if event.ev_or_prod_teaser %}<div class="copy"><p>{{ event.ev_or_prod_teaser }}</p></div>{% endif %}
                                                {% if event.get_special_text %}<div class="extra"><span>{{ event.get_special_text }}</span></div>{% endif %}
                                            </a>
                                        </div>
                                        
                                    </div>
                                </div>
                            {% endfor %}
                                {% include "utils/pagination.html" %}
                        {% else %}
                            {% include "utils/container_empty.html" %}
                        {% endif %}
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
{% endblock %}