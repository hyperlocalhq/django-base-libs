{% extends "base.html" %}
{% load base_tags i18n fb_tags image_modifications tagging_tags babel auth_extended fb_tags infoblocks favorites production_tags %}
{% block title %}{% trans "Event" %} – {{ object.production.title }} – {% endblock %}
{% block bodyclass %}event-detail{% endblock %}

{% block open_graph %}
    <meta property="og:title" content="{{ object.title }}" />
    <meta property="og:type" content="article" />
    {% if object.image %}
        <meta property="og:image" content="{{ current_website_url }}{{ MEDIA_URL }}{{ object.image|modified_path:"og" }}" />
    {% else %}
        <meta property="og:image" content="{{ current_website_url }}{{ STATIC_URL }}site/img/berlinbuehnen_opengraph.png" />
    {% endif %}
    <meta property="og:url" content="{{ object.get_url }}" />
    <meta property="og:site_name" content="Berlin Bühnen" />
    <meta property="og:description" content="{{ object.get_rendered_description|striptags|truncatewords:20|escape }}" />
{% endblock %}

{% block js %}
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/accordion.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/gallery.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}site/js/slider.js"></script>
    <script type="text/javascript">
    
        $(document).ready(function() {
        
            $('a.more-dates').click(function() {
            
                var $this = $(this);
            
                $('li.more-dates').css('display', 'block');
                $this.css('display', 'none');
                $('a.less-dates').css('display', 'inline-block');
                
                var $accordion = $this.closest('.accordion');
                $accordion.data('accordion').initHeights();
            });
        
            $('a.less-dates').click(function() {
            
                var $this = $(this);
                
                $('li.more-dates').css('display', 'none');
                $this.css('display', 'none');
                $('a.more-dates').css('display', 'inline-block');
                
                var $accordion = $this.closest('.accordion');
                $accordion.data('accordion').initHeights();
            });
        
        });
        
    </script>
{% endblock %}

{% block content %}
    {% with object as event %}
        <div id="event" class="content details">
            <div class="container">
                <div class="row">
                    <div class="col-xs-12">
                        <a class="fawesome back uc" href="{% url 'event_list' %}">{% trans "back to overview" %}</a>
                        <article>
                            
                            <!-- headlines -->
                            <header>
                                <ul class="header-top">
                                    {% if event.start_date or event.start_time %}
                                        <li><time>{{ event.start_date|date:"l, j. F Y" }}{{ event.start_time|time:", H:i" }}</time></li>
                                    {% endif %}
                                    {% if event.production.in_program_of.exists or event.location_title or event.ev_or_prod_play_locations %}
                                            <li>
                                                <dl>
                                                    {% if event.production.in_program_of.exists %}
                                                        {% for location in event.production.in_program_of.all %}
                                                            <dd>
                                                                {{ location.title }}
                                                            </dd>
                                                        {% endfor %}
                                                    {% endif %}
                                                    {% if event.location_title %}
                                                        <dd>
                                                            {{ event.location_title }}
                                                        </dd>
                                                    {% endif %}
                                                    {% for location in event.ev_or_prod_play_locations %}
                                                        <dd>
                                                            {{ location.title }}
                                                        </dd>
                                                    {% endfor %}
                                                </dl>
                                            </li>
                                    {% endif %}
                                </ul>
                                {% if event.production.ensembles %}<h3>{{ event.production.ensembles }}</h3>{% endif %}
                                <h1>{% if event.production.prefix %}{{ event.production.prefix }} {% endif %}{{ event.production.title }}
                                    {% if_has_perm "productions.change_production" object %}
                                        {% if not request.is_mobile %}
                                            <span class="cms_edit"><a class="icon icon-pencil" data-toggle="tooltip" data-placement="bottom" data-original-title="{% trans "Edit" %}" href="{% url "change_production" slug=event.production.slug %}">&nbsp;<span class="sr-only">{% trans "Edit" %}</span></a></span>
                                        {% endif %}
                                    {% end_if_has_perm %}
                                </h1>
                                {% if event.production.subtitle %}
                                    <h2>{{ event.production.subtitle }}</h2>
                                {% elif event.ev_or_prod_subtitles_text %}
                                    <h2>{{ event.ev_or_prod_subtitles_text|disarm_user_input }}</h2>
                                {% endif %}
                                {% if event.production.original %}<h2>{{ event.production.original }}</h2>{% endif %}
                            </header>
                            
                            <!-- main  part (including sidebar) -->
                            <div class="main">
                                <div class="container">
                                    <div class="row">
                                        
                                        <!-- main content -->
                                        <div class="col-xs-12 col-md-8 left">
                                            {% if event.cover_image %}
                                                <div class="top-image img"><img src="{{ STATIC_URL }}site/img/placeholder_rectangle.gif" data-original="{{ MEDIA_URL }}{{ event.cover_image.path|modified_path:"detail_image" }}" alt="{{ event.production.title|escape }}"  /></div> 
                                            {% elif event.ev_or_prod_images %}
                                                {% with event.ev_or_prod_images|first as first %}
                                                    <div class="top-image img"><img src="{{ STATIC_URL }}site/img/placeholder_rectangle.gif" data-original="{{ MEDIA_URL }}{{ first.path|modified_path:"detail_image" }}" alt="{{ event.production.title|escape }}"  /></div> 
                                                {% endwith %}
                                            {% endif %}
                                            <div class="description">
                                                {% if event.ev_or_prod_teaser %}{{ event.ev_or_prod_teaser }}{% endif %}
                                                {{ event.ev_or_prod_description }}
                                            </div>
                                            {% if event.production.language_and_subtitles or event.humanized_duration or event.ev_or_prod_duration_text or event.pauses or event.production.website %}
                                                <dl class="listing">
                                                    {% if event.production.language_and_subtitles %}
                                                        <dt>{% trans "Language" %}</dt>
                                                        <dd>{{ event.production.language_and_subtitles }}</dd>
                                                    {% endif %}
                                                    {% if event.humanized_duration or event.ev_or_prod_duration_text %}
                                                        <dt>{% trans "Duration" %}</dt>
                                                        <dd>
                                                            {% if event.humanized_duration %}{{ event.humanized_duration }}{% endif %}
                                                            {% if event.ev_or_prod_duration_text %}{{ event.ev_or_prod_duration_text }}{% endif %}
                                                        </dd>
                                                    {% endif %}
                                                    {% if event.pauses %}
                                                        <dt>{% trans "Pauses" %}</dt>
                                                        <dd>{{ event.pauses }}</dd>
                                                    {% endif %}
                                                    {% if event.production.website %}
                                                        <dt>{% trans "Web" %}</dt>
                                                        <dd><a href="{{ event.production.website }}" target="_blank">{{ event.production.website }}</a></dd>
                                                    {% endif %}
                                                </dl>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- main sidebar -->
                                        <div class="col-xs-12 col-md-4 right">
                                            <div class="accordion sidebar-accordion">
                                                <div class="accordion-item">
                                                    <h4 class="accordion-item-head open">{% trans "Dates" %}</h4>
                                                    <div class="accordion-item-content">
                                                        {% if event.production.get_upcoming_occurrences %}
                                                            <ul class="dates">
                                                                {% for ev in event.production.get_upcoming_occurrences %}
                                                                    <li class="{% if forloop.counter0 < 6 or ev == event %}first-dates{% else %}more-dates{% endif %}">
                                                                        {% if ev == event %}
                                                                            <span class="date-wrapper"><span class="date">{{ ev.start_date|date:"j. M Y" }}</span></span><span class="time-wrapper"><span class="time">{{ ev.start_time|time:"H:i" }}</span></span>
                                                                        {% else %}
                                                                            <a class="black" href="{% url "event_detail" slug=ev.production.slug event_id=ev.id %}"><span class="date-wrapper"><span class="date">{{ ev.start_date|date:"j. M Y" }}</span></span><span class="time-wrapper"><span class="time">{{ ev.start_time|time:"H:i" }}</span></span></a>
                                                                        {% endif %}
                                                                        {% if ev.ev_or_prod_tickets_website %}
                                                                            <span class="tickets-wrapper"><a class="fawesome tickets" href="{{ ev.ev_or_prod_tickets_website }}" target="_blank"></a></span>
                                                                        {% endif %}
                                                                        {% if ev.get_special_text %}
                                                                            <span class="extra"><span>{{ ev.get_special_text }}</span></span>
                                                                        {% endif %}
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                            {% if event.production.get_upcoming_occurrences|length > 6 %}
                                                                <a href="javascript:void(null);" class="fawesome more more-dates">{% trans "more dates" %}</a>
                                                                <a href="javascript:void(null);" class="fawesome back less-dates">{% trans "less dates" %}</a>
                                                            {% endif %}
                                                        {% else %}
                                                            <p>{% trans "No dates found" %}</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                {% with locations=event.ev_or_prod_play_locations stages=event.ev_or_prod_play_stages %}
                                                    {% if event.production.in_program_of.exists or event.location_title or event.production.location_title or locations or stages %}
                                                        <div class="accordion-item">
                                                            <h4 class="accordion-item-head open">{% trans "Venue" %}</h4>
                                                            <div class="accordion-item-content">
                                                                {% if event.production.in_program_of.exists %}
                                                                    {% for location in event.production.in_program_of.all %}
                                                                        <a class="black block" href="{{ location.get_url_path }}" data-latitude="{{ location.latitude|stringformat:"%f" }}" data-longitude="{{ location.longitude|stringformat:"%f" }}">
                                                                            <strong>{{ location.title }}</strong><br />
                                                                            {% if location.street_address %}{{ location.street_address }}<br />{% endif %}
                                                                            {% if location.street_address2 %}{{ location.street_address2 }}<br />{% endif %}
                                                                            {% if location.city %}{{ location.postal_code }} {{ location.city }}<br />{% endif %}
                                                                        </a>
                                                                    {% endfor %}
                                                                    {% if not stages %}
                                                                        {% if event.location_title or event.production.location_title or locations %}
                                                                            <h5>{% trans "Stage" %}:</h5>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% endif %}
                                                                {% if event.location_title %}
                                                                    <p data-latitude="{{ event.latitude|stringformat:"%f" }}" data-longitude="{{ event.longitude|stringformat:"%f" }}">
                                                                        <strong>{{ event.location_title }}</strong><br />
                                                                        {% if event.street_address %}{{ event.street_address }}<br />{% endif %}
                                                                        {% if event.street_address2 %}{{ event.street_address2 }}<br />{% endif %}
                                                                        {% if event.city %}{{ event.postal_code }} {{ event.city }}<br />{% endif %}
                                                                    </p>
                                                                {% elif event.production.location_title %}
                                                                    <p data-latitude="{{ event.production.latitude|stringformat:"%f" }}" data-longitude="{{ event.production.longitude|stringformat:"%f" }}">
                                                                        <strong>{{ event.production.location_title }}</strong><br />
                                                                        {% if event.production.street_address %}{{ event.production.street_address }}<br />{% endif %}
                                                                        {% if event.production.street_address2 %}{{ event.production.street_address2 }}<br />{% endif %}
                                                                        {% if event.production.city %}{{ event.production.postal_code }} {{ event.production.city }}<br />{% endif %}
                                                                    </p>
                                                                {% endif %}
                                                                {% for location in locations %}
                                                                    <a class="black block" href="{{ location.get_url_path }}" data-latitude="{{ location.latitude|stringformat:"%f" }}" data-longitude="{{ location.longitude|stringformat:"%f" }}">
                                                                        <strong>{{ location.title }}</strong><br />
                                                                        {% if location.street_address %}{{ location.street_address }}<br />{% endif %}
                                                                        {% if location.street_address2 %}{{ location.street_address2 }}<br />{% endif %}
                                                                        {% if location.city %}{{ location.postal_code }} {{ location.city }}<br />{% endif %}
                                                                    </a>
                                                                {% endfor %}
                                                                {% if stages %}
                                                                    {% if event.production.in_program_of.exists or event.location_title or event.production.location_title or locations %}
                                                                        <h5>{% trans "Stage" %}:</h5>
                                                                    {% endif %}
                                                                {% endif %}
                                                                {% for stage in stages %}
                                                                    <p data-latitude="{{ stage.latitude|stringformat:"%f" }}" data-longitude="{{ stage.longitude|stringformat:"%f" }}">
                                                                        <strong>{{ stage.title }}</strong><br />
                                                                        {% if stage.street_address %}{{ stage.street_address }}<br />{% endif %}
                                                                        {% if stage.street_address2 %}{{ stage.street_address2 }}<br />{% endif %}
                                                                        {% if stage.city %}{{ stage.postal_code }} {{ stage.city }}<br />{% endif %}
                                                                    </p>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                {% endwith %}
                                                {% if event.characteristics.exists or event.production.characteristics.exists or event.get_rendered_other_characteristics %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head open">{% trans "Characteristics" %}</h4>
                                                        <div class="accordion-item-content">
                                                            <p>
                                                                {% for ch in event.characteristics.all %}
                                                                    {{ ch.title }}<br/>
                                                                {% endfor %}
                                                                {% for ch in event.production.characteristics.all %}
                                                                    {{ ch.title }}<br/>
                                                                {% endfor %}
                                                                {{ event.get_rendered_other_characteristics }}
                                                            </p>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.production.get_categories %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head open">{% trans "Categories" %}</h4>
                                                        <div class="accordion-item-content">
                                                            <p>
                                                                {% for cat in event.production.get_categories %}
                                                                    {{ cat.title }}<br/>
                                                                {% endfor %}
                                                            </p>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ticket_status or event.ev_or_prod_free_entrance or event.ev_or_prod_price_from or event.ev_or_prod_price_information %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Tickets" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {% if event.ticket_status %}
                                                                <p>{{ event.get_ticket_status_display }}<p>
                                                            {% endif %}
                                                            {% if event.ev_or_prod_free_entrance %}
                                                                <p>{% trans "Free entrance" %}</p>
                                                            {% else %}
                                                                <p>
                                                                    {% if event.ev_or_prod_price_from %}
                                                                        {{ event.ev_or_prod_price_from }} EUR
                                                                    {% endif %}
                                                                    {% if event.ev_or_prod_price_till %}
                                                                        - {{ event.ev_or_prod_price_till }} EUR
                                                                    {% endif %}
                                                                    {% if event.ev_or_prod_price_information %}
                                                                        {{ event.ev_or_prod_price_information }}
                                                                    {% endif %}
                                                                </p>
                                                                {% if event.ev_or_prod_tickets_website %}
                                                                    <p><a class="fawesome tickets tickets-link" href="{{ event.ev_or_prod_tickets_website }}" target="_blank">{% trans "Buy tickets" %}</a></p>
                                                                {% endif %}
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% with event.ev_or_prod_play_locations|first as location %}
                                                    {% if location %}
                                                        {% if location.tickets_street_address or location.get_opening_hours or location.tickets_phone_number or location.tickets_fax_number or location.tickets_email or location.tickets_website %}
                                                            <div class="accordion-item">
                                                                <h4 class="accordion-item-head">{% trans "Tickets Box Office" %}</h4>
                                                                <div class="accordion-item-content">
                                                                    {% if location.tickets_street_address %}
                                                                        <p>
                                                                            {{ location.tickets_street_address }}<br />
                                                                            {% if location.tickets_street_address2 %}{{ location.tickets_street_address2 }}<br />{% endif %}
                                                                            {% if location.tickets_city %}{{ location.tickets_postal_code }} {{ location.tickets_city }}<br />{% endif %}
                                                                        </p>
                                                                    {% endif %}
                                                                    {% if location.get_opening_hours %}
                                                                        <dl>
                                                                            {% for times in location.get_opening_hours %}
                                                                                <dt class="width_80">{{ times.weekday }}</dt>
                                                                                <dd>
                                                                                    {% if times.open %}
                                                                                        {{ times.open|time:"H:i" }} -
                                                                                            {% if times.break_open and times.break_close %}
                                                                                                {{ times.break_close|time:"H:i" }}, {{ times.break_open|time:"H:i" }} -
                                                                                            {% endif %}
                                                                                        {{ times.close|time:"H:i" }}
                                                                                    {% else %}
                                                                                        {% trans "Closed" %}
                                                                                    {% endif %}
                                                                                </dd>
                                                                            {% endfor %}
                                                                        </dl>
                                                                    {% endif %}
                                                                    {% if location.tickets_phone_number or location.tickets_fax_number or location.tickets_email or location.tickets_website %}
                                                                        {% if location.get_opening_hours %}<br/>{% endif %}
                                                                        <dl>
                                                                            {% if location.tickets_phone_number %}
                                                                                <dt class="width_50">{% trans "Phone" %}</dt>
                                                                                <dd><a class="phone" href="tel:{% if location.tickets_phone_country %}+{{ location.tickets_phone_country }}{% endif %}{{ location.tickets_phone_area }}{{ location.tickets_phone_number }}">{% if location.tickets_phone_country %}+{{ location.tickets_phone_country }}-{% endif %}{{ location.tickets_phone_area }}-{{ location.tickets_phone_number }}</a> {{ location.get_rendered_tickets_calling_prices }}
                                                                                </dd>
                                                                            {% endif %}
                                                                            {% if location.tickets_fax_number %}
                                                                                <dt class="width_50">{% trans "Fax" %}</dt>
                                                                                <dd>{% if location.tickets_fax_country %}+{{ location.tickets_fax_country }}-{% endif %}{{ location.tickets_fax_area }}-{{ location.tickets_fax_number }}</dd>
                                                                            {% endif %}
                                                                            {% if location.tickets_email %}
                                                                                <dt class="width_50">{% trans "Mail" %}</dt>
                                                                                <dd><a href="mailto:{{ location.tickets_email }}">{{ location.tickets_email }}</a></dd>
                                                                            {% endif %}
                                                                            {% if location.tickets_website %}
                                                                                <dt class="width_50">{% trans "Web" %}</dt>
                                                                                <dd><a href="{{ location.tickets_website }}">{{ location.tickets_website|humanize_url:30 }}</a></dd>
                                                                            {% endif %}
                                                                        </dl>
                                                                    {% endif %}
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    {% endif %}
                                                {% endwith %}
                                                {% if event.production.organizers or event.organizers %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Organizers" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {% if event.production.organizers %}
                                                                <p>{{ event.production.organizers }}</p>
                                                            {% endif %}
                                                            {% if event.organizers %}
                                                                <p>{{ event.organizers }}</p>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.production.in_cooperation_with %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "In cooperation with" %}</h4>
                                                        <div class="accordion-item-content">
                                                            <p>{{ event.production.in_cooperation_with }}</p>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.production.age_from or event.production.edu_offer_website or event.ev_or_prod_age_text %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Age" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {% if event.ev_or_prod_age_text %}
                                                                <p>{{ event.ev_or_prod_age_text|disarm_user_input }}</p>
                                                            {% endif %}
                                                            {% if event.production.age_from and event.production.age_till %}
                                                                <p>{{ event.production.age_from }}{% if event.production.age_till %} - {{ event.production.age_till }}{% endif %}</p>
                                                            {% endif %}
                                                            {% if event.production.edu_offer_website %}
                                                                <p><strong>Educational offer: </strong><a href="{{ event.production.edu_offer_website }}">{{ event.production.edu_offer_website|humanize_url:30 }}</a></p>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_pdfs %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Downloads" %}</h4>
                                                        <div class="accordion-item-content">
                                                            <p>
                                                                {% for pdf in event.ev_or_prod_pdfs %}
                                                                    {% with pdf.path|file_description as file_desc %}
                                                                        {% if file_desc.title %}
                                                                            <a class="pdf" href="{{ MEDIA_URL }}{{ pdf.path }}" target="_blank">{{ file_desc.title }}</a>
                                                                        {% elif file_desc.filename %}
                                                                            <a class="pdf" href="{{ MEDIA_URL }}{{ pdf.path }}" target="_blank">{{ file_desc.filename }}</a>
                                                                        {% else %}
                                                                            <a class="pdf" href="{{ MEDIA_URL }}{{ pdf.path }}" target="_blank">{{ pdf.path }}</a>
                                                                        {% endif %}
                                                                    {% endwith %}
                                                                {% endfor %}
                                                            </p>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                                    
                            <!-- additional content (accordion) -->
                            <div class="additional">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-xs-12 full">
                                            <div class="accordion accordion-autoclose content-accordion">
                                                {% if event.ev_or_prod_leaderships %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Staff" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {% comment %}
                                                            <dl>
                                                                {% for leadership in event.ev_or_prod_leaderships %}{% ifchanged leadership.function %}
                                                                    {% if leadership.function %}
                                                                        <dt>{{ leadership.function }}</dt>
                                                                    {% else %}
                                                                        <dt class="empty"></dt>
                                                                    {% endif %}<dd>{{ leadership.person }}</dd>{% else %}<dd class="series">{{ leadership.person }}</dd>{% endifchanged %}{% endfor %}
                                                            </dl>
                                                            {% endcomment %}
                                                            <dl>
                                                                {% regroup event.ev_or_prod_leaderships by get_function as leaderships %}
                                                                {% for leadership_function in leaderships %}
                                                                    {% if leadership_function.grouper %}
                                                                        <dt>{{ leadership_function.grouper }}</dt>
                                                                    {% else %}
                                                                        <dt class="empty"></dt>
                                                                    {% endif %}{% for leadership in leadership_function.list %}<dd{% if not forloop.first %} class="series"{% endif %}>{{ leadership.person }}</dd>{% endfor %}
                                                                {% endfor %}
                                                            </dl>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_involvements %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Cast" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {% comment %}
                                                            <dl>
                                                                {% for involvement in event.ev_or_prod_involvements %}{% ifchanged involvement.involvement_type.title involvement.involvement_role nvolvement.involvement_instrument %}
                                                                    {% if involvement.involvement_type.title or involvement.involvement_role or involvement.involvement_instrument %}
                                                                        <dt>{{ involvement.involvement_type.title }}{{ involvement.involvement_role }}{{ involvement.involvement_instrument }}</dt>
                                                                    {% else %}
                                                                        <dt class="empty" />
                                                                    {% endif %}<dd>{{ involvement.person }}</dd>{% else %}<dd class="series">{{ involvement.person }}</dd>{% endifchanged %}{% endfor %}
                                                            </dl>
                                                            {% endcomment %}
                                                            <dl>
                                                                {% regroup event.ev_or_prod_involvements by get_function as involvements %}
                                                                {% for involvement_function in involvements %}
                                                                    {% if involvement_function.grouper %}
                                                                        <dt>{{ involvement_function.grouper }}</dt>
                                                                    {% else %}
                                                                        <dt class="empty"></dt>
                                                                    {% endif %}{% for involvement in involvement_function.list %}<dd{% if not forloop.first %} class="series"{% endif %}>({{ involvement.imported_sort_order }} | {{ involvement.sort_order }}) {{ involvement.person }}</dd>{% endfor %}
                                                                {% endfor %}
                                                            </dl>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_authorships %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Authors" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {% comment %}
                                                            <dl>
                                                                {% for authorship in event.ev_or_prod_authorships %}{% ifchanged authorship.authorship_type.title %}
                                                                    {% if authorship.authorship_type.title %}
                                                                        <dt>{{ authorship.authorship_type.title }}</dt>
                                                                    {% else %}
                                                                        <dt class="empty"></dt>
                                                                    {% endif %}<dd>{{ authorship.person }}</dd>{% else %}<dd class="series">{{ authorship.person }}</dd>{% endifchanged %}{% endfor %}
                                                            </dl>
                                                            {% endcomment %}
                                                            <dl>
                                                                {% regroup event.ev_or_prod_authorships by get_function as authorships %}
                                                                {% for authorship_function in authorships %}
                                                                    {% if authorship_function.grouper %}
                                                                        <dt>{{ authorship_function.grouper }}</dt>
                                                                    {% else %}
                                                                        <dt class="empty"></dt>
                                                                    {% endif %}{% for authorship in authorship_function.list %}<dd{% if not forloop.first %} class="series"{% endif %}>{{ authorship.person }}</dd>{% endfor %}
                                                                {% endfor %}
                                                            </dl>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_sponsors %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Presented by" %}</h4>
                                                        <div class="accordion-item-content sponsor-content">
                                                            {% for sponsor in event.ev_or_prod_sponsors %}
                                                                <div class="sponsor">
                                                                    {% if sponsor.website %}
                                                                        <a href="{{ sponsor.website }}" target="_blank">
                                                                    {% endif %}
                                                                    {% if sponsor.image %}
                                                                        <img alt="{{ sponsor.title }}" src="{{ MEDIA_URL }}{{ sponsor.image.path }}" />
                                                                    {% else %}
                                                                        {{ sponsor.title }}
                                                                    {% endif %}
                                                                    {% if sponsor.website %}
                                                                        </a>
                                                                    {% endif %}
                                                                </div>
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_contents %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Contents" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {{ event.ev_or_prod_contents|disarm_user_input }}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_concert_program %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Concert program" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {{ event.ev_or_prod_concert_program|disarm_user_input }}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_supporting_programm %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Supporting program" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {{ event.ev_or_prod_supporting_programm|disarm_user_input }}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_work_info %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Work info" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {{ event.ev_or_prod_work_info|disarm_user_input }}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_press_text %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Press text" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {{ event.ev_or_prod_press_text|disarm_user_input }}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_remarks %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Remarks" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {{ event.ev_or_prod_remarks|disarm_user_input }}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                {% if event.ev_or_prod_credits %}
                                                    <div class="accordion-item">
                                                        <h4 class="accordion-item-head">{% trans "Credits" %}</h4>
                                                        <div class="accordion-item-content">
                                                            {{ event.ev_or_prod_credits|disarm_user_input }}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            </div>
                                            
                                            <!-- Gallery -->
                                            {% if event.ev_or_prod_videos or event.ev_or_prod_images%}
                                                <div class="gallery row">
                                                    <h4 class="gallery-head">{% trans "Gallery" %}</h4>
                                                    {% if event.ev_or_prod_videos %}
                                                        {% for video in event.ev_or_prod_videos %}
                                                            <div class="col-xs-12 col-md-8 video gallery-item">{{ video.get_embed|safe }}</div>
                                                        {% endfor %}
                                                    {% endif %}
                                                    {% if event.ev_or_prod_images %}
                                                        {% for image in event.ev_or_prod_images %}
                                                            <div class="col-xs-12 col-sm-6 col-md-4 image gallery-item img">
                                                                {% with image.path|file_description as file_desc %}
                                                                    <img class="gallery-image" src="{{ STATIC_URL }}site/img/placeholder_rectangle.gif" data-original="{{ MEDIA_URL }}{{ image.path|modified_path:"gallery_image" }}" alt="{% if file_desc.description %}{{ file_desc.description|escape }}{% endif %}" width="100%" data-image-big="{{ MEDIA_URL }}{{ image.path }}" />
                                                                    <div class="gallery-image-text">
                                                                        <div class="gallery-image-text-description">
                                                                            {% if file_desc.title %}
                                                                                <span class="gallery-image-text-description-title">{{ file_desc.title }}</span>
                                                                            {% endif %}
                                                                            {% if file_desc.description %}
                                                                                <span class="gallery-image-text-description-copy">{{ file_desc.description }}</span>
                                                                            {% endif %}
                                                                            {% if file_desc.author %}
                                                                                <span class="gallery-image-text-description-author">{% trans "Photo" %}: {{ file_desc.author }}</span>
                                                                            {% endif %}
                                                                        </div>
                                                                        {% if file_desc.copyright_limitations %}
                                                                            <div class="gallery-image-text-copyright">{% trans "Copyright" %}: {{ file_desc.copyright_limitations }}</div>
                                                                        {% endif %}
                                                                    </div>
                                                                {% endwith %}
                                                            </div>
                                                        {% endfor %}
                                                    {% endif %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </article>
                        
                        <!-- event slider -->
                        {% other_productions current_event=event %}
                    </div>
                </div>
            </div>
        </div>
    {% endwith %}
    {% include "utils/page_controls.html" %}
{% endblock %}