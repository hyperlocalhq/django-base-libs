{% extends "productions/events/base.html" %}
{% load crispy_forms_tags i18n %}

{% block stylesheet %}
    {{ block.super }}
    <link href="{{ STATIC_URL }}site/js/autocomplete_1.0/jquery.autocomplete.css" rel="stylesheet" />
{% endblock %}

{% block js %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}site/js/autocomplete_1.0/jquery.bgiframe.min.js"></script>
    <script src="{{ STATIC_URL }}site/js/autocomplete_1.0/jquery.autocomplete.js"></script>
    <script src="{{ STATIC_URL }}site/js/autocomplete.js"></script>
{% endblock %}

{% block event_tabs %}
    <li class="active"><a class="txt" href="{% url "change_event_basic_info" slug=production.slug event_id=event.pk %}"> {% trans "Details" %} </a></li>
    <li><a class="txt" href="{% url "change_event_description" slug=production.slug event_id=event.pk %}"> {% trans "Description" %} </a></li>
    <li><a class="txt" href="{% url "change_event_gallery" slug=production.slug event_id=event.pk %}"> {% trans "Media" %} </a></li>
{% endblock %}

{% block multistep_form %}
    {% crispy form %}
    <script src="http://maps.google.com/maps/api/js?sensor=false&amp;language={{ LANGUAGE_CODE }}&amp;region=DE"></script>
    <script src="{{ STATIC_URL }}site/js/locating.min.js"></script>
    <script src="{{ STATIC_URL }}site/js/checkbox-tree.js"></script>
    <script>
        $(function() {
            $('body').on('change', '.autocomplete-light-widget select[name$=play_locations]', function() {
                var $this = $(this);
                var stagesSelectElement = $('#' + $this.attr('id').replace('play_locations', 'play_stages'));
                var stagesWidgetElement = stagesSelectElement.closest('.autocomplete-light-widget');

                // When the country select changes
                values = $this.val();

                if (values) {
                    // If value is contains something, add it to autocomplete.data
                    stagesWidgetElement.yourlabsWidget().autocomplete.data = {
                        'location_ids': values.join(',')
                    };
                } else {
                    // If value is empty, empty autocomplete.data
                    stagesWidgetElement.yourlabsWidget().autocomplete.data = {};
                }

                // example debug statements, that does not replace using breakbpoints and a proper debugger but can hel
                // console.log($(this), 'changed to', value);
                // console.log(regionWidgetElement, 'data is', regionWidgetElement.yourlabsWidget().autocomplete.data)
            });
        });
    </script>
{% endblock %}
