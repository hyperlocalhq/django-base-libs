{% load base_tags i18n image_modifications fb_tags %}
{% if article.get_related_productions %}
    <div class="row theater-of-the-week-productions">
    {% for prod in article.get_related_productions %}
        <div class="col-md-6">
            {% with event=prod.get_nearest_occurrence %}
                {% with im=event.first_image %}
                    {% if im.path %}
                        <a href="{{ event.get_url_path }}">
                            <div class="photo-credits-wrapper">
                                <img src="{{ MEDIA_URL }}{{ im.path|modified_path:"detail_image" }}" alt="{{ prod.title|escape }}" class="img-responsive" />
                                {% with im.path|file_description as file_desc %}
                                    {% if file_desc.author %}
                                        <span class="photo-credits-over">{% trans "Photo" %}: {{ file_desc.author }}</span>
                                    {% endif %}
                                {% endwith %}
                            </div>
                        </a>
                        <br />
                    {% endif %}
                    <h4>{{ prod.title }}</h4>
                    {% if prod.subtitle %}<h5>{{ prod.subtitle }}</h5>{% endif %}
                    {% if event.ev_or_prod_language_and_subtitles %}<p><strong>{{ event.ev_or_prod_language_and_subtitles.title }}</strong></p>{% endif %}
                    {{ event.ev_or_prod_teaser }}
                    {% with future_events=prod.get_future_occurrences %}
                        {% if future_events %}
                            <p>
                                <strong>
                                    {% trans "Events" %}:
                                    {% for ev in future_events|slice:":4" %}
                                        {% if forloop.counter < 4 %}
                                            <span class="date">{{ ev.start_date|date:"j.n.Y" }}</span>
                                            <span class="time">{{ ev.start_time|time:"H:i" }}</span>{% if ev.get_special_text %}
                                            {{ ev.get_special_text }}{% endif %}{% if not forloop.last %}{% if forloop.counter < 3 %}<span>, </span>{% endif %}{% endif %}
                                        {% else %}
                                             â€¦
                                        {% endif %}
                                    {% endfor %}
                                </strong>
                            </p>
                        {% endif %}
                    {% endwith %}
                    <p class="text-right"><strong><a href="{{ event.get_url_path }}">&gt; {% trans "More" %}</a></strong></p>
                {% endwith %}
            {% endwith %}
        </div>
        {% if not forloop.counter0|divisibleby:"2" %}
            </div>
            <br />
            <div class="row">
        {% endif %}
    {% endfor %}
    </div>
{% endif %}
