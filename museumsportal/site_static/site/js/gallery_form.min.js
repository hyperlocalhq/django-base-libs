(function(a,d){function b(){lazyload_images();var e=false;a("#photos").each(function(){var f=a(this).data("load-url");a(this).load(f+" #photos>*",function(){a("#photos").sortable({start:function(){e=true},stop:function(){setTimeout(function(){e=false},500)},placeholder:"ui-state-highlight",update:function(g,h){var i=[];a(".photo","#photos").each(function(){if(a(this).data("token")){i[i.length]=a(this).data("token")}});a.post(f,{ordering:i.join(",")})},forcePlaceholderSize:true,create:function(){var h=this;var g=function(){a(h).css("height","auto")};a(h).find("img").load(g).error(g)}});a("#photos").disableSelection().find(".edit").click(function(){if(e){return false}a("#edit_photo").load(a(this).attr("href")+" #edit_photo form",c);a("#photos").parents("fieldset:first").hide();a(".form-actions:last").hide();return false});a("#add_photo").click(function(){a("#edit_photo").load(a(this).attr("href")+" #edit_photo form",c);a("#photos").parents("fieldset:first").hide();a(".form-actions:last").hide();return false});a("#photos").find(".crop").each(function(){if(a(this).attr("href")){a(this).attr("href",a(this).attr("href").replace(/goto_next=.+$/gim,"goto_next="+location.href))}});a(window).trigger("scrollstop")})});a("#photos").parents("fieldset:first").show();a(".form-actions:last").show()}a(document).on("click","#crop_list_image",function(){location.href=a("#photos").find(".crop_list_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href);return false});a(document).on("click","#crop_cover_image",function(){location.href=a("#photos").find(".crop_cover_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href);return false});function c(){a("textarea").autosize();a("#button-id-cancel").click(function(){a("#edit_photo").html("");b()});a("#button-id-crop-photo").click(function(){location.href=a(this).data("href").replace(/goto_next=.+$/,"goto_next="+location.href)});a("#button-id-delete-photo").click(function(){var g=a(this).data("href");a("#deleteConfirmation").removeClass("hide").modal("show");a("#button-id-confirm-deletion").click(function(){a.post(g,{},function(){a("#deleteConfirmation").modal("hide");a("#edit_photo").html("");b()});return false})});a("#edit_photo form").attr("target","hidden_iframe");self.hidden_iframe_loaded=function(h){var g=a("<div>"+h+"</div>").find("form");if(g.length){a("#edit_photo").html("").append(g);c()}else{a("#edit_photo").html("");b()}};var e=a.extend(translatable_file_uploader_options,{allowedExtensions:["gif","jpg","png","tif","bmp"],action:"/"+self.settings.lang+"/helper/ajax-upload/",element:a("#image_uploader")[0],multiple:false,onComplete:function(i,h,g){if(g.success){a(".messages").html("");a("#id_media_file_path").val(g.path);a.post("/"+self.settings.lang+"/helper/modified-path/",{file_path:self.settings.media_url+g.path,mod_sysname:"medium"},function(k,l,j){a("#image_preview").html('<img class="img-responsive" alt="" src="'+k+'" />');a("#image_uploader").hide();a("#image_help_text").hide()},"text")}},onAllComplete:function(g){a(".qq-upload-success").fadeOut("slow",function(){a(this).remove()})},params:{csrf_token:a('input[name="csrfmiddlewaretoken"]').val(),csrf_name:"csrfmiddlewaretoken",csrf_xname:"X-CSRFToken"},showMessage:function(g){a(".messages").html('<div class="alert alert-danger">'+g+"</div>")}});var f=new qq.FileUploader(e)}a(function(){b()})})(jQuery);