!function(n,t){function o(){lazyload_images();var t=!1;n("#photos").each(function(){var i=n(this).data("load-url");n(this).load(i+" #photos>*",function(){n("#photos").sortable({start:function(){t=!0},stop:function(){setTimeout(function(){t=!1},500)},placeholder:"ui-state-highlight",update:function(t,e){var o=[];n(".photo","#photos").each(function(){n(this).data("token")&&(o[o.length]=n(this).data("token"))}),n.post(i,{ordering:o.join(",")})},forcePlaceholderSize:!0,create:function(){var t=this,e=function(){n(t).css("height","auto")};n(t).find("img").load(e).error(e)}}),n("#photos").disableSelection().find(".edit").click(function(){return t||(n("#edit_photo").load(n(this).attr("href")+" #edit_photo form",a),n("#photos").parents("fieldset:first").hide(),n(".form-actions:last").hide()),!1}),n("#add_photo").click(function(){return n("#edit_photo").load(n(this).attr("href")+" #edit_photo form",a),n("#photos").parents("fieldset:first").hide(),n(".form-actions:last").hide(),!1}),n("#photos").find(".crop").each(function(){n(this).attr("href")&&n(this).attr("href",n(this).attr("href").replace(/goto_next=.+$/gim,"goto_next="+location.href))}),n(window).trigger("scrollstop")})}),n("#photos").parents("fieldset:first").show(),n(".form-actions:last").show()}function a(){n("textarea").autosize(),n("#button-id-cancel").click(function(){n("#edit_photo").html(""),o()}),n("#button-id-crop-photo").click(function(){location.href=n(this).data("href").replace(/goto_next=.+$/,"goto_next="+location.href)}),n("#button-id-delete-photo").click(function(){var t=n(this).data("href");n("#deleteConfirmation").removeClass("hide").modal("show"),n("#button-id-confirm-deletion").click(function(){return n.post(t,{},function(){n("#deleteConfirmation").modal("hide"),n("#edit_photo").html(""),o()}),!1})}),n("#edit_photo form").attr("target","hidden_iframe"),self.hidden_iframe_loaded=function(t){var e=n("<div>"+t+"</div>").find("form");e.length?(n("#edit_photo").html("").append(e),a()):(n("#edit_photo").html(""),o())};var t=n.extend(translatable_file_uploader_options,{allowedExtensions:["gif","jpg","png","tif","bmp"],action:"/"+self.settings.lang+"/helper/ajax-upload/",element:n("#image_uploader")[0],multiple:!1,onComplete:function(t,e,o){o.success&&(n(".messages").html(""),n("#id_media_file_path").val(o.path),n.post("/"+self.settings.lang+"/helper/modified-path/",{file_path:self.settings.MEDIA_URL+o.path,mod_sysname:"medium"},function(t,e,o){n("#image_preview").html('<img class="img-responsive" alt="" src="'+t+'" />'),n("#image_uploader").hide(),n("#image_help_text").hide()},"text"))},onAllComplete:function(t){n(".qq-upload-success").fadeOut("slow",function(){n(this).remove()})},params:{csrf_token:n('input[name="csrfmiddlewaretoken"]').val(),csrf_name:"csrfmiddlewaretoken",csrf_xname:"X-CSRFToken"},showMessage:function(t){n(".messages").html('<div class="alert alert-danger">'+t+"</div>")}}),e=new qq.FileUploader(t);n(function(){n("select").not('[name*="__prefix__"]').selectbox()})}n(document).on("click","#crop_list_image",function(){return location.href=n("#photos").find(".crop_list_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href),!1}),n(document).on("click","#crop_cover_image",function(){return location.href=n("#photos").find(".crop_cover_image:first").attr("href").replace(/goto_next=.+$/,"goto_next="+location.href),!1}),n(function(){o()})}(jQuery);