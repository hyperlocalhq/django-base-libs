!function(f,t){var h="selectbox",_=!1,x=!0;function s(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}f.extend(s.prototype,{_isOpenSelectbox:function(s){return s?this._getInst(s).isOpen:_;var e},_isDisabledSelectbox:function(s){return s?this._getInst(s).isDisabled:_;var e},_attachSelectbox:function(l,s){if(this._getInst(l))return _;var e=f(l),d=this,o=d._newInst(e),t,c,r,u,p=_,i=e.find("optgroup"),a=e.find("option"),b=a.length;function n(){var s,e,t=this.attr("id").split("_")[1];for(s in d._state)s!==t&&d._state.hasOwnProperty(s)&&(e=f("select[sb='"+s+"']")[0])&&d._closeSelectbox(e)}function g(){var a=!(!arguments[1]||!arguments[1].sub),n=!(!arguments[1]||!arguments[1].disabled);arguments[0].each(function(s){var e=f(this),t=f("<li>"),i;e.is(":selected")&&(c.text(e.text()),p=x),s===b-1&&t.addClass("last"),e.is(":disabled")||n?(i=f("<span>",{text:e.text()}).addClass(o.settings.classDisabled),a&&i.addClass(o.settings.classSub)):(i=f("<a>",{href:"#"+e.val(),rel:e.val()}).text(e.text()).bind("click.sb",function(s){s&&s.preventDefault&&s.preventDefault();var e=r,t=f(this),i=e.attr("id").split("_")[1];d._changeSelectbox(l,t.attr("rel"),t.text()),d._closeSelectbox(l)}).bind("mouseover.sb",function(){var s=f(this);s.parent().siblings().find("a").removeClass(o.settings.classFocus),s.addClass(o.settings.classFocus)}).bind("mouseout.sb",function(){f(this).removeClass(o.settings.classFocus)}),a&&i.addClass(o.settings.classSub),e.is(":selected")&&i.addClass(o.settings.classFocus)),i.appendTo(t),t.appendTo(u)})}e.attr("sb",o.uid),f.extend(o.settings,d._defaults,s),d._state[o.uid]=_,e.hide(),t=f("<div>",{id:"sbHolder_"+o.uid,class:o.settings.classHolder,tabindex:e.attr("tabindex")}),c=f("<a>",{id:"sbSelector_"+o.uid,href:"#",class:o.settings.classSelector,click:function(s){s.preventDefault(),n.apply(f(this),[]);var e=f(this).attr("id").split("_")[1];d._state[e]?d._closeSelectbox(l):d._openSelectbox(l)}}),(r=f("<a>",{id:"sbToggle_"+o.uid,href:"#",class:o.settings.classToggle,click:function(s){s.preventDefault(),n.apply(f(this),[]);var e=f(this).attr("id").split("_")[1];d._state[e]?d._closeSelectbox(l):d._openSelectbox(l)}})).appendTo(t),u=f("<ul>",{id:"sbOptions_"+o.uid,class:o.settings.classOptions,css:{display:"none"}}),e.children().each(function(s){var e=f(this),t,i={};e.is("option")?g(e):e.is("optgroup")&&(t=f("<li>"),f("<span>",{text:e.attr("label")}).addClass(o.settings.classGroup).appendTo(t),t.appendTo(u),e.is(":disabled")&&(i.disabled=!0),i.sub=!0,g(e.find("option"),i))}),p||c.text(a.first().text()),f.data(l,h,o),t.data("uid",o.uid).bind("keydown.sb",function(s){var e=s.charCode?s.charCode:s.keyCode?s.keyCode:0,t=f(this),i=t.data("uid"),a=t.siblings("select[sb='"+i+"']").data(h),n=t.siblings(["select[sb='",i,"']"].join("")).get(0),l=t.find("ul").find("a."+a.settings.classFocus);switch(e){case 37:case 38:var o;if(0<l.length)f("a",t).removeClass(a.settings.classFocus),0<(o=l.parent().prevAll("li:has(a)").eq(0).find("a")).length&&(o.addClass(a.settings.classFocus).focus(),f("#sbSelector_"+i).text(o.text()));break;case 39:case 40:var o;f("a",t).removeClass(a.settings.classFocus),0<(o=0<l.length?l.parent().nextAll("li:has(a)").eq(0).find("a"):t.find("ul").find("a").eq(0)).length&&(o.addClass(a.settings.classFocus).focus(),f("#sbSelector_"+i).text(o.text()));break;case 13:0<l.length&&d._changeSelectbox(n,l.attr("rel"),l.text()),d._closeSelectbox(n);break;case 9:var a;if(n)(a=d._getInst(n))&&(0<l.length&&d._changeSelectbox(n,l.attr("rel"),l.text()),d._closeSelectbox(n));var c=parseInt(t.attr("tabindex"),10);s.shiftKey?c--:c++,f("*[tabindex='"+c+"']").focus();break;case 27:d._closeSelectbox(n)}return s.stopPropagation(),!1}).delegate("a","mouseover",function(s){f(this).addClass(o.settings.classFocus)}).delegate("a","mouseout",function(s){f(this).removeClass(o.settings.classFocus)}),c.appendTo(t),u.appendTo(t),t.insertAfter(e),f("html").on("mousedown",function(s){s.stopPropagation(),f("select").selectbox("close")}),f([".",o.settings.classHolder,", .",o.settings.classSelector].join("")).mousedown(function(s){s.stopPropagation()})},_detachSelectbox:function(s){var e=this._getInst(s);if(!e)return _;f("#sbHolder_"+e.uid).remove(),f.data(s,h,null),f(s).show()},_changeSelectbox:function(s,e,t){var i,a=this._getInst(s);a&&(i=this._get(a,"onChange"),f("#sbSelector_"+a.uid).text(t)),e=e.replace(/\'/g,"\\'"),f(s).find("option[value='"+e+"']").attr("selected",x),a&&i?i.apply(a.input?a.input[0]:null,[e,a]):a&&a.input&&a.input.trigger("change")},_enableSelectbox:function(s){var e=this._getInst(s);if(!e||!e.isDisabled)return _;f("#sbHolder_"+e.uid).removeClass(e.settings.classHolderDisabled),e.isDisabled=_,f.data(s,h,e)},_disableSelectbox:function(s){var e=this._getInst(s);if(!e||e.isDisabled)return _;f("#sbHolder_"+e.uid).addClass(e.settings.classHolderDisabled),e.isDisabled=x,f.data(s,h,e)},_optionSelectbox:function(s,e,t){var i=this._getInst(s);if(!i)return _;i[e]=t,f.data(s,h,i)},_openSelectbox:function(s){var e=this._getInst(s);if(e&&!e.isOpen&&!e.isDisabled){var t=f("#sbOptions_"+e.uid),i=parseInt(f(window).height(),10),a=f("#sbHolder_"+e.uid).offset(),n=f(window).scrollTop(),l=t.prev().height(),o=i-(a.top-n)-l/2,c=this._get(e,"onOpen");t.css({top:l+"px",maxHeight:o-l+"px"}),"fade"===e.settings.effect?t.fadeIn(e.settings.speed):t.slideDown(e.settings.speed),f("#sbToggle_"+e.uid).addClass(e.settings.classToggleOpen),this._state[e.uid]=x,e.isOpen=x,c&&c.apply(e.input?e.input[0]:null,[e]),f.data(s,h,e)}},_closeSelectbox:function(s){var e=this._getInst(s);if(e&&e.isOpen){var t=this._get(e,"onClose");"fade"===e.settings.effect?f("#sbOptions_"+e.uid).fadeOut(e.settings.speed):f("#sbOptions_"+e.uid).slideUp(e.settings.speed),f("#sbToggle_"+e.uid).removeClass(e.settings.classToggleOpen),this._state[e.uid]=_,e.isOpen=_,t&&t.apply(e.input?e.input[0]:null,[e]),f.data(s,h,e)}},_newInst:function(s){var e;return{id:s[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:s,uid:Math.floor(99999999*Math.random()),isOpen:_,isDisabled:_,settings:{}}},_getInst:function(s){try{return f.data(s,h)}catch(s){throw"Missing instance data for this selectbox"}},_get:function(s,e){return s.settings[e]!==t?s.settings[e]:this._defaults[e]}}),f.fn.selectbox=function(s){var e=Array.prototype.slice.call(arguments,1);return"string"==typeof s&&"isDisabled"==s?f.selectbox["_"+s+"Selectbox"].apply(f.selectbox,[this[0]].concat(e)):"option"==s&&2==arguments.length&&"string"==typeof arguments[1]?f.selectbox["_"+s+"Selectbox"].apply(f.selectbox,[this[0]].concat(e)):this.each(function(){"string"==typeof s?f.selectbox["_"+s+"Selectbox"].apply(f.selectbox,[this].concat(e)):f.selectbox._attachSelectbox(this,s)})},f.selectbox=new s,f.selectbox.version="0.2"}(jQuery);