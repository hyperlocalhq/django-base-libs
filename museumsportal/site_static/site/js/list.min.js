!function(t,e){function a(){var e=t("#container").css("position","relative");if(l&&l.length){for(l.addClass("item-preview"),o&&o.removeClass("first_item_on_next_row"),o=l.nextAll(".item:visible:first");o.length&&l.position().top>=o.position().top;)o=o.nextAll(".item:visible:first");o.length&&o.addClass("first_item_on_next_row");var a=l.find(".description"),i=l.position().left,r=e.width(),n=parseInt(e.css("margin-left"),10),s=parseInt(e.css("margin-right"),10);a.css({left:-i-10,width:r+n+s})}}function i(){return l&&l.hasClass("item-preview")?(l.removeClass("item-preview"),o&&(o.removeClass("first_item_on_next_row"),o=null),l=null,lazyload_images(),!1):void 0}function r(){if(!navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|Opera Mini|webOS/i)){var e=t(".pagination").removeClass("item").hide(),a=t("#container").data("jscroll",null);e.length&&a.jscroll({loadingHtml:"<small>Loading...</small>",padding:100,contentSelector:"#container .grid,#container .list",nextSelector:".next_page:last",pagingSelector:".pagination",callback:function(){t(".pagination").removeClass("item").hide(),lazyload_images()}})}}var n="click";navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|Opera Mini|webOS/i)&&(n="touchstart");var l,o;t(function(){r(),t("#map-list-link").click(function(){return location.href=t(this).attr("href")+location.hash,!1}),t("#container").on("contextmenu taphold",".item>a",function(e){e.preventDefault();var r=t(this).closest(".item");if(r.hasClass("item-preview"))return i(),!1;l&&i(),l=r;var n=l.find(".description");return t.trim(n.text())?a():n.load(l.data("description-src"),function(){a(),window.init_share&&window.init_share()}),!1}).on("click",".item .cancel",function(t){t.preventDefault(),i()})}),t(window).bind("smartresize",a),t(window).load(function(){var e=t("#container"),a={};if(e.length){var i=t("#filters"),l=t("#filter-summary"),o={},s=!1;t(".panel-collapse",i).on("show.bs.collapse",function(e){t.bbq.pushState({filter_section:t(e.target).attr("id").replace(/^filter-/,"")})});var c=t.bbq.getState();c.filter_section&&(t("#toggle-list-filter").click(),t('.btn[data-target="#filter-'+c.filter_section+'"]',i).click()),t(".filter a").on(n,function(i,c){if(i.preventDefault(),!s||c){s=!0;var d=t(this),f=d.closest("li"),v=d.closest(".option-set"),p=v.attr("data-filter-group");a[p]=a[p]||[];var u=d.attr("data-filter-value"),g=v.attr("data-single-selection"),m=v.attr("data-hierarchical"),h=parseInt(f.attr("data-level"),10),w=d.attr("data-level-1-at"),_=d.attr("data-target"),b;w?b=t(w):1===h&&(b=d.closest(".level-1-container"));var y=f.data("param"),C=f.data("value");if(u)if(f.hasClass("active"))f.removeClass("active"),b&&0===h&&(t("li.active>a",b).trigger(n,[!0]),t("ul.in",b).removeClass("in")),a[p]=t.grep(a[p],function(t){return t!==u}),t('li[data-param="'+y+'"]',l).remove(),1===l.children().length&&l.empty(),o[y]=!1;else{m?g?0===h?(t("li.active>a",v).trigger(n,[!0]),b&&t("ul.in",b).removeClass("in"),a[p]=[u]):(b&&t("li.active>a",b).trigger(n,[!0]),a[p].push(u)):a[p].push(u):g?(t("li.active>a",v).trigger(n,[!0]),a[p]=[u]):a[p].push(u),o[y]=C,f.addClass("active"),b&&t(_,b).addClass("in");var x;""===l.text().trim()&&(x=t("<li><b>"+window.str_filter_selection+":</b></li>"),l.append(x)),x=t('<li data-filter-group="'+p+'" data-filter-value="'+u+'" data-param="'+y+'" data-value="'+C+'"><a href="">'+d.text()+"</a></li>"),l.append(x),l.css("display","block")}var k=[];for(var S in a)for(var j=0;j<a[S].length;j++){var A=a[S][j].replace(/\./,"");k.push(A)}o.page="";var P="?"+window.append_to_get(o,!0);return window.history.pushState({},document.title,P),c?s=!1:(t("#container").jscroll.destroy&&t("#container").jscroll.destroy(),t("#container").load(P+" #container>*",function(){r(),setTimeout(function(){lazyload_images(),s=!1},500)})),e.trigger("map_filter",{filter:k}),!1}}),l.on(n,"a",function(e){e.preventDefault();var a=t(this).closest("li"),r=a.data("param"),l=a.data("value");r?t('li.active[data-param="'+r+'"][data-value="'+l+'"]>a',i).trigger(n):t("li.active>a",i).trigger(n)}),t("#filter-reset").on(n,function(e){e.preventDefault(),t(t("li.active>a",i).get().reverse()).trigger(n,[!0]),t("#container").jscroll.destroy&&t("#container").jscroll.destroy(),t("#container").load("? #container>*",function(){r(),lazyload_images()})})}}),t(window).load(function(){setTimeout(function(){t("body").removeClass("no-transition")},1e3)})}(jQuery);